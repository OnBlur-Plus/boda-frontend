<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite + React + TS</title>
    <script type="module" crossorigin>(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();var pl={exports:{}},Ri={},yl={exports:{}},Re={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yf;function Om(){if(yf)return Re;yf=1;var l=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),a=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),p=Symbol.iterator;function v(w){return w===null||typeof w!="object"?null:(w=p&&w[p]||w["@@iterator"],typeof w=="function"?w:null)}var T={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E=Object.assign,S={};function A(w,$,re){this.props=w,this.context=$,this.refs=S,this.updater=re||T}A.prototype.isReactComponent={},A.prototype.setState=function(w,$){if(typeof w!="object"&&typeof w!="function"&&w!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,w,$,"setState")},A.prototype.forceUpdate=function(w){this.updater.enqueueForceUpdate(this,w,"forceUpdate")};function R(){}R.prototype=A.prototype;function k(w,$,re){this.props=w,this.context=$,this.refs=S,this.updater=re||T}var D=k.prototype=new R;D.constructor=k,E(D,A.prototype),D.isPureReactComponent=!0;var N=Array.isArray,P=Object.prototype.hasOwnProperty,V={current:null},U={key:!0,ref:!0,__self:!0,__source:!0};function j(w,$,re){var ce,Ee={},Te=null,Ae=null;if($!=null)for(ce in $.ref!==void 0&&(Ae=$.ref),$.key!==void 0&&(Te=""+$.key),$)P.call($,ce)&&!U.hasOwnProperty(ce)&&(Ee[ce]=$[ce]);var Ie=arguments.length-2;if(Ie===1)Ee.children=re;else if(1<Ie){for(var Pe=Array(Ie),Tt=0;Tt<Ie;Tt++)Pe[Tt]=arguments[Tt+2];Ee.children=Pe}if(w&&w.defaultProps)for(ce in Ie=w.defaultProps,Ie)Ee[ce]===void 0&&(Ee[ce]=Ie[ce]);return{$$typeof:l,type:w,key:Te,ref:Ae,props:Ee,_owner:V.current}}function ee(w,$){return{$$typeof:l,type:w.type,key:$,ref:w.ref,props:w.props,_owner:w._owner}}function H(w){return typeof w=="object"&&w!==null&&w.$$typeof===l}function Q(w){var $={"=":"=0",":":"=2"};return"$"+w.replace(/[=:]/g,function(re){return $[re]})}var ge=/\/+/g;function te(w,$){return typeof w=="object"&&w!==null&&w.key!=null?Q(""+w.key):$.toString(36)}function de(w,$,re,ce,Ee){var Te=typeof w;(Te==="undefined"||Te==="boolean")&&(w=null);var Ae=!1;if(w===null)Ae=!0;else switch(Te){case"string":case"number":Ae=!0;break;case"object":switch(w.$$typeof){case l:case e:Ae=!0}}if(Ae)return Ae=w,Ee=Ee(Ae),w=ce===""?"."+te(Ae,0):ce,N(Ee)?(re="",w!=null&&(re=w.replace(ge,"$&/")+"/"),de(Ee,$,re,"",function(Tt){return Tt})):Ee!=null&&(H(Ee)&&(Ee=ee(Ee,re+(!Ee.key||Ae&&Ae.key===Ee.key?"":(""+Ee.key).replace(ge,"$&/")+"/")+w)),$.push(Ee)),1;if(Ae=0,ce=ce===""?".":ce+":",N(w))for(var Ie=0;Ie<w.length;Ie++){Te=w[Ie];var Pe=ce+te(Te,Ie);Ae+=de(Te,$,re,Pe,Ee)}else if(Pe=v(w),typeof Pe=="function")for(w=Pe.call(w),Ie=0;!(Te=w.next()).done;)Te=Te.value,Pe=ce+te(Te,Ie++),Ae+=de(Te,$,re,Pe,Ee);else if(Te==="object")throw $=String(w),Error("Objects are not valid as a React child (found: "+($==="[object Object]"?"object with keys {"+Object.keys(w).join(", ")+"}":$)+"). If you meant to render a collection of children, use an array instead.");return Ae}function fe(w,$,re){if(w==null)return w;var ce=[],Ee=0;return de(w,ce,"","",function(Te){return $.call(re,Te,Ee++)}),ce}function oe(w){if(w._status===-1){var $=w._result;$=$(),$.then(function(re){(w._status===0||w._status===-1)&&(w._status=1,w._result=re)},function(re){(w._status===0||w._status===-1)&&(w._status=2,w._result=re)}),w._status===-1&&(w._status=0,w._result=$)}if(w._status===1)return w._result.default;throw w._result}var he={current:null},q={transition:null},z={ReactCurrentDispatcher:he,ReactCurrentBatchConfig:q,ReactCurrentOwner:V};function K(){throw Error("act(...) is not supported in production builds of React.")}return Re.Children={map:fe,forEach:function(w,$,re){fe(w,function(){$.apply(this,arguments)},re)},count:function(w){var $=0;return fe(w,function(){$++}),$},toArray:function(w){return fe(w,function($){return $})||[]},only:function(w){if(!H(w))throw Error("React.Children.only expected to receive a single React element child.");return w}},Re.Component=A,Re.Fragment=t,Re.Profiler=s,Re.PureComponent=k,Re.StrictMode=r,Re.Suspense=d,Re.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=z,Re.act=K,Re.cloneElement=function(w,$,re){if(w==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+w+".");var ce=E({},w.props),Ee=w.key,Te=w.ref,Ae=w._owner;if($!=null){if($.ref!==void 0&&(Te=$.ref,Ae=V.current),$.key!==void 0&&(Ee=""+$.key),w.type&&w.type.defaultProps)var Ie=w.type.defaultProps;for(Pe in $)P.call($,Pe)&&!U.hasOwnProperty(Pe)&&(ce[Pe]=$[Pe]===void 0&&Ie!==void 0?Ie[Pe]:$[Pe])}var Pe=arguments.length-2;if(Pe===1)ce.children=re;else if(1<Pe){Ie=Array(Pe);for(var Tt=0;Tt<Pe;Tt++)Ie[Tt]=arguments[Tt+2];ce.children=Ie}return{$$typeof:l,type:w.type,key:Ee,ref:Te,props:ce,_owner:Ae}},Re.createContext=function(w){return w={$$typeof:a,_currentValue:w,_currentValue2:w,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},w.Provider={$$typeof:o,_context:w},w.Consumer=w},Re.createElement=j,Re.createFactory=function(w){var $=j.bind(null,w);return $.type=w,$},Re.createRef=function(){return{current:null}},Re.forwardRef=function(w){return{$$typeof:c,render:w}},Re.isValidElement=H,Re.lazy=function(w){return{$$typeof:g,_payload:{_status:-1,_result:w},_init:oe}},Re.memo=function(w,$){return{$$typeof:h,type:w,compare:$===void 0?null:$}},Re.startTransition=function(w){var $=q.transition;q.transition={};try{w()}finally{q.transition=$}},Re.unstable_act=K,Re.useCallback=function(w,$){return he.current.useCallback(w,$)},Re.useContext=function(w){return he.current.useContext(w)},Re.useDebugValue=function(){},Re.useDeferredValue=function(w){return he.current.useDeferredValue(w)},Re.useEffect=function(w,$){return he.current.useEffect(w,$)},Re.useId=function(){return he.current.useId()},Re.useImperativeHandle=function(w,$,re){return he.current.useImperativeHandle(w,$,re)},Re.useInsertionEffect=function(w,$){return he.current.useInsertionEffect(w,$)},Re.useLayoutEffect=function(w,$){return he.current.useLayoutEffect(w,$)},Re.useMemo=function(w,$){return he.current.useMemo(w,$)},Re.useReducer=function(w,$,re){return he.current.useReducer(w,$,re)},Re.useRef=function(w){return he.current.useRef(w)},Re.useState=function(w){return he.current.useState(w)},Re.useSyncExternalStore=function(w,$,re){return he.current.useSyncExternalStore(w,$,re)},Re.useTransition=function(){return he.current.useTransition()},Re.version="18.3.1",Re}var vf;function ru(){return vf||(vf=1,yl.exports=Om()),yl.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ef;function bm(){if(Ef)return Ri;Ef=1;var l=ru(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,s=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function a(c,d,h){var g,p={},v=null,T=null;h!==void 0&&(v=""+h),d.key!==void 0&&(v=""+d.key),d.ref!==void 0&&(T=d.ref);for(g in d)r.call(d,g)&&!o.hasOwnProperty(g)&&(p[g]=d[g]);if(c&&c.defaultProps)for(g in d=c.defaultProps,d)p[g]===void 0&&(p[g]=d[g]);return{$$typeof:e,type:c,key:v,ref:T,props:p,_owner:s.current}}return Ri.Fragment=t,Ri.jsx=a,Ri.jsxs=a,Ri}var Tf;function Mm(){return Tf||(Tf=1,pl.exports=bm()),pl.exports}var Nn=Mm(),Jn=ru(),Ks={},vl={exports:{}},yt={},El={exports:{}},Tl={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sf;function Nm(){return Sf||(Sf=1,function(l){function e(q,z){var K=q.length;q.push(z);e:for(;0<K;){var w=K-1>>>1,$=q[w];if(0<s($,z))q[w]=z,q[K]=$,K=w;else break e}}function t(q){return q.length===0?null:q[0]}function r(q){if(q.length===0)return null;var z=q[0],K=q.pop();if(K!==z){q[0]=K;e:for(var w=0,$=q.length,re=$>>>1;w<re;){var ce=2*(w+1)-1,Ee=q[ce],Te=ce+1,Ae=q[Te];if(0>s(Ee,K))Te<$&&0>s(Ae,Ee)?(q[w]=Ae,q[Te]=K,w=Te):(q[w]=Ee,q[ce]=K,w=ce);else if(Te<$&&0>s(Ae,K))q[w]=Ae,q[Te]=K,w=Te;else break e}}return z}function s(q,z){var K=q.sortIndex-z.sortIndex;return K!==0?K:q.id-z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;l.unstable_now=function(){return o.now()}}else{var a=Date,c=a.now();l.unstable_now=function(){return a.now()-c}}var d=[],h=[],g=1,p=null,v=3,T=!1,E=!1,S=!1,A=typeof setTimeout=="function"?setTimeout:null,R=typeof clearTimeout=="function"?clearTimeout:null,k=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function D(q){for(var z=t(h);z!==null;){if(z.callback===null)r(h);else if(z.startTime<=q)r(h),z.sortIndex=z.expirationTime,e(d,z);else break;z=t(h)}}function N(q){if(S=!1,D(q),!E)if(t(d)!==null)E=!0,oe(P);else{var z=t(h);z!==null&&he(N,z.startTime-q)}}function P(q,z){E=!1,S&&(S=!1,R(j),j=-1),T=!0;var K=v;try{for(D(z),p=t(d);p!==null&&(!(p.expirationTime>z)||q&&!Q());){var w=p.callback;if(typeof w=="function"){p.callback=null,v=p.priorityLevel;var $=w(p.expirationTime<=z);z=l.unstable_now(),typeof $=="function"?p.callback=$:p===t(d)&&r(d),D(z)}else r(d);p=t(d)}if(p!==null)var re=!0;else{var ce=t(h);ce!==null&&he(N,ce.startTime-z),re=!1}return re}finally{p=null,v=K,T=!1}}var V=!1,U=null,j=-1,ee=5,H=-1;function Q(){return!(l.unstable_now()-H<ee)}function ge(){if(U!==null){var q=l.unstable_now();H=q;var z=!0;try{z=U(!0,q)}finally{z?te():(V=!1,U=null)}}else V=!1}var te;if(typeof k=="function")te=function(){k(ge)};else if(typeof MessageChannel<"u"){var de=new MessageChannel,fe=de.port2;de.port1.onmessage=ge,te=function(){fe.postMessage(null)}}else te=function(){A(ge,0)};function oe(q){U=q,V||(V=!0,te())}function he(q,z){j=A(function(){q(l.unstable_now())},z)}l.unstable_IdlePriority=5,l.unstable_ImmediatePriority=1,l.unstable_LowPriority=4,l.unstable_NormalPriority=3,l.unstable_Profiling=null,l.unstable_UserBlockingPriority=2,l.unstable_cancelCallback=function(q){q.callback=null},l.unstable_continueExecution=function(){E||T||(E=!0,oe(P))},l.unstable_forceFrameRate=function(q){0>q||125<q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ee=0<q?Math.floor(1e3/q):5},l.unstable_getCurrentPriorityLevel=function(){return v},l.unstable_getFirstCallbackNode=function(){return t(d)},l.unstable_next=function(q){switch(v){case 1:case 2:case 3:var z=3;break;default:z=v}var K=v;v=z;try{return q()}finally{v=K}},l.unstable_pauseExecution=function(){},l.unstable_requestPaint=function(){},l.unstable_runWithPriority=function(q,z){switch(q){case 1:case 2:case 3:case 4:case 5:break;default:q=3}var K=v;v=q;try{return z()}finally{v=K}},l.unstable_scheduleCallback=function(q,z,K){var w=l.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?w+K:w):K=w,q){case 1:var $=-1;break;case 2:$=250;break;case 5:$=1073741823;break;case 4:$=1e4;break;default:$=5e3}return $=K+$,q={id:g++,callback:z,priorityLevel:q,startTime:K,expirationTime:$,sortIndex:-1},K>w?(q.sortIndex=K,e(h,q),t(d)===null&&q===t(h)&&(S?(R(j),j=-1):S=!0,he(N,K-w))):(q.sortIndex=$,e(d,q),E||T||(E=!0,oe(P))),q},l.unstable_shouldYield=Q,l.unstable_wrapCallback=function(q){var z=v;return function(){var K=v;v=z;try{return q.apply(this,arguments)}finally{v=K}}}}(Tl)),Tl}var xf;function Um(){return xf||(xf=1,El.exports=Nm()),El.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lf;function Bm(){if(Lf)return yt;Lf=1;var l=ru(),e=Um();function t(n){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+n,u=1;u<arguments.length;u++)i+="&args[]="+encodeURIComponent(arguments[u]);return"Minified React error #"+n+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,s={};function o(n,i){a(n,i),a(n+"Capture",i)}function a(n,i){for(s[n]=i,n=0;n<i.length;n++)r.add(i[n])}var c=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,g={},p={};function v(n){return d.call(p,n)?!0:d.call(g,n)?!1:h.test(n)?p[n]=!0:(g[n]=!0,!1)}function T(n,i,u,f){if(u!==null&&u.type===0)return!1;switch(typeof i){case"function":case"symbol":return!0;case"boolean":return f?!1:u!==null?!u.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function E(n,i,u,f){if(i===null||typeof i>"u"||T(n,i,u,f))return!0;if(f)return!1;if(u!==null)switch(u.type){case 3:return!i;case 4:return i===!1;case 5:return isNaN(i);case 6:return isNaN(i)||1>i}return!1}function S(n,i,u,f,m,y,L){this.acceptsBooleans=i===2||i===3||i===4,this.attributeName=f,this.attributeNamespace=m,this.mustUseProperty=u,this.propertyName=n,this.type=i,this.sanitizeURL=y,this.removeEmptyString=L}var A={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){A[n]=new S(n,0,!1,n,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var i=n[0];A[i]=new S(i,1,!1,n[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(n){A[n]=new S(n,2,!1,n.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){A[n]=new S(n,2,!1,n,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){A[n]=new S(n,3,!1,n.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(n){A[n]=new S(n,3,!0,n,null,!1,!1)}),["capture","download"].forEach(function(n){A[n]=new S(n,4,!1,n,null,!1,!1)}),["cols","rows","size","span"].forEach(function(n){A[n]=new S(n,6,!1,n,null,!1,!1)}),["rowSpan","start"].forEach(function(n){A[n]=new S(n,5,!1,n.toLowerCase(),null,!1,!1)});var R=/[\-:]([a-z])/g;function k(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var i=n.replace(R,k);A[i]=new S(i,1,!1,n,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var i=n.replace(R,k);A[i]=new S(i,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(n){var i=n.replace(R,k);A[i]=new S(i,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(n){A[n]=new S(n,1,!1,n.toLowerCase(),null,!1,!1)}),A.xlinkHref=new S("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(n){A[n]=new S(n,1,!1,n.toLowerCase(),null,!0,!0)});function D(n,i,u,f){var m=A.hasOwnProperty(i)?A[i]:null;(m!==null?m.type!==0:f||!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(E(i,u,m,f)&&(u=null),f||m===null?v(i)&&(u===null?n.removeAttribute(i):n.setAttribute(i,""+u)):m.mustUseProperty?n[m.propertyName]=u===null?m.type===3?!1:"":u:(i=m.attributeName,f=m.attributeNamespace,u===null?n.removeAttribute(i):(m=m.type,u=m===3||m===4&&u===!0?"":""+u,f?n.setAttributeNS(f,i,u):n.setAttribute(i,u))))}var N=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,P=Symbol.for("react.element"),V=Symbol.for("react.portal"),U=Symbol.for("react.fragment"),j=Symbol.for("react.strict_mode"),ee=Symbol.for("react.profiler"),H=Symbol.for("react.provider"),Q=Symbol.for("react.context"),ge=Symbol.for("react.forward_ref"),te=Symbol.for("react.suspense"),de=Symbol.for("react.suspense_list"),fe=Symbol.for("react.memo"),oe=Symbol.for("react.lazy"),he=Symbol.for("react.offscreen"),q=Symbol.iterator;function z(n){return n===null||typeof n!="object"?null:(n=q&&n[q]||n["@@iterator"],typeof n=="function"?n:null)}var K=Object.assign,w;function $(n){if(w===void 0)try{throw Error()}catch(u){var i=u.stack.trim().match(/\n( *(at )?)/);w=i&&i[1]||""}return`
`+w+n}var re=!1;function ce(n,i){if(!n||re)return"";re=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(i)if(i=function(){throw Error()},Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(i,[])}catch(B){var f=B}Reflect.construct(n,[],i)}else{try{i.call()}catch(B){f=B}n.call(i.prototype)}else{try{throw Error()}catch(B){f=B}n()}}catch(B){if(B&&f&&typeof B.stack=="string"){for(var m=B.stack.split(`
`),y=f.stack.split(`
`),L=m.length-1,I=y.length-1;1<=L&&0<=I&&m[L]!==y[I];)I--;for(;1<=L&&0<=I;L--,I--)if(m[L]!==y[I]){if(L!==1||I!==1)do if(L--,I--,0>I||m[L]!==y[I]){var C=`
`+m[L].replace(" at new "," at ");return n.displayName&&C.includes("<anonymous>")&&(C=C.replace("<anonymous>",n.displayName)),C}while(1<=L&&0<=I);break}}}finally{re=!1,Error.prepareStackTrace=u}return(n=n?n.displayName||n.name:"")?$(n):""}function Ee(n){switch(n.tag){case 5:return $(n.type);case 16:return $("Lazy");case 13:return $("Suspense");case 19:return $("SuspenseList");case 0:case 2:case 15:return n=ce(n.type,!1),n;case 11:return n=ce(n.type.render,!1),n;case 1:return n=ce(n.type,!0),n;default:return""}}function Te(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case U:return"Fragment";case V:return"Portal";case ee:return"Profiler";case j:return"StrictMode";case te:return"Suspense";case de:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Q:return(n.displayName||"Context")+".Consumer";case H:return(n._context.displayName||"Context")+".Provider";case ge:var i=n.render;return n=n.displayName,n||(n=i.displayName||i.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case fe:return i=n.displayName||null,i!==null?i:Te(n.type)||"Memo";case oe:i=n._payload,n=n._init;try{return Te(n(i))}catch{}}return null}function Ae(n){var i=n.type;switch(n.tag){case 24:return"Cache";case 9:return(i.displayName||"Context")+".Consumer";case 10:return(i._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=i.render,n=n.displayName||n.name||"",i.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return i;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Te(i);case 8:return i===j?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i}return null}function Ie(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Pe(n){var i=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function Tt(n){var i=Pe(n)?"checked":"value",u=Object.getOwnPropertyDescriptor(n.constructor.prototype,i),f=""+n[i];if(!n.hasOwnProperty(i)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var m=u.get,y=u.set;return Object.defineProperty(n,i,{configurable:!0,get:function(){return m.call(this)},set:function(L){f=""+L,y.call(this,L)}}),Object.defineProperty(n,i,{enumerable:u.enumerable}),{getValue:function(){return f},setValue:function(L){f=""+L},stopTracking:function(){n._valueTracker=null,delete n[i]}}}}function Pi(n){n._valueTracker||(n._valueTracker=Tt(n))}function xu(n){if(!n)return!1;var i=n._valueTracker;if(!i)return!0;var u=i.getValue(),f="";return n&&(f=Pe(n)?n.checked?"true":"false":n.value),n=f,n!==u?(i.setValue(n),!0):!1}function Fi(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Lo(n,i){var u=i.checked;return K({},i,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:u??n._wrapperState.initialChecked})}function Lu(n,i){var u=i.defaultValue==null?"":i.defaultValue,f=i.checked!=null?i.checked:i.defaultChecked;u=Ie(i.value!=null?i.value:u),n._wrapperState={initialChecked:f,initialValue:u,controlled:i.type==="checkbox"||i.type==="radio"?i.checked!=null:i.value!=null}}function Au(n,i){i=i.checked,i!=null&&D(n,"checked",i,!1)}function Ao(n,i){Au(n,i);var u=Ie(i.value),f=i.type;if(u!=null)f==="number"?(u===0&&n.value===""||n.value!=u)&&(n.value=""+u):n.value!==""+u&&(n.value=""+u);else if(f==="submit"||f==="reset"){n.removeAttribute("value");return}i.hasOwnProperty("value")?Ro(n,i.type,u):i.hasOwnProperty("defaultValue")&&Ro(n,i.type,Ie(i.defaultValue)),i.checked==null&&i.defaultChecked!=null&&(n.defaultChecked=!!i.defaultChecked)}function Ru(n,i,u){if(i.hasOwnProperty("value")||i.hasOwnProperty("defaultValue")){var f=i.type;if(!(f!=="submit"&&f!=="reset"||i.value!==void 0&&i.value!==null))return;i=""+n._wrapperState.initialValue,u||i===n.value||(n.value=i),n.defaultValue=i}u=n.name,u!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,u!==""&&(n.name=u)}function Ro(n,i,u){(i!=="number"||Fi(n.ownerDocument)!==n)&&(u==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+u&&(n.defaultValue=""+u))}var $r=Array.isArray;function rr(n,i,u,f){if(n=n.options,i){i={};for(var m=0;m<u.length;m++)i["$"+u[m]]=!0;for(u=0;u<n.length;u++)m=i.hasOwnProperty("$"+n[u].value),n[u].selected!==m&&(n[u].selected=m),m&&f&&(n[u].defaultSelected=!0)}else{for(u=""+Ie(u),i=null,m=0;m<n.length;m++){if(n[m].value===u){n[m].selected=!0,f&&(n[m].defaultSelected=!0);return}i!==null||n[m].disabled||(i=n[m])}i!==null&&(i.selected=!0)}}function Io(n,i){if(i.dangerouslySetInnerHTML!=null)throw Error(t(91));return K({},i,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function Iu(n,i){var u=i.value;if(u==null){if(u=i.children,i=i.defaultValue,u!=null){if(i!=null)throw Error(t(92));if($r(u)){if(1<u.length)throw Error(t(93));u=u[0]}i=u}i==null&&(i=""),u=i}n._wrapperState={initialValue:Ie(u)}}function Cu(n,i){var u=Ie(i.value),f=Ie(i.defaultValue);u!=null&&(u=""+u,u!==n.value&&(n.value=u),i.defaultValue==null&&n.defaultValue!==u&&(n.defaultValue=u)),f!=null&&(n.defaultValue=""+f)}function wu(n){var i=n.textContent;i===n._wrapperState.initialValue&&i!==""&&i!==null&&(n.value=i)}function Du(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Co(n,i){return n==null||n==="http://www.w3.org/1999/xhtml"?Du(i):n==="http://www.w3.org/2000/svg"&&i==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Oi,ku=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(i,u,f,m){MSApp.execUnsafeLocalFunction(function(){return n(i,u,f,m)})}:n}(function(n,i){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=i;else{for(Oi=Oi||document.createElement("div"),Oi.innerHTML="<svg>"+i.valueOf().toString()+"</svg>",i=Oi.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;i.firstChild;)n.appendChild(i.firstChild)}});function Gr(n,i){if(i){var u=n.firstChild;if(u&&u===n.lastChild&&u.nodeType===3){u.nodeValue=i;return}}n.textContent=i}var Kr={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},U0=["Webkit","ms","Moz","O"];Object.keys(Kr).forEach(function(n){U0.forEach(function(i){i=i+n.charAt(0).toUpperCase()+n.substring(1),Kr[i]=Kr[n]})});function _u(n,i,u){return i==null||typeof i=="boolean"||i===""?"":u||typeof i!="number"||i===0||Kr.hasOwnProperty(n)&&Kr[n]?(""+i).trim():i+"px"}function Pu(n,i){n=n.style;for(var u in i)if(i.hasOwnProperty(u)){var f=u.indexOf("--")===0,m=_u(u,i[u],f);u==="float"&&(u="cssFloat"),f?n.setProperty(u,m):n[u]=m}}var B0=K({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function wo(n,i){if(i){if(B0[n]&&(i.children!=null||i.dangerouslySetInnerHTML!=null))throw Error(t(137,n));if(i.dangerouslySetInnerHTML!=null){if(i.children!=null)throw Error(t(60));if(typeof i.dangerouslySetInnerHTML!="object"||!("__html"in i.dangerouslySetInnerHTML))throw Error(t(61))}if(i.style!=null&&typeof i.style!="object")throw Error(t(62))}}function Do(n,i){if(n.indexOf("-")===-1)return typeof i.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ko=null;function _o(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Po=null,ir=null,sr=null;function Fu(n){if(n=ci(n)){if(typeof Po!="function")throw Error(t(280));var i=n.stateNode;i&&(i=rs(i),Po(n.stateNode,n.type,i))}}function Ou(n){ir?sr?sr.push(n):sr=[n]:ir=n}function bu(){if(ir){var n=ir,i=sr;if(sr=ir=null,Fu(n),i)for(n=0;n<i.length;n++)Fu(i[n])}}function Mu(n,i){return n(i)}function Nu(){}var Fo=!1;function Uu(n,i,u){if(Fo)return n(i,u);Fo=!0;try{return Mu(n,i,u)}finally{Fo=!1,(ir!==null||sr!==null)&&(Nu(),bu())}}function Vr(n,i){var u=n.stateNode;if(u===null)return null;var f=rs(u);if(f===null)return null;u=f[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(n=n.type,f=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!f;break e;default:n=!1}if(n)return null;if(u&&typeof u!="function")throw Error(t(231,i,typeof u));return u}var Oo=!1;if(c)try{var Hr={};Object.defineProperty(Hr,"passive",{get:function(){Oo=!0}}),window.addEventListener("test",Hr,Hr),window.removeEventListener("test",Hr,Hr)}catch{Oo=!1}function $0(n,i,u,f,m,y,L,I,C){var B=Array.prototype.slice.call(arguments,3);try{i.apply(u,B)}catch(X){this.onError(X)}}var zr=!1,bi=null,Mi=!1,bo=null,G0={onError:function(n){zr=!0,bi=n}};function K0(n,i,u,f,m,y,L,I,C){zr=!1,bi=null,$0.apply(G0,arguments)}function V0(n,i,u,f,m,y,L,I,C){if(K0.apply(this,arguments),zr){if(zr){var B=bi;zr=!1,bi=null}else throw Error(t(198));Mi||(Mi=!0,bo=B)}}function Un(n){var i=n,u=n;if(n.alternate)for(;i.return;)i=i.return;else{n=i;do i=n,i.flags&4098&&(u=i.return),n=i.return;while(n)}return i.tag===3?u:null}function Bu(n){if(n.tag===13){var i=n.memoizedState;if(i===null&&(n=n.alternate,n!==null&&(i=n.memoizedState)),i!==null)return i.dehydrated}return null}function $u(n){if(Un(n)!==n)throw Error(t(188))}function H0(n){var i=n.alternate;if(!i){if(i=Un(n),i===null)throw Error(t(188));return i!==n?null:n}for(var u=n,f=i;;){var m=u.return;if(m===null)break;var y=m.alternate;if(y===null){if(f=m.return,f!==null){u=f;continue}break}if(m.child===y.child){for(y=m.child;y;){if(y===u)return $u(m),n;if(y===f)return $u(m),i;y=y.sibling}throw Error(t(188))}if(u.return!==f.return)u=m,f=y;else{for(var L=!1,I=m.child;I;){if(I===u){L=!0,u=m,f=y;break}if(I===f){L=!0,f=m,u=y;break}I=I.sibling}if(!L){for(I=y.child;I;){if(I===u){L=!0,u=y,f=m;break}if(I===f){L=!0,f=y,u=m;break}I=I.sibling}if(!L)throw Error(t(189))}}if(u.alternate!==f)throw Error(t(190))}if(u.tag!==3)throw Error(t(188));return u.stateNode.current===u?n:i}function Gu(n){return n=H0(n),n!==null?Ku(n):null}function Ku(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var i=Ku(n);if(i!==null)return i;n=n.sibling}return null}var Vu=e.unstable_scheduleCallback,Hu=e.unstable_cancelCallback,z0=e.unstable_shouldYield,W0=e.unstable_requestPaint,Ve=e.unstable_now,j0=e.unstable_getCurrentPriorityLevel,Mo=e.unstable_ImmediatePriority,zu=e.unstable_UserBlockingPriority,Ni=e.unstable_NormalPriority,Y0=e.unstable_LowPriority,Wu=e.unstable_IdlePriority,Ui=null,Ht=null;function q0(n){if(Ht&&typeof Ht.onCommitFiberRoot=="function")try{Ht.onCommitFiberRoot(Ui,n,void 0,(n.current.flags&128)===128)}catch{}}var Ot=Math.clz32?Math.clz32:J0,X0=Math.log,Q0=Math.LN2;function J0(n){return n>>>=0,n===0?32:31-(X0(n)/Q0|0)|0}var Bi=64,$i=4194304;function Wr(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Gi(n,i){var u=n.pendingLanes;if(u===0)return 0;var f=0,m=n.suspendedLanes,y=n.pingedLanes,L=u&268435455;if(L!==0){var I=L&~m;I!==0?f=Wr(I):(y&=L,y!==0&&(f=Wr(y)))}else L=u&~m,L!==0?f=Wr(L):y!==0&&(f=Wr(y));if(f===0)return 0;if(i!==0&&i!==f&&!(i&m)&&(m=f&-f,y=i&-i,m>=y||m===16&&(y&4194240)!==0))return i;if(f&4&&(f|=u&16),i=n.entangledLanes,i!==0)for(n=n.entanglements,i&=f;0<i;)u=31-Ot(i),m=1<<u,f|=n[u],i&=~m;return f}function Z0(n,i){switch(n){case 1:case 2:case 4:return i+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function eg(n,i){for(var u=n.suspendedLanes,f=n.pingedLanes,m=n.expirationTimes,y=n.pendingLanes;0<y;){var L=31-Ot(y),I=1<<L,C=m[L];C===-1?(!(I&u)||I&f)&&(m[L]=Z0(I,i)):C<=i&&(n.expiredLanes|=I),y&=~I}}function No(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function ju(){var n=Bi;return Bi<<=1,!(Bi&4194240)&&(Bi=64),n}function Uo(n){for(var i=[],u=0;31>u;u++)i.push(n);return i}function jr(n,i,u){n.pendingLanes|=i,i!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,i=31-Ot(i),n[i]=u}function tg(n,i){var u=n.pendingLanes&~i;n.pendingLanes=i,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=i,n.mutableReadLanes&=i,n.entangledLanes&=i,i=n.entanglements;var f=n.eventTimes;for(n=n.expirationTimes;0<u;){var m=31-Ot(u),y=1<<m;i[m]=0,f[m]=-1,n[m]=-1,u&=~y}}function Bo(n,i){var u=n.entangledLanes|=i;for(n=n.entanglements;u;){var f=31-Ot(u),m=1<<f;m&i|n[f]&i&&(n[f]|=i),u&=~m}}var ke=0;function Yu(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var qu,$o,Xu,Qu,Ju,Go=!1,Ki=[],pn=null,yn=null,vn=null,Yr=new Map,qr=new Map,En=[],ng="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Zu(n,i){switch(n){case"focusin":case"focusout":pn=null;break;case"dragenter":case"dragleave":yn=null;break;case"mouseover":case"mouseout":vn=null;break;case"pointerover":case"pointerout":Yr.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":qr.delete(i.pointerId)}}function Xr(n,i,u,f,m,y){return n===null||n.nativeEvent!==y?(n={blockedOn:i,domEventName:u,eventSystemFlags:f,nativeEvent:y,targetContainers:[m]},i!==null&&(i=ci(i),i!==null&&$o(i)),n):(n.eventSystemFlags|=f,i=n.targetContainers,m!==null&&i.indexOf(m)===-1&&i.push(m),n)}function rg(n,i,u,f,m){switch(i){case"focusin":return pn=Xr(pn,n,i,u,f,m),!0;case"dragenter":return yn=Xr(yn,n,i,u,f,m),!0;case"mouseover":return vn=Xr(vn,n,i,u,f,m),!0;case"pointerover":var y=m.pointerId;return Yr.set(y,Xr(Yr.get(y)||null,n,i,u,f,m)),!0;case"gotpointercapture":return y=m.pointerId,qr.set(y,Xr(qr.get(y)||null,n,i,u,f,m)),!0}return!1}function ec(n){var i=Bn(n.target);if(i!==null){var u=Un(i);if(u!==null){if(i=u.tag,i===13){if(i=Bu(u),i!==null){n.blockedOn=i,Ju(n.priority,function(){Xu(u)});return}}else if(i===3&&u.stateNode.current.memoizedState.isDehydrated){n.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Vi(n){if(n.blockedOn!==null)return!1;for(var i=n.targetContainers;0<i.length;){var u=Vo(n.domEventName,n.eventSystemFlags,i[0],n.nativeEvent);if(u===null){u=n.nativeEvent;var f=new u.constructor(u.type,u);ko=f,u.target.dispatchEvent(f),ko=null}else return i=ci(u),i!==null&&$o(i),n.blockedOn=u,!1;i.shift()}return!0}function tc(n,i,u){Vi(n)&&u.delete(i)}function ig(){Go=!1,pn!==null&&Vi(pn)&&(pn=null),yn!==null&&Vi(yn)&&(yn=null),vn!==null&&Vi(vn)&&(vn=null),Yr.forEach(tc),qr.forEach(tc)}function Qr(n,i){n.blockedOn===i&&(n.blockedOn=null,Go||(Go=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,ig)))}function Jr(n){function i(m){return Qr(m,n)}if(0<Ki.length){Qr(Ki[0],n);for(var u=1;u<Ki.length;u++){var f=Ki[u];f.blockedOn===n&&(f.blockedOn=null)}}for(pn!==null&&Qr(pn,n),yn!==null&&Qr(yn,n),vn!==null&&Qr(vn,n),Yr.forEach(i),qr.forEach(i),u=0;u<En.length;u++)f=En[u],f.blockedOn===n&&(f.blockedOn=null);for(;0<En.length&&(u=En[0],u.blockedOn===null);)ec(u),u.blockedOn===null&&En.shift()}var or=N.ReactCurrentBatchConfig,Hi=!0;function sg(n,i,u,f){var m=ke,y=or.transition;or.transition=null;try{ke=1,Ko(n,i,u,f)}finally{ke=m,or.transition=y}}function og(n,i,u,f){var m=ke,y=or.transition;or.transition=null;try{ke=4,Ko(n,i,u,f)}finally{ke=m,or.transition=y}}function Ko(n,i,u,f){if(Hi){var m=Vo(n,i,u,f);if(m===null)oa(n,i,f,zi,u),Zu(n,f);else if(rg(m,n,i,u,f))f.stopPropagation();else if(Zu(n,f),i&4&&-1<ng.indexOf(n)){for(;m!==null;){var y=ci(m);if(y!==null&&qu(y),y=Vo(n,i,u,f),y===null&&oa(n,i,f,zi,u),y===m)break;m=y}m!==null&&f.stopPropagation()}else oa(n,i,f,null,u)}}var zi=null;function Vo(n,i,u,f){if(zi=null,n=_o(f),n=Bn(n),n!==null)if(i=Un(n),i===null)n=null;else if(u=i.tag,u===13){if(n=Bu(i),n!==null)return n;n=null}else if(u===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;n=null}else i!==n&&(n=null);return zi=n,null}function nc(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(j0()){case Mo:return 1;case zu:return 4;case Ni:case Y0:return 16;case Wu:return 536870912;default:return 16}default:return 16}}var Tn=null,Ho=null,Wi=null;function rc(){if(Wi)return Wi;var n,i=Ho,u=i.length,f,m="value"in Tn?Tn.value:Tn.textContent,y=m.length;for(n=0;n<u&&i[n]===m[n];n++);var L=u-n;for(f=1;f<=L&&i[u-f]===m[y-f];f++);return Wi=m.slice(n,1<f?1-f:void 0)}function ji(n){var i=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&i===13&&(n=13)):n=i,n===10&&(n=13),32<=n||n===13?n:0}function Yi(){return!0}function ic(){return!1}function St(n){function i(u,f,m,y,L){this._reactName=u,this._targetInst=m,this.type=f,this.nativeEvent=y,this.target=L,this.currentTarget=null;for(var I in n)n.hasOwnProperty(I)&&(u=n[I],this[I]=u?u(y):y[I]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?Yi:ic,this.isPropagationStopped=ic,this}return K(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=Yi)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=Yi)},persist:function(){},isPersistent:Yi}),i}var ar={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},zo=St(ar),Zr=K({},ar,{view:0,detail:0}),ag=St(Zr),Wo,jo,ei,qi=K({},Zr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:qo,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==ei&&(ei&&n.type==="mousemove"?(Wo=n.screenX-ei.screenX,jo=n.screenY-ei.screenY):jo=Wo=0,ei=n),Wo)},movementY:function(n){return"movementY"in n?n.movementY:jo}}),sc=St(qi),lg=K({},qi,{dataTransfer:0}),ug=St(lg),cg=K({},Zr,{relatedTarget:0}),Yo=St(cg),dg=K({},ar,{animationName:0,elapsedTime:0,pseudoElement:0}),fg=St(dg),hg=K({},ar,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),gg=St(hg),mg=K({},ar,{data:0}),oc=St(mg),pg={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},yg={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},vg={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Eg(n){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(n):(n=vg[n])?!!i[n]:!1}function qo(){return Eg}var Tg=K({},Zr,{key:function(n){if(n.key){var i=pg[n.key]||n.key;if(i!=="Unidentified")return i}return n.type==="keypress"?(n=ji(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?yg[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:qo,charCode:function(n){return n.type==="keypress"?ji(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?ji(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Sg=St(Tg),xg=K({},qi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ac=St(xg),Lg=K({},Zr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:qo}),Ag=St(Lg),Rg=K({},ar,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ig=St(Rg),Cg=K({},qi,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),wg=St(Cg),Dg=[9,13,27,32],Xo=c&&"CompositionEvent"in window,ti=null;c&&"documentMode"in document&&(ti=document.documentMode);var kg=c&&"TextEvent"in window&&!ti,lc=c&&(!Xo||ti&&8<ti&&11>=ti),uc=" ",cc=!1;function dc(n,i){switch(n){case"keyup":return Dg.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function fc(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var lr=!1;function _g(n,i){switch(n){case"compositionend":return fc(i);case"keypress":return i.which!==32?null:(cc=!0,uc);case"textInput":return n=i.data,n===uc&&cc?null:n;default:return null}}function Pg(n,i){if(lr)return n==="compositionend"||!Xo&&dc(n,i)?(n=rc(),Wi=Ho=Tn=null,lr=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return lc&&i.locale!=="ko"?null:i.data;default:return null}}var Fg={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function hc(n){var i=n&&n.nodeName&&n.nodeName.toLowerCase();return i==="input"?!!Fg[n.type]:i==="textarea"}function gc(n,i,u,f){Ou(f),i=es(i,"onChange"),0<i.length&&(u=new zo("onChange","change",null,u,f),n.push({event:u,listeners:i}))}var ni=null,ri=null;function Og(n){Pc(n,0)}function Xi(n){var i=hr(n);if(xu(i))return n}function bg(n,i){if(n==="change")return i}var mc=!1;if(c){var Qo;if(c){var Jo="oninput"in document;if(!Jo){var pc=document.createElement("div");pc.setAttribute("oninput","return;"),Jo=typeof pc.oninput=="function"}Qo=Jo}else Qo=!1;mc=Qo&&(!document.documentMode||9<document.documentMode)}function yc(){ni&&(ni.detachEvent("onpropertychange",vc),ri=ni=null)}function vc(n){if(n.propertyName==="value"&&Xi(ri)){var i=[];gc(i,ri,n,_o(n)),Uu(Og,i)}}function Mg(n,i,u){n==="focusin"?(yc(),ni=i,ri=u,ni.attachEvent("onpropertychange",vc)):n==="focusout"&&yc()}function Ng(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Xi(ri)}function Ug(n,i){if(n==="click")return Xi(i)}function Bg(n,i){if(n==="input"||n==="change")return Xi(i)}function $g(n,i){return n===i&&(n!==0||1/n===1/i)||n!==n&&i!==i}var bt=typeof Object.is=="function"?Object.is:$g;function ii(n,i){if(bt(n,i))return!0;if(typeof n!="object"||n===null||typeof i!="object"||i===null)return!1;var u=Object.keys(n),f=Object.keys(i);if(u.length!==f.length)return!1;for(f=0;f<u.length;f++){var m=u[f];if(!d.call(i,m)||!bt(n[m],i[m]))return!1}return!0}function Ec(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Tc(n,i){var u=Ec(n);n=0;for(var f;u;){if(u.nodeType===3){if(f=n+u.textContent.length,n<=i&&f>=i)return{node:u,offset:i-n};n=f}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=Ec(u)}}function Sc(n,i){return n&&i?n===i?!0:n&&n.nodeType===3?!1:i&&i.nodeType===3?Sc(n,i.parentNode):"contains"in n?n.contains(i):n.compareDocumentPosition?!!(n.compareDocumentPosition(i)&16):!1:!1}function xc(){for(var n=window,i=Fi();i instanceof n.HTMLIFrameElement;){try{var u=typeof i.contentWindow.location.href=="string"}catch{u=!1}if(u)n=i.contentWindow;else break;i=Fi(n.document)}return i}function Zo(n){var i=n&&n.nodeName&&n.nodeName.toLowerCase();return i&&(i==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||i==="textarea"||n.contentEditable==="true")}function Gg(n){var i=xc(),u=n.focusedElem,f=n.selectionRange;if(i!==u&&u&&u.ownerDocument&&Sc(u.ownerDocument.documentElement,u)){if(f!==null&&Zo(u)){if(i=f.start,n=f.end,n===void 0&&(n=i),"selectionStart"in u)u.selectionStart=i,u.selectionEnd=Math.min(n,u.value.length);else if(n=(i=u.ownerDocument||document)&&i.defaultView||window,n.getSelection){n=n.getSelection();var m=u.textContent.length,y=Math.min(f.start,m);f=f.end===void 0?y:Math.min(f.end,m),!n.extend&&y>f&&(m=f,f=y,y=m),m=Tc(u,y);var L=Tc(u,f);m&&L&&(n.rangeCount!==1||n.anchorNode!==m.node||n.anchorOffset!==m.offset||n.focusNode!==L.node||n.focusOffset!==L.offset)&&(i=i.createRange(),i.setStart(m.node,m.offset),n.removeAllRanges(),y>f?(n.addRange(i),n.extend(L.node,L.offset)):(i.setEnd(L.node,L.offset),n.addRange(i)))}}for(i=[],n=u;n=n.parentNode;)n.nodeType===1&&i.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof u.focus=="function"&&u.focus(),u=0;u<i.length;u++)n=i[u],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var Kg=c&&"documentMode"in document&&11>=document.documentMode,ur=null,ea=null,si=null,ta=!1;function Lc(n,i,u){var f=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;ta||ur==null||ur!==Fi(f)||(f=ur,"selectionStart"in f&&Zo(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),si&&ii(si,f)||(si=f,f=es(ea,"onSelect"),0<f.length&&(i=new zo("onSelect","select",null,i,u),n.push({event:i,listeners:f}),i.target=ur)))}function Qi(n,i){var u={};return u[n.toLowerCase()]=i.toLowerCase(),u["Webkit"+n]="webkit"+i,u["Moz"+n]="moz"+i,u}var cr={animationend:Qi("Animation","AnimationEnd"),animationiteration:Qi("Animation","AnimationIteration"),animationstart:Qi("Animation","AnimationStart"),transitionend:Qi("Transition","TransitionEnd")},na={},Ac={};c&&(Ac=document.createElement("div").style,"AnimationEvent"in window||(delete cr.animationend.animation,delete cr.animationiteration.animation,delete cr.animationstart.animation),"TransitionEvent"in window||delete cr.transitionend.transition);function Ji(n){if(na[n])return na[n];if(!cr[n])return n;var i=cr[n],u;for(u in i)if(i.hasOwnProperty(u)&&u in Ac)return na[n]=i[u];return n}var Rc=Ji("animationend"),Ic=Ji("animationiteration"),Cc=Ji("animationstart"),wc=Ji("transitionend"),Dc=new Map,kc="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Sn(n,i){Dc.set(n,i),o(i,[n])}for(var ra=0;ra<kc.length;ra++){var ia=kc[ra],Vg=ia.toLowerCase(),Hg=ia[0].toUpperCase()+ia.slice(1);Sn(Vg,"on"+Hg)}Sn(Rc,"onAnimationEnd"),Sn(Ic,"onAnimationIteration"),Sn(Cc,"onAnimationStart"),Sn("dblclick","onDoubleClick"),Sn("focusin","onFocus"),Sn("focusout","onBlur"),Sn(wc,"onTransitionEnd"),a("onMouseEnter",["mouseout","mouseover"]),a("onMouseLeave",["mouseout","mouseover"]),a("onPointerEnter",["pointerout","pointerover"]),a("onPointerLeave",["pointerout","pointerover"]),o("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),o("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),o("onBeforeInput",["compositionend","keypress","textInput","paste"]),o("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var oi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),zg=new Set("cancel close invalid load scroll toggle".split(" ").concat(oi));function _c(n,i,u){var f=n.type||"unknown-event";n.currentTarget=u,V0(f,i,void 0,n),n.currentTarget=null}function Pc(n,i){i=(i&4)!==0;for(var u=0;u<n.length;u++){var f=n[u],m=f.event;f=f.listeners;e:{var y=void 0;if(i)for(var L=f.length-1;0<=L;L--){var I=f[L],C=I.instance,B=I.currentTarget;if(I=I.listener,C!==y&&m.isPropagationStopped())break e;_c(m,I,B),y=C}else for(L=0;L<f.length;L++){if(I=f[L],C=I.instance,B=I.currentTarget,I=I.listener,C!==y&&m.isPropagationStopped())break e;_c(m,I,B),y=C}}}if(Mi)throw n=bo,Mi=!1,bo=null,n}function Me(n,i){var u=i[fa];u===void 0&&(u=i[fa]=new Set);var f=n+"__bubble";u.has(f)||(Fc(i,n,2,!1),u.add(f))}function sa(n,i,u){var f=0;i&&(f|=4),Fc(u,n,f,i)}var Zi="_reactListening"+Math.random().toString(36).slice(2);function ai(n){if(!n[Zi]){n[Zi]=!0,r.forEach(function(u){u!=="selectionchange"&&(zg.has(u)||sa(u,!1,n),sa(u,!0,n))});var i=n.nodeType===9?n:n.ownerDocument;i===null||i[Zi]||(i[Zi]=!0,sa("selectionchange",!1,i))}}function Fc(n,i,u,f){switch(nc(i)){case 1:var m=sg;break;case 4:m=og;break;default:m=Ko}u=m.bind(null,i,u,n),m=void 0,!Oo||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(m=!0),f?m!==void 0?n.addEventListener(i,u,{capture:!0,passive:m}):n.addEventListener(i,u,!0):m!==void 0?n.addEventListener(i,u,{passive:m}):n.addEventListener(i,u,!1)}function oa(n,i,u,f,m){var y=f;if(!(i&1)&&!(i&2)&&f!==null)e:for(;;){if(f===null)return;var L=f.tag;if(L===3||L===4){var I=f.stateNode.containerInfo;if(I===m||I.nodeType===8&&I.parentNode===m)break;if(L===4)for(L=f.return;L!==null;){var C=L.tag;if((C===3||C===4)&&(C=L.stateNode.containerInfo,C===m||C.nodeType===8&&C.parentNode===m))return;L=L.return}for(;I!==null;){if(L=Bn(I),L===null)return;if(C=L.tag,C===5||C===6){f=y=L;continue e}I=I.parentNode}}f=f.return}Uu(function(){var B=y,X=_o(u),J=[];e:{var Y=Dc.get(n);if(Y!==void 0){var ne=zo,ae=n;switch(n){case"keypress":if(ji(u)===0)break e;case"keydown":case"keyup":ne=Sg;break;case"focusin":ae="focus",ne=Yo;break;case"focusout":ae="blur",ne=Yo;break;case"beforeblur":case"afterblur":ne=Yo;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ne=sc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ne=ug;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ne=Ag;break;case Rc:case Ic:case Cc:ne=fg;break;case wc:ne=Ig;break;case"scroll":ne=ag;break;case"wheel":ne=wg;break;case"copy":case"cut":case"paste":ne=gg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ne=ac}var le=(i&4)!==0,He=!le&&n==="scroll",O=le?Y!==null?Y+"Capture":null:Y;le=[];for(var _=B,M;_!==null;){M=_;var Z=M.stateNode;if(M.tag===5&&Z!==null&&(M=Z,O!==null&&(Z=Vr(_,O),Z!=null&&le.push(li(_,Z,M)))),He)break;_=_.return}0<le.length&&(Y=new ne(Y,ae,null,u,X),J.push({event:Y,listeners:le}))}}if(!(i&7)){e:{if(Y=n==="mouseover"||n==="pointerover",ne=n==="mouseout"||n==="pointerout",Y&&u!==ko&&(ae=u.relatedTarget||u.fromElement)&&(Bn(ae)||ae[nn]))break e;if((ne||Y)&&(Y=X.window===X?X:(Y=X.ownerDocument)?Y.defaultView||Y.parentWindow:window,ne?(ae=u.relatedTarget||u.toElement,ne=B,ae=ae?Bn(ae):null,ae!==null&&(He=Un(ae),ae!==He||ae.tag!==5&&ae.tag!==6)&&(ae=null)):(ne=null,ae=B),ne!==ae)){if(le=sc,Z="onMouseLeave",O="onMouseEnter",_="mouse",(n==="pointerout"||n==="pointerover")&&(le=ac,Z="onPointerLeave",O="onPointerEnter",_="pointer"),He=ne==null?Y:hr(ne),M=ae==null?Y:hr(ae),Y=new le(Z,_+"leave",ne,u,X),Y.target=He,Y.relatedTarget=M,Z=null,Bn(X)===B&&(le=new le(O,_+"enter",ae,u,X),le.target=M,le.relatedTarget=He,Z=le),He=Z,ne&&ae)t:{for(le=ne,O=ae,_=0,M=le;M;M=dr(M))_++;for(M=0,Z=O;Z;Z=dr(Z))M++;for(;0<_-M;)le=dr(le),_--;for(;0<M-_;)O=dr(O),M--;for(;_--;){if(le===O||O!==null&&le===O.alternate)break t;le=dr(le),O=dr(O)}le=null}else le=null;ne!==null&&Oc(J,Y,ne,le,!1),ae!==null&&He!==null&&Oc(J,He,ae,le,!0)}}e:{if(Y=B?hr(B):window,ne=Y.nodeName&&Y.nodeName.toLowerCase(),ne==="select"||ne==="input"&&Y.type==="file")var ue=bg;else if(hc(Y))if(mc)ue=Bg;else{ue=Ng;var me=Mg}else(ne=Y.nodeName)&&ne.toLowerCase()==="input"&&(Y.type==="checkbox"||Y.type==="radio")&&(ue=Ug);if(ue&&(ue=ue(n,B))){gc(J,ue,u,X);break e}me&&me(n,Y,B),n==="focusout"&&(me=Y._wrapperState)&&me.controlled&&Y.type==="number"&&Ro(Y,"number",Y.value)}switch(me=B?hr(B):window,n){case"focusin":(hc(me)||me.contentEditable==="true")&&(ur=me,ea=B,si=null);break;case"focusout":si=ea=ur=null;break;case"mousedown":ta=!0;break;case"contextmenu":case"mouseup":case"dragend":ta=!1,Lc(J,u,X);break;case"selectionchange":if(Kg)break;case"keydown":case"keyup":Lc(J,u,X)}var pe;if(Xo)e:{switch(n){case"compositionstart":var xe="onCompositionStart";break e;case"compositionend":xe="onCompositionEnd";break e;case"compositionupdate":xe="onCompositionUpdate";break e}xe=void 0}else lr?dc(n,u)&&(xe="onCompositionEnd"):n==="keydown"&&u.keyCode===229&&(xe="onCompositionStart");xe&&(lc&&u.locale!=="ko"&&(lr||xe!=="onCompositionStart"?xe==="onCompositionEnd"&&lr&&(pe=rc()):(Tn=X,Ho="value"in Tn?Tn.value:Tn.textContent,lr=!0)),me=es(B,xe),0<me.length&&(xe=new oc(xe,n,null,u,X),J.push({event:xe,listeners:me}),pe?xe.data=pe:(pe=fc(u),pe!==null&&(xe.data=pe)))),(pe=kg?_g(n,u):Pg(n,u))&&(B=es(B,"onBeforeInput"),0<B.length&&(X=new oc("onBeforeInput","beforeinput",null,u,X),J.push({event:X,listeners:B}),X.data=pe))}Pc(J,i)})}function li(n,i,u){return{instance:n,listener:i,currentTarget:u}}function es(n,i){for(var u=i+"Capture",f=[];n!==null;){var m=n,y=m.stateNode;m.tag===5&&y!==null&&(m=y,y=Vr(n,u),y!=null&&f.unshift(li(n,y,m)),y=Vr(n,i),y!=null&&f.push(li(n,y,m))),n=n.return}return f}function dr(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Oc(n,i,u,f,m){for(var y=i._reactName,L=[];u!==null&&u!==f;){var I=u,C=I.alternate,B=I.stateNode;if(C!==null&&C===f)break;I.tag===5&&B!==null&&(I=B,m?(C=Vr(u,y),C!=null&&L.unshift(li(u,C,I))):m||(C=Vr(u,y),C!=null&&L.push(li(u,C,I)))),u=u.return}L.length!==0&&n.push({event:i,listeners:L})}var Wg=/\r\n?/g,jg=/\u0000|\uFFFD/g;function bc(n){return(typeof n=="string"?n:""+n).replace(Wg,`
`).replace(jg,"")}function ts(n,i,u){if(i=bc(i),bc(n)!==i&&u)throw Error(t(425))}function ns(){}var aa=null,la=null;function ua(n,i){return n==="textarea"||n==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var ca=typeof setTimeout=="function"?setTimeout:void 0,Yg=typeof clearTimeout=="function"?clearTimeout:void 0,Mc=typeof Promise=="function"?Promise:void 0,qg=typeof queueMicrotask=="function"?queueMicrotask:typeof Mc<"u"?function(n){return Mc.resolve(null).then(n).catch(Xg)}:ca;function Xg(n){setTimeout(function(){throw n})}function da(n,i){var u=i,f=0;do{var m=u.nextSibling;if(n.removeChild(u),m&&m.nodeType===8)if(u=m.data,u==="/$"){if(f===0){n.removeChild(m),Jr(i);return}f--}else u!=="$"&&u!=="$?"&&u!=="$!"||f++;u=m}while(u);Jr(i)}function xn(n){for(;n!=null;n=n.nextSibling){var i=n.nodeType;if(i===1||i===3)break;if(i===8){if(i=n.data,i==="$"||i==="$!"||i==="$?")break;if(i==="/$")return null}}return n}function Nc(n){n=n.previousSibling;for(var i=0;n;){if(n.nodeType===8){var u=n.data;if(u==="$"||u==="$!"||u==="$?"){if(i===0)return n;i--}else u==="/$"&&i++}n=n.previousSibling}return null}var fr=Math.random().toString(36).slice(2),zt="__reactFiber$"+fr,ui="__reactProps$"+fr,nn="__reactContainer$"+fr,fa="__reactEvents$"+fr,Qg="__reactListeners$"+fr,Jg="__reactHandles$"+fr;function Bn(n){var i=n[zt];if(i)return i;for(var u=n.parentNode;u;){if(i=u[nn]||u[zt]){if(u=i.alternate,i.child!==null||u!==null&&u.child!==null)for(n=Nc(n);n!==null;){if(u=n[zt])return u;n=Nc(n)}return i}n=u,u=n.parentNode}return null}function ci(n){return n=n[zt]||n[nn],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function hr(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(t(33))}function rs(n){return n[ui]||null}var ha=[],gr=-1;function Ln(n){return{current:n}}function Ne(n){0>gr||(n.current=ha[gr],ha[gr]=null,gr--)}function Fe(n,i){gr++,ha[gr]=n.current,n.current=i}var An={},st=Ln(An),ft=Ln(!1),$n=An;function mr(n,i){var u=n.type.contextTypes;if(!u)return An;var f=n.stateNode;if(f&&f.__reactInternalMemoizedUnmaskedChildContext===i)return f.__reactInternalMemoizedMaskedChildContext;var m={},y;for(y in u)m[y]=i[y];return f&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=m),m}function ht(n){return n=n.childContextTypes,n!=null}function is(){Ne(ft),Ne(st)}function Uc(n,i,u){if(st.current!==An)throw Error(t(168));Fe(st,i),Fe(ft,u)}function Bc(n,i,u){var f=n.stateNode;if(i=i.childContextTypes,typeof f.getChildContext!="function")return u;f=f.getChildContext();for(var m in f)if(!(m in i))throw Error(t(108,Ae(n)||"Unknown",m));return K({},u,f)}function ss(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||An,$n=st.current,Fe(st,n),Fe(ft,ft.current),!0}function $c(n,i,u){var f=n.stateNode;if(!f)throw Error(t(169));u?(n=Bc(n,i,$n),f.__reactInternalMemoizedMergedChildContext=n,Ne(ft),Ne(st),Fe(st,n)):Ne(ft),Fe(ft,u)}var rn=null,os=!1,ga=!1;function Gc(n){rn===null?rn=[n]:rn.push(n)}function Zg(n){os=!0,Gc(n)}function Rn(){if(!ga&&rn!==null){ga=!0;var n=0,i=ke;try{var u=rn;for(ke=1;n<u.length;n++){var f=u[n];do f=f(!0);while(f!==null)}rn=null,os=!1}catch(m){throw rn!==null&&(rn=rn.slice(n+1)),Vu(Mo,Rn),m}finally{ke=i,ga=!1}}return null}var pr=[],yr=0,as=null,ls=0,Rt=[],It=0,Gn=null,sn=1,on="";function Kn(n,i){pr[yr++]=ls,pr[yr++]=as,as=n,ls=i}function Kc(n,i,u){Rt[It++]=sn,Rt[It++]=on,Rt[It++]=Gn,Gn=n;var f=sn;n=on;var m=32-Ot(f)-1;f&=~(1<<m),u+=1;var y=32-Ot(i)+m;if(30<y){var L=m-m%5;y=(f&(1<<L)-1).toString(32),f>>=L,m-=L,sn=1<<32-Ot(i)+m|u<<m|f,on=y+n}else sn=1<<y|u<<m|f,on=n}function ma(n){n.return!==null&&(Kn(n,1),Kc(n,1,0))}function pa(n){for(;n===as;)as=pr[--yr],pr[yr]=null,ls=pr[--yr],pr[yr]=null;for(;n===Gn;)Gn=Rt[--It],Rt[It]=null,on=Rt[--It],Rt[It]=null,sn=Rt[--It],Rt[It]=null}var xt=null,Lt=null,Ue=!1,Mt=null;function Vc(n,i){var u=kt(5,null,null,0);u.elementType="DELETED",u.stateNode=i,u.return=n,i=n.deletions,i===null?(n.deletions=[u],n.flags|=16):i.push(u)}function Hc(n,i){switch(n.tag){case 5:var u=n.type;return i=i.nodeType!==1||u.toLowerCase()!==i.nodeName.toLowerCase()?null:i,i!==null?(n.stateNode=i,xt=n,Lt=xn(i.firstChild),!0):!1;case 6:return i=n.pendingProps===""||i.nodeType!==3?null:i,i!==null?(n.stateNode=i,xt=n,Lt=null,!0):!1;case 13:return i=i.nodeType!==8?null:i,i!==null?(u=Gn!==null?{id:sn,overflow:on}:null,n.memoizedState={dehydrated:i,treeContext:u,retryLane:1073741824},u=kt(18,null,null,0),u.stateNode=i,u.return=n,n.child=u,xt=n,Lt=null,!0):!1;default:return!1}}function ya(n){return(n.mode&1)!==0&&(n.flags&128)===0}function va(n){if(Ue){var i=Lt;if(i){var u=i;if(!Hc(n,i)){if(ya(n))throw Error(t(418));i=xn(u.nextSibling);var f=xt;i&&Hc(n,i)?Vc(f,u):(n.flags=n.flags&-4097|2,Ue=!1,xt=n)}}else{if(ya(n))throw Error(t(418));n.flags=n.flags&-4097|2,Ue=!1,xt=n}}}function zc(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;xt=n}function us(n){if(n!==xt)return!1;if(!Ue)return zc(n),Ue=!0,!1;var i;if((i=n.tag!==3)&&!(i=n.tag!==5)&&(i=n.type,i=i!=="head"&&i!=="body"&&!ua(n.type,n.memoizedProps)),i&&(i=Lt)){if(ya(n))throw Wc(),Error(t(418));for(;i;)Vc(n,i),i=xn(i.nextSibling)}if(zc(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(t(317));e:{for(n=n.nextSibling,i=0;n;){if(n.nodeType===8){var u=n.data;if(u==="/$"){if(i===0){Lt=xn(n.nextSibling);break e}i--}else u!=="$"&&u!=="$!"&&u!=="$?"||i++}n=n.nextSibling}Lt=null}}else Lt=xt?xn(n.stateNode.nextSibling):null;return!0}function Wc(){for(var n=Lt;n;)n=xn(n.nextSibling)}function vr(){Lt=xt=null,Ue=!1}function Ea(n){Mt===null?Mt=[n]:Mt.push(n)}var em=N.ReactCurrentBatchConfig;function di(n,i,u){if(n=u.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(u._owner){if(u=u._owner,u){if(u.tag!==1)throw Error(t(309));var f=u.stateNode}if(!f)throw Error(t(147,n));var m=f,y=""+n;return i!==null&&i.ref!==null&&typeof i.ref=="function"&&i.ref._stringRef===y?i.ref:(i=function(L){var I=m.refs;L===null?delete I[y]:I[y]=L},i._stringRef=y,i)}if(typeof n!="string")throw Error(t(284));if(!u._owner)throw Error(t(290,n))}return n}function cs(n,i){throw n=Object.prototype.toString.call(i),Error(t(31,n==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":n))}function jc(n){var i=n._init;return i(n._payload)}function Yc(n){function i(O,_){if(n){var M=O.deletions;M===null?(O.deletions=[_],O.flags|=16):M.push(_)}}function u(O,_){if(!n)return null;for(;_!==null;)i(O,_),_=_.sibling;return null}function f(O,_){for(O=new Map;_!==null;)_.key!==null?O.set(_.key,_):O.set(_.index,_),_=_.sibling;return O}function m(O,_){return O=Fn(O,_),O.index=0,O.sibling=null,O}function y(O,_,M){return O.index=M,n?(M=O.alternate,M!==null?(M=M.index,M<_?(O.flags|=2,_):M):(O.flags|=2,_)):(O.flags|=1048576,_)}function L(O){return n&&O.alternate===null&&(O.flags|=2),O}function I(O,_,M,Z){return _===null||_.tag!==6?(_=cl(M,O.mode,Z),_.return=O,_):(_=m(_,M),_.return=O,_)}function C(O,_,M,Z){var ue=M.type;return ue===U?X(O,_,M.props.children,Z,M.key):_!==null&&(_.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===oe&&jc(ue)===_.type)?(Z=m(_,M.props),Z.ref=di(O,_,M),Z.return=O,Z):(Z=Os(M.type,M.key,M.props,null,O.mode,Z),Z.ref=di(O,_,M),Z.return=O,Z)}function B(O,_,M,Z){return _===null||_.tag!==4||_.stateNode.containerInfo!==M.containerInfo||_.stateNode.implementation!==M.implementation?(_=dl(M,O.mode,Z),_.return=O,_):(_=m(_,M.children||[]),_.return=O,_)}function X(O,_,M,Z,ue){return _===null||_.tag!==7?(_=Xn(M,O.mode,Z,ue),_.return=O,_):(_=m(_,M),_.return=O,_)}function J(O,_,M){if(typeof _=="string"&&_!==""||typeof _=="number")return _=cl(""+_,O.mode,M),_.return=O,_;if(typeof _=="object"&&_!==null){switch(_.$$typeof){case P:return M=Os(_.type,_.key,_.props,null,O.mode,M),M.ref=di(O,null,_),M.return=O,M;case V:return _=dl(_,O.mode,M),_.return=O,_;case oe:var Z=_._init;return J(O,Z(_._payload),M)}if($r(_)||z(_))return _=Xn(_,O.mode,M,null),_.return=O,_;cs(O,_)}return null}function Y(O,_,M,Z){var ue=_!==null?_.key:null;if(typeof M=="string"&&M!==""||typeof M=="number")return ue!==null?null:I(O,_,""+M,Z);if(typeof M=="object"&&M!==null){switch(M.$$typeof){case P:return M.key===ue?C(O,_,M,Z):null;case V:return M.key===ue?B(O,_,M,Z):null;case oe:return ue=M._init,Y(O,_,ue(M._payload),Z)}if($r(M)||z(M))return ue!==null?null:X(O,_,M,Z,null);cs(O,M)}return null}function ne(O,_,M,Z,ue){if(typeof Z=="string"&&Z!==""||typeof Z=="number")return O=O.get(M)||null,I(_,O,""+Z,ue);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case P:return O=O.get(Z.key===null?M:Z.key)||null,C(_,O,Z,ue);case V:return O=O.get(Z.key===null?M:Z.key)||null,B(_,O,Z,ue);case oe:var me=Z._init;return ne(O,_,M,me(Z._payload),ue)}if($r(Z)||z(Z))return O=O.get(M)||null,X(_,O,Z,ue,null);cs(_,Z)}return null}function ae(O,_,M,Z){for(var ue=null,me=null,pe=_,xe=_=0,Je=null;pe!==null&&xe<M.length;xe++){pe.index>xe?(Je=pe,pe=null):Je=pe.sibling;var De=Y(O,pe,M[xe],Z);if(De===null){pe===null&&(pe=Je);break}n&&pe&&De.alternate===null&&i(O,pe),_=y(De,_,xe),me===null?ue=De:me.sibling=De,me=De,pe=Je}if(xe===M.length)return u(O,pe),Ue&&Kn(O,xe),ue;if(pe===null){for(;xe<M.length;xe++)pe=J(O,M[xe],Z),pe!==null&&(_=y(pe,_,xe),me===null?ue=pe:me.sibling=pe,me=pe);return Ue&&Kn(O,xe),ue}for(pe=f(O,pe);xe<M.length;xe++)Je=ne(pe,O,xe,M[xe],Z),Je!==null&&(n&&Je.alternate!==null&&pe.delete(Je.key===null?xe:Je.key),_=y(Je,_,xe),me===null?ue=Je:me.sibling=Je,me=Je);return n&&pe.forEach(function(On){return i(O,On)}),Ue&&Kn(O,xe),ue}function le(O,_,M,Z){var ue=z(M);if(typeof ue!="function")throw Error(t(150));if(M=ue.call(M),M==null)throw Error(t(151));for(var me=ue=null,pe=_,xe=_=0,Je=null,De=M.next();pe!==null&&!De.done;xe++,De=M.next()){pe.index>xe?(Je=pe,pe=null):Je=pe.sibling;var On=Y(O,pe,De.value,Z);if(On===null){pe===null&&(pe=Je);break}n&&pe&&On.alternate===null&&i(O,pe),_=y(On,_,xe),me===null?ue=On:me.sibling=On,me=On,pe=Je}if(De.done)return u(O,pe),Ue&&Kn(O,xe),ue;if(pe===null){for(;!De.done;xe++,De=M.next())De=J(O,De.value,Z),De!==null&&(_=y(De,_,xe),me===null?ue=De:me.sibling=De,me=De);return Ue&&Kn(O,xe),ue}for(pe=f(O,pe);!De.done;xe++,De=M.next())De=ne(pe,O,xe,De.value,Z),De!==null&&(n&&De.alternate!==null&&pe.delete(De.key===null?xe:De.key),_=y(De,_,xe),me===null?ue=De:me.sibling=De,me=De);return n&&pe.forEach(function(Fm){return i(O,Fm)}),Ue&&Kn(O,xe),ue}function He(O,_,M,Z){if(typeof M=="object"&&M!==null&&M.type===U&&M.key===null&&(M=M.props.children),typeof M=="object"&&M!==null){switch(M.$$typeof){case P:e:{for(var ue=M.key,me=_;me!==null;){if(me.key===ue){if(ue=M.type,ue===U){if(me.tag===7){u(O,me.sibling),_=m(me,M.props.children),_.return=O,O=_;break e}}else if(me.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===oe&&jc(ue)===me.type){u(O,me.sibling),_=m(me,M.props),_.ref=di(O,me,M),_.return=O,O=_;break e}u(O,me);break}else i(O,me);me=me.sibling}M.type===U?(_=Xn(M.props.children,O.mode,Z,M.key),_.return=O,O=_):(Z=Os(M.type,M.key,M.props,null,O.mode,Z),Z.ref=di(O,_,M),Z.return=O,O=Z)}return L(O);case V:e:{for(me=M.key;_!==null;){if(_.key===me)if(_.tag===4&&_.stateNode.containerInfo===M.containerInfo&&_.stateNode.implementation===M.implementation){u(O,_.sibling),_=m(_,M.children||[]),_.return=O,O=_;break e}else{u(O,_);break}else i(O,_);_=_.sibling}_=dl(M,O.mode,Z),_.return=O,O=_}return L(O);case oe:return me=M._init,He(O,_,me(M._payload),Z)}if($r(M))return ae(O,_,M,Z);if(z(M))return le(O,_,M,Z);cs(O,M)}return typeof M=="string"&&M!==""||typeof M=="number"?(M=""+M,_!==null&&_.tag===6?(u(O,_.sibling),_=m(_,M),_.return=O,O=_):(u(O,_),_=cl(M,O.mode,Z),_.return=O,O=_),L(O)):u(O,_)}return He}var Er=Yc(!0),qc=Yc(!1),ds=Ln(null),fs=null,Tr=null,Ta=null;function Sa(){Ta=Tr=fs=null}function xa(n){var i=ds.current;Ne(ds),n._currentValue=i}function La(n,i,u){for(;n!==null;){var f=n.alternate;if((n.childLanes&i)!==i?(n.childLanes|=i,f!==null&&(f.childLanes|=i)):f!==null&&(f.childLanes&i)!==i&&(f.childLanes|=i),n===u)break;n=n.return}}function Sr(n,i){fs=n,Ta=Tr=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&i&&(gt=!0),n.firstContext=null)}function Ct(n){var i=n._currentValue;if(Ta!==n)if(n={context:n,memoizedValue:i,next:null},Tr===null){if(fs===null)throw Error(t(308));Tr=n,fs.dependencies={lanes:0,firstContext:n}}else Tr=Tr.next=n;return i}var Vn=null;function Aa(n){Vn===null?Vn=[n]:Vn.push(n)}function Xc(n,i,u,f){var m=i.interleaved;return m===null?(u.next=u,Aa(i)):(u.next=m.next,m.next=u),i.interleaved=u,an(n,f)}function an(n,i){n.lanes|=i;var u=n.alternate;for(u!==null&&(u.lanes|=i),u=n,n=n.return;n!==null;)n.childLanes|=i,u=n.alternate,u!==null&&(u.childLanes|=i),u=n,n=n.return;return u.tag===3?u.stateNode:null}var In=!1;function Ra(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Qc(n,i){n=n.updateQueue,i.updateQueue===n&&(i.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function ln(n,i){return{eventTime:n,lane:i,tag:0,payload:null,callback:null,next:null}}function Cn(n,i,u){var f=n.updateQueue;if(f===null)return null;if(f=f.shared,we&2){var m=f.pending;return m===null?i.next=i:(i.next=m.next,m.next=i),f.pending=i,an(n,u)}return m=f.interleaved,m===null?(i.next=i,Aa(f)):(i.next=m.next,m.next=i),f.interleaved=i,an(n,u)}function hs(n,i,u){if(i=i.updateQueue,i!==null&&(i=i.shared,(u&4194240)!==0)){var f=i.lanes;f&=n.pendingLanes,u|=f,i.lanes=u,Bo(n,u)}}function Jc(n,i){var u=n.updateQueue,f=n.alternate;if(f!==null&&(f=f.updateQueue,u===f)){var m=null,y=null;if(u=u.firstBaseUpdate,u!==null){do{var L={eventTime:u.eventTime,lane:u.lane,tag:u.tag,payload:u.payload,callback:u.callback,next:null};y===null?m=y=L:y=y.next=L,u=u.next}while(u!==null);y===null?m=y=i:y=y.next=i}else m=y=i;u={baseState:f.baseState,firstBaseUpdate:m,lastBaseUpdate:y,shared:f.shared,effects:f.effects},n.updateQueue=u;return}n=u.lastBaseUpdate,n===null?u.firstBaseUpdate=i:n.next=i,u.lastBaseUpdate=i}function gs(n,i,u,f){var m=n.updateQueue;In=!1;var y=m.firstBaseUpdate,L=m.lastBaseUpdate,I=m.shared.pending;if(I!==null){m.shared.pending=null;var C=I,B=C.next;C.next=null,L===null?y=B:L.next=B,L=C;var X=n.alternate;X!==null&&(X=X.updateQueue,I=X.lastBaseUpdate,I!==L&&(I===null?X.firstBaseUpdate=B:I.next=B,X.lastBaseUpdate=C))}if(y!==null){var J=m.baseState;L=0,X=B=C=null,I=y;do{var Y=I.lane,ne=I.eventTime;if((f&Y)===Y){X!==null&&(X=X.next={eventTime:ne,lane:0,tag:I.tag,payload:I.payload,callback:I.callback,next:null});e:{var ae=n,le=I;switch(Y=i,ne=u,le.tag){case 1:if(ae=le.payload,typeof ae=="function"){J=ae.call(ne,J,Y);break e}J=ae;break e;case 3:ae.flags=ae.flags&-65537|128;case 0:if(ae=le.payload,Y=typeof ae=="function"?ae.call(ne,J,Y):ae,Y==null)break e;J=K({},J,Y);break e;case 2:In=!0}}I.callback!==null&&I.lane!==0&&(n.flags|=64,Y=m.effects,Y===null?m.effects=[I]:Y.push(I))}else ne={eventTime:ne,lane:Y,tag:I.tag,payload:I.payload,callback:I.callback,next:null},X===null?(B=X=ne,C=J):X=X.next=ne,L|=Y;if(I=I.next,I===null){if(I=m.shared.pending,I===null)break;Y=I,I=Y.next,Y.next=null,m.lastBaseUpdate=Y,m.shared.pending=null}}while(!0);if(X===null&&(C=J),m.baseState=C,m.firstBaseUpdate=B,m.lastBaseUpdate=X,i=m.shared.interleaved,i!==null){m=i;do L|=m.lane,m=m.next;while(m!==i)}else y===null&&(m.shared.lanes=0);Wn|=L,n.lanes=L,n.memoizedState=J}}function Zc(n,i,u){if(n=i.effects,i.effects=null,n!==null)for(i=0;i<n.length;i++){var f=n[i],m=f.callback;if(m!==null){if(f.callback=null,f=u,typeof m!="function")throw Error(t(191,m));m.call(f)}}}var fi={},Wt=Ln(fi),hi=Ln(fi),gi=Ln(fi);function Hn(n){if(n===fi)throw Error(t(174));return n}function Ia(n,i){switch(Fe(gi,i),Fe(hi,n),Fe(Wt,fi),n=i.nodeType,n){case 9:case 11:i=(i=i.documentElement)?i.namespaceURI:Co(null,"");break;default:n=n===8?i.parentNode:i,i=n.namespaceURI||null,n=n.tagName,i=Co(i,n)}Ne(Wt),Fe(Wt,i)}function xr(){Ne(Wt),Ne(hi),Ne(gi)}function ed(n){Hn(gi.current);var i=Hn(Wt.current),u=Co(i,n.type);i!==u&&(Fe(hi,n),Fe(Wt,u))}function Ca(n){hi.current===n&&(Ne(Wt),Ne(hi))}var Be=Ln(0);function ms(n){for(var i=n;i!==null;){if(i.tag===13){var u=i.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||u.data==="$!"))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if(i.flags&128)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===n)break;for(;i.sibling===null;){if(i.return===null||i.return===n)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var wa=[];function Da(){for(var n=0;n<wa.length;n++)wa[n]._workInProgressVersionPrimary=null;wa.length=0}var ps=N.ReactCurrentDispatcher,ka=N.ReactCurrentBatchConfig,zn=0,$e=null,je=null,Xe=null,ys=!1,mi=!1,pi=0,tm=0;function ot(){throw Error(t(321))}function _a(n,i){if(i===null)return!1;for(var u=0;u<i.length&&u<n.length;u++)if(!bt(n[u],i[u]))return!1;return!0}function Pa(n,i,u,f,m,y){if(zn=y,$e=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,ps.current=n===null||n.memoizedState===null?sm:om,n=u(f,m),mi){y=0;do{if(mi=!1,pi=0,25<=y)throw Error(t(301));y+=1,Xe=je=null,i.updateQueue=null,ps.current=am,n=u(f,m)}while(mi)}if(ps.current=Ts,i=je!==null&&je.next!==null,zn=0,Xe=je=$e=null,ys=!1,i)throw Error(t(300));return n}function Fa(){var n=pi!==0;return pi=0,n}function jt(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Xe===null?$e.memoizedState=Xe=n:Xe=Xe.next=n,Xe}function wt(){if(je===null){var n=$e.alternate;n=n!==null?n.memoizedState:null}else n=je.next;var i=Xe===null?$e.memoizedState:Xe.next;if(i!==null)Xe=i,je=n;else{if(n===null)throw Error(t(310));je=n,n={memoizedState:je.memoizedState,baseState:je.baseState,baseQueue:je.baseQueue,queue:je.queue,next:null},Xe===null?$e.memoizedState=Xe=n:Xe=Xe.next=n}return Xe}function yi(n,i){return typeof i=="function"?i(n):i}function Oa(n){var i=wt(),u=i.queue;if(u===null)throw Error(t(311));u.lastRenderedReducer=n;var f=je,m=f.baseQueue,y=u.pending;if(y!==null){if(m!==null){var L=m.next;m.next=y.next,y.next=L}f.baseQueue=m=y,u.pending=null}if(m!==null){y=m.next,f=f.baseState;var I=L=null,C=null,B=y;do{var X=B.lane;if((zn&X)===X)C!==null&&(C=C.next={lane:0,action:B.action,hasEagerState:B.hasEagerState,eagerState:B.eagerState,next:null}),f=B.hasEagerState?B.eagerState:n(f,B.action);else{var J={lane:X,action:B.action,hasEagerState:B.hasEagerState,eagerState:B.eagerState,next:null};C===null?(I=C=J,L=f):C=C.next=J,$e.lanes|=X,Wn|=X}B=B.next}while(B!==null&&B!==y);C===null?L=f:C.next=I,bt(f,i.memoizedState)||(gt=!0),i.memoizedState=f,i.baseState=L,i.baseQueue=C,u.lastRenderedState=f}if(n=u.interleaved,n!==null){m=n;do y=m.lane,$e.lanes|=y,Wn|=y,m=m.next;while(m!==n)}else m===null&&(u.lanes=0);return[i.memoizedState,u.dispatch]}function ba(n){var i=wt(),u=i.queue;if(u===null)throw Error(t(311));u.lastRenderedReducer=n;var f=u.dispatch,m=u.pending,y=i.memoizedState;if(m!==null){u.pending=null;var L=m=m.next;do y=n(y,L.action),L=L.next;while(L!==m);bt(y,i.memoizedState)||(gt=!0),i.memoizedState=y,i.baseQueue===null&&(i.baseState=y),u.lastRenderedState=y}return[y,f]}function td(){}function nd(n,i){var u=$e,f=wt(),m=i(),y=!bt(f.memoizedState,m);if(y&&(f.memoizedState=m,gt=!0),f=f.queue,Ma(sd.bind(null,u,f,n),[n]),f.getSnapshot!==i||y||Xe!==null&&Xe.memoizedState.tag&1){if(u.flags|=2048,vi(9,id.bind(null,u,f,m,i),void 0,null),Qe===null)throw Error(t(349));zn&30||rd(u,i,m)}return m}function rd(n,i,u){n.flags|=16384,n={getSnapshot:i,value:u},i=$e.updateQueue,i===null?(i={lastEffect:null,stores:null},$e.updateQueue=i,i.stores=[n]):(u=i.stores,u===null?i.stores=[n]:u.push(n))}function id(n,i,u,f){i.value=u,i.getSnapshot=f,od(i)&&ad(n)}function sd(n,i,u){return u(function(){od(i)&&ad(n)})}function od(n){var i=n.getSnapshot;n=n.value;try{var u=i();return!bt(n,u)}catch{return!0}}function ad(n){var i=an(n,1);i!==null&&$t(i,n,1,-1)}function ld(n){var i=jt();return typeof n=="function"&&(n=n()),i.memoizedState=i.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:yi,lastRenderedState:n},i.queue=n,n=n.dispatch=im.bind(null,$e,n),[i.memoizedState,n]}function vi(n,i,u,f){return n={tag:n,create:i,destroy:u,deps:f,next:null},i=$e.updateQueue,i===null?(i={lastEffect:null,stores:null},$e.updateQueue=i,i.lastEffect=n.next=n):(u=i.lastEffect,u===null?i.lastEffect=n.next=n:(f=u.next,u.next=n,n.next=f,i.lastEffect=n)),n}function ud(){return wt().memoizedState}function vs(n,i,u,f){var m=jt();$e.flags|=n,m.memoizedState=vi(1|i,u,void 0,f===void 0?null:f)}function Es(n,i,u,f){var m=wt();f=f===void 0?null:f;var y=void 0;if(je!==null){var L=je.memoizedState;if(y=L.destroy,f!==null&&_a(f,L.deps)){m.memoizedState=vi(i,u,y,f);return}}$e.flags|=n,m.memoizedState=vi(1|i,u,y,f)}function cd(n,i){return vs(8390656,8,n,i)}function Ma(n,i){return Es(2048,8,n,i)}function dd(n,i){return Es(4,2,n,i)}function fd(n,i){return Es(4,4,n,i)}function hd(n,i){if(typeof i=="function")return n=n(),i(n),function(){i(null)};if(i!=null)return n=n(),i.current=n,function(){i.current=null}}function gd(n,i,u){return u=u!=null?u.concat([n]):null,Es(4,4,hd.bind(null,i,n),u)}function Na(){}function md(n,i){var u=wt();i=i===void 0?null:i;var f=u.memoizedState;return f!==null&&i!==null&&_a(i,f[1])?f[0]:(u.memoizedState=[n,i],n)}function pd(n,i){var u=wt();i=i===void 0?null:i;var f=u.memoizedState;return f!==null&&i!==null&&_a(i,f[1])?f[0]:(n=n(),u.memoizedState=[n,i],n)}function yd(n,i,u){return zn&21?(bt(u,i)||(u=ju(),$e.lanes|=u,Wn|=u,n.baseState=!0),i):(n.baseState&&(n.baseState=!1,gt=!0),n.memoizedState=u)}function nm(n,i){var u=ke;ke=u!==0&&4>u?u:4,n(!0);var f=ka.transition;ka.transition={};try{n(!1),i()}finally{ke=u,ka.transition=f}}function vd(){return wt().memoizedState}function rm(n,i,u){var f=_n(n);if(u={lane:f,action:u,hasEagerState:!1,eagerState:null,next:null},Ed(n))Td(i,u);else if(u=Xc(n,i,u,f),u!==null){var m=dt();$t(u,n,f,m),Sd(u,i,f)}}function im(n,i,u){var f=_n(n),m={lane:f,action:u,hasEagerState:!1,eagerState:null,next:null};if(Ed(n))Td(i,m);else{var y=n.alternate;if(n.lanes===0&&(y===null||y.lanes===0)&&(y=i.lastRenderedReducer,y!==null))try{var L=i.lastRenderedState,I=y(L,u);if(m.hasEagerState=!0,m.eagerState=I,bt(I,L)){var C=i.interleaved;C===null?(m.next=m,Aa(i)):(m.next=C.next,C.next=m),i.interleaved=m;return}}catch{}finally{}u=Xc(n,i,m,f),u!==null&&(m=dt(),$t(u,n,f,m),Sd(u,i,f))}}function Ed(n){var i=n.alternate;return n===$e||i!==null&&i===$e}function Td(n,i){mi=ys=!0;var u=n.pending;u===null?i.next=i:(i.next=u.next,u.next=i),n.pending=i}function Sd(n,i,u){if(u&4194240){var f=i.lanes;f&=n.pendingLanes,u|=f,i.lanes=u,Bo(n,u)}}var Ts={readContext:Ct,useCallback:ot,useContext:ot,useEffect:ot,useImperativeHandle:ot,useInsertionEffect:ot,useLayoutEffect:ot,useMemo:ot,useReducer:ot,useRef:ot,useState:ot,useDebugValue:ot,useDeferredValue:ot,useTransition:ot,useMutableSource:ot,useSyncExternalStore:ot,useId:ot,unstable_isNewReconciler:!1},sm={readContext:Ct,useCallback:function(n,i){return jt().memoizedState=[n,i===void 0?null:i],n},useContext:Ct,useEffect:cd,useImperativeHandle:function(n,i,u){return u=u!=null?u.concat([n]):null,vs(4194308,4,hd.bind(null,i,n),u)},useLayoutEffect:function(n,i){return vs(4194308,4,n,i)},useInsertionEffect:function(n,i){return vs(4,2,n,i)},useMemo:function(n,i){var u=jt();return i=i===void 0?null:i,n=n(),u.memoizedState=[n,i],n},useReducer:function(n,i,u){var f=jt();return i=u!==void 0?u(i):i,f.memoizedState=f.baseState=i,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:i},f.queue=n,n=n.dispatch=rm.bind(null,$e,n),[f.memoizedState,n]},useRef:function(n){var i=jt();return n={current:n},i.memoizedState=n},useState:ld,useDebugValue:Na,useDeferredValue:function(n){return jt().memoizedState=n},useTransition:function(){var n=ld(!1),i=n[0];return n=nm.bind(null,n[1]),jt().memoizedState=n,[i,n]},useMutableSource:function(){},useSyncExternalStore:function(n,i,u){var f=$e,m=jt();if(Ue){if(u===void 0)throw Error(t(407));u=u()}else{if(u=i(),Qe===null)throw Error(t(349));zn&30||rd(f,i,u)}m.memoizedState=u;var y={value:u,getSnapshot:i};return m.queue=y,cd(sd.bind(null,f,y,n),[n]),f.flags|=2048,vi(9,id.bind(null,f,y,u,i),void 0,null),u},useId:function(){var n=jt(),i=Qe.identifierPrefix;if(Ue){var u=on,f=sn;u=(f&~(1<<32-Ot(f)-1)).toString(32)+u,i=":"+i+"R"+u,u=pi++,0<u&&(i+="H"+u.toString(32)),i+=":"}else u=tm++,i=":"+i+"r"+u.toString(32)+":";return n.memoizedState=i},unstable_isNewReconciler:!1},om={readContext:Ct,useCallback:md,useContext:Ct,useEffect:Ma,useImperativeHandle:gd,useInsertionEffect:dd,useLayoutEffect:fd,useMemo:pd,useReducer:Oa,useRef:ud,useState:function(){return Oa(yi)},useDebugValue:Na,useDeferredValue:function(n){var i=wt();return yd(i,je.memoizedState,n)},useTransition:function(){var n=Oa(yi)[0],i=wt().memoizedState;return[n,i]},useMutableSource:td,useSyncExternalStore:nd,useId:vd,unstable_isNewReconciler:!1},am={readContext:Ct,useCallback:md,useContext:Ct,useEffect:Ma,useImperativeHandle:gd,useInsertionEffect:dd,useLayoutEffect:fd,useMemo:pd,useReducer:ba,useRef:ud,useState:function(){return ba(yi)},useDebugValue:Na,useDeferredValue:function(n){var i=wt();return je===null?i.memoizedState=n:yd(i,je.memoizedState,n)},useTransition:function(){var n=ba(yi)[0],i=wt().memoizedState;return[n,i]},useMutableSource:td,useSyncExternalStore:nd,useId:vd,unstable_isNewReconciler:!1};function Nt(n,i){if(n&&n.defaultProps){i=K({},i),n=n.defaultProps;for(var u in n)i[u]===void 0&&(i[u]=n[u]);return i}return i}function Ua(n,i,u,f){i=n.memoizedState,u=u(f,i),u=u==null?i:K({},i,u),n.memoizedState=u,n.lanes===0&&(n.updateQueue.baseState=u)}var Ss={isMounted:function(n){return(n=n._reactInternals)?Un(n)===n:!1},enqueueSetState:function(n,i,u){n=n._reactInternals;var f=dt(),m=_n(n),y=ln(f,m);y.payload=i,u!=null&&(y.callback=u),i=Cn(n,y,m),i!==null&&($t(i,n,m,f),hs(i,n,m))},enqueueReplaceState:function(n,i,u){n=n._reactInternals;var f=dt(),m=_n(n),y=ln(f,m);y.tag=1,y.payload=i,u!=null&&(y.callback=u),i=Cn(n,y,m),i!==null&&($t(i,n,m,f),hs(i,n,m))},enqueueForceUpdate:function(n,i){n=n._reactInternals;var u=dt(),f=_n(n),m=ln(u,f);m.tag=2,i!=null&&(m.callback=i),i=Cn(n,m,f),i!==null&&($t(i,n,f,u),hs(i,n,f))}};function xd(n,i,u,f,m,y,L){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(f,y,L):i.prototype&&i.prototype.isPureReactComponent?!ii(u,f)||!ii(m,y):!0}function Ld(n,i,u){var f=!1,m=An,y=i.contextType;return typeof y=="object"&&y!==null?y=Ct(y):(m=ht(i)?$n:st.current,f=i.contextTypes,y=(f=f!=null)?mr(n,m):An),i=new i(u,y),n.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=Ss,n.stateNode=i,i._reactInternals=n,f&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=m,n.__reactInternalMemoizedMaskedChildContext=y),i}function Ad(n,i,u,f){n=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(u,f),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(u,f),i.state!==n&&Ss.enqueueReplaceState(i,i.state,null)}function Ba(n,i,u,f){var m=n.stateNode;m.props=u,m.state=n.memoizedState,m.refs={},Ra(n);var y=i.contextType;typeof y=="object"&&y!==null?m.context=Ct(y):(y=ht(i)?$n:st.current,m.context=mr(n,y)),m.state=n.memoizedState,y=i.getDerivedStateFromProps,typeof y=="function"&&(Ua(n,i,y,u),m.state=n.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(i=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),i!==m.state&&Ss.enqueueReplaceState(m,m.state,null),gs(n,u,m,f),m.state=n.memoizedState),typeof m.componentDidMount=="function"&&(n.flags|=4194308)}function Lr(n,i){try{var u="",f=i;do u+=Ee(f),f=f.return;while(f);var m=u}catch(y){m=`
Error generating stack: `+y.message+`
`+y.stack}return{value:n,source:i,stack:m,digest:null}}function $a(n,i,u){return{value:n,source:null,stack:u??null,digest:i??null}}function Ga(n,i){try{console.error(i.value)}catch(u){setTimeout(function(){throw u})}}var lm=typeof WeakMap=="function"?WeakMap:Map;function Rd(n,i,u){u=ln(-1,u),u.tag=3,u.payload={element:null};var f=i.value;return u.callback=function(){ws||(ws=!0,nl=f),Ga(n,i)},u}function Id(n,i,u){u=ln(-1,u),u.tag=3;var f=n.type.getDerivedStateFromError;if(typeof f=="function"){var m=i.value;u.payload=function(){return f(m)},u.callback=function(){Ga(n,i)}}var y=n.stateNode;return y!==null&&typeof y.componentDidCatch=="function"&&(u.callback=function(){Ga(n,i),typeof f!="function"&&(Dn===null?Dn=new Set([this]):Dn.add(this));var L=i.stack;this.componentDidCatch(i.value,{componentStack:L!==null?L:""})}),u}function Cd(n,i,u){var f=n.pingCache;if(f===null){f=n.pingCache=new lm;var m=new Set;f.set(i,m)}else m=f.get(i),m===void 0&&(m=new Set,f.set(i,m));m.has(u)||(m.add(u),n=xm.bind(null,n,i,u),i.then(n,n))}function wd(n){do{var i;if((i=n.tag===13)&&(i=n.memoizedState,i=i!==null?i.dehydrated!==null:!0),i)return n;n=n.return}while(n!==null);return null}function Dd(n,i,u,f,m){return n.mode&1?(n.flags|=65536,n.lanes=m,n):(n===i?n.flags|=65536:(n.flags|=128,u.flags|=131072,u.flags&=-52805,u.tag===1&&(u.alternate===null?u.tag=17:(i=ln(-1,1),i.tag=2,Cn(u,i,1))),u.lanes|=1),n)}var um=N.ReactCurrentOwner,gt=!1;function ct(n,i,u,f){i.child=n===null?qc(i,null,u,f):Er(i,n.child,u,f)}function kd(n,i,u,f,m){u=u.render;var y=i.ref;return Sr(i,m),f=Pa(n,i,u,f,y,m),u=Fa(),n!==null&&!gt?(i.updateQueue=n.updateQueue,i.flags&=-2053,n.lanes&=~m,un(n,i,m)):(Ue&&u&&ma(i),i.flags|=1,ct(n,i,f,m),i.child)}function _d(n,i,u,f,m){if(n===null){var y=u.type;return typeof y=="function"&&!ul(y)&&y.defaultProps===void 0&&u.compare===null&&u.defaultProps===void 0?(i.tag=15,i.type=y,Pd(n,i,y,f,m)):(n=Os(u.type,null,f,i,i.mode,m),n.ref=i.ref,n.return=i,i.child=n)}if(y=n.child,!(n.lanes&m)){var L=y.memoizedProps;if(u=u.compare,u=u!==null?u:ii,u(L,f)&&n.ref===i.ref)return un(n,i,m)}return i.flags|=1,n=Fn(y,f),n.ref=i.ref,n.return=i,i.child=n}function Pd(n,i,u,f,m){if(n!==null){var y=n.memoizedProps;if(ii(y,f)&&n.ref===i.ref)if(gt=!1,i.pendingProps=f=y,(n.lanes&m)!==0)n.flags&131072&&(gt=!0);else return i.lanes=n.lanes,un(n,i,m)}return Ka(n,i,u,f,m)}function Fd(n,i,u){var f=i.pendingProps,m=f.children,y=n!==null?n.memoizedState:null;if(f.mode==="hidden")if(!(i.mode&1))i.memoizedState={baseLanes:0,cachePool:null,transitions:null},Fe(Rr,At),At|=u;else{if(!(u&1073741824))return n=y!==null?y.baseLanes|u:u,i.lanes=i.childLanes=1073741824,i.memoizedState={baseLanes:n,cachePool:null,transitions:null},i.updateQueue=null,Fe(Rr,At),At|=n,null;i.memoizedState={baseLanes:0,cachePool:null,transitions:null},f=y!==null?y.baseLanes:u,Fe(Rr,At),At|=f}else y!==null?(f=y.baseLanes|u,i.memoizedState=null):f=u,Fe(Rr,At),At|=f;return ct(n,i,m,u),i.child}function Od(n,i){var u=i.ref;(n===null&&u!==null||n!==null&&n.ref!==u)&&(i.flags|=512,i.flags|=2097152)}function Ka(n,i,u,f,m){var y=ht(u)?$n:st.current;return y=mr(i,y),Sr(i,m),u=Pa(n,i,u,f,y,m),f=Fa(),n!==null&&!gt?(i.updateQueue=n.updateQueue,i.flags&=-2053,n.lanes&=~m,un(n,i,m)):(Ue&&f&&ma(i),i.flags|=1,ct(n,i,u,m),i.child)}function bd(n,i,u,f,m){if(ht(u)){var y=!0;ss(i)}else y=!1;if(Sr(i,m),i.stateNode===null)Ls(n,i),Ld(i,u,f),Ba(i,u,f,m),f=!0;else if(n===null){var L=i.stateNode,I=i.memoizedProps;L.props=I;var C=L.context,B=u.contextType;typeof B=="object"&&B!==null?B=Ct(B):(B=ht(u)?$n:st.current,B=mr(i,B));var X=u.getDerivedStateFromProps,J=typeof X=="function"||typeof L.getSnapshotBeforeUpdate=="function";J||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||(I!==f||C!==B)&&Ad(i,L,f,B),In=!1;var Y=i.memoizedState;L.state=Y,gs(i,f,L,m),C=i.memoizedState,I!==f||Y!==C||ft.current||In?(typeof X=="function"&&(Ua(i,u,X,f),C=i.memoizedState),(I=In||xd(i,u,I,f,Y,C,B))?(J||typeof L.UNSAFE_componentWillMount!="function"&&typeof L.componentWillMount!="function"||(typeof L.componentWillMount=="function"&&L.componentWillMount(),typeof L.UNSAFE_componentWillMount=="function"&&L.UNSAFE_componentWillMount()),typeof L.componentDidMount=="function"&&(i.flags|=4194308)):(typeof L.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=f,i.memoizedState=C),L.props=f,L.state=C,L.context=B,f=I):(typeof L.componentDidMount=="function"&&(i.flags|=4194308),f=!1)}else{L=i.stateNode,Qc(n,i),I=i.memoizedProps,B=i.type===i.elementType?I:Nt(i.type,I),L.props=B,J=i.pendingProps,Y=L.context,C=u.contextType,typeof C=="object"&&C!==null?C=Ct(C):(C=ht(u)?$n:st.current,C=mr(i,C));var ne=u.getDerivedStateFromProps;(X=typeof ne=="function"||typeof L.getSnapshotBeforeUpdate=="function")||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||(I!==J||Y!==C)&&Ad(i,L,f,C),In=!1,Y=i.memoizedState,L.state=Y,gs(i,f,L,m);var ae=i.memoizedState;I!==J||Y!==ae||ft.current||In?(typeof ne=="function"&&(Ua(i,u,ne,f),ae=i.memoizedState),(B=In||xd(i,u,B,f,Y,ae,C)||!1)?(X||typeof L.UNSAFE_componentWillUpdate!="function"&&typeof L.componentWillUpdate!="function"||(typeof L.componentWillUpdate=="function"&&L.componentWillUpdate(f,ae,C),typeof L.UNSAFE_componentWillUpdate=="function"&&L.UNSAFE_componentWillUpdate(f,ae,C)),typeof L.componentDidUpdate=="function"&&(i.flags|=4),typeof L.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof L.componentDidUpdate!="function"||I===n.memoizedProps&&Y===n.memoizedState||(i.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||I===n.memoizedProps&&Y===n.memoizedState||(i.flags|=1024),i.memoizedProps=f,i.memoizedState=ae),L.props=f,L.state=ae,L.context=C,f=B):(typeof L.componentDidUpdate!="function"||I===n.memoizedProps&&Y===n.memoizedState||(i.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||I===n.memoizedProps&&Y===n.memoizedState||(i.flags|=1024),f=!1)}return Va(n,i,u,f,y,m)}function Va(n,i,u,f,m,y){Od(n,i);var L=(i.flags&128)!==0;if(!f&&!L)return m&&$c(i,u,!1),un(n,i,y);f=i.stateNode,um.current=i;var I=L&&typeof u.getDerivedStateFromError!="function"?null:f.render();return i.flags|=1,n!==null&&L?(i.child=Er(i,n.child,null,y),i.child=Er(i,null,I,y)):ct(n,i,I,y),i.memoizedState=f.state,m&&$c(i,u,!0),i.child}function Md(n){var i=n.stateNode;i.pendingContext?Uc(n,i.pendingContext,i.pendingContext!==i.context):i.context&&Uc(n,i.context,!1),Ia(n,i.containerInfo)}function Nd(n,i,u,f,m){return vr(),Ea(m),i.flags|=256,ct(n,i,u,f),i.child}var Ha={dehydrated:null,treeContext:null,retryLane:0};function za(n){return{baseLanes:n,cachePool:null,transitions:null}}function Ud(n,i,u){var f=i.pendingProps,m=Be.current,y=!1,L=(i.flags&128)!==0,I;if((I=L)||(I=n!==null&&n.memoizedState===null?!1:(m&2)!==0),I?(y=!0,i.flags&=-129):(n===null||n.memoizedState!==null)&&(m|=1),Fe(Be,m&1),n===null)return va(i),n=i.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(i.mode&1?n.data==="$!"?i.lanes=8:i.lanes=1073741824:i.lanes=1,null):(L=f.children,n=f.fallback,y?(f=i.mode,y=i.child,L={mode:"hidden",children:L},!(f&1)&&y!==null?(y.childLanes=0,y.pendingProps=L):y=bs(L,f,0,null),n=Xn(n,f,u,null),y.return=i,n.return=i,y.sibling=n,i.child=y,i.child.memoizedState=za(u),i.memoizedState=Ha,n):Wa(i,L));if(m=n.memoizedState,m!==null&&(I=m.dehydrated,I!==null))return cm(n,i,L,f,I,m,u);if(y){y=f.fallback,L=i.mode,m=n.child,I=m.sibling;var C={mode:"hidden",children:f.children};return!(L&1)&&i.child!==m?(f=i.child,f.childLanes=0,f.pendingProps=C,i.deletions=null):(f=Fn(m,C),f.subtreeFlags=m.subtreeFlags&14680064),I!==null?y=Fn(I,y):(y=Xn(y,L,u,null),y.flags|=2),y.return=i,f.return=i,f.sibling=y,i.child=f,f=y,y=i.child,L=n.child.memoizedState,L=L===null?za(u):{baseLanes:L.baseLanes|u,cachePool:null,transitions:L.transitions},y.memoizedState=L,y.childLanes=n.childLanes&~u,i.memoizedState=Ha,f}return y=n.child,n=y.sibling,f=Fn(y,{mode:"visible",children:f.children}),!(i.mode&1)&&(f.lanes=u),f.return=i,f.sibling=null,n!==null&&(u=i.deletions,u===null?(i.deletions=[n],i.flags|=16):u.push(n)),i.child=f,i.memoizedState=null,f}function Wa(n,i){return i=bs({mode:"visible",children:i},n.mode,0,null),i.return=n,n.child=i}function xs(n,i,u,f){return f!==null&&Ea(f),Er(i,n.child,null,u),n=Wa(i,i.pendingProps.children),n.flags|=2,i.memoizedState=null,n}function cm(n,i,u,f,m,y,L){if(u)return i.flags&256?(i.flags&=-257,f=$a(Error(t(422))),xs(n,i,L,f)):i.memoizedState!==null?(i.child=n.child,i.flags|=128,null):(y=f.fallback,m=i.mode,f=bs({mode:"visible",children:f.children},m,0,null),y=Xn(y,m,L,null),y.flags|=2,f.return=i,y.return=i,f.sibling=y,i.child=f,i.mode&1&&Er(i,n.child,null,L),i.child.memoizedState=za(L),i.memoizedState=Ha,y);if(!(i.mode&1))return xs(n,i,L,null);if(m.data==="$!"){if(f=m.nextSibling&&m.nextSibling.dataset,f)var I=f.dgst;return f=I,y=Error(t(419)),f=$a(y,f,void 0),xs(n,i,L,f)}if(I=(L&n.childLanes)!==0,gt||I){if(f=Qe,f!==null){switch(L&-L){case 4:m=2;break;case 16:m=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:m=32;break;case 536870912:m=268435456;break;default:m=0}m=m&(f.suspendedLanes|L)?0:m,m!==0&&m!==y.retryLane&&(y.retryLane=m,an(n,m),$t(f,n,m,-1))}return ll(),f=$a(Error(t(421))),xs(n,i,L,f)}return m.data==="$?"?(i.flags|=128,i.child=n.child,i=Lm.bind(null,n),m._reactRetry=i,null):(n=y.treeContext,Lt=xn(m.nextSibling),xt=i,Ue=!0,Mt=null,n!==null&&(Rt[It++]=sn,Rt[It++]=on,Rt[It++]=Gn,sn=n.id,on=n.overflow,Gn=i),i=Wa(i,f.children),i.flags|=4096,i)}function Bd(n,i,u){n.lanes|=i;var f=n.alternate;f!==null&&(f.lanes|=i),La(n.return,i,u)}function ja(n,i,u,f,m){var y=n.memoizedState;y===null?n.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:f,tail:u,tailMode:m}:(y.isBackwards=i,y.rendering=null,y.renderingStartTime=0,y.last=f,y.tail=u,y.tailMode=m)}function $d(n,i,u){var f=i.pendingProps,m=f.revealOrder,y=f.tail;if(ct(n,i,f.children,u),f=Be.current,f&2)f=f&1|2,i.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=i.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Bd(n,u,i);else if(n.tag===19)Bd(n,u,i);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===i)break e;for(;n.sibling===null;){if(n.return===null||n.return===i)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}f&=1}if(Fe(Be,f),!(i.mode&1))i.memoizedState=null;else switch(m){case"forwards":for(u=i.child,m=null;u!==null;)n=u.alternate,n!==null&&ms(n)===null&&(m=u),u=u.sibling;u=m,u===null?(m=i.child,i.child=null):(m=u.sibling,u.sibling=null),ja(i,!1,m,u,y);break;case"backwards":for(u=null,m=i.child,i.child=null;m!==null;){if(n=m.alternate,n!==null&&ms(n)===null){i.child=m;break}n=m.sibling,m.sibling=u,u=m,m=n}ja(i,!0,u,null,y);break;case"together":ja(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function Ls(n,i){!(i.mode&1)&&n!==null&&(n.alternate=null,i.alternate=null,i.flags|=2)}function un(n,i,u){if(n!==null&&(i.dependencies=n.dependencies),Wn|=i.lanes,!(u&i.childLanes))return null;if(n!==null&&i.child!==n.child)throw Error(t(153));if(i.child!==null){for(n=i.child,u=Fn(n,n.pendingProps),i.child=u,u.return=i;n.sibling!==null;)n=n.sibling,u=u.sibling=Fn(n,n.pendingProps),u.return=i;u.sibling=null}return i.child}function dm(n,i,u){switch(i.tag){case 3:Md(i),vr();break;case 5:ed(i);break;case 1:ht(i.type)&&ss(i);break;case 4:Ia(i,i.stateNode.containerInfo);break;case 10:var f=i.type._context,m=i.memoizedProps.value;Fe(ds,f._currentValue),f._currentValue=m;break;case 13:if(f=i.memoizedState,f!==null)return f.dehydrated!==null?(Fe(Be,Be.current&1),i.flags|=128,null):u&i.child.childLanes?Ud(n,i,u):(Fe(Be,Be.current&1),n=un(n,i,u),n!==null?n.sibling:null);Fe(Be,Be.current&1);break;case 19:if(f=(u&i.childLanes)!==0,n.flags&128){if(f)return $d(n,i,u);i.flags|=128}if(m=i.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),Fe(Be,Be.current),f)break;return null;case 22:case 23:return i.lanes=0,Fd(n,i,u)}return un(n,i,u)}var Gd,Ya,Kd,Vd;Gd=function(n,i){for(var u=i.child;u!==null;){if(u.tag===5||u.tag===6)n.appendChild(u.stateNode);else if(u.tag!==4&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===i)break;for(;u.sibling===null;){if(u.return===null||u.return===i)return;u=u.return}u.sibling.return=u.return,u=u.sibling}},Ya=function(){},Kd=function(n,i,u,f){var m=n.memoizedProps;if(m!==f){n=i.stateNode,Hn(Wt.current);var y=null;switch(u){case"input":m=Lo(n,m),f=Lo(n,f),y=[];break;case"select":m=K({},m,{value:void 0}),f=K({},f,{value:void 0}),y=[];break;case"textarea":m=Io(n,m),f=Io(n,f),y=[];break;default:typeof m.onClick!="function"&&typeof f.onClick=="function"&&(n.onclick=ns)}wo(u,f);var L;u=null;for(B in m)if(!f.hasOwnProperty(B)&&m.hasOwnProperty(B)&&m[B]!=null)if(B==="style"){var I=m[B];for(L in I)I.hasOwnProperty(L)&&(u||(u={}),u[L]="")}else B!=="dangerouslySetInnerHTML"&&B!=="children"&&B!=="suppressContentEditableWarning"&&B!=="suppressHydrationWarning"&&B!=="autoFocus"&&(s.hasOwnProperty(B)?y||(y=[]):(y=y||[]).push(B,null));for(B in f){var C=f[B];if(I=m!=null?m[B]:void 0,f.hasOwnProperty(B)&&C!==I&&(C!=null||I!=null))if(B==="style")if(I){for(L in I)!I.hasOwnProperty(L)||C&&C.hasOwnProperty(L)||(u||(u={}),u[L]="");for(L in C)C.hasOwnProperty(L)&&I[L]!==C[L]&&(u||(u={}),u[L]=C[L])}else u||(y||(y=[]),y.push(B,u)),u=C;else B==="dangerouslySetInnerHTML"?(C=C?C.__html:void 0,I=I?I.__html:void 0,C!=null&&I!==C&&(y=y||[]).push(B,C)):B==="children"?typeof C!="string"&&typeof C!="number"||(y=y||[]).push(B,""+C):B!=="suppressContentEditableWarning"&&B!=="suppressHydrationWarning"&&(s.hasOwnProperty(B)?(C!=null&&B==="onScroll"&&Me("scroll",n),y||I===C||(y=[])):(y=y||[]).push(B,C))}u&&(y=y||[]).push("style",u);var B=y;(i.updateQueue=B)&&(i.flags|=4)}},Vd=function(n,i,u,f){u!==f&&(i.flags|=4)};function Ei(n,i){if(!Ue)switch(n.tailMode){case"hidden":i=n.tail;for(var u=null;i!==null;)i.alternate!==null&&(u=i),i=i.sibling;u===null?n.tail=null:u.sibling=null;break;case"collapsed":u=n.tail;for(var f=null;u!==null;)u.alternate!==null&&(f=u),u=u.sibling;f===null?i||n.tail===null?n.tail=null:n.tail.sibling=null:f.sibling=null}}function at(n){var i=n.alternate!==null&&n.alternate.child===n.child,u=0,f=0;if(i)for(var m=n.child;m!==null;)u|=m.lanes|m.childLanes,f|=m.subtreeFlags&14680064,f|=m.flags&14680064,m.return=n,m=m.sibling;else for(m=n.child;m!==null;)u|=m.lanes|m.childLanes,f|=m.subtreeFlags,f|=m.flags,m.return=n,m=m.sibling;return n.subtreeFlags|=f,n.childLanes=u,i}function fm(n,i,u){var f=i.pendingProps;switch(pa(i),i.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return at(i),null;case 1:return ht(i.type)&&is(),at(i),null;case 3:return f=i.stateNode,xr(),Ne(ft),Ne(st),Da(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(n===null||n.child===null)&&(us(i)?i.flags|=4:n===null||n.memoizedState.isDehydrated&&!(i.flags&256)||(i.flags|=1024,Mt!==null&&(sl(Mt),Mt=null))),Ya(n,i),at(i),null;case 5:Ca(i);var m=Hn(gi.current);if(u=i.type,n!==null&&i.stateNode!=null)Kd(n,i,u,f,m),n.ref!==i.ref&&(i.flags|=512,i.flags|=2097152);else{if(!f){if(i.stateNode===null)throw Error(t(166));return at(i),null}if(n=Hn(Wt.current),us(i)){f=i.stateNode,u=i.type;var y=i.memoizedProps;switch(f[zt]=i,f[ui]=y,n=(i.mode&1)!==0,u){case"dialog":Me("cancel",f),Me("close",f);break;case"iframe":case"object":case"embed":Me("load",f);break;case"video":case"audio":for(m=0;m<oi.length;m++)Me(oi[m],f);break;case"source":Me("error",f);break;case"img":case"image":case"link":Me("error",f),Me("load",f);break;case"details":Me("toggle",f);break;case"input":Lu(f,y),Me("invalid",f);break;case"select":f._wrapperState={wasMultiple:!!y.multiple},Me("invalid",f);break;case"textarea":Iu(f,y),Me("invalid",f)}wo(u,y),m=null;for(var L in y)if(y.hasOwnProperty(L)){var I=y[L];L==="children"?typeof I=="string"?f.textContent!==I&&(y.suppressHydrationWarning!==!0&&ts(f.textContent,I,n),m=["children",I]):typeof I=="number"&&f.textContent!==""+I&&(y.suppressHydrationWarning!==!0&&ts(f.textContent,I,n),m=["children",""+I]):s.hasOwnProperty(L)&&I!=null&&L==="onScroll"&&Me("scroll",f)}switch(u){case"input":Pi(f),Ru(f,y,!0);break;case"textarea":Pi(f),wu(f);break;case"select":case"option":break;default:typeof y.onClick=="function"&&(f.onclick=ns)}f=m,i.updateQueue=f,f!==null&&(i.flags|=4)}else{L=m.nodeType===9?m:m.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=Du(u)),n==="http://www.w3.org/1999/xhtml"?u==="script"?(n=L.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof f.is=="string"?n=L.createElement(u,{is:f.is}):(n=L.createElement(u),u==="select"&&(L=n,f.multiple?L.multiple=!0:f.size&&(L.size=f.size))):n=L.createElementNS(n,u),n[zt]=i,n[ui]=f,Gd(n,i,!1,!1),i.stateNode=n;e:{switch(L=Do(u,f),u){case"dialog":Me("cancel",n),Me("close",n),m=f;break;case"iframe":case"object":case"embed":Me("load",n),m=f;break;case"video":case"audio":for(m=0;m<oi.length;m++)Me(oi[m],n);m=f;break;case"source":Me("error",n),m=f;break;case"img":case"image":case"link":Me("error",n),Me("load",n),m=f;break;case"details":Me("toggle",n),m=f;break;case"input":Lu(n,f),m=Lo(n,f),Me("invalid",n);break;case"option":m=f;break;case"select":n._wrapperState={wasMultiple:!!f.multiple},m=K({},f,{value:void 0}),Me("invalid",n);break;case"textarea":Iu(n,f),m=Io(n,f),Me("invalid",n);break;default:m=f}wo(u,m),I=m;for(y in I)if(I.hasOwnProperty(y)){var C=I[y];y==="style"?Pu(n,C):y==="dangerouslySetInnerHTML"?(C=C?C.__html:void 0,C!=null&&ku(n,C)):y==="children"?typeof C=="string"?(u!=="textarea"||C!=="")&&Gr(n,C):typeof C=="number"&&Gr(n,""+C):y!=="suppressContentEditableWarning"&&y!=="suppressHydrationWarning"&&y!=="autoFocus"&&(s.hasOwnProperty(y)?C!=null&&y==="onScroll"&&Me("scroll",n):C!=null&&D(n,y,C,L))}switch(u){case"input":Pi(n),Ru(n,f,!1);break;case"textarea":Pi(n),wu(n);break;case"option":f.value!=null&&n.setAttribute("value",""+Ie(f.value));break;case"select":n.multiple=!!f.multiple,y=f.value,y!=null?rr(n,!!f.multiple,y,!1):f.defaultValue!=null&&rr(n,!!f.multiple,f.defaultValue,!0);break;default:typeof m.onClick=="function"&&(n.onclick=ns)}switch(u){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}}f&&(i.flags|=4)}i.ref!==null&&(i.flags|=512,i.flags|=2097152)}return at(i),null;case 6:if(n&&i.stateNode!=null)Vd(n,i,n.memoizedProps,f);else{if(typeof f!="string"&&i.stateNode===null)throw Error(t(166));if(u=Hn(gi.current),Hn(Wt.current),us(i)){if(f=i.stateNode,u=i.memoizedProps,f[zt]=i,(y=f.nodeValue!==u)&&(n=xt,n!==null))switch(n.tag){case 3:ts(f.nodeValue,u,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&ts(f.nodeValue,u,(n.mode&1)!==0)}y&&(i.flags|=4)}else f=(u.nodeType===9?u:u.ownerDocument).createTextNode(f),f[zt]=i,i.stateNode=f}return at(i),null;case 13:if(Ne(Be),f=i.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Ue&&Lt!==null&&i.mode&1&&!(i.flags&128))Wc(),vr(),i.flags|=98560,y=!1;else if(y=us(i),f!==null&&f.dehydrated!==null){if(n===null){if(!y)throw Error(t(318));if(y=i.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(t(317));y[zt]=i}else vr(),!(i.flags&128)&&(i.memoizedState=null),i.flags|=4;at(i),y=!1}else Mt!==null&&(sl(Mt),Mt=null),y=!0;if(!y)return i.flags&65536?i:null}return i.flags&128?(i.lanes=u,i):(f=f!==null,f!==(n!==null&&n.memoizedState!==null)&&f&&(i.child.flags|=8192,i.mode&1&&(n===null||Be.current&1?Ye===0&&(Ye=3):ll())),i.updateQueue!==null&&(i.flags|=4),at(i),null);case 4:return xr(),Ya(n,i),n===null&&ai(i.stateNode.containerInfo),at(i),null;case 10:return xa(i.type._context),at(i),null;case 17:return ht(i.type)&&is(),at(i),null;case 19:if(Ne(Be),y=i.memoizedState,y===null)return at(i),null;if(f=(i.flags&128)!==0,L=y.rendering,L===null)if(f)Ei(y,!1);else{if(Ye!==0||n!==null&&n.flags&128)for(n=i.child;n!==null;){if(L=ms(n),L!==null){for(i.flags|=128,Ei(y,!1),f=L.updateQueue,f!==null&&(i.updateQueue=f,i.flags|=4),i.subtreeFlags=0,f=u,u=i.child;u!==null;)y=u,n=f,y.flags&=14680066,L=y.alternate,L===null?(y.childLanes=0,y.lanes=n,y.child=null,y.subtreeFlags=0,y.memoizedProps=null,y.memoizedState=null,y.updateQueue=null,y.dependencies=null,y.stateNode=null):(y.childLanes=L.childLanes,y.lanes=L.lanes,y.child=L.child,y.subtreeFlags=0,y.deletions=null,y.memoizedProps=L.memoizedProps,y.memoizedState=L.memoizedState,y.updateQueue=L.updateQueue,y.type=L.type,n=L.dependencies,y.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),u=u.sibling;return Fe(Be,Be.current&1|2),i.child}n=n.sibling}y.tail!==null&&Ve()>Ir&&(i.flags|=128,f=!0,Ei(y,!1),i.lanes=4194304)}else{if(!f)if(n=ms(L),n!==null){if(i.flags|=128,f=!0,u=n.updateQueue,u!==null&&(i.updateQueue=u,i.flags|=4),Ei(y,!0),y.tail===null&&y.tailMode==="hidden"&&!L.alternate&&!Ue)return at(i),null}else 2*Ve()-y.renderingStartTime>Ir&&u!==1073741824&&(i.flags|=128,f=!0,Ei(y,!1),i.lanes=4194304);y.isBackwards?(L.sibling=i.child,i.child=L):(u=y.last,u!==null?u.sibling=L:i.child=L,y.last=L)}return y.tail!==null?(i=y.tail,y.rendering=i,y.tail=i.sibling,y.renderingStartTime=Ve(),i.sibling=null,u=Be.current,Fe(Be,f?u&1|2:u&1),i):(at(i),null);case 22:case 23:return al(),f=i.memoizedState!==null,n!==null&&n.memoizedState!==null!==f&&(i.flags|=8192),f&&i.mode&1?At&1073741824&&(at(i),i.subtreeFlags&6&&(i.flags|=8192)):at(i),null;case 24:return null;case 25:return null}throw Error(t(156,i.tag))}function hm(n,i){switch(pa(i),i.tag){case 1:return ht(i.type)&&is(),n=i.flags,n&65536?(i.flags=n&-65537|128,i):null;case 3:return xr(),Ne(ft),Ne(st),Da(),n=i.flags,n&65536&&!(n&128)?(i.flags=n&-65537|128,i):null;case 5:return Ca(i),null;case 13:if(Ne(Be),n=i.memoizedState,n!==null&&n.dehydrated!==null){if(i.alternate===null)throw Error(t(340));vr()}return n=i.flags,n&65536?(i.flags=n&-65537|128,i):null;case 19:return Ne(Be),null;case 4:return xr(),null;case 10:return xa(i.type._context),null;case 22:case 23:return al(),null;case 24:return null;default:return null}}var As=!1,lt=!1,gm=typeof WeakSet=="function"?WeakSet:Set,ie=null;function Ar(n,i){var u=n.ref;if(u!==null)if(typeof u=="function")try{u(null)}catch(f){Ke(n,i,f)}else u.current=null}function qa(n,i,u){try{u()}catch(f){Ke(n,i,f)}}var Hd=!1;function mm(n,i){if(aa=Hi,n=xc(),Zo(n)){if("selectionStart"in n)var u={start:n.selectionStart,end:n.selectionEnd};else e:{u=(u=n.ownerDocument)&&u.defaultView||window;var f=u.getSelection&&u.getSelection();if(f&&f.rangeCount!==0){u=f.anchorNode;var m=f.anchorOffset,y=f.focusNode;f=f.focusOffset;try{u.nodeType,y.nodeType}catch{u=null;break e}var L=0,I=-1,C=-1,B=0,X=0,J=n,Y=null;t:for(;;){for(var ne;J!==u||m!==0&&J.nodeType!==3||(I=L+m),J!==y||f!==0&&J.nodeType!==3||(C=L+f),J.nodeType===3&&(L+=J.nodeValue.length),(ne=J.firstChild)!==null;)Y=J,J=ne;for(;;){if(J===n)break t;if(Y===u&&++B===m&&(I=L),Y===y&&++X===f&&(C=L),(ne=J.nextSibling)!==null)break;J=Y,Y=J.parentNode}J=ne}u=I===-1||C===-1?null:{start:I,end:C}}else u=null}u=u||{start:0,end:0}}else u=null;for(la={focusedElem:n,selectionRange:u},Hi=!1,ie=i;ie!==null;)if(i=ie,n=i.child,(i.subtreeFlags&1028)!==0&&n!==null)n.return=i,ie=n;else for(;ie!==null;){i=ie;try{var ae=i.alternate;if(i.flags&1024)switch(i.tag){case 0:case 11:case 15:break;case 1:if(ae!==null){var le=ae.memoizedProps,He=ae.memoizedState,O=i.stateNode,_=O.getSnapshotBeforeUpdate(i.elementType===i.type?le:Nt(i.type,le),He);O.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var M=i.stateNode.containerInfo;M.nodeType===1?M.textContent="":M.nodeType===9&&M.documentElement&&M.removeChild(M.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(Z){Ke(i,i.return,Z)}if(n=i.sibling,n!==null){n.return=i.return,ie=n;break}ie=i.return}return ae=Hd,Hd=!1,ae}function Ti(n,i,u){var f=i.updateQueue;if(f=f!==null?f.lastEffect:null,f!==null){var m=f=f.next;do{if((m.tag&n)===n){var y=m.destroy;m.destroy=void 0,y!==void 0&&qa(i,u,y)}m=m.next}while(m!==f)}}function Rs(n,i){if(i=i.updateQueue,i=i!==null?i.lastEffect:null,i!==null){var u=i=i.next;do{if((u.tag&n)===n){var f=u.create;u.destroy=f()}u=u.next}while(u!==i)}}function Xa(n){var i=n.ref;if(i!==null){var u=n.stateNode;switch(n.tag){case 5:n=u;break;default:n=u}typeof i=="function"?i(n):i.current=n}}function zd(n){var i=n.alternate;i!==null&&(n.alternate=null,zd(i)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(i=n.stateNode,i!==null&&(delete i[zt],delete i[ui],delete i[fa],delete i[Qg],delete i[Jg])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function Wd(n){return n.tag===5||n.tag===3||n.tag===4}function jd(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Wd(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Qa(n,i,u){var f=n.tag;if(f===5||f===6)n=n.stateNode,i?u.nodeType===8?u.parentNode.insertBefore(n,i):u.insertBefore(n,i):(u.nodeType===8?(i=u.parentNode,i.insertBefore(n,u)):(i=u,i.appendChild(n)),u=u._reactRootContainer,u!=null||i.onclick!==null||(i.onclick=ns));else if(f!==4&&(n=n.child,n!==null))for(Qa(n,i,u),n=n.sibling;n!==null;)Qa(n,i,u),n=n.sibling}function Ja(n,i,u){var f=n.tag;if(f===5||f===6)n=n.stateNode,i?u.insertBefore(n,i):u.appendChild(n);else if(f!==4&&(n=n.child,n!==null))for(Ja(n,i,u),n=n.sibling;n!==null;)Ja(n,i,u),n=n.sibling}var nt=null,Ut=!1;function wn(n,i,u){for(u=u.child;u!==null;)Yd(n,i,u),u=u.sibling}function Yd(n,i,u){if(Ht&&typeof Ht.onCommitFiberUnmount=="function")try{Ht.onCommitFiberUnmount(Ui,u)}catch{}switch(u.tag){case 5:lt||Ar(u,i);case 6:var f=nt,m=Ut;nt=null,wn(n,i,u),nt=f,Ut=m,nt!==null&&(Ut?(n=nt,u=u.stateNode,n.nodeType===8?n.parentNode.removeChild(u):n.removeChild(u)):nt.removeChild(u.stateNode));break;case 18:nt!==null&&(Ut?(n=nt,u=u.stateNode,n.nodeType===8?da(n.parentNode,u):n.nodeType===1&&da(n,u),Jr(n)):da(nt,u.stateNode));break;case 4:f=nt,m=Ut,nt=u.stateNode.containerInfo,Ut=!0,wn(n,i,u),nt=f,Ut=m;break;case 0:case 11:case 14:case 15:if(!lt&&(f=u.updateQueue,f!==null&&(f=f.lastEffect,f!==null))){m=f=f.next;do{var y=m,L=y.destroy;y=y.tag,L!==void 0&&(y&2||y&4)&&qa(u,i,L),m=m.next}while(m!==f)}wn(n,i,u);break;case 1:if(!lt&&(Ar(u,i),f=u.stateNode,typeof f.componentWillUnmount=="function"))try{f.props=u.memoizedProps,f.state=u.memoizedState,f.componentWillUnmount()}catch(I){Ke(u,i,I)}wn(n,i,u);break;case 21:wn(n,i,u);break;case 22:u.mode&1?(lt=(f=lt)||u.memoizedState!==null,wn(n,i,u),lt=f):wn(n,i,u);break;default:wn(n,i,u)}}function qd(n){var i=n.updateQueue;if(i!==null){n.updateQueue=null;var u=n.stateNode;u===null&&(u=n.stateNode=new gm),i.forEach(function(f){var m=Am.bind(null,n,f);u.has(f)||(u.add(f),f.then(m,m))})}}function Bt(n,i){var u=i.deletions;if(u!==null)for(var f=0;f<u.length;f++){var m=u[f];try{var y=n,L=i,I=L;e:for(;I!==null;){switch(I.tag){case 5:nt=I.stateNode,Ut=!1;break e;case 3:nt=I.stateNode.containerInfo,Ut=!0;break e;case 4:nt=I.stateNode.containerInfo,Ut=!0;break e}I=I.return}if(nt===null)throw Error(t(160));Yd(y,L,m),nt=null,Ut=!1;var C=m.alternate;C!==null&&(C.return=null),m.return=null}catch(B){Ke(m,i,B)}}if(i.subtreeFlags&12854)for(i=i.child;i!==null;)Xd(i,n),i=i.sibling}function Xd(n,i){var u=n.alternate,f=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Bt(i,n),Yt(n),f&4){try{Ti(3,n,n.return),Rs(3,n)}catch(le){Ke(n,n.return,le)}try{Ti(5,n,n.return)}catch(le){Ke(n,n.return,le)}}break;case 1:Bt(i,n),Yt(n),f&512&&u!==null&&Ar(u,u.return);break;case 5:if(Bt(i,n),Yt(n),f&512&&u!==null&&Ar(u,u.return),n.flags&32){var m=n.stateNode;try{Gr(m,"")}catch(le){Ke(n,n.return,le)}}if(f&4&&(m=n.stateNode,m!=null)){var y=n.memoizedProps,L=u!==null?u.memoizedProps:y,I=n.type,C=n.updateQueue;if(n.updateQueue=null,C!==null)try{I==="input"&&y.type==="radio"&&y.name!=null&&Au(m,y),Do(I,L);var B=Do(I,y);for(L=0;L<C.length;L+=2){var X=C[L],J=C[L+1];X==="style"?Pu(m,J):X==="dangerouslySetInnerHTML"?ku(m,J):X==="children"?Gr(m,J):D(m,X,J,B)}switch(I){case"input":Ao(m,y);break;case"textarea":Cu(m,y);break;case"select":var Y=m._wrapperState.wasMultiple;m._wrapperState.wasMultiple=!!y.multiple;var ne=y.value;ne!=null?rr(m,!!y.multiple,ne,!1):Y!==!!y.multiple&&(y.defaultValue!=null?rr(m,!!y.multiple,y.defaultValue,!0):rr(m,!!y.multiple,y.multiple?[]:"",!1))}m[ui]=y}catch(le){Ke(n,n.return,le)}}break;case 6:if(Bt(i,n),Yt(n),f&4){if(n.stateNode===null)throw Error(t(162));m=n.stateNode,y=n.memoizedProps;try{m.nodeValue=y}catch(le){Ke(n,n.return,le)}}break;case 3:if(Bt(i,n),Yt(n),f&4&&u!==null&&u.memoizedState.isDehydrated)try{Jr(i.containerInfo)}catch(le){Ke(n,n.return,le)}break;case 4:Bt(i,n),Yt(n);break;case 13:Bt(i,n),Yt(n),m=n.child,m.flags&8192&&(y=m.memoizedState!==null,m.stateNode.isHidden=y,!y||m.alternate!==null&&m.alternate.memoizedState!==null||(tl=Ve())),f&4&&qd(n);break;case 22:if(X=u!==null&&u.memoizedState!==null,n.mode&1?(lt=(B=lt)||X,Bt(i,n),lt=B):Bt(i,n),Yt(n),f&8192){if(B=n.memoizedState!==null,(n.stateNode.isHidden=B)&&!X&&n.mode&1)for(ie=n,X=n.child;X!==null;){for(J=ie=X;ie!==null;){switch(Y=ie,ne=Y.child,Y.tag){case 0:case 11:case 14:case 15:Ti(4,Y,Y.return);break;case 1:Ar(Y,Y.return);var ae=Y.stateNode;if(typeof ae.componentWillUnmount=="function"){f=Y,u=Y.return;try{i=f,ae.props=i.memoizedProps,ae.state=i.memoizedState,ae.componentWillUnmount()}catch(le){Ke(f,u,le)}}break;case 5:Ar(Y,Y.return);break;case 22:if(Y.memoizedState!==null){Zd(J);continue}}ne!==null?(ne.return=Y,ie=ne):Zd(J)}X=X.sibling}e:for(X=null,J=n;;){if(J.tag===5){if(X===null){X=J;try{m=J.stateNode,B?(y=m.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none"):(I=J.stateNode,C=J.memoizedProps.style,L=C!=null&&C.hasOwnProperty("display")?C.display:null,I.style.display=_u("display",L))}catch(le){Ke(n,n.return,le)}}}else if(J.tag===6){if(X===null)try{J.stateNode.nodeValue=B?"":J.memoizedProps}catch(le){Ke(n,n.return,le)}}else if((J.tag!==22&&J.tag!==23||J.memoizedState===null||J===n)&&J.child!==null){J.child.return=J,J=J.child;continue}if(J===n)break e;for(;J.sibling===null;){if(J.return===null||J.return===n)break e;X===J&&(X=null),J=J.return}X===J&&(X=null),J.sibling.return=J.return,J=J.sibling}}break;case 19:Bt(i,n),Yt(n),f&4&&qd(n);break;case 21:break;default:Bt(i,n),Yt(n)}}function Yt(n){var i=n.flags;if(i&2){try{e:{for(var u=n.return;u!==null;){if(Wd(u)){var f=u;break e}u=u.return}throw Error(t(160))}switch(f.tag){case 5:var m=f.stateNode;f.flags&32&&(Gr(m,""),f.flags&=-33);var y=jd(n);Ja(n,y,m);break;case 3:case 4:var L=f.stateNode.containerInfo,I=jd(n);Qa(n,I,L);break;default:throw Error(t(161))}}catch(C){Ke(n,n.return,C)}n.flags&=-3}i&4096&&(n.flags&=-4097)}function pm(n,i,u){ie=n,Qd(n)}function Qd(n,i,u){for(var f=(n.mode&1)!==0;ie!==null;){var m=ie,y=m.child;if(m.tag===22&&f){var L=m.memoizedState!==null||As;if(!L){var I=m.alternate,C=I!==null&&I.memoizedState!==null||lt;I=As;var B=lt;if(As=L,(lt=C)&&!B)for(ie=m;ie!==null;)L=ie,C=L.child,L.tag===22&&L.memoizedState!==null?ef(m):C!==null?(C.return=L,ie=C):ef(m);for(;y!==null;)ie=y,Qd(y),y=y.sibling;ie=m,As=I,lt=B}Jd(n)}else m.subtreeFlags&8772&&y!==null?(y.return=m,ie=y):Jd(n)}}function Jd(n){for(;ie!==null;){var i=ie;if(i.flags&8772){var u=i.alternate;try{if(i.flags&8772)switch(i.tag){case 0:case 11:case 15:lt||Rs(5,i);break;case 1:var f=i.stateNode;if(i.flags&4&&!lt)if(u===null)f.componentDidMount();else{var m=i.elementType===i.type?u.memoizedProps:Nt(i.type,u.memoizedProps);f.componentDidUpdate(m,u.memoizedState,f.__reactInternalSnapshotBeforeUpdate)}var y=i.updateQueue;y!==null&&Zc(i,y,f);break;case 3:var L=i.updateQueue;if(L!==null){if(u=null,i.child!==null)switch(i.child.tag){case 5:u=i.child.stateNode;break;case 1:u=i.child.stateNode}Zc(i,L,u)}break;case 5:var I=i.stateNode;if(u===null&&i.flags&4){u=I;var C=i.memoizedProps;switch(i.type){case"button":case"input":case"select":case"textarea":C.autoFocus&&u.focus();break;case"img":C.src&&(u.src=C.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(i.memoizedState===null){var B=i.alternate;if(B!==null){var X=B.memoizedState;if(X!==null){var J=X.dehydrated;J!==null&&Jr(J)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}lt||i.flags&512&&Xa(i)}catch(Y){Ke(i,i.return,Y)}}if(i===n){ie=null;break}if(u=i.sibling,u!==null){u.return=i.return,ie=u;break}ie=i.return}}function Zd(n){for(;ie!==null;){var i=ie;if(i===n){ie=null;break}var u=i.sibling;if(u!==null){u.return=i.return,ie=u;break}ie=i.return}}function ef(n){for(;ie!==null;){var i=ie;try{switch(i.tag){case 0:case 11:case 15:var u=i.return;try{Rs(4,i)}catch(C){Ke(i,u,C)}break;case 1:var f=i.stateNode;if(typeof f.componentDidMount=="function"){var m=i.return;try{f.componentDidMount()}catch(C){Ke(i,m,C)}}var y=i.return;try{Xa(i)}catch(C){Ke(i,y,C)}break;case 5:var L=i.return;try{Xa(i)}catch(C){Ke(i,L,C)}}}catch(C){Ke(i,i.return,C)}if(i===n){ie=null;break}var I=i.sibling;if(I!==null){I.return=i.return,ie=I;break}ie=i.return}}var ym=Math.ceil,Is=N.ReactCurrentDispatcher,Za=N.ReactCurrentOwner,Dt=N.ReactCurrentBatchConfig,we=0,Qe=null,ze=null,rt=0,At=0,Rr=Ln(0),Ye=0,Si=null,Wn=0,Cs=0,el=0,xi=null,mt=null,tl=0,Ir=1/0,cn=null,ws=!1,nl=null,Dn=null,Ds=!1,kn=null,ks=0,Li=0,rl=null,_s=-1,Ps=0;function dt(){return we&6?Ve():_s!==-1?_s:_s=Ve()}function _n(n){return n.mode&1?we&2&&rt!==0?rt&-rt:em.transition!==null?(Ps===0&&(Ps=ju()),Ps):(n=ke,n!==0||(n=window.event,n=n===void 0?16:nc(n.type)),n):1}function $t(n,i,u,f){if(50<Li)throw Li=0,rl=null,Error(t(185));jr(n,u,f),(!(we&2)||n!==Qe)&&(n===Qe&&(!(we&2)&&(Cs|=u),Ye===4&&Pn(n,rt)),pt(n,f),u===1&&we===0&&!(i.mode&1)&&(Ir=Ve()+500,os&&Rn()))}function pt(n,i){var u=n.callbackNode;eg(n,i);var f=Gi(n,n===Qe?rt:0);if(f===0)u!==null&&Hu(u),n.callbackNode=null,n.callbackPriority=0;else if(i=f&-f,n.callbackPriority!==i){if(u!=null&&Hu(u),i===1)n.tag===0?Zg(nf.bind(null,n)):Gc(nf.bind(null,n)),qg(function(){!(we&6)&&Rn()}),u=null;else{switch(Yu(f)){case 1:u=Mo;break;case 4:u=zu;break;case 16:u=Ni;break;case 536870912:u=Wu;break;default:u=Ni}u=df(u,tf.bind(null,n))}n.callbackPriority=i,n.callbackNode=u}}function tf(n,i){if(_s=-1,Ps=0,we&6)throw Error(t(327));var u=n.callbackNode;if(Cr()&&n.callbackNode!==u)return null;var f=Gi(n,n===Qe?rt:0);if(f===0)return null;if(f&30||f&n.expiredLanes||i)i=Fs(n,f);else{i=f;var m=we;we|=2;var y=sf();(Qe!==n||rt!==i)&&(cn=null,Ir=Ve()+500,Yn(n,i));do try{Tm();break}catch(I){rf(n,I)}while(!0);Sa(),Is.current=y,we=m,ze!==null?i=0:(Qe=null,rt=0,i=Ye)}if(i!==0){if(i===2&&(m=No(n),m!==0&&(f=m,i=il(n,m))),i===1)throw u=Si,Yn(n,0),Pn(n,f),pt(n,Ve()),u;if(i===6)Pn(n,f);else{if(m=n.current.alternate,!(f&30)&&!vm(m)&&(i=Fs(n,f),i===2&&(y=No(n),y!==0&&(f=y,i=il(n,y))),i===1))throw u=Si,Yn(n,0),Pn(n,f),pt(n,Ve()),u;switch(n.finishedWork=m,n.finishedLanes=f,i){case 0:case 1:throw Error(t(345));case 2:qn(n,mt,cn);break;case 3:if(Pn(n,f),(f&130023424)===f&&(i=tl+500-Ve(),10<i)){if(Gi(n,0)!==0)break;if(m=n.suspendedLanes,(m&f)!==f){dt(),n.pingedLanes|=n.suspendedLanes&m;break}n.timeoutHandle=ca(qn.bind(null,n,mt,cn),i);break}qn(n,mt,cn);break;case 4:if(Pn(n,f),(f&4194240)===f)break;for(i=n.eventTimes,m=-1;0<f;){var L=31-Ot(f);y=1<<L,L=i[L],L>m&&(m=L),f&=~y}if(f=m,f=Ve()-f,f=(120>f?120:480>f?480:1080>f?1080:1920>f?1920:3e3>f?3e3:4320>f?4320:1960*ym(f/1960))-f,10<f){n.timeoutHandle=ca(qn.bind(null,n,mt,cn),f);break}qn(n,mt,cn);break;case 5:qn(n,mt,cn);break;default:throw Error(t(329))}}}return pt(n,Ve()),n.callbackNode===u?tf.bind(null,n):null}function il(n,i){var u=xi;return n.current.memoizedState.isDehydrated&&(Yn(n,i).flags|=256),n=Fs(n,i),n!==2&&(i=mt,mt=u,i!==null&&sl(i)),n}function sl(n){mt===null?mt=n:mt.push.apply(mt,n)}function vm(n){for(var i=n;;){if(i.flags&16384){var u=i.updateQueue;if(u!==null&&(u=u.stores,u!==null))for(var f=0;f<u.length;f++){var m=u[f],y=m.getSnapshot;m=m.value;try{if(!bt(y(),m))return!1}catch{return!1}}}if(u=i.child,i.subtreeFlags&16384&&u!==null)u.return=i,i=u;else{if(i===n)break;for(;i.sibling===null;){if(i.return===null||i.return===n)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function Pn(n,i){for(i&=~el,i&=~Cs,n.suspendedLanes|=i,n.pingedLanes&=~i,n=n.expirationTimes;0<i;){var u=31-Ot(i),f=1<<u;n[u]=-1,i&=~f}}function nf(n){if(we&6)throw Error(t(327));Cr();var i=Gi(n,0);if(!(i&1))return pt(n,Ve()),null;var u=Fs(n,i);if(n.tag!==0&&u===2){var f=No(n);f!==0&&(i=f,u=il(n,f))}if(u===1)throw u=Si,Yn(n,0),Pn(n,i),pt(n,Ve()),u;if(u===6)throw Error(t(345));return n.finishedWork=n.current.alternate,n.finishedLanes=i,qn(n,mt,cn),pt(n,Ve()),null}function ol(n,i){var u=we;we|=1;try{return n(i)}finally{we=u,we===0&&(Ir=Ve()+500,os&&Rn())}}function jn(n){kn!==null&&kn.tag===0&&!(we&6)&&Cr();var i=we;we|=1;var u=Dt.transition,f=ke;try{if(Dt.transition=null,ke=1,n)return n()}finally{ke=f,Dt.transition=u,we=i,!(we&6)&&Rn()}}function al(){At=Rr.current,Ne(Rr)}function Yn(n,i){n.finishedWork=null,n.finishedLanes=0;var u=n.timeoutHandle;if(u!==-1&&(n.timeoutHandle=-1,Yg(u)),ze!==null)for(u=ze.return;u!==null;){var f=u;switch(pa(f),f.tag){case 1:f=f.type.childContextTypes,f!=null&&is();break;case 3:xr(),Ne(ft),Ne(st),Da();break;case 5:Ca(f);break;case 4:xr();break;case 13:Ne(Be);break;case 19:Ne(Be);break;case 10:xa(f.type._context);break;case 22:case 23:al()}u=u.return}if(Qe=n,ze=n=Fn(n.current,null),rt=At=i,Ye=0,Si=null,el=Cs=Wn=0,mt=xi=null,Vn!==null){for(i=0;i<Vn.length;i++)if(u=Vn[i],f=u.interleaved,f!==null){u.interleaved=null;var m=f.next,y=u.pending;if(y!==null){var L=y.next;y.next=m,f.next=L}u.pending=f}Vn=null}return n}function rf(n,i){do{var u=ze;try{if(Sa(),ps.current=Ts,ys){for(var f=$e.memoizedState;f!==null;){var m=f.queue;m!==null&&(m.pending=null),f=f.next}ys=!1}if(zn=0,Xe=je=$e=null,mi=!1,pi=0,Za.current=null,u===null||u.return===null){Ye=1,Si=i,ze=null;break}e:{var y=n,L=u.return,I=u,C=i;if(i=rt,I.flags|=32768,C!==null&&typeof C=="object"&&typeof C.then=="function"){var B=C,X=I,J=X.tag;if(!(X.mode&1)&&(J===0||J===11||J===15)){var Y=X.alternate;Y?(X.updateQueue=Y.updateQueue,X.memoizedState=Y.memoizedState,X.lanes=Y.lanes):(X.updateQueue=null,X.memoizedState=null)}var ne=wd(L);if(ne!==null){ne.flags&=-257,Dd(ne,L,I,y,i),ne.mode&1&&Cd(y,B,i),i=ne,C=B;var ae=i.updateQueue;if(ae===null){var le=new Set;le.add(C),i.updateQueue=le}else ae.add(C);break e}else{if(!(i&1)){Cd(y,B,i),ll();break e}C=Error(t(426))}}else if(Ue&&I.mode&1){var He=wd(L);if(He!==null){!(He.flags&65536)&&(He.flags|=256),Dd(He,L,I,y,i),Ea(Lr(C,I));break e}}y=C=Lr(C,I),Ye!==4&&(Ye=2),xi===null?xi=[y]:xi.push(y),y=L;do{switch(y.tag){case 3:y.flags|=65536,i&=-i,y.lanes|=i;var O=Rd(y,C,i);Jc(y,O);break e;case 1:I=C;var _=y.type,M=y.stateNode;if(!(y.flags&128)&&(typeof _.getDerivedStateFromError=="function"||M!==null&&typeof M.componentDidCatch=="function"&&(Dn===null||!Dn.has(M)))){y.flags|=65536,i&=-i,y.lanes|=i;var Z=Id(y,I,i);Jc(y,Z);break e}}y=y.return}while(y!==null)}af(u)}catch(ue){i=ue,ze===u&&u!==null&&(ze=u=u.return);continue}break}while(!0)}function sf(){var n=Is.current;return Is.current=Ts,n===null?Ts:n}function ll(){(Ye===0||Ye===3||Ye===2)&&(Ye=4),Qe===null||!(Wn&268435455)&&!(Cs&268435455)||Pn(Qe,rt)}function Fs(n,i){var u=we;we|=2;var f=sf();(Qe!==n||rt!==i)&&(cn=null,Yn(n,i));do try{Em();break}catch(m){rf(n,m)}while(!0);if(Sa(),we=u,Is.current=f,ze!==null)throw Error(t(261));return Qe=null,rt=0,Ye}function Em(){for(;ze!==null;)of(ze)}function Tm(){for(;ze!==null&&!z0();)of(ze)}function of(n){var i=cf(n.alternate,n,At);n.memoizedProps=n.pendingProps,i===null?af(n):ze=i,Za.current=null}function af(n){var i=n;do{var u=i.alternate;if(n=i.return,i.flags&32768){if(u=hm(u,i),u!==null){u.flags&=32767,ze=u;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Ye=6,ze=null;return}}else if(u=fm(u,i,At),u!==null){ze=u;return}if(i=i.sibling,i!==null){ze=i;return}ze=i=n}while(i!==null);Ye===0&&(Ye=5)}function qn(n,i,u){var f=ke,m=Dt.transition;try{Dt.transition=null,ke=1,Sm(n,i,u,f)}finally{Dt.transition=m,ke=f}return null}function Sm(n,i,u,f){do Cr();while(kn!==null);if(we&6)throw Error(t(327));u=n.finishedWork;var m=n.finishedLanes;if(u===null)return null;if(n.finishedWork=null,n.finishedLanes=0,u===n.current)throw Error(t(177));n.callbackNode=null,n.callbackPriority=0;var y=u.lanes|u.childLanes;if(tg(n,y),n===Qe&&(ze=Qe=null,rt=0),!(u.subtreeFlags&2064)&&!(u.flags&2064)||Ds||(Ds=!0,df(Ni,function(){return Cr(),null})),y=(u.flags&15990)!==0,u.subtreeFlags&15990||y){y=Dt.transition,Dt.transition=null;var L=ke;ke=1;var I=we;we|=4,Za.current=null,mm(n,u),Xd(u,n),Gg(la),Hi=!!aa,la=aa=null,n.current=u,pm(u),W0(),we=I,ke=L,Dt.transition=y}else n.current=u;if(Ds&&(Ds=!1,kn=n,ks=m),y=n.pendingLanes,y===0&&(Dn=null),q0(u.stateNode),pt(n,Ve()),i!==null)for(f=n.onRecoverableError,u=0;u<i.length;u++)m=i[u],f(m.value,{componentStack:m.stack,digest:m.digest});if(ws)throw ws=!1,n=nl,nl=null,n;return ks&1&&n.tag!==0&&Cr(),y=n.pendingLanes,y&1?n===rl?Li++:(Li=0,rl=n):Li=0,Rn(),null}function Cr(){if(kn!==null){var n=Yu(ks),i=Dt.transition,u=ke;try{if(Dt.transition=null,ke=16>n?16:n,kn===null)var f=!1;else{if(n=kn,kn=null,ks=0,we&6)throw Error(t(331));var m=we;for(we|=4,ie=n.current;ie!==null;){var y=ie,L=y.child;if(ie.flags&16){var I=y.deletions;if(I!==null){for(var C=0;C<I.length;C++){var B=I[C];for(ie=B;ie!==null;){var X=ie;switch(X.tag){case 0:case 11:case 15:Ti(8,X,y)}var J=X.child;if(J!==null)J.return=X,ie=J;else for(;ie!==null;){X=ie;var Y=X.sibling,ne=X.return;if(zd(X),X===B){ie=null;break}if(Y!==null){Y.return=ne,ie=Y;break}ie=ne}}}var ae=y.alternate;if(ae!==null){var le=ae.child;if(le!==null){ae.child=null;do{var He=le.sibling;le.sibling=null,le=He}while(le!==null)}}ie=y}}if(y.subtreeFlags&2064&&L!==null)L.return=y,ie=L;else e:for(;ie!==null;){if(y=ie,y.flags&2048)switch(y.tag){case 0:case 11:case 15:Ti(9,y,y.return)}var O=y.sibling;if(O!==null){O.return=y.return,ie=O;break e}ie=y.return}}var _=n.current;for(ie=_;ie!==null;){L=ie;var M=L.child;if(L.subtreeFlags&2064&&M!==null)M.return=L,ie=M;else e:for(L=_;ie!==null;){if(I=ie,I.flags&2048)try{switch(I.tag){case 0:case 11:case 15:Rs(9,I)}}catch(ue){Ke(I,I.return,ue)}if(I===L){ie=null;break e}var Z=I.sibling;if(Z!==null){Z.return=I.return,ie=Z;break e}ie=I.return}}if(we=m,Rn(),Ht&&typeof Ht.onPostCommitFiberRoot=="function")try{Ht.onPostCommitFiberRoot(Ui,n)}catch{}f=!0}return f}finally{ke=u,Dt.transition=i}}return!1}function lf(n,i,u){i=Lr(u,i),i=Rd(n,i,1),n=Cn(n,i,1),i=dt(),n!==null&&(jr(n,1,i),pt(n,i))}function Ke(n,i,u){if(n.tag===3)lf(n,n,u);else for(;i!==null;){if(i.tag===3){lf(i,n,u);break}else if(i.tag===1){var f=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Dn===null||!Dn.has(f))){n=Lr(u,n),n=Id(i,n,1),i=Cn(i,n,1),n=dt(),i!==null&&(jr(i,1,n),pt(i,n));break}}i=i.return}}function xm(n,i,u){var f=n.pingCache;f!==null&&f.delete(i),i=dt(),n.pingedLanes|=n.suspendedLanes&u,Qe===n&&(rt&u)===u&&(Ye===4||Ye===3&&(rt&130023424)===rt&&500>Ve()-tl?Yn(n,0):el|=u),pt(n,i)}function uf(n,i){i===0&&(n.mode&1?(i=$i,$i<<=1,!($i&130023424)&&($i=4194304)):i=1);var u=dt();n=an(n,i),n!==null&&(jr(n,i,u),pt(n,u))}function Lm(n){var i=n.memoizedState,u=0;i!==null&&(u=i.retryLane),uf(n,u)}function Am(n,i){var u=0;switch(n.tag){case 13:var f=n.stateNode,m=n.memoizedState;m!==null&&(u=m.retryLane);break;case 19:f=n.stateNode;break;default:throw Error(t(314))}f!==null&&f.delete(i),uf(n,u)}var cf;cf=function(n,i,u){if(n!==null)if(n.memoizedProps!==i.pendingProps||ft.current)gt=!0;else{if(!(n.lanes&u)&&!(i.flags&128))return gt=!1,dm(n,i,u);gt=!!(n.flags&131072)}else gt=!1,Ue&&i.flags&1048576&&Kc(i,ls,i.index);switch(i.lanes=0,i.tag){case 2:var f=i.type;Ls(n,i),n=i.pendingProps;var m=mr(i,st.current);Sr(i,u),m=Pa(null,i,f,n,m,u);var y=Fa();return i.flags|=1,typeof m=="object"&&m!==null&&typeof m.render=="function"&&m.$$typeof===void 0?(i.tag=1,i.memoizedState=null,i.updateQueue=null,ht(f)?(y=!0,ss(i)):y=!1,i.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,Ra(i),m.updater=Ss,i.stateNode=m,m._reactInternals=i,Ba(i,f,n,u),i=Va(null,i,f,!0,y,u)):(i.tag=0,Ue&&y&&ma(i),ct(null,i,m,u),i=i.child),i;case 16:f=i.elementType;e:{switch(Ls(n,i),n=i.pendingProps,m=f._init,f=m(f._payload),i.type=f,m=i.tag=Im(f),n=Nt(f,n),m){case 0:i=Ka(null,i,f,n,u);break e;case 1:i=bd(null,i,f,n,u);break e;case 11:i=kd(null,i,f,n,u);break e;case 14:i=_d(null,i,f,Nt(f.type,n),u);break e}throw Error(t(306,f,""))}return i;case 0:return f=i.type,m=i.pendingProps,m=i.elementType===f?m:Nt(f,m),Ka(n,i,f,m,u);case 1:return f=i.type,m=i.pendingProps,m=i.elementType===f?m:Nt(f,m),bd(n,i,f,m,u);case 3:e:{if(Md(i),n===null)throw Error(t(387));f=i.pendingProps,y=i.memoizedState,m=y.element,Qc(n,i),gs(i,f,null,u);var L=i.memoizedState;if(f=L.element,y.isDehydrated)if(y={element:f,isDehydrated:!1,cache:L.cache,pendingSuspenseBoundaries:L.pendingSuspenseBoundaries,transitions:L.transitions},i.updateQueue.baseState=y,i.memoizedState=y,i.flags&256){m=Lr(Error(t(423)),i),i=Nd(n,i,f,u,m);break e}else if(f!==m){m=Lr(Error(t(424)),i),i=Nd(n,i,f,u,m);break e}else for(Lt=xn(i.stateNode.containerInfo.firstChild),xt=i,Ue=!0,Mt=null,u=qc(i,null,f,u),i.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling;else{if(vr(),f===m){i=un(n,i,u);break e}ct(n,i,f,u)}i=i.child}return i;case 5:return ed(i),n===null&&va(i),f=i.type,m=i.pendingProps,y=n!==null?n.memoizedProps:null,L=m.children,ua(f,m)?L=null:y!==null&&ua(f,y)&&(i.flags|=32),Od(n,i),ct(n,i,L,u),i.child;case 6:return n===null&&va(i),null;case 13:return Ud(n,i,u);case 4:return Ia(i,i.stateNode.containerInfo),f=i.pendingProps,n===null?i.child=Er(i,null,f,u):ct(n,i,f,u),i.child;case 11:return f=i.type,m=i.pendingProps,m=i.elementType===f?m:Nt(f,m),kd(n,i,f,m,u);case 7:return ct(n,i,i.pendingProps,u),i.child;case 8:return ct(n,i,i.pendingProps.children,u),i.child;case 12:return ct(n,i,i.pendingProps.children,u),i.child;case 10:e:{if(f=i.type._context,m=i.pendingProps,y=i.memoizedProps,L=m.value,Fe(ds,f._currentValue),f._currentValue=L,y!==null)if(bt(y.value,L)){if(y.children===m.children&&!ft.current){i=un(n,i,u);break e}}else for(y=i.child,y!==null&&(y.return=i);y!==null;){var I=y.dependencies;if(I!==null){L=y.child;for(var C=I.firstContext;C!==null;){if(C.context===f){if(y.tag===1){C=ln(-1,u&-u),C.tag=2;var B=y.updateQueue;if(B!==null){B=B.shared;var X=B.pending;X===null?C.next=C:(C.next=X.next,X.next=C),B.pending=C}}y.lanes|=u,C=y.alternate,C!==null&&(C.lanes|=u),La(y.return,u,i),I.lanes|=u;break}C=C.next}}else if(y.tag===10)L=y.type===i.type?null:y.child;else if(y.tag===18){if(L=y.return,L===null)throw Error(t(341));L.lanes|=u,I=L.alternate,I!==null&&(I.lanes|=u),La(L,u,i),L=y.sibling}else L=y.child;if(L!==null)L.return=y;else for(L=y;L!==null;){if(L===i){L=null;break}if(y=L.sibling,y!==null){y.return=L.return,L=y;break}L=L.return}y=L}ct(n,i,m.children,u),i=i.child}return i;case 9:return m=i.type,f=i.pendingProps.children,Sr(i,u),m=Ct(m),f=f(m),i.flags|=1,ct(n,i,f,u),i.child;case 14:return f=i.type,m=Nt(f,i.pendingProps),m=Nt(f.type,m),_d(n,i,f,m,u);case 15:return Pd(n,i,i.type,i.pendingProps,u);case 17:return f=i.type,m=i.pendingProps,m=i.elementType===f?m:Nt(f,m),Ls(n,i),i.tag=1,ht(f)?(n=!0,ss(i)):n=!1,Sr(i,u),Ld(i,f,m),Ba(i,f,m,u),Va(null,i,f,!0,n,u);case 19:return $d(n,i,u);case 22:return Fd(n,i,u)}throw Error(t(156,i.tag))};function df(n,i){return Vu(n,i)}function Rm(n,i,u,f){this.tag=n,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function kt(n,i,u,f){return new Rm(n,i,u,f)}function ul(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Im(n){if(typeof n=="function")return ul(n)?1:0;if(n!=null){if(n=n.$$typeof,n===ge)return 11;if(n===fe)return 14}return 2}function Fn(n,i){var u=n.alternate;return u===null?(u=kt(n.tag,i,n.key,n.mode),u.elementType=n.elementType,u.type=n.type,u.stateNode=n.stateNode,u.alternate=n,n.alternate=u):(u.pendingProps=i,u.type=n.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=n.flags&14680064,u.childLanes=n.childLanes,u.lanes=n.lanes,u.child=n.child,u.memoizedProps=n.memoizedProps,u.memoizedState=n.memoizedState,u.updateQueue=n.updateQueue,i=n.dependencies,u.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},u.sibling=n.sibling,u.index=n.index,u.ref=n.ref,u}function Os(n,i,u,f,m,y){var L=2;if(f=n,typeof n=="function")ul(n)&&(L=1);else if(typeof n=="string")L=5;else e:switch(n){case U:return Xn(u.children,m,y,i);case j:L=8,m|=8;break;case ee:return n=kt(12,u,i,m|2),n.elementType=ee,n.lanes=y,n;case te:return n=kt(13,u,i,m),n.elementType=te,n.lanes=y,n;case de:return n=kt(19,u,i,m),n.elementType=de,n.lanes=y,n;case he:return bs(u,m,y,i);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case H:L=10;break e;case Q:L=9;break e;case ge:L=11;break e;case fe:L=14;break e;case oe:L=16,f=null;break e}throw Error(t(130,n==null?n:typeof n,""))}return i=kt(L,u,i,m),i.elementType=n,i.type=f,i.lanes=y,i}function Xn(n,i,u,f){return n=kt(7,n,f,i),n.lanes=u,n}function bs(n,i,u,f){return n=kt(22,n,f,i),n.elementType=he,n.lanes=u,n.stateNode={isHidden:!1},n}function cl(n,i,u){return n=kt(6,n,null,i),n.lanes=u,n}function dl(n,i,u){return i=kt(4,n.children!==null?n.children:[],n.key,i),i.lanes=u,i.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},i}function Cm(n,i,u,f,m){this.tag=i,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Uo(0),this.expirationTimes=Uo(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Uo(0),this.identifierPrefix=f,this.onRecoverableError=m,this.mutableSourceEagerHydrationData=null}function fl(n,i,u,f,m,y,L,I,C){return n=new Cm(n,i,u,I,C),i===1?(i=1,y===!0&&(i|=8)):i=0,y=kt(3,null,null,i),n.current=y,y.stateNode=n,y.memoizedState={element:f,isDehydrated:u,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ra(y),n}function wm(n,i,u){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:V,key:f==null?null:""+f,children:n,containerInfo:i,implementation:u}}function ff(n){if(!n)return An;n=n._reactInternals;e:{if(Un(n)!==n||n.tag!==1)throw Error(t(170));var i=n;do{switch(i.tag){case 3:i=i.stateNode.context;break e;case 1:if(ht(i.type)){i=i.stateNode.__reactInternalMemoizedMergedChildContext;break e}}i=i.return}while(i!==null);throw Error(t(171))}if(n.tag===1){var u=n.type;if(ht(u))return Bc(n,u,i)}return i}function hf(n,i,u,f,m,y,L,I,C){return n=fl(u,f,!0,n,m,y,L,I,C),n.context=ff(null),u=n.current,f=dt(),m=_n(u),y=ln(f,m),y.callback=i??null,Cn(u,y,m),n.current.lanes=m,jr(n,m,f),pt(n,f),n}function Ms(n,i,u,f){var m=i.current,y=dt(),L=_n(m);return u=ff(u),i.context===null?i.context=u:i.pendingContext=u,i=ln(y,L),i.payload={element:n},f=f===void 0?null:f,f!==null&&(i.callback=f),n=Cn(m,i,L),n!==null&&($t(n,m,L,y),hs(n,m,L)),L}function Ns(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function gf(n,i){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var u=n.retryLane;n.retryLane=u!==0&&u<i?u:i}}function hl(n,i){gf(n,i),(n=n.alternate)&&gf(n,i)}function Dm(){return null}var mf=typeof reportError=="function"?reportError:function(n){console.error(n)};function gl(n){this._internalRoot=n}Us.prototype.render=gl.prototype.render=function(n){var i=this._internalRoot;if(i===null)throw Error(t(409));Ms(n,i,null,null)},Us.prototype.unmount=gl.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var i=n.containerInfo;jn(function(){Ms(null,n,null,null)}),i[nn]=null}};function Us(n){this._internalRoot=n}Us.prototype.unstable_scheduleHydration=function(n){if(n){var i=Qu();n={blockedOn:null,target:n,priority:i};for(var u=0;u<En.length&&i!==0&&i<En[u].priority;u++);En.splice(u,0,n),u===0&&ec(n)}};function ml(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Bs(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function pf(){}function km(n,i,u,f,m){if(m){if(typeof f=="function"){var y=f;f=function(){var B=Ns(L);y.call(B)}}var L=hf(i,f,n,0,null,!1,!1,"",pf);return n._reactRootContainer=L,n[nn]=L.current,ai(n.nodeType===8?n.parentNode:n),jn(),L}for(;m=n.lastChild;)n.removeChild(m);if(typeof f=="function"){var I=f;f=function(){var B=Ns(C);I.call(B)}}var C=fl(n,0,!1,null,null,!1,!1,"",pf);return n._reactRootContainer=C,n[nn]=C.current,ai(n.nodeType===8?n.parentNode:n),jn(function(){Ms(i,C,u,f)}),C}function $s(n,i,u,f,m){var y=u._reactRootContainer;if(y){var L=y;if(typeof m=="function"){var I=m;m=function(){var C=Ns(L);I.call(C)}}Ms(i,L,n,m)}else L=km(u,i,n,m,f);return Ns(L)}qu=function(n){switch(n.tag){case 3:var i=n.stateNode;if(i.current.memoizedState.isDehydrated){var u=Wr(i.pendingLanes);u!==0&&(Bo(i,u|1),pt(i,Ve()),!(we&6)&&(Ir=Ve()+500,Rn()))}break;case 13:jn(function(){var f=an(n,1);if(f!==null){var m=dt();$t(f,n,1,m)}}),hl(n,1)}},$o=function(n){if(n.tag===13){var i=an(n,134217728);if(i!==null){var u=dt();$t(i,n,134217728,u)}hl(n,134217728)}},Xu=function(n){if(n.tag===13){var i=_n(n),u=an(n,i);if(u!==null){var f=dt();$t(u,n,i,f)}hl(n,i)}},Qu=function(){return ke},Ju=function(n,i){var u=ke;try{return ke=n,i()}finally{ke=u}},Po=function(n,i,u){switch(i){case"input":if(Ao(n,u),i=u.name,u.type==="radio"&&i!=null){for(u=n;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),i=0;i<u.length;i++){var f=u[i];if(f!==n&&f.form===n.form){var m=rs(f);if(!m)throw Error(t(90));xu(f),Ao(f,m)}}}break;case"textarea":Cu(n,u);break;case"select":i=u.value,i!=null&&rr(n,!!u.multiple,i,!1)}},Mu=ol,Nu=jn;var _m={usingClientEntryPoint:!1,Events:[ci,hr,rs,Ou,bu,ol]},Ai={findFiberByHostInstance:Bn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Pm={bundleType:Ai.bundleType,version:Ai.version,rendererPackageName:Ai.rendererPackageName,rendererConfig:Ai.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:N.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=Gu(n),n===null?null:n.stateNode},findFiberByHostInstance:Ai.findFiberByHostInstance||Dm,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Gs=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Gs.isDisabled&&Gs.supportsFiber)try{Ui=Gs.inject(Pm),Ht=Gs}catch{}}return yt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=_m,yt.createPortal=function(n,i){var u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ml(i))throw Error(t(200));return wm(n,i,null,u)},yt.createRoot=function(n,i){if(!ml(n))throw Error(t(299));var u=!1,f="",m=mf;return i!=null&&(i.unstable_strictMode===!0&&(u=!0),i.identifierPrefix!==void 0&&(f=i.identifierPrefix),i.onRecoverableError!==void 0&&(m=i.onRecoverableError)),i=fl(n,1,!1,null,null,u,!1,f,m),n[nn]=i.current,ai(n.nodeType===8?n.parentNode:n),new gl(i)},yt.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var i=n._reactInternals;if(i===void 0)throw typeof n.render=="function"?Error(t(188)):(n=Object.keys(n).join(","),Error(t(268,n)));return n=Gu(i),n=n===null?null:n.stateNode,n},yt.flushSync=function(n){return jn(n)},yt.hydrate=function(n,i,u){if(!Bs(i))throw Error(t(200));return $s(null,n,i,!0,u)},yt.hydrateRoot=function(n,i,u){if(!ml(n))throw Error(t(405));var f=u!=null&&u.hydratedSources||null,m=!1,y="",L=mf;if(u!=null&&(u.unstable_strictMode===!0&&(m=!0),u.identifierPrefix!==void 0&&(y=u.identifierPrefix),u.onRecoverableError!==void 0&&(L=u.onRecoverableError)),i=hf(i,null,n,1,u??null,m,!1,y,L),n[nn]=i.current,ai(n),f)for(n=0;n<f.length;n++)u=f[n],m=u._getVersion,m=m(u._source),i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[u,m]:i.mutableSourceEagerHydrationData.push(u,m);return new Us(i)},yt.render=function(n,i,u){if(!Bs(i))throw Error(t(200));return $s(null,n,i,!1,u)},yt.unmountComponentAtNode=function(n){if(!Bs(n))throw Error(t(40));return n._reactRootContainer?(jn(function(){$s(null,null,n,!1,function(){n._reactRootContainer=null,n[nn]=null})}),!0):!1},yt.unstable_batchedUpdates=ol,yt.unstable_renderSubtreeIntoContainer=function(n,i,u,f){if(!Bs(u))throw Error(t(200));if(n==null||n._reactInternals===void 0)throw Error(t(38));return $s(n,i,u,!1,f)},yt.version="18.3.1-next-f1338f8080-20240426",yt}var Af;function $m(){if(Af)return vl.exports;Af=1;function l(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(l)}catch(e){console.error(e)}}return l(),vl.exports=Bm(),vl.exports}var Rf;function Gm(){if(Rf)return Ks;Rf=1;var l=$m();return Ks.createRoot=l.createRoot,Ks.hydrateRoot=l.hydrateRoot,Ks}var Km=Gm();function Vm(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var kh={exports:{}};(function(l,e){(function(t){var r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,o=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,c={buildAbsoluteURL:function(d,h,g){if(g=g||{},d=d.trim(),h=h.trim(),!h){if(!g.alwaysNormalize)return d;var p=c.parseURL(d);if(!p)throw new Error("Error trying to parse base URL.");return p.path=c.normalizePath(p.path),c.buildURLFromParts(p)}var v=c.parseURL(h);if(!v)throw new Error("Error trying to parse relative URL.");if(v.scheme)return g.alwaysNormalize?(v.path=c.normalizePath(v.path),c.buildURLFromParts(v)):h;var T=c.parseURL(d);if(!T)throw new Error("Error trying to parse base URL.");if(!T.netLoc&&T.path&&T.path[0]!=="/"){var E=s.exec(T.path);T.netLoc=E[1],T.path=E[2]}T.netLoc&&!T.path&&(T.path="/");var S={scheme:T.scheme,netLoc:v.netLoc,path:null,params:v.params,query:v.query,fragment:v.fragment};if(!v.netLoc&&(S.netLoc=T.netLoc,v.path[0]!=="/"))if(!v.path)S.path=T.path,v.params||(S.params=T.params,v.query||(S.query=T.query));else{var A=T.path,R=A.substring(0,A.lastIndexOf("/")+1)+v.path;S.path=c.normalizePath(R)}return S.path===null&&(S.path=g.alwaysNormalize?c.normalizePath(v.path):v.path),c.buildURLFromParts(S)},parseURL:function(d){var h=r.exec(d);return h?{scheme:h[1]||"",netLoc:h[2]||"",path:h[3]||"",params:h[4]||"",query:h[5]||"",fragment:h[6]||""}:null},normalizePath:function(d){for(d=d.split("").reverse().join("").replace(o,"");d.length!==(d=d.replace(a,"")).length;);return d.split("").reverse().join("")},buildURLFromParts:function(d){return d.scheme+d.netLoc+d.path+d.params+d.query+d.fragment}};l.exports=c})()})(kh);var iu=kh.exports;function If(l,e){var t=Object.keys(l);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(l);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(l,s).enumerable})),t.push.apply(t,r)}return t}function tt(l){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?If(Object(t),!0).forEach(function(r){Wm(l,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(t)):If(Object(t)).forEach(function(r){Object.defineProperty(l,r,Object.getOwnPropertyDescriptor(t,r))})}return l}function Hm(l,e){if(typeof l!="object"||!l)return l;var t=l[Symbol.toPrimitive];if(t!==void 0){var r=t.call(l,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(l)}function zm(l){var e=Hm(l,"string");return typeof e=="symbol"?e:String(e)}function Wm(l,e,t){return e=zm(e),e in l?Object.defineProperty(l,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):l[e]=t,l}function We(){return We=Object.assign?Object.assign.bind():function(l){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(l[r]=t[r])}return l},We.apply(this,arguments)}const se=Number.isFinite||function(l){return typeof l=="number"&&isFinite(l)},jm=Number.isSafeInteger||function(l){return typeof l=="number"&&Math.abs(l)<=Ym},Ym=Number.MAX_SAFE_INTEGER||9007199254740991;let x=function(l){return l.MEDIA_ATTACHING="hlsMediaAttaching",l.MEDIA_ATTACHED="hlsMediaAttached",l.MEDIA_DETACHING="hlsMediaDetaching",l.MEDIA_DETACHED="hlsMediaDetached",l.BUFFER_RESET="hlsBufferReset",l.BUFFER_CODECS="hlsBufferCodecs",l.BUFFER_CREATED="hlsBufferCreated",l.BUFFER_APPENDING="hlsBufferAppending",l.BUFFER_APPENDED="hlsBufferAppended",l.BUFFER_EOS="hlsBufferEos",l.BUFFER_FLUSHING="hlsBufferFlushing",l.BUFFER_FLUSHED="hlsBufferFlushed",l.MANIFEST_LOADING="hlsManifestLoading",l.MANIFEST_LOADED="hlsManifestLoaded",l.MANIFEST_PARSED="hlsManifestParsed",l.LEVEL_SWITCHING="hlsLevelSwitching",l.LEVEL_SWITCHED="hlsLevelSwitched",l.LEVEL_LOADING="hlsLevelLoading",l.LEVEL_LOADED="hlsLevelLoaded",l.LEVEL_UPDATED="hlsLevelUpdated",l.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",l.LEVELS_UPDATED="hlsLevelsUpdated",l.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",l.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",l.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",l.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",l.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",l.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",l.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",l.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",l.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",l.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",l.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",l.CUES_PARSED="hlsCuesParsed",l.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",l.INIT_PTS_FOUND="hlsInitPtsFound",l.FRAG_LOADING="hlsFragLoading",l.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",l.FRAG_LOADED="hlsFragLoaded",l.FRAG_DECRYPTED="hlsFragDecrypted",l.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",l.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",l.FRAG_PARSING_METADATA="hlsFragParsingMetadata",l.FRAG_PARSED="hlsFragParsed",l.FRAG_BUFFERED="hlsFragBuffered",l.FRAG_CHANGED="hlsFragChanged",l.FPS_DROP="hlsFpsDrop",l.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",l.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",l.ERROR="hlsError",l.DESTROYING="hlsDestroying",l.KEY_LOADING="hlsKeyLoading",l.KEY_LOADED="hlsKeyLoaded",l.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",l.BACK_BUFFER_REACHED="hlsBackBufferReached",l.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",l}({}),Se=function(l){return l.NETWORK_ERROR="networkError",l.MEDIA_ERROR="mediaError",l.KEY_SYSTEM_ERROR="keySystemError",l.MUX_ERROR="muxError",l.OTHER_ERROR="otherError",l}({}),G=function(l){return l.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",l.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",l.KEY_SYSTEM_NO_SESSION="keySystemNoSession",l.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",l.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",l.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",l.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",l.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",l.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",l.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",l.MANIFEST_LOAD_ERROR="manifestLoadError",l.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",l.MANIFEST_PARSING_ERROR="manifestParsingError",l.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",l.LEVEL_EMPTY_ERROR="levelEmptyError",l.LEVEL_LOAD_ERROR="levelLoadError",l.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",l.LEVEL_PARSING_ERROR="levelParsingError",l.LEVEL_SWITCH_ERROR="levelSwitchError",l.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",l.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",l.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",l.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",l.FRAG_LOAD_ERROR="fragLoadError",l.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",l.FRAG_DECRYPT_ERROR="fragDecryptError",l.FRAG_PARSING_ERROR="fragParsingError",l.FRAG_GAP="fragGap",l.REMUX_ALLOC_ERROR="remuxAllocError",l.KEY_LOAD_ERROR="keyLoadError",l.KEY_LOAD_TIMEOUT="keyLoadTimeOut",l.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",l.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",l.BUFFER_APPEND_ERROR="bufferAppendError",l.BUFFER_APPENDING_ERROR="bufferAppendingError",l.BUFFER_STALLED_ERROR="bufferStalledError",l.BUFFER_FULL_ERROR="bufferFullError",l.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",l.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",l.INTERNAL_EXCEPTION="internalException",l.INTERNAL_ABORTED="aborted",l.UNKNOWN="unknown",l}({});const Zn=function(){},Kl={trace:Zn,debug:Zn,log:Zn,warn:Zn,info:Zn,error:Zn};let wi=Kl;function qm(l){const e=self.console[l];return e?e.bind(self.console,`[${l}] >`):Zn}function Xm(l,...e){e.forEach(function(t){wi[t]=l[t]?l[t].bind(l):qm(t)})}function Qm(l,e){if(typeof console=="object"&&l===!0||typeof l=="object"){Xm(l,"debug","log","info","warn","error");try{wi.log(`Debug logs enabled for "${e}" in hls.js version 1.5.17`)}catch{wi=Kl}}else wi=Kl}const F=wi,Jm=/^(\d+)x(\d+)$/,Cf=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Ge{constructor(e){typeof e=="string"&&(e=Ge.parseAttrList(e)),We(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const r=new Uint8Array(t.length/2);for(let s=0;s<t.length/2;s++)r[s]=parseInt(t.slice(s*2,s*2+2),16);return r}else return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}bool(e){return this[e]==="YES"}decimalResolution(e){const t=Jm.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e){let t;const r={},s='"';for(Cf.lastIndex=0;(t=Cf.exec(e))!==null;){let o=t[2];o.indexOf(s)===0&&o.lastIndexOf(s)===o.length-1&&(o=o.slice(1,-1));const a=t[1].trim();r[a]=o}return r}}function Zm(l){return l!=="ID"&&l!=="CLASS"&&l!=="START-DATE"&&l!=="DURATION"&&l!=="END-DATE"&&l!=="END-ON-NEXT"}function ep(l){return l==="SCTE35-OUT"||l==="SCTE35-IN"}class _h{constructor(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){const r=t.attr;for(const s in r)if(Object.prototype.hasOwnProperty.call(e,s)&&e[s]!==r[s]){F.warn(`DATERANGE tag attribute: "${s}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=s;break}e=We(new Ge({}),r,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const r=new Date(this.attr["END-DATE"]);se(r.getTime())&&(this._endDate=r)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const e=this.duration;return e!==null?new Date(this._startDate.getTime()+e*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(se(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&se(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class So{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var _e={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class Ph{constructor(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[_e.AUDIO]:null,[_e.VIDEO]:null,[_e.AUDIOVIDEO]:null},this.baseurl=e}setByteRange(e,t){const r=e.split("@",2);let s;r.length===1?s=(t==null?void 0:t.byteRangeEndOffset)||0:s=parseInt(r[1]),this._byteRange=[s,parseInt(r[0])+s]}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=iu.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}}class Sl extends Ph{constructor(e,t){super(t),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new So,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const r=Object.keys(this.levelkeys);if(r.length===1)return this._decryptdata=this.levelkeys[r[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null||!se(this.programDateTime))return null;const e=se(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),r=t.length;if(r>1||r===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,r,s,o,a=!1){const{elementaryStreams:c}=this,d=c[e];if(!d){c[e]={startPTS:t,endPTS:r,startDTS:s,endDTS:o,partial:a};return}d.startPTS=Math.min(d.startPTS,t),d.endPTS=Math.max(d.endPTS,r),d.startDTS=Math.min(d.startDTS,s),d.endDTS=Math.max(d.endDTS,o)}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[_e.AUDIO]=null,e[_e.VIDEO]=null,e[_e.AUDIOVIDEO]=null}}class tp extends Ph{constructor(e,t,r,s,o){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new So,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=s;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,o),o&&(this.fragOffset=o.fragOffset+o.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}const np=10;class rp{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&r>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay}get hasProgramDateTime(){return this.fragments.length?se(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||np}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function su(l){return Uint8Array.from(atob(l),e=>e.charCodeAt(0))}function ip(l){const e=Vl(l).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function sp(l){const e=function(r,s,o){const a=r[s];r[s]=r[o],r[o]=a};e(l,0,3),e(l,1,2),e(l,4,5),e(l,6,7)}function op(l){const e=l.split(":");let t=null;if(e[0]==="data"&&e.length===2){const r=e[1].split(";"),s=r[r.length-1].split(",");if(s.length===2){const o=s[0]==="base64",a=s[1];o?(r.splice(-1,1),t=su(a)):t=ip(a)}}return t}function Vl(l){return Uint8Array.from(unescape(encodeURIComponent(l)),e=>e.charCodeAt(0))}const Mr=typeof self<"u"?self:void 0;var be={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Et={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function wf(l){switch(l){case Et.FAIRPLAY:return be.FAIRPLAY;case Et.PLAYREADY:return be.PLAYREADY;case Et.WIDEVINE:return be.WIDEVINE;case Et.CLEARKEY:return be.CLEARKEY}}var Ci={CENC:"1077efecc0b24d02ace33c1e52e2fb4b",CLEARKEY:"e2719d58a985b3c9781ab030af78d30e",FAIRPLAY:"94ce86fb07ff4f43adb893d2fa968ca2",PLAYREADY:"9a04f07998404286ab92e65be0885f95",WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function Df(l){if(l===Ci.WIDEVINE)return be.WIDEVINE;if(l===Ci.PLAYREADY)return be.PLAYREADY;if(l===Ci.CENC||l===Ci.CLEARKEY)return be.CLEARKEY}function kf(l){switch(l){case be.FAIRPLAY:return Et.FAIRPLAY;case be.PLAYREADY:return Et.PLAYREADY;case be.WIDEVINE:return Et.WIDEVINE;case be.CLEARKEY:return Et.CLEARKEY}}function xl(l){const{drmSystems:e,widevineLicenseUrl:t}=l,r=e?[be.FAIRPLAY,be.WIDEVINE,be.PLAYREADY,be.CLEARKEY].filter(s=>!!e[s]):[];return!r[be.WIDEVINE]&&t&&r.push(be.WIDEVINE),r}const Fh=function(l){return Mr!=null&&(l=Mr.navigator)!=null&&l.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function ap(l,e,t,r){let s;switch(l){case be.FAIRPLAY:s=["cenc","sinf"];break;case be.WIDEVINE:case be.PLAYREADY:s=["cenc"];break;case be.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${l}`)}return lp(s,e,t,r)}function lp(l,e,t,r){return[{initDataTypes:l,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:e.map(o=>({contentType:`audio/mp4; codecs="${o}"`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:t.map(o=>({contentType:`video/mp4; codecs="${o}"`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}function tr(l,e,t){return Uint8Array.prototype.slice?l.slice(e,t):new Uint8Array(Array.prototype.slice.call(l,e,t))}const ou=(l,e)=>e+10<=l.length&&l[e]===73&&l[e+1]===68&&l[e+2]===51&&l[e+3]<255&&l[e+4]<255&&l[e+6]<128&&l[e+7]<128&&l[e+8]<128&&l[e+9]<128,Oh=(l,e)=>e+10<=l.length&&l[e]===51&&l[e+1]===68&&l[e+2]===73&&l[e+3]<255&&l[e+4]<255&&l[e+6]<128&&l[e+7]<128&&l[e+8]<128&&l[e+9]<128,Di=(l,e)=>{const t=e;let r=0;for(;ou(l,e);){r+=10;const s=xo(l,e+6);r+=s,Oh(l,e+10)&&(r+=10),e+=r}if(r>0)return l.subarray(t,t+r)},xo=(l,e)=>{let t=0;return t=(l[e]&127)<<21,t|=(l[e+1]&127)<<14,t|=(l[e+2]&127)<<7,t|=l[e+3]&127,t},up=(l,e)=>ou(l,e)&&xo(l,e+6)+10<=l.length-e,au=l=>{const e=Mh(l);for(let t=0;t<e.length;t++){const r=e[t];if(bh(r))return mp(r)}},bh=l=>l&&l.key==="PRIV"&&l.info==="com.apple.streaming.transportStreamTimestamp",cp=l=>{const e=String.fromCharCode(l[0],l[1],l[2],l[3]),t=xo(l,4),r=10;return{type:e,size:t,data:l.subarray(r,r+t)}},Mh=l=>{let e=0;const t=[];for(;ou(l,e);){const r=xo(l,e+6);e+=10;const s=e+r;for(;e+8<s;){const o=cp(l.subarray(e)),a=dp(o);a&&t.push(a),e+=o.size+10}Oh(l,e)&&(e+=10)}return t},dp=l=>l.type==="PRIV"?fp(l):l.type[0]==="W"?gp(l):hp(l),fp=l=>{if(l.size<2)return;const e=en(l.data,!0),t=new Uint8Array(l.data.subarray(e.length+1));return{key:l.type,info:e,data:t.buffer}},hp=l=>{if(l.size<2)return;if(l.type==="TXXX"){let t=1;const r=en(l.data.subarray(t),!0);t+=r.length+1;const s=en(l.data.subarray(t));return{key:l.type,info:r,data:s}}const e=en(l.data.subarray(1));return{key:l.type,data:e}},gp=l=>{if(l.type==="WXXX"){if(l.size<2)return;let t=1;const r=en(l.data.subarray(t),!0);t+=r.length+1;const s=en(l.data.subarray(t));return{key:l.type,info:r,data:s}}const e=en(l.data);return{key:l.type,data:e}},mp=l=>{if(l.data.byteLength===8){const e=new Uint8Array(l.data),t=e[3]&1;let r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,t&&(r+=4772185884e-2),Math.round(r)}},en=(l,e=!1)=>{const t=pp();if(t){const h=t.decode(l);if(e){const g=h.indexOf("\0");return g!==-1?h.substring(0,g):h}return h.replace(/\0/g,"")}const r=l.length;let s,o,a,c="",d=0;for(;d<r;){if(s=l[d++],s===0&&e)return c;if(s===0||s===3)continue;switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:c+=String.fromCharCode(s);break;case 12:case 13:o=l[d++],c+=String.fromCharCode((s&31)<<6|o&63);break;case 14:o=l[d++],a=l[d++],c+=String.fromCharCode((s&15)<<12|(o&63)<<6|(a&63)<<0);break}}return c};let Ll;function pp(){if(!navigator.userAgent.includes("PlayStation 4"))return!Ll&&typeof self.TextDecoder<"u"&&(Ll=new self.TextDecoder("utf-8")),Ll}const Xt={hexDump:function(l){let e="";for(let t=0;t<l.length;t++){let r=l[t].toString(16);r.length<2&&(r="0"+r),e+=r}return e}},uo=Math.pow(2,32)-1,yp=[].push,Nh={video:1,audio:2,id3:3,text:4};function qe(l){return String.fromCharCode.apply(null,l)}function Uh(l,e){const t=l[e]<<8|l[e+1];return t<0?65536+t:t}function ye(l,e){const t=Bh(l,e);return t<0?4294967296+t:t}function _f(l,e){let t=ye(l,e);return t*=Math.pow(2,32),t+=ye(l,e+4),t}function Bh(l,e){return l[e]<<24|l[e+1]<<16|l[e+2]<<8|l[e+3]}function Al(l,e,t){l[e]=t>>24,l[e+1]=t>>16&255,l[e+2]=t>>8&255,l[e+3]=t&255}function vp(l){const e=l.byteLength;for(let t=0;t<e;){const r=ye(l,t);if(r>8&&l[t+4]===109&&l[t+5]===111&&l[t+6]===111&&l[t+7]===102)return!0;t=r>1?t+r:e}return!1}function Le(l,e){const t=[];if(!e.length)return t;const r=l.byteLength;for(let s=0;s<r;){const o=ye(l,s),a=qe(l.subarray(s+4,s+8)),c=o>1?s+o:r;if(a===e[0])if(e.length===1)t.push(l.subarray(s+8,c));else{const d=Le(l.subarray(s+8,c),e.slice(1));d.length&&yp.apply(t,d)}s=c}return t}function Ep(l){const e=[],t=l[0];let r=8;const s=ye(l,r);r+=4;let o=0,a=0;t===0?(o=ye(l,r),a=ye(l,r+4),r+=8):(o=_f(l,r),a=_f(l,r+8),r+=16),r+=2;let c=l.length+a;const d=Uh(l,r);r+=2;for(let h=0;h<d;h++){let g=r;const p=ye(l,g);g+=4;const v=p&2147483647;if((p&2147483648)>>>31===1)return F.warn("SIDX has hierarchical references (not supported)"),null;const E=ye(l,g);g+=4,e.push({referenceSize:v,subsegmentDuration:E,info:{duration:E/s,start:c,end:c+v-1}}),c+=v,g+=4,r=g}return{earliestPresentationTime:o,timescale:s,version:t,referencesCount:d,references:e}}function $h(l){const e=[],t=Le(l,["moov","trak"]);for(let s=0;s<t.length;s++){const o=t[s],a=Le(o,["tkhd"])[0];if(a){let c=a[0];const d=ye(a,c===0?12:20),h=Le(o,["mdia","mdhd"])[0];if(h){c=h[0];const g=ye(h,c===0?12:20),p=Le(o,["mdia","hdlr"])[0];if(p){const v=qe(p.subarray(8,12)),T={soun:_e.AUDIO,vide:_e.VIDEO}[v];if(T){const E=Le(o,["mdia","minf","stbl","stsd"])[0],S=Tp(E);e[d]={timescale:g,type:T},e[T]=tt({timescale:g,id:d},S)}}}}}return Le(l,["moov","mvex","trex"]).forEach(s=>{const o=ye(s,4),a=e[o];a&&(a.default={duration:ye(s,12),flags:ye(s,20)})}),e}function Tp(l){const e=l.subarray(8),t=e.subarray(86),r=qe(e.subarray(4,8));let s=r;const o=r==="enca"||r==="encv";if(o){const c=Le(e,[r])[0].subarray(r==="enca"?28:78);Le(c,["sinf"]).forEach(h=>{const g=Le(h,["schm"])[0];if(g){const p=qe(g.subarray(4,8));if(p==="cbcs"||p==="cenc"){const v=Le(h,["frma"])[0];v&&(s=qe(v))}}})}switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{const a=Le(t,["avcC"])[0];s+="."+Vs(a[1])+Vs(a[2])+Vs(a[3]);break}case"mp4a":{const a=Le(e,[r])[0],c=Le(a.subarray(28),["esds"])[0];if(c&&c.length>12){let d=4;if(c[d++]!==3)break;d=Rl(c,d),d+=2;const h=c[d++];if(h&128&&(d+=2),h&64&&(d+=c[d++]),c[d++]!==4)break;d=Rl(c,d);const g=c[d++];if(g===64)s+="."+Vs(g);else break;if(d+=12,c[d++]!==5)break;d=Rl(c,d);const p=c[d++];let v=(p&248)>>3;v===31&&(v+=1+((p&7)<<3)+((c[d]&224)>>5)),s+="."+v}break}case"hvc1":case"hev1":{const a=Le(t,["hvcC"])[0],c=a[1],d=["","A","B","C"][c>>6],h=c&31,g=ye(a,2),p=(c&32)>>5?"H":"L",v=a[12],T=a.subarray(6,12);s+="."+d+h,s+="."+g.toString(16).toUpperCase(),s+="."+p+v;let E="";for(let S=T.length;S--;){const A=T[S];(A||E)&&(E="."+A.toString(16).toUpperCase()+E)}s+=E;break}case"dvh1":case"dvhe":{const a=Le(t,["dvcC"])[0],c=a[2]>>1&127,d=a[2]<<5&32|a[3]>>3&31;s+="."+qt(c)+"."+qt(d);break}case"vp09":{const a=Le(t,["vpcC"])[0],c=a[4],d=a[5],h=a[6]>>4&15;s+="."+qt(c)+"."+qt(d)+"."+qt(h);break}case"av01":{const a=Le(t,["av1C"])[0],c=a[1]>>>5,d=a[1]&31,h=a[2]>>>7?"H":"M",g=(a[2]&64)>>6,p=(a[2]&32)>>5,v=c===2&&g?p?12:10:g?10:8,T=(a[2]&16)>>4,E=(a[2]&8)>>3,S=(a[2]&4)>>2,A=a[2]&3;s+="."+c+"."+qt(d)+h+"."+qt(v)+"."+T+"."+E+S+A+"."+qt(1)+"."+qt(1)+"."+qt(1)+"."+0;break}}return{codec:s,encrypted:o}}function Rl(l,e){const t=e+5;for(;l[e++]&128&&e<t;);return e}function Vs(l){return("0"+l.toString(16).toUpperCase()).slice(-2)}function qt(l){return(l<10?"0":"")+l}function Sp(l,e){if(!l||!e)return l;const t=e.keyId;return t&&e.isCommonEncryption&&Le(l,["moov","trak"]).forEach(s=>{const a=Le(s,["mdia","minf","stbl","stsd"])[0].subarray(8);let c=Le(a,["enca"]);const d=c.length>0;d||(c=Le(a,["encv"])),c.forEach(h=>{const g=d?h.subarray(28):h.subarray(78);Le(g,["sinf"]).forEach(v=>{const T=Gh(v);if(T){const E=T.subarray(8,24);E.some(S=>S!==0)||(F.log(`[eme] Patching keyId in 'enc${d?"a":"v"}>sinf>>tenc' box: ${Xt.hexDump(E)} -> ${Xt.hexDump(t)}`),T.set(t,8))}})})}),l}function Gh(l){const e=Le(l,["schm"])[0];if(e){const t=qe(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return Le(l,["schi","tenc"])[0]}return null}function xp(l,e){return Le(e,["moof","traf"]).reduce((t,r)=>{const s=Le(r,["tfdt"])[0],o=s[0],a=Le(r,["tfhd"]).reduce((c,d)=>{const h=ye(d,4),g=l[h];if(g){let p=ye(s,4);if(o===1){if(p===uo)return F.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),c;p*=uo+1,p+=ye(s,8)}const v=g.timescale||9e4,T=p/v;if(se(T)&&(c===null||T<c))return T}return c},null);return a!==null&&se(a)&&(t===null||a<t)?a:t},null)}function Lp(l,e){let t=0,r=0,s=0;const o=Le(l,["moof","traf"]);for(let a=0;a<o.length;a++){const c=o[a],d=Le(c,["tfhd"])[0],h=ye(d,4),g=e[h];if(!g)continue;const p=g.default,v=ye(d,0)|(p==null?void 0:p.flags);let T=p==null?void 0:p.duration;v&8&&(v&2?T=ye(d,12):T=ye(d,8));const E=g.timescale||9e4,S=Le(c,["trun"]);for(let A=0;A<S.length;A++){if(t=Ap(S[A]),!t&&T){const R=ye(S[A],4);t=T*R}g.type===_e.VIDEO?r+=t/E:g.type===_e.AUDIO&&(s+=t/E)}}if(r===0&&s===0){let a=1/0,c=0,d=0;const h=Le(l,["sidx"]);for(let g=0;g<h.length;g++){const p=Ep(h[g]);if(p!=null&&p.references){a=Math.min(a,p.earliestPresentationTime/p.timescale);const v=p.references.reduce((T,E)=>T+E.info.duration||0,0);c=Math.max(c,v+p.earliestPresentationTime/p.timescale),d=c-a}}if(d&&se(d))return d}return r||s}function Ap(l){const e=ye(l,0);let t=8;e&1&&(t+=4),e&4&&(t+=4);let r=0;const s=ye(l,4);for(let o=0;o<s;o++){if(e&256){const a=ye(l,t);r+=a,t+=4}e&512&&(t+=4),e&1024&&(t+=4),e&2048&&(t+=4)}return r}function Rp(l,e,t){Le(e,["moof","traf"]).forEach(r=>{Le(r,["tfhd"]).forEach(s=>{const o=ye(s,4),a=l[o];if(!a)return;const c=a.timescale||9e4;Le(r,["tfdt"]).forEach(d=>{const h=d[0],g=t*c;if(g){let p=ye(d,4);if(h===0)p-=g,p=Math.max(p,0),Al(d,4,p);else{p*=Math.pow(2,32),p+=ye(d,8),p-=g,p=Math.max(p,0);const v=Math.floor(p/(uo+1)),T=Math.floor(p%(uo+1));Al(d,4,v),Al(d,8,T)}}})})})}function Ip(l){const e={valid:null,remainder:null},t=Le(l,["moof"]);if(t.length<2)return e.remainder=l,e;const r=t[t.length-1];return e.valid=tr(l,0,r.byteOffset-8),e.remainder=tr(l,r.byteOffset-8),e}function Ft(l,e){const t=new Uint8Array(l.length+e.length);return t.set(l),t.set(e,l.length),t}function Pf(l,e){const t=[],r=e.samples,s=e.timescale,o=e.id;let a=!1;return Le(r,["moof"]).map(d=>{const h=d.byteOffset-8;Le(d,["traf"]).map(p=>{const v=Le(p,["tfdt"]).map(T=>{const E=T[0];let S=ye(T,4);return E===1&&(S*=Math.pow(2,32),S+=ye(T,8)),S/s})[0];return v!==void 0&&(l=v),Le(p,["tfhd"]).map(T=>{const E=ye(T,4),S=ye(T,0)&16777215,A=(S&1)!==0,R=(S&2)!==0,k=(S&8)!==0;let D=0;const N=(S&16)!==0;let P=0;const V=(S&32)!==0;let U=8;E===o&&(A&&(U+=8),R&&(U+=4),k&&(D=ye(T,U),U+=4),N&&(P=ye(T,U),U+=4),V&&(U+=4),e.type==="video"&&(a=Cp(e.codec)),Le(p,["trun"]).map(j=>{const ee=j[0],H=ye(j,0)&16777215,Q=(H&1)!==0;let ge=0;const te=(H&4)!==0,de=(H&256)!==0;let fe=0;const oe=(H&512)!==0;let he=0;const q=(H&1024)!==0,z=(H&2048)!==0;let K=0;const w=ye(j,4);let $=8;Q&&(ge=ye(j,$),$+=4),te&&($+=4);let re=ge+h;for(let ce=0;ce<w;ce++){if(de?(fe=ye(j,$),$+=4):fe=D,oe?(he=ye(j,$),$+=4):he=P,q&&($+=4),z&&(ee===0?K=ye(j,$):K=Bh(j,$),$+=4),e.type===_e.VIDEO){let Ee=0;for(;Ee<he;){const Te=ye(r,re);if(re+=4,wp(a,r[re])){const Ae=r.subarray(re,re+Te);Kh(Ae,a?2:1,l+K/s,t)}re+=Te,Ee+=Te+4}}l+=fe/s}}))})})}),t}function Cp(l){if(!l)return!1;const e=l.indexOf("."),t=e<0?l:l.substring(0,e);return t==="hvc1"||t==="hev1"||t==="dvh1"||t==="dvhe"}function wp(l,e){if(l){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Kh(l,e,t,r){const s=Vh(l);let o=0;o+=e;let a=0,c=0,d=0;for(;o<s.length;){a=0;do{if(o>=s.length)break;d=s[o++],a+=d}while(d===255);c=0;do{if(o>=s.length)break;d=s[o++],c+=d}while(d===255);const h=s.length-o;let g=o;if(c<h)o+=c;else if(c>h){F.error(`Malformed SEI payload. ${c} is too small, only ${h} bytes left to parse.`);break}if(a===4){if(s[g++]===181){const v=Uh(s,g);if(g+=2,v===49){const T=ye(s,g);if(g+=4,T===1195456820){const E=s[g++];if(E===3){const S=s[g++],A=31&S,R=64&S,k=R?2+A*3:0,D=new Uint8Array(k);if(R){D[0]=S;for(let N=1;N<k;N++)D[N]=s[g++]}r.push({type:E,payloadType:a,pts:t,bytes:D})}}}}}else if(a===5&&c>16){const p=[];for(let E=0;E<16;E++){const S=s[g++].toString(16);p.push(S.length==1?"0"+S:S),(E===3||E===5||E===7||E===9)&&p.push("-")}const v=c-16,T=new Uint8Array(v);for(let E=0;E<v;E++)T[E]=s[g++];r.push({payloadType:a,pts:t,uuid:p.join(""),userData:en(T),userDataBytes:T})}}}function Vh(l){const e=l.byteLength,t=[];let r=1;for(;r<e-2;)l[r]===0&&l[r+1]===0&&l[r+2]===3?(t.push(r+2),r+=2):r++;if(t.length===0)return l;const s=e-t.length,o=new Uint8Array(s);let a=0;for(r=0;r<s;a++,r++)a===t[0]&&(a++,t.shift()),o[r]=l[a];return o}function Dp(l){const e=l[0];let t="",r="",s=0,o=0,a=0,c=0,d=0,h=0;if(e===0){for(;qe(l.subarray(h,h+1))!=="\0";)t+=qe(l.subarray(h,h+1)),h+=1;for(t+=qe(l.subarray(h,h+1)),h+=1;qe(l.subarray(h,h+1))!=="\0";)r+=qe(l.subarray(h,h+1)),h+=1;r+=qe(l.subarray(h,h+1)),h+=1,s=ye(l,12),o=ye(l,16),c=ye(l,20),d=ye(l,24),h=28}else if(e===1){h+=4,s=ye(l,h),h+=4;const p=ye(l,h);h+=4;const v=ye(l,h);for(h+=4,a=2**32*p+v,jm(a)||(a=Number.MAX_SAFE_INTEGER,F.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),c=ye(l,h),h+=4,d=ye(l,h),h+=4;qe(l.subarray(h,h+1))!=="\0";)t+=qe(l.subarray(h,h+1)),h+=1;for(t+=qe(l.subarray(h,h+1)),h+=1;qe(l.subarray(h,h+1))!=="\0";)r+=qe(l.subarray(h,h+1)),h+=1;r+=qe(l.subarray(h,h+1)),h+=1}const g=l.subarray(h,l.byteLength);return{schemeIdUri:t,value:r,timeScale:s,presentationTime:a,presentationTimeDelta:o,eventDuration:c,id:d,payload:g}}function kp(l,...e){const t=e.length;let r=8,s=t;for(;s--;)r+=e[s].byteLength;const o=new Uint8Array(r);for(o[0]=r>>24&255,o[1]=r>>16&255,o[2]=r>>8&255,o[3]=r&255,o.set(l,4),s=0,r=8;s<t;s++)o.set(e[s],r),r+=e[s].byteLength;return o}function _p(l,e,t){if(l.byteLength!==16)throw new RangeError("Invalid system id");let r,s;r=0,s=new Uint8Array;let o;r>0?(o=new Uint8Array(4),e.length>0&&new DataView(o.buffer).setUint32(0,e.length,!1)):o=new Uint8Array;const a=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),kp([112,115,115,104],new Uint8Array([r,0,0,0]),l,o,s,a,t||new Uint8Array)}function Pp(l){const e=[];if(l instanceof ArrayBuffer){const t=l.byteLength;let r=0;for(;r+32<t;){const s=new DataView(l,r),o=Fp(s);e.push(o),r+=o.size}}return e}function Fp(l){const e=l.getUint32(0),t=l.byteOffset,r=l.byteLength;if(r<e)return{offset:t,size:r};if(l.getUint32(4)!==1886614376)return{offset:t,size:e};const o=l.getUint32(8)>>>24;if(o!==0&&o!==1)return{offset:t,size:e};const a=l.buffer,c=Xt.hexDump(new Uint8Array(a,t+12,16)),d=l.getUint32(28);let h=null,g=null;if(o===0){if(e-32<d||d<22)return{offset:t,size:e};g=new Uint8Array(a,t+32,d)}else if(o===1){if(!d||r<t+32+d*16+16)return{offset:t,size:e};h=[];for(let p=0;p<d;p++)h.push(new Uint8Array(a,t+32+p*16,16))}return{version:o,systemId:c,kids:h,data:g,offset:t,size:e}}let Hs={};class ki{static clearKeyUriToKeyIdMap(){Hs={}}constructor(e,t,r,s=[1],o=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=s,this.iv=o,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&e!=="AES-128"}isSupported(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Et.FAIRPLAY:case Et.WIDEVINE:case Et.PLAYREADY:case Et.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof e!="number"&&(this.method==="AES-128"&&!this.iv&&F.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const r=Op(e);return new ki(this.method,this.uri,"identity",this.keyFormatVersions,r)}const t=op(this.uri);if(t)switch(this.keyFormat){case Et.WIDEVINE:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case Et.PLAYREADY:{const r=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=_p(r,null,t);const s=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2),o=String.fromCharCode.apply(null,Array.from(s)),a=o.substring(o.indexOf("<"),o.length),h=new DOMParser().parseFromString(a,"text/xml").getElementsByTagName("KID")[0];if(h){const g=h.childNodes[0]?h.childNodes[0].nodeValue:h.getAttribute("VALUE");if(g){const p=su(g).subarray(0,16);sp(p),this.keyId=p}}break}default:{let r=t.subarray(0,16);if(r.length!==16){const s=new Uint8Array(16);s.set(r,16-r.length),r=s}this.keyId=r;break}}if(!this.keyId||this.keyId.byteLength!==16){let r=Hs[this.uri];if(!r){const s=Object.keys(Hs).length%Number.MAX_SAFE_INTEGER;r=new Uint8Array(16),new DataView(r.buffer,12,4).setUint32(0,s),Hs[this.uri]=r}this.keyId=r}return this}}function Op(l){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=l>>8*(15-t)&255;return e}const Hh=/\{\$([a-zA-Z0-9-_]+)\}/g;function Ff(l){return Hh.test(l)}function vt(l,e,t){if(l.variableList!==null||l.hasVariableRefs)for(let r=t.length;r--;){const s=t[r],o=e[s];o&&(e[s]=Hl(l,o))}}function Hl(l,e){if(l.variableList!==null||l.hasVariableRefs){const t=l.variableList;return e.replace(Hh,r=>{const s=r.substring(2,r.length-1),o=t==null?void 0:t[s];return o===void 0?(l.playlistParsingError||(l.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),r):o})}return e}function Of(l,e,t){let r=l.variableList;r||(l.variableList=r={});let s,o;if("QUERYPARAM"in e){s=e.QUERYPARAM;try{const a=new self.URL(t).searchParams;if(a.has(s))o=a.get(s);else throw new Error(`"${s}" does not match any query parameter in URI: "${t}"`)}catch(a){l.playlistParsingError||(l.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else s=e.NAME,o=e.VALUE;s in r?l.playlistParsingError||(l.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):r[s]=o||""}function bp(l,e,t){const r=e.IMPORT;if(t&&r in t){let s=l.variableList;s||(l.variableList=s={}),s[r]=t[r]}else l.playlistParsingError||(l.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}function nr(l=!0){return typeof self>"u"?void 0:(l||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function Mp(l){return typeof self<"u"&&l===self.ManagedMediaSource}const co={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Np(l,e){const t=co[e];return!!t&&!!t[l.slice(0,4)]}function Il(l,e,t=!0){return!l.split(",").some(r=>!zh(r,e,t))}function zh(l,e,t=!0){var r;const s=nr(t);return(r=s==null?void 0:s.isTypeSupported(_i(l,e)))!=null?r:!1}function _i(l,e){return`${e}/mp4;codecs="${l}"`}function bf(l){if(l){const e=l.substring(0,4);return co.video[e]}return 2}function fo(l){return l.split(",").reduce((e,t)=>{const r=co.video[t];return r?(r*2+e)/(e?3:2):(co.audio[t]+e)/(e?2:1)},0)}const Cl={};function Up(l,e=!0){if(Cl[l])return Cl[l];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[l];for(let r=0;r<t.length;r++)if(zh(t[r],"audio",e))return Cl[l]=t[r],t[r];return l}const Bp=/flac|opus/i;function ho(l,e=!0){return l.replace(Bp,t=>Up(t.toLowerCase(),e))}function Mf(l,e){return l&&l!=="mp4a"?l:e&&e.split(",")[0]}function $p(l){const e=l.split(",");for(let t=0;t<e.length;t++){const r=e[t].split(".");if(r.length>2){let s=r.shift()+".";s+=parseInt(r.shift()).toString(16),s+=("000"+parseInt(r.shift()).toString(16)).slice(-4),e[t]=s}}return e.join(",")}const Nf=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Uf=/#EXT-X-MEDIA:(.*)/g,Gp=/^#EXT(?:INF|-X-TARGETDURATION):/m,Bf=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),Kp=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Jt{static findGroup(e,t){for(let r=0;r<e.length;r++){const s=e[r];if(s.id===t)return s}}static resolve(e,t){return iu.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return Gp.test(e)}static parseMasterPlaylist(e,t){const r=Ff(e),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:r},o=[];Nf.lastIndex=0;let a;for(;(a=Nf.exec(e))!=null;)if(a[1]){var c;const h=new Ge(a[1]);vt(s,h,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const g=Hl(s,a[2]),p={attrs:h,bitrate:h.decimalInteger("BANDWIDTH")||h.decimalInteger("AVERAGE-BANDWIDTH"),name:h.NAME,url:Jt.resolve(g,t)},v=h.decimalResolution("RESOLUTION");v&&(p.width=v.width,p.height=v.height),Vp(h.CODECS,p),(c=p.unknownCodecs)!=null&&c.length||o.push(p),s.levels.push(p)}else if(a[3]){const h=a[3],g=a[4];switch(h){case"SESSION-DATA":{const p=new Ge(g);vt(s,p,["DATA-ID","LANGUAGE","VALUE","URI"]);const v=p["DATA-ID"];v&&(s.sessionData===null&&(s.sessionData={}),s.sessionData[v]=p);break}case"SESSION-KEY":{const p=$f(g,t,s);p.encrypted&&p.isSupported()?(s.sessionKeys===null&&(s.sessionKeys=[]),s.sessionKeys.push(p)):F.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${g}"`);break}case"DEFINE":{{const p=new Ge(g);vt(s,p,["NAME","VALUE","QUERYPARAM"]),Of(s,p,t)}break}case"CONTENT-STEERING":{const p=new Ge(g);vt(s,p,["SERVER-URI","PATHWAY-ID"]),s.contentSteering={uri:Jt.resolve(p["SERVER-URI"],t),pathwayId:p["PATHWAY-ID"]||"."};break}case"START":{s.startTimeOffset=Gf(g);break}}}const d=o.length>0&&o.length<s.levels.length;return s.levels=d?o:s.levels,s.levels.length===0&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,r){let s;const o={},a=r.levels,c={AUDIO:a.map(h=>({id:h.attrs.AUDIO,audioCodec:h.audioCodec})),SUBTITLES:a.map(h=>({id:h.attrs.SUBTITLES,textCodec:h.textCodec})),"CLOSED-CAPTIONS":[]};let d=0;for(Uf.lastIndex=0;(s=Uf.exec(e))!==null;){const h=new Ge(s[1]),g=h.TYPE;if(g){const p=c[g],v=o[g]||[];o[g]=v,vt(r,h,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const T=h.LANGUAGE,E=h["ASSOC-LANGUAGE"],S=h.CHANNELS,A=h.CHARACTERISTICS,R=h["INSTREAM-ID"],k={attrs:h,bitrate:0,id:d++,groupId:h["GROUP-ID"]||"",name:h.NAME||T||"",type:g,default:h.bool("DEFAULT"),autoselect:h.bool("AUTOSELECT"),forced:h.bool("FORCED"),lang:T,url:h.URI?Jt.resolve(h.URI,t):""};if(E&&(k.assocLang=E),S&&(k.channels=S),A&&(k.characteristics=A),R&&(k.instreamId=R),p!=null&&p.length){const D=Jt.findGroup(p,k.groupId)||p[0];Kf(k,D,"audioCodec"),Kf(k,D,"textCodec")}v.push(k)}}return o}static parseLevelPlaylist(e,t,r,s,o,a){const c=new rp(t),d=c.fragments;let h=null,g=0,p=0,v=0,T=0,E=null,S=new Sl(s,t),A,R,k,D=-1,N=!1,P=null;for(Bf.lastIndex=0,c.m3u8=e,c.hasVariableRefs=Ff(e);(A=Bf.exec(e))!==null;){N&&(N=!1,S=new Sl(s,t),S.start=v,S.sn=g,S.cc=T,S.level=r,h&&(S.initSegment=h,S.rawProgramDateTime=h.rawProgramDateTime,h.rawProgramDateTime=null,P&&(S.setByteRange(P),P=null)));const ee=A[1];if(ee){S.duration=parseFloat(ee);const H=(" "+A[2]).slice(1);S.title=H||null,S.tagList.push(H?["INF",ee,H]:["INF",ee])}else if(A[3]){if(se(S.duration)){S.start=v,k&&zf(S,k,c),S.sn=g,S.level=r,S.cc=T,d.push(S);const H=(" "+A[3]).slice(1);S.relurl=Hl(c,H),Vf(S,E),E=S,v+=S.duration,g++,p=0,N=!0}}else if(A[4]){const H=(" "+A[4]).slice(1);E?S.setByteRange(H,E):S.setByteRange(H)}else if(A[5])S.rawProgramDateTime=(" "+A[5]).slice(1),S.tagList.push(["PROGRAM-DATE-TIME",S.rawProgramDateTime]),D===-1&&(D=d.length);else{if(A=A[0].match(Kp),!A){F.warn("No matches on slow regex match for level playlist!");continue}for(R=1;R<A.length&&!(typeof A[R]<"u");R++);const H=(" "+A[R]).slice(1),Q=(" "+A[R+1]).slice(1),ge=A[R+2]?(" "+A[R+2]).slice(1):"";switch(H){case"PLAYLIST-TYPE":c.type=Q.toUpperCase();break;case"MEDIA-SEQUENCE":g=c.startSN=parseInt(Q);break;case"SKIP":{const te=new Ge(Q);vt(c,te,["RECENTLY-REMOVED-DATERANGES"]);const de=te.decimalInteger("SKIPPED-SEGMENTS");if(se(de)){c.skippedSegments=de;for(let oe=de;oe--;)d.unshift(null);g+=de}const fe=te.enumeratedString("RECENTLY-REMOVED-DATERANGES");fe&&(c.recentlyRemovedDateranges=fe.split("	"));break}case"TARGETDURATION":c.targetduration=Math.max(parseInt(Q),1);break;case"VERSION":c.version=parseInt(Q);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":c.live=!1;break;case"#":(Q||ge)&&S.tagList.push(ge?[Q,ge]:[Q]);break;case"DISCONTINUITY":T++,S.tagList.push(["DIS"]);break;case"GAP":S.gap=!0,S.tagList.push([H]);break;case"BITRATE":S.tagList.push([H,Q]);break;case"DATERANGE":{const te=new Ge(Q);vt(c,te,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),vt(c,te,te.clientAttrs);const de=new _h(te,c.dateRanges[te.ID]);de.isValid||c.skippedSegments?c.dateRanges[de.id]=de:F.warn(`Ignoring invalid DATERANGE tag: "${Q}"`),S.tagList.push(["EXT-X-DATERANGE",Q]);break}case"DEFINE":{{const te=new Ge(Q);vt(c,te,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in te?bp(c,te,a):Of(c,te,t)}break}case"DISCONTINUITY-SEQUENCE":T=parseInt(Q);break;case"KEY":{const te=$f(Q,t,c);if(te.isSupported()){if(te.method==="NONE"){k=void 0;break}k||(k={}),k[te.keyFormat]&&(k=We({},k)),k[te.keyFormat]=te}else F.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${Q}"`);break}case"START":c.startTimeOffset=Gf(Q);break;case"MAP":{const te=new Ge(Q);if(vt(c,te,["BYTERANGE","URI"]),S.duration){const de=new Sl(s,t);Hf(de,te,r,k),h=de,S.initSegment=h,h.rawProgramDateTime&&!S.rawProgramDateTime&&(S.rawProgramDateTime=h.rawProgramDateTime)}else{const de=S.byteRangeEndOffset;if(de){const fe=S.byteRangeStartOffset;P=`${de-fe}@${fe}`}else P=null;Hf(S,te,r,k),h=S,N=!0}break}case"SERVER-CONTROL":{const te=new Ge(Q);c.canBlockReload=te.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=te.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&te.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=te.optionalFloat("PART-HOLD-BACK",0),c.holdBack=te.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const te=new Ge(Q);c.partTarget=te.decimalFloatingPoint("PART-TARGET");break}case"PART":{let te=c.partList;te||(te=c.partList=[]);const de=p>0?te[te.length-1]:void 0,fe=p++,oe=new Ge(Q);vt(c,oe,["BYTERANGE","URI"]);const he=new tp(oe,S,t,fe,de);te.push(he),S.duration+=he.duration;break}case"PRELOAD-HINT":{const te=new Ge(Q);vt(c,te,["URI"]),c.preloadHint=te;break}case"RENDITION-REPORT":{const te=new Ge(Q);vt(c,te,["URI"]),c.renditionReports=c.renditionReports||[],c.renditionReports.push(te);break}default:F.warn(`line parsed but not handled: ${A}`);break}}}E&&!E.relurl?(d.pop(),v-=E.duration,c.partList&&(c.fragmentHint=E)):c.partList&&(Vf(S,E),S.cc=T,c.fragmentHint=S,k&&zf(S,k,c));const V=d.length,U=d[0],j=d[V-1];if(v+=c.skippedSegments*c.targetduration,v>0&&V&&j){c.averagetargetduration=v/V;const ee=j.sn;c.endSN=ee!=="initSegment"?ee:0,c.live||(j.endList=!0),U&&(c.startCC=U.cc)}else c.endSN=0,c.startCC=0;return c.fragmentHint&&(v+=c.fragmentHint.duration),c.totalduration=v,c.endCC=T,D>0&&Hp(d,D),c}}function $f(l,e,t){var r,s;const o=new Ge(l);vt(t,o,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const a=(r=o.METHOD)!=null?r:"",c=o.URI,d=o.hexadecimalInteger("IV"),h=o.KEYFORMATVERSIONS,g=(s=o.KEYFORMAT)!=null?s:"identity";c&&o.IV&&!d&&F.error(`Invalid IV: ${o.IV}`);const p=c?Jt.resolve(c,e):"",v=(h||"1").split("/").map(Number).filter(Number.isFinite);return new ki(a,p,g,v,d)}function Gf(l){const t=new Ge(l).decimalFloatingPoint("TIME-OFFSET");return se(t)?t:null}function Vp(l,e){let t=(l||"").split(/[ ,]+/).filter(r=>r);["video","audio","text"].forEach(r=>{const s=t.filter(o=>Np(o,r));s.length&&(e[`${r}Codec`]=s.join(","),t=t.filter(o=>s.indexOf(o)===-1))}),e.unknownCodecs=t}function Kf(l,e,t){const r=e[t];r&&(l[t]=r)}function Hp(l,e){let t=l[e];for(let r=e;r--;){const s=l[r];if(!s)return;s.programDateTime=t.programDateTime-s.duration*1e3,t=s}}function Vf(l,e){l.rawProgramDateTime?l.programDateTime=Date.parse(l.rawProgramDateTime):e!=null&&e.programDateTime&&(l.programDateTime=e.endProgramDateTime),se(l.programDateTime)||(l.programDateTime=null,l.rawProgramDateTime=null)}function Hf(l,e,t,r){l.relurl=e.URI,e.BYTERANGE&&l.setByteRange(e.BYTERANGE),l.level=t,l.sn="initSegment",r&&(l.levelkeys=r),l.initSegment=null}function zf(l,e,t){l.levelkeys=e;const{encryptedFragments:r}=t;(!r.length||r[r.length-1].levelkeys!==e)&&Object.keys(e).some(s=>e[s].isCommonEncryption)&&r.push(l)}var Ce={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},ve={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function Wf(l){const{type:e}=l;switch(e){case Ce.AUDIO_TRACK:return ve.AUDIO;case Ce.SUBTITLE_TRACK:return ve.SUBTITLE;default:return ve.MAIN}}function wl(l,e){let t=l.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class zp{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.LEVEL_LOADING,this.onLevelLoading,this),e.on(x.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(x.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:e}=this;e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.LEVEL_LOADING,this.onLevelLoading,this),e.off(x.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(x.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(e){const t=this.hls.config,r=t.pLoader,s=t.loader,o=r||s,a=new o(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Ce.MANIFEST,url:r,deliveryDirectives:null})}onLevelLoading(e,t){const{id:r,level:s,pathwayId:o,url:a,deliveryDirectives:c}=t;this.load({id:r,level:s,pathwayId:o,responseType:"text",type:Ce.LEVEL,url:a,deliveryDirectives:c})}onAudioTrackLoading(e,t){const{id:r,groupId:s,url:o,deliveryDirectives:a}=t;this.load({id:r,groupId:s,level:null,responseType:"text",type:Ce.AUDIO_TRACK,url:o,deliveryDirectives:a})}onSubtitleTrackLoading(e,t){const{id:r,groupId:s,url:o,deliveryDirectives:a}=t;this.load({id:r,groupId:s,level:null,responseType:"text",type:Ce.SUBTITLE_TRACK,url:o,deliveryDirectives:a})}load(e){var t;const r=this.hls.config;let s=this.getInternalLoader(e);if(s){const h=s.context;if(h&&h.url===e.url&&h.level===e.level){F.trace("[playlist-loader]: playlist request ongoing");return}F.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),s.abort()}let o;if(e.type===Ce.MANIFEST?o=r.manifestLoadPolicy.default:o=We({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),se((t=e.deliveryDirectives)==null?void 0:t.part)){let h;if(e.type===Ce.LEVEL&&e.level!==null?h=this.hls.levels[e.level].details:e.type===Ce.AUDIO_TRACK&&e.id!==null?h=this.hls.audioTracks[e.id].details:e.type===Ce.SUBTITLE_TRACK&&e.id!==null&&(h=this.hls.subtitleTracks[e.id].details),h){const g=h.partTarget,p=h.targetduration;if(g&&p){const v=Math.max(g*3,p*.8)*1e3;o=We({},o,{maxTimeToFirstByteMs:Math.min(v,o.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(v,o.maxTimeToFirstByteMs)})}}}const a=o.errorRetry||o.timeoutRetry||{},c={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},d={onSuccess:(h,g,p,v)=>{const T=this.getInternalLoader(p);this.resetInternalLoader(p.type);const E=h.data;if(E.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(h,p,new Error("no EXTM3U delimiter"),v||null,g);return}g.parsing.start=performance.now(),Jt.isMediaPlaylist(E)?this.handleTrackOrLevelPlaylist(h,g,p,v||null,T):this.handleMasterPlaylist(h,g,p,v)},onError:(h,g,p,v)=>{this.handleNetworkError(g,p,!1,h,v)},onTimeout:(h,g,p)=>{this.handleNetworkError(g,p,!0,void 0,h)}};s.load(e,c,d)}handleMasterPlaylist(e,t,r,s){const o=this.hls,a=e.data,c=wl(e,r),d=Jt.parseMasterPlaylist(a,c);if(d.playlistParsingError){this.handleManifestParsingError(e,r,d.playlistParsingError,s,t);return}const{contentSteering:h,levels:g,sessionData:p,sessionKeys:v,startTimeOffset:T,variableList:E}=d;this.variableList=E;const{AUDIO:S=[],SUBTITLES:A,"CLOSED-CAPTIONS":R}=Jt.parseMasterPlaylistMedia(a,c,d);S.length&&!S.some(D=>!D.url)&&g[0].audioCodec&&!g[0].attrs.AUDIO&&(F.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),S.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Ge({}),bitrate:0,url:""})),o.trigger(x.MANIFEST_LOADED,{levels:g,audioTracks:S,subtitles:A,captions:R,contentSteering:h,url:c,stats:t,networkDetails:s,sessionData:p,sessionKeys:v,startTimeOffset:T,variableList:E})}handleTrackOrLevelPlaylist(e,t,r,s,o){const a=this.hls,{id:c,level:d,type:h}=r,g=wl(e,r),p=0,v=se(d)?d:se(c)?c:0,T=Wf(r),E=Jt.parseLevelPlaylist(e.data,g,v,T,p,this.variableList);if(h===Ce.MANIFEST){const S={attrs:new Ge({}),bitrate:0,details:E,name:"",url:g};a.trigger(x.MANIFEST_LOADED,{levels:[S],audioTracks:[],url:g,stats:t,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=E,this.handlePlaylistLoaded(E,e,t,r,s,o)}handleManifestParsingError(e,t,r,s,o){this.hls.trigger(x.ERROR,{type:Se.NETWORK_ERROR,details:G.MANIFEST_PARSING_ERROR,fatal:t.type===Ce.MANIFEST,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:s,stats:o})}handleNetworkError(e,t,r=!1,s,o){let a=`A network ${r?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${e.type}`;e.type===Ce.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===Ce.AUDIO_TRACK||e.type===Ce.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const c=new Error(a);F.warn(`[playlist-loader]: ${a}`);let d=G.UNKNOWN,h=!1;const g=this.getInternalLoader(e);switch(e.type){case Ce.MANIFEST:d=r?G.MANIFEST_LOAD_TIMEOUT:G.MANIFEST_LOAD_ERROR,h=!0;break;case Ce.LEVEL:d=r?G.LEVEL_LOAD_TIMEOUT:G.LEVEL_LOAD_ERROR,h=!1;break;case Ce.AUDIO_TRACK:d=r?G.AUDIO_TRACK_LOAD_TIMEOUT:G.AUDIO_TRACK_LOAD_ERROR,h=!1;break;case Ce.SUBTITLE_TRACK:d=r?G.SUBTITLE_TRACK_LOAD_TIMEOUT:G.SUBTITLE_LOAD_ERROR,h=!1;break}g&&this.resetInternalLoader(e.type);const p={type:Se.NETWORK_ERROR,details:d,fatal:h,url:e.url,loader:g,context:e,error:c,networkDetails:t,stats:o};if(s){const v=(t==null?void 0:t.url)||e.url;p.response=tt({url:v,data:void 0},s)}this.hls.trigger(x.ERROR,p)}handlePlaylistLoaded(e,t,r,s,o,a){const c=this.hls,{type:d,level:h,id:g,groupId:p,deliveryDirectives:v}=s,T=wl(t,s),E=Wf(s),S=typeof s.level=="number"&&E===ve.MAIN?h:void 0;if(!e.fragments.length){const R=new Error("No Segments found in Playlist");c.trigger(x.ERROR,{type:Se.NETWORK_ERROR,details:G.LEVEL_EMPTY_ERROR,fatal:!1,url:T,error:R,reason:R.message,response:t,context:s,level:S,parent:E,networkDetails:o,stats:r});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const A=e.playlistParsingError;if(A){c.trigger(x.ERROR,{type:Se.NETWORK_ERROR,details:G.LEVEL_PARSING_ERROR,fatal:!1,url:T,error:A,reason:A.message,response:t,context:s,level:S,parent:E,networkDetails:o,stats:r});return}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),d){case Ce.MANIFEST:case Ce.LEVEL:c.trigger(x.LEVEL_LOADED,{details:e,level:S||0,id:g||0,stats:r,networkDetails:o,deliveryDirectives:v});break;case Ce.AUDIO_TRACK:c.trigger(x.AUDIO_TRACK_LOADED,{details:e,id:g||0,groupId:p||"",stats:r,networkDetails:o,deliveryDirectives:v});break;case Ce.SUBTITLE_TRACK:c.trigger(x.SUBTITLE_TRACK_LOADED,{details:e,id:g||0,groupId:p||"",stats:r,networkDetails:o,deliveryDirectives:v});break}}}function Wh(l,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=l,e.dispatchEvent(t)}function jh(l,e){const t=l.mode;if(t==="disabled"&&(l.mode="hidden"),l.cues&&!l.cues.getCueById(e.id))try{if(l.addCue(e),!l.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(r){F.debug(`[texttrack-utils]: ${r}`);try{const s=new self.TextTrackCue(e.startTime,e.endTime,e.text);s.id=e.id,l.addCue(s)}catch(s){F.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${s}`)}}t==="disabled"&&(l.mode=t)}function Fr(l){const e=l.mode;if(e==="disabled"&&(l.mode="hidden"),l.cues)for(let t=l.cues.length;t--;)l.removeCue(l.cues[t]);e==="disabled"&&(l.mode=e)}function zl(l,e,t,r){const s=l.mode;if(s==="disabled"&&(l.mode="hidden"),l.cues&&l.cues.length>0){const o=jp(l.cues,e,t);for(let a=0;a<o.length;a++)(!r||r(o[a]))&&l.removeCue(o[a])}s==="disabled"&&(l.mode=s)}function Wp(l,e){if(e<l[0].startTime)return 0;const t=l.length-1;if(e>l[t].endTime)return-1;let r=0,s=t;for(;r<=s;){const o=Math.floor((s+r)/2);if(e<l[o].startTime)s=o-1;else if(e>l[o].startTime&&r<t)r=o+1;else return o}return l[r].startTime-e<e-l[s].startTime?r:s}function jp(l,e,t){const r=[],s=Wp(l,e);if(s>-1)for(let o=s,a=l.length;o<a;o++){const c=l[o];if(c.startTime>=e&&c.endTime<=t)r.push(c);else if(c.startTime>t)return r}return r}function eo(l){const e=[];for(let t=0;t<l.length;t++){const r=l[t];(r.kind==="subtitles"||r.kind==="captions")&&r.label&&e.push(l[t])}return e}var Vt={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};const Yp=.25;function Wl(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function jf(l,e,t,r,s){let o=new l(e,t,"");try{o.value=r,s&&(o.type=s)}catch{o=new l(e,t,JSON.stringify(s?tt({type:s},r):r))}return o}const zs=(()=>{const l=Wl();try{l&&new l(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function Dl(l,e){return l.getTime()/1e3-e}function qp(l){return Uint8Array.from(l.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class Xp{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:e}=this;e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(e,t){this.media=t.media}onMediaDetaching(){this.id3Track&&(Fr(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const r=e[t];if(r.kind==="metadata"&&r.label==="id3")return Wh(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:r,enableID3MetadataCues:s}}}=this;if(!r&&!s)return;const{samples:o}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=Wl();if(a)for(let c=0;c<o.length;c++){const d=o[c].type;if(d===Vt.emsg&&!r||!s)continue;const h=Mh(o[c].data);if(h){const g=o[c].pts;let p=g+o[c].duration;p>zs&&(p=zs),p-g<=0&&(p=g+Yp);for(let T=0;T<h.length;T++){const E=h[T];if(!bh(E)){this.updateId3CueEnds(g,d);const S=jf(a,g,p,E,d);S&&this.id3Track.addCue(S)}}}}}updateId3CueEnds(e,t){var r;const s=(r=this.id3Track)==null?void 0:r.cues;if(s)for(let o=s.length;o--;){const a=s[o];a.type===t&&a.startTime<e&&a.endTime===zs&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:s}){const{id3Track:o,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:c,enableID3MetadataCues:d}}=a;if(o&&(c||d)){let h;s==="audio"?h=g=>g.type===Vt.audioId3&&d:s==="video"?h=g=>g.type===Vt.emsg&&c:h=g=>g.type===Vt.audioId3&&d||g.type===Vt.emsg&&c,zl(o,t,r,h)}}onLevelUpdated(e,{details:t}){if(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:r,id3Track:s}=this,{dateRanges:o}=t,a=Object.keys(o);if(s){const g=Object.keys(r).filter(p=>!a.includes(p));for(let p=g.length;p--;){const v=g[p];Object.keys(r[v].cues).forEach(T=>{s.removeCue(r[v].cues[T])}),delete r[v]}}const c=t.fragments[t.fragments.length-1];if(a.length===0||!se(c==null?void 0:c.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const d=c.programDateTime/1e3-c.start,h=Wl();for(let g=0;g<a.length;g++){const p=a[g],v=o[p],T=Dl(v.startDate,d),E=r[p],S=(E==null?void 0:E.cues)||{};let A=(E==null?void 0:E.durationKnown)||!1,R=zs;const k=v.endDate;if(k)R=Dl(k,d),A=!0;else if(v.endOnNext&&!A){const N=a.reduce((P,V)=>{if(V!==v.id){const U=o[V];if(U.class===v.class&&U.startDate>v.startDate&&(!P||v.startDate<P.startDate))return U}return P},null);N&&(R=Dl(N.startDate,d),A=!0)}const D=Object.keys(v.attr);for(let N=0;N<D.length;N++){const P=D[N];if(!Zm(P))continue;const V=S[P];if(V)A&&!E.durationKnown&&(V.endTime=R);else if(h){let U=v.attr[P];ep(P)&&(U=qp(U));const j=jf(h,T,R,{key:P,data:U},Vt.dateRange);j&&(j.id=p,this.id3Track.addCue(j),S[P]=j)}}r[p]={cues:S,dateRange:v,durationKnown:A}}}}class Qp{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=e,this.config=e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:e,levelDetails:t}=this;return e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const{levelDetails:e}=this;if(e===null)return null;const{holdBack:t,partHoldBack:r,targetduration:s}=e,{liveSyncDuration:o,liveSyncDurationCount:a,lowLatencyMode:c}=this.config,d=this.hls.userConfig;let h=c&&r||t;(d.liveSyncDuration||d.liveSyncDurationCount||h===0)&&(h=o!==void 0?o:a*s);const g=s;return h+Math.min(this.stallCount*1,g)}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency,r=this.levelDetails;if(e===null||t===null||r===null)return null;const s=r.edge,o=e-t-this.edgeStalled,a=s-r.totalduration,c=s-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(a,o),c)}get drift(){const{levelDetails:e}=this;return e===null?1:e.drift}get edgeStalled(){const{levelDetails:e}=this;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e,levelDetails:t}=this;if(!e||!t)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(x.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(x.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(x.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(x.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){this.levelDetails=t,t.advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(e,t){var r;t.details===G.BUFFER_STALLED_ERROR&&(this.stallCount++,(r=this.levelDetails)!=null&&r.live&&F.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:e,levelDetails:t}=this;if(!e||!t)return;this.currentTime=e.currentTime;const r=this.computeLatency();if(r===null)return;this._latency=r;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:o}=this.config;if(!s||o===1||!t.live)return;const a=this.targetLatency;if(a===null)return;const c=r-a,d=Math.min(this.maxLatency,a+t.targetduration);if(c<d&&c>.05&&this.forwardBufferLength>1){const g=Math.min(2,Math.max(1,o)),p=Math.round(2/(1+Math.exp(-.75*c-this.edgeStalled))*20)/20;e.playbackRate=Math.min(g,Math.max(1,p))}else e.playbackRate!==1&&e.playbackRate!==0&&(e.playbackRate=1)}estimateLiveEdge(){const{levelDetails:e}=this;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}const jl=["NONE","TYPE-0","TYPE-1",null];function Jp(l){return jl.indexOf(l)>-1}const go=["SDR","PQ","HLG"];function Zp(l){return!!l&&go.indexOf(l)>-1}var to={No:"",Yes:"YES",v2:"v2"};function Yf(l){const{canSkipUntil:e,canSkipDateRanges:t,age:r}=l,s=r<e/2;return e&&s?t?to.v2:to.Yes:to.No}class qf{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Nr{constructor(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(t=>!!t).map(t=>t.substring(0,4)).join(","),this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Xf(this._audioGroups,e)}hasSubtitleGroup(e){return Xf(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let r=this._audioGroups;r||(r=this._audioGroups=[]),r.indexOf(t)===-1&&r.push(t)}else if(e==="text"){let r=this._subtitleGroups;r||(r=this._subtitleGroups=[]),r.indexOf(t)===-1&&r.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Xf(l,e){return!e||!l?!1:l.indexOf(e)!==-1}function kl(l,e){const t=e.startPTS;if(se(t)){let r=0,s;e.sn>l.sn?(r=t-l.start,s=l):(r=l.start-t,s=e),s.duration!==r&&(s.duration=r)}else e.sn>l.sn?l.cc===e.cc&&l.minEndPTS?e.start=l.start+(l.minEndPTS-l.start):e.start=l.start+l.duration:e.start=Math.max(l.start-e.duration,0)}function Yh(l,e,t,r,s,o){r-t<=0&&(F.warn("Fragment should have a positive duration",e),r=t+e.duration,o=s+e.duration);let c=t,d=r;const h=e.startPTS,g=e.endPTS;if(se(h)){const A=Math.abs(h-t);se(e.deltaPTS)?e.deltaPTS=Math.max(A,e.deltaPTS):e.deltaPTS=A,c=Math.max(t,h),t=Math.min(t,h),s=Math.min(s,e.startDTS),d=Math.min(r,g),r=Math.max(r,g),o=Math.max(o,e.endDTS)}const p=t-e.start;e.start!==0&&(e.start=t),e.duration=r-e.start,e.startPTS=t,e.maxStartPTS=c,e.startDTS=s,e.endPTS=r,e.minEndPTS=d,e.endDTS=o;const v=e.sn;if(!l||v<l.startSN||v>l.endSN)return 0;let T;const E=v-l.startSN,S=l.fragments;for(S[E]=e,T=E;T>0;T--)kl(S[T],S[T-1]);for(T=E;T<S.length-1;T++)kl(S[T],S[T+1]);return l.fragmentHint&&kl(S[S.length-1],l.fragmentHint),l.PTSKnown=l.alignedSliding=!0,p}function ey(l,e){let t=null;const r=l.fragments;for(let d=r.length-1;d>=0;d--){const h=r[d].initSegment;if(h){t=h;break}}l.fragmentHint&&delete l.fragmentHint.endPTS;let s=0,o;if(ry(l,e,(d,h)=>{d.relurl&&(s=d.cc-h.cc),se(d.startPTS)&&se(d.endPTS)&&(h.start=h.startPTS=d.startPTS,h.startDTS=d.startDTS,h.maxStartPTS=d.maxStartPTS,h.endPTS=d.endPTS,h.endDTS=d.endDTS,h.minEndPTS=d.minEndPTS,h.duration=d.endPTS-d.startPTS,h.duration&&(o=h),e.PTSKnown=e.alignedSliding=!0),h.elementaryStreams=d.elementaryStreams,h.loader=d.loader,h.stats=d.stats,d.initSegment&&(h.initSegment=d.initSegment,t=d.initSegment)}),t&&(e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments).forEach(h=>{var g;h&&(!h.initSegment||h.initSegment.relurl===((g=t)==null?void 0:g.relurl))&&(h.initSegment=t)}),e.skippedSegments)if(e.deltaUpdateFailed=e.fragments.some(d=>!d),e.deltaUpdateFailed){F.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let d=e.skippedSegments;d--;)e.fragments.shift();e.startSN=e.fragments[0].sn,e.startCC=e.fragments[0].cc}else e.canSkipDateRanges&&(e.dateRanges=ty(l.dateRanges,e.dateRanges,e.recentlyRemovedDateranges));const a=e.fragments;if(s){F.warn("discontinuity sliding from playlist, take drift into account");for(let d=0;d<a.length;d++)a[d].cc+=s}e.skippedSegments&&(e.startCC=e.fragments[0].cc),ny(l.partList,e.partList,(d,h)=>{h.elementaryStreams=d.elementaryStreams,h.stats=d.stats}),o?Yh(e,o,o.startPTS,o.endPTS,o.startDTS,o.endDTS):qh(l,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=l.driftStartTime,e.driftStart=l.driftStart;const c=e.advancedDateTime;if(e.advanced&&c){const d=e.edge;e.driftStart||(e.driftStartTime=c,e.driftStart=d),e.driftEndTime=c,e.driftEnd=d}else e.driftEndTime=l.driftEndTime,e.driftEnd=l.driftEnd,e.advancedDateTime=l.advancedDateTime}function ty(l,e,t){const r=We({},l);return t&&t.forEach(s=>{delete r[s]}),Object.keys(e).forEach(s=>{const o=new _h(e[s].attr,r[s]);o.isValid?r[s]=o:F.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(e[s].attr)}"`)}),r}function ny(l,e,t){if(l&&e){let r=0;for(let s=0,o=l.length;s<=o;s++){const a=l[s],c=e[s+r];a&&c&&a.index===c.index&&a.fragment.sn===c.fragment.sn?t(a,c):r--}}}function ry(l,e,t){const r=e.skippedSegments,s=Math.max(l.startSN,e.startSN)-e.startSN,o=(l.fragmentHint?1:0)+(r?e.endSN:Math.min(l.endSN,e.endSN))-e.startSN,a=e.startSN-l.startSN,c=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,d=l.fragmentHint?l.fragments.concat(l.fragmentHint):l.fragments;for(let h=s;h<=o;h++){const g=d[a+h];let p=c[h];r&&!p&&h<r&&(p=e.fragments[h]=g),g&&p&&t(g,p)}}function qh(l,e){const t=e.startSN+e.skippedSegments-l.startSN,r=l.fragments;t<0||t>=r.length||Yl(e,r[t].start)}function Yl(l,e){if(e){const t=l.fragments;for(let r=l.skippedSegments;r<t.length;r++)t[r].start+=e;l.fragmentHint&&(l.fragmentHint.start+=e)}}function iy(l,e=1/0){let t=1e3*l.targetduration;if(l.updated){const r=l.fragments;if(r.length&&t*4>e){const o=r[r.length-1].duration*1e3;o<t&&(t=o)}}else t/=2;return Math.round(t)}function sy(l,e,t){if(!(l!=null&&l.details))return null;const r=l.details;let s=r.fragments[e-r.startSN];return s||(s=r.fragmentHint,s&&s.sn===e)?s:e<r.startSN&&t&&t.sn===e?t:null}function Qf(l,e,t){var r;return l!=null&&l.details?Xh((r=l.details)==null?void 0:r.partList,e,t):null}function Xh(l,e,t){if(l)for(let r=l.length;r--;){const s=l[r];if(s.index===t&&s.fragment.sn===e)return s}return null}function Qh(l){l.forEach((e,t)=>{const{details:r}=e;r!=null&&r.fragments&&r.fragments.forEach(s=>{s.level=t})})}function mo(l){switch(l.details){case G.FRAG_LOAD_TIMEOUT:case G.KEY_LOAD_TIMEOUT:case G.LEVEL_LOAD_TIMEOUT:case G.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Jf(l,e){const t=mo(e);return l.default[`${t?"timeout":"error"}Retry`]}function lu(l,e){const t=l.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*l.retryDelayMs,l.maxRetryDelayMs)}function Zf(l){return tt(tt({},l),{errorRetry:null,timeoutRetry:null})}function po(l,e,t,r){if(!l)return!1;const s=r==null?void 0:r.code,o=e<l.maxNumRetry&&(oy(s)||!!t);return l.shouldRetry?l.shouldRetry(l,e,t,r,o):o}function oy(l){return l===0&&navigator.onLine===!1||!!l&&(l<400||l>499)}const Jh={search:function(l,e){let t=0,r=l.length-1,s=null,o=null;for(;t<=r;){s=(t+r)/2|0,o=l[s];const a=e(o);if(a>0)t=s+1;else if(a<0)r=s-1;else return o}return null}};function ay(l,e,t){if(e===null||!Array.isArray(l)||!l.length||!se(e))return null;const r=l[0].programDateTime;if(e<(r||0))return null;const s=l[l.length-1].endProgramDateTime;if(e>=(s||0))return null;t=t||0;for(let o=0;o<l.length;++o){const a=l[o];if(uy(e,t,a))return a}return null}function yo(l,e,t=0,r=0,s=.005){let o=null;if(l){o=e[l.sn-e[0].sn+1]||null;const c=l.endDTS-t;c>0&&c<15e-7&&(t+=15e-7)}else t===0&&e[0].start===0&&(o=e[0]);if(o&&((!l||l.level===o.level)&&ql(t,r,o)===0||ly(o,l,Math.min(s,r))))return o;const a=Jh.search(e,ql.bind(null,t,r));return a&&(a!==l||!o)?a:o}function ly(l,e,t){if(e&&e.start===0&&e.level<l.level&&(e.endPTS||0)>0){const r=e.tagList.reduce((s,o)=>(o[0]==="INF"&&(s+=parseFloat(o[1])),s),t);return l.start<=r}return!1}function ql(l=0,e=0,t){if(t.start<=l&&t.start+t.duration>l)return 0;const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-r<=l?1:t.start-r>l&&t.start?-1:0}function uy(l,e,t){const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-r>l}function cy(l,e){return Jh.search(l,t=>t.cc<e?1:t.cc>e?-1:0)}var it={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},Gt={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class dy{constructor(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=F.log.bind(F,"[info]:"),this.warn=F.warn.bind(F,"[warning]:"),this.error=F.error.bind(F,"[error]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(x.ERROR,this.onError,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(x.ERROR,this.onError,this),e.off(x.ERROR,this.onErrorOut,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===ve.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var r,s;if(t.fatal)return;const o=this.hls,a=t.context;switch(t.details){case G.FRAG_LOAD_ERROR:case G.FRAG_LOAD_TIMEOUT:case G.KEY_LOAD_ERROR:case G.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case G.FRAG_PARSING_ERROR:if((r=t.frag)!=null&&r.gap){t.errorAction={action:it.DoNothing,flags:Gt.None};return}case G.FRAG_GAP:case G.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=it.SendAlternateToPenaltyBox;return}case G.LEVEL_EMPTY_ERROR:case G.LEVEL_PARSING_ERROR:{var c,d;const h=t.parent===ve.MAIN?t.level:o.loadLevel;t.details===G.LEVEL_EMPTY_ERROR&&((c=t.context)!=null&&(d=c.levelDetails)!=null&&d.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,h):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,h))}return;case G.LEVEL_LOAD_ERROR:case G.LEVEL_LOAD_TIMEOUT:typeof(a==null?void 0:a.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,a.level));return;case G.AUDIO_TRACK_LOAD_ERROR:case G.AUDIO_TRACK_LOAD_TIMEOUT:case G.SUBTITLE_LOAD_ERROR:case G.SUBTITLE_TRACK_LOAD_TIMEOUT:if(a){const h=o.levels[o.loadLevel];if(h&&(a.type===Ce.AUDIO_TRACK&&h.hasAudioGroup(a.groupId)||a.type===Ce.SUBTITLE_TRACK&&h.hasSubtitleGroup(a.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,o.loadLevel),t.errorAction.action=it.SendAlternateToPenaltyBox,t.errorAction.flags=Gt.MoveAllAlternatesMatchingHost;return}}return;case G.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const h=o.levels[o.loadLevel],g=h==null?void 0:h.attrs["HDCP-LEVEL"];g?t.errorAction={action:it.SendAlternateToPenaltyBox,flags:Gt.MoveAllAlternatesMatchingHDCP,hdcpLevel:g}:this.keySystemError(t)}return;case G.BUFFER_ADD_CODEC_ERROR:case G.REMUX_ALLOC_ERROR:case G.BUFFER_APPEND_ERROR:t.errorAction=this.getLevelSwitchAction(t,(s=t.level)!=null?s:o.loadLevel);return;case G.INTERNAL_EXCEPTION:case G.BUFFER_APPENDING_ERROR:case G.BUFFER_FULL_ERROR:case G.LEVEL_SWITCH_ERROR:case G.BUFFER_STALLED_ERROR:case G.BUFFER_SEEK_OVER_HOLE:case G.BUFFER_NUDGE_ON_STALL:t.errorAction={action:it.DoNothing,flags:Gt.None};return}t.type===Se.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const r=this.hls,s=Jf(r.config.playlistLoadPolicy,e),o=this.playlistError++;if(po(s,o,mo(e),e.response))return{action:it.RetryRequest,flags:Gt.None,retryConfig:s,retryCount:o};const c=this.getLevelSwitchAction(e,t);return s&&(c.retryConfig=s,c.retryCount=o),c}getFragRetryOrSwitchAction(e){const t=this.hls,r=this.getVariantLevelIndex(e.frag),s=t.levels[r],{fragLoadPolicy:o,keyLoadPolicy:a}=t.config,c=Jf(e.details.startsWith("key")?a:o,e),d=t.levels.reduce((g,p)=>g+p.fragmentError,0);if(s&&(e.details!==G.FRAG_GAP&&s.fragmentError++,po(c,d,mo(e),e.response)))return{action:it.RetryRequest,flags:Gt.None,retryConfig:c,retryCount:d};const h=this.getLevelSwitchAction(e,r);return c&&(h.retryConfig=c,h.retryCount=d),h}getLevelSwitchAction(e,t){const r=this.hls;t==null&&(t=r.loadLevel);const s=this.hls.levels[t];if(s){var o,a;const h=e.details;s.loadError++,h===G.BUFFER_APPEND_ERROR&&s.fragmentError++;let g=-1;const{levels:p,loadLevel:v,minAutoLevel:T,maxAutoLevel:E}=r;r.autoLevelEnabled||(r.loadLevel=-1);const S=(o=e.frag)==null?void 0:o.type,R=(S===ve.AUDIO&&h===G.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(h===G.BUFFER_ADD_CODEC_ERROR||h===G.BUFFER_APPEND_ERROR))&&p.some(({audioCodec:V})=>s.audioCodec!==V),D=e.sourceBufferName==="video"&&(h===G.BUFFER_ADD_CODEC_ERROR||h===G.BUFFER_APPEND_ERROR)&&p.some(({codecSet:V,audioCodec:U})=>s.codecSet!==V&&s.audioCodec===U),{type:N,groupId:P}=(a=e.context)!=null?a:{};for(let V=p.length;V--;){const U=(V+v)%p.length;if(U!==v&&U>=T&&U<=E&&p[U].loadError===0){var c,d;const j=p[U];if(h===G.FRAG_GAP&&S===ve.MAIN&&e.frag){const ee=p[U].details;if(ee){const H=yo(e.frag,ee.fragments,e.frag.start);if(H!=null&&H.gap)continue}}else{if(N===Ce.AUDIO_TRACK&&j.hasAudioGroup(P)||N===Ce.SUBTITLE_TRACK&&j.hasSubtitleGroup(P))continue;if(S===ve.AUDIO&&(c=s.audioGroups)!=null&&c.some(ee=>j.hasAudioGroup(ee))||S===ve.SUBTITLE&&(d=s.subtitleGroups)!=null&&d.some(ee=>j.hasSubtitleGroup(ee))||R&&s.audioCodec===j.audioCodec||!R&&s.audioCodec!==j.audioCodec||D&&s.codecSet===j.codecSet)continue}g=U;break}}if(g>-1&&r.loadLevel!==g)return e.levelRetry=!0,this.playlistError=0,{action:it.SendAlternateToPenaltyBox,flags:Gt.None,nextAutoLevel:g}}return{action:it.SendAlternateToPenaltyBox,flags:Gt.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var r;switch((r=t.errorAction)==null?void 0:r.action){case it.DoNothing:break;case it.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==G.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,r=e.errorAction;if(!r)return;const{flags:s,hdcpLevel:o,nextAutoLevel:a}=r;switch(s){case Gt.None:this.switchLevel(e,a);break;case Gt.MoveAllAlternatesMatchingHDCP:o&&(t.maxHdcpLevel=jl[jl.indexOf(o)-1],r.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}r.resolved||this.switchLevel(e,a)}switchLevel(e,t){t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}}class uu{constructor(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=F.log.bind(F,`${t}:`),this.warn=F.warn.bind(F,`${t}:`),this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,r){const s=t==null?void 0:t.renditionReports;if(s){let o=-1;for(let a=0;a<s.length;a++){const c=s[a];let d;try{d=new self.URL(c.URI,t.url).href}catch(h){F.warn(`Could not construct new URL for Rendition Report: ${h}`),d=c.URI||""}if(d===e){o=a;break}else d===e.substring(0,d.length)&&(o=a)}if(o!==-1){const a=s[o],c=parseInt(a["LAST-MSN"])||(t==null?void 0:t.lastPartSn);let d=parseInt(a["LAST-PART"])||(t==null?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const g=Math.min(t.age-t.partTarget,t.targetduration);d>=0&&g>t.partTarget&&(d+=1)}const h=r&&Yf(r);return new qf(c,d>=0?d:void 0,h)}}}loadPlaylist(e){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}shouldReloadPlaylist(e){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(e)}playlistLoaded(e,t,r){const{details:s,stats:o}=t,a=self.performance.now(),c=o.loading.first?Math.max(0,a-o.loading.first):0;if(s.advancedDateTime=Date.now()-c,s.live||r!=null&&r.live){if(s.reloaded(r),r&&this.log(`live playlist ${e} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED"}`),r&&s.fragments.length>0&&ey(r,s),!this.canLoad||!s.live)return;let d,h,g;if(s.canBlockReload&&s.endSN&&s.advanced){const A=this.hls.config.lowLatencyMode,R=s.lastPartSn,k=s.endSN,D=s.lastPartIndex,N=D!==-1,P=R===k,V=A?0:D;N?(h=P?k+1:R,g=P?V:D+1):h=k+1;const U=s.age,j=U+s.ageHeader;let ee=Math.min(j-s.partTarget,s.targetduration*1.5);if(ee>0){if(r&&ee>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${ee} with playlist age: ${s.age}`),ee=0;else{const H=Math.floor(ee/s.targetduration);if(h+=H,g!==void 0){const Q=Math.round(ee%s.targetduration/s.partTarget);g+=Q}this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${U.toFixed(2)}s goal: ${ee} skip sn ${H} to part ${g}`)}s.tuneInGoal=ee}if(d=this.getDeliveryDirectives(s,t.deliveryDirectives,h,g),A||!P){this.loadPlaylist(d);return}}else(s.canBlockReload||s.canSkipUntil)&&(d=this.getDeliveryDirectives(s,t.deliveryDirectives,h,g));const p=this.hls.mainForwardBufferInfo,v=p?p.end-p.len:0,T=(s.edge-v)*1e3,E=iy(s,T);s.updated&&a>this.requestScheduled+E&&(this.requestScheduled=o.loading.start),h!==void 0&&s.canBlockReload?this.requestScheduled=o.loading.first+E-(s.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+E<a?this.requestScheduled=a:this.requestScheduled-a<=0&&(this.requestScheduled+=E);let S=this.requestScheduled-a;S=Math.max(0,S),this.log(`reload live playlist ${e} in ${Math.round(S)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(d),S)}else this.clearTimer()}getDeliveryDirectives(e,t,r,s){let o=Yf(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,s=t.part,o=to.No),new qf(r,s,o)}checkRetry(e){const t=e.details,r=mo(e),s=e.errorAction,{action:o,retryCount:a=0,retryConfig:c}=s||{},d=!!s&&!!c&&(o===it.RetryRequest||!s.resolved&&o===it.SendAlternateToPenaltyBox);if(d){var h;if(this.requestScheduled=-1,a>=c.maxNumRetry)return!1;if(r&&(h=e.context)!=null&&h.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${c.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const g=lu(c,a);this.timer=self.setTimeout(()=>this.loadPlaylist(),g),this.warn(`Retrying playlist loading ${a+1}/${c.maxNumRetry} after "${t}" in ${g}ms`)}e.levelRetry=!0,s.resolved=!0}return d}}class wr{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){const r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class fy{constructor(e,t,r,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new wr(e),this.fast_=new wr(t),this.defaultTTFB_=s,this.ttfb_=new wr(e)}update(e,t){const{slow_:r,fast_:s,ttfb_:o}=this;r.halfLife!==e&&(this.slow_=new wr(e,r.getEstimate(),r.getTotalWeight())),s.halfLife!==t&&(this.fast_=new wr(t,s.getEstimate(),s.getTotalWeight())),o.halfLife!==e&&(this.ttfb_=new wr(e,o.getEstimate(),o.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const r=8*t,s=e/1e3,o=r/s;this.fast_.sample(s,o),this.slow_.sample(s,o)}sampleTTFB(e){const t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}const Zh={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},eh={};function hy(l,e,t,r,s,o){const a=l.audioCodec?l.audioGroups:null,c=o==null?void 0:o.audioCodec,d=o==null?void 0:o.channels,h=d?parseInt(d):c?1/0:2;let g=null;if(a!=null&&a.length)try{a.length===1&&a[0]?g=e.groups[a[0]].channels:g=a.reduce((p,v)=>{if(v){const T=e.groups[v];if(!T)throw new Error(`Audio track group ${v} not found`);Object.keys(T.channels).forEach(E=>{p[E]=(p[E]||0)+T.channels[E]})}return p},{2:0})}catch{return!0}return l.videoCodec!==void 0&&(l.width>1920&&l.height>1088||l.height>1920&&l.width>1088||l.frameRate>Math.max(r,30)||l.videoRange!=="SDR"&&l.videoRange!==t||l.bitrate>Math.max(s,8e6))||!!g&&se(h)&&Object.keys(g).some(p=>parseInt(p)>h)}function gy(l,e,t){const r=l.videoCodec,s=l.audioCodec;if(!r||!s||!t)return Promise.resolve(Zh);const o={width:l.width,height:l.height,bitrate:Math.ceil(Math.max(l.bitrate*.9,l.averageBitrate)),framerate:l.frameRate||30},a=l.videoRange;a!=="SDR"&&(o.transferFunction=a.toLowerCase());const c=r.split(",").map(d=>({type:"media-source",video:tt(tt({},o),{},{contentType:_i(d,"video")})}));return s&&l.audioGroups&&l.audioGroups.forEach(d=>{var h;d&&((h=e.groups[d])==null||h.tracks.forEach(g=>{if(g.groupId===d){const p=g.channels||"",v=parseFloat(p);se(v)&&v>2&&c.push.apply(c,s.split(",").map(T=>({type:"media-source",audio:{contentType:_i(T,"audio"),channels:""+v}})))}}))}),Promise.all(c.map(d=>{const h=my(d);return eh[h]||(eh[h]=t.decodingInfo(d))})).then(d=>({supported:!d.some(h=>!h.supported),configurations:c,decodingInfoResults:d})).catch(d=>({supported:!1,configurations:c,decodingInfoResults:[],error:d}))}function my(l){const{audio:e,video:t}=l,r=t||e;if(r){const s=r.contentType.split('"')[1];if(t)return`r${t.height}x${t.width}f${Math.ceil(t.framerate)}${t.transferFunction||"sd"}_${s}_${Math.ceil(t.bitrate/1e5)}`;if(e)return`c${e.channels}${e.spatialRendering?"s":"n"}_${s}`}return""}function py(){if(typeof matchMedia=="function"){const l=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(l.media!==e.media)return l.matches===!0}return!1}function yy(l,e){let t=!1,r=[];return l&&(t=l!=="SDR",r=[l]),e&&(r=e.allowedVideoRanges||go.slice(0),t=e.preferHDR!==void 0?e.preferHDR:py(),t?r=r.filter(s=>s!=="SDR"):r=["SDR"]),{preferHDR:t,allowedVideoRanges:r}}function vy(l,e,t,r,s){const o=Object.keys(l),a=r==null?void 0:r.channels,c=r==null?void 0:r.audioCodec,d=a&&parseInt(a)===2;let h=!0,g=!1,p=1/0,v=1/0,T=1/0,E=0,S=[];const{preferHDR:A,allowedVideoRanges:R}=yy(e,s);for(let P=o.length;P--;){const V=l[o[P]];h=V.channels[2]>0,p=Math.min(p,V.minHeight),v=Math.min(v,V.minFramerate),T=Math.min(T,V.minBitrate);const U=R.filter(j=>V.videoRanges[j]>0);U.length>0&&(g=!0,S=U)}p=se(p)?p:0,v=se(v)?v:0;const k=Math.max(1080,p),D=Math.max(30,v);return T=se(T)?T:t,t=Math.max(T,t),g||(e=void 0,S=[]),{codecSet:o.reduce((P,V)=>{const U=l[V];if(V===P)return P;if(U.minBitrate>t)return dn(V,`min bitrate of ${U.minBitrate} > current estimate of ${t}`),P;if(!U.hasDefaultAudio)return dn(V,"no renditions with default or auto-select sound found"),P;if(c&&V.indexOf(c.substring(0,4))%5!==0)return dn(V,`audio codec preference "${c}" not found`),P;if(a&&!d){if(!U.channels[a])return dn(V,`no renditions with ${a} channel sound found (channels options: ${Object.keys(U.channels)})`),P}else if((!c||d)&&h&&U.channels[2]===0)return dn(V,"no renditions with stereo sound found"),P;return U.minHeight>k?(dn(V,`min resolution of ${U.minHeight} > maximum of ${k}`),P):U.minFramerate>D?(dn(V,`min framerate of ${U.minFramerate} > maximum of ${D}`),P):S.some(j=>U.videoRanges[j]>0)?U.maxScore<E?(dn(V,`max score of ${U.maxScore} < selected max of ${E}`),P):P&&(fo(V)>=fo(P)||U.fragmentError>l[P].fragmentError)?P:(E=U.maxScore,V):(dn(V,`no variants with VIDEO-RANGE of ${JSON.stringify(S)} found`),P)},void 0),videoRanges:S,preferHDR:A,minFramerate:v,minBitrate:T}}function dn(l,e){F.log(`[abr] start candidates with "${l}" ignored because ${e}`)}function Ey(l){return l.reduce((e,t)=>{let r=e.groups[t.groupId];r||(r=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(t);const s=t.channels||"2";return r.channels[s]=(r.channels[s]||0)+1,r.hasDefault=r.hasDefault||t.default,r.hasAutoSelect=r.hasAutoSelect||t.autoselect,r.hasDefault&&(e.hasDefaultAudio=!0),r.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function Ty(l,e,t,r){return l.slice(t,r+1).reduce((s,o)=>{if(!o.codecSet)return s;const a=o.audioGroups;let c=s[o.codecSet];c||(s[o.codecSet]=c={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!a,fragmentError:0}),c.minBitrate=Math.min(c.minBitrate,o.bitrate);const d=Math.min(o.height,o.width);return c.minHeight=Math.min(c.minHeight,d),c.minFramerate=Math.min(c.minFramerate,o.frameRate),c.maxScore=Math.max(c.maxScore,o.score),c.fragmentError+=o.fragmentError,c.videoRanges[o.videoRange]=(c.videoRanges[o.videoRange]||0)+1,a&&a.forEach(h=>{if(!h)return;const g=e.groups[h];g&&(c.hasDefaultAudio=c.hasDefaultAudio||e.hasDefaultAudio?g.hasDefault:g.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(g.channels).forEach(p=>{c.channels[p]=(c.channels[p]||0)+g.channels[p]}))}),s},{})}function Zt(l,e,t){if("attrs"in l){const r=e.indexOf(l);if(r!==-1)return r}for(let r=0;r<e.length;r++){const s=e[r];if(Or(l,s,t))return r}return-1}function Or(l,e,t){const{groupId:r,name:s,lang:o,assocLang:a,characteristics:c,default:d}=l,h=l.forced;return(r===void 0||e.groupId===r)&&(s===void 0||e.name===s)&&(o===void 0||e.lang===o)&&(o===void 0||e.assocLang===a)&&(d===void 0||e.default===d)&&(h===void 0||e.forced===h)&&(c===void 0||Sy(c,e.characteristics))&&(t===void 0||t(l,e))}function Sy(l,e=""){const t=l.split(","),r=e.split(",");return t.length===r.length&&!t.some(s=>r.indexOf(s)===-1)}function Dr(l,e){const{audioCodec:t,channels:r}=l;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(r===void 0||r===(e.channels||"2"))}function xy(l,e,t,r,s){const o=e[r],c=e.reduce((v,T,E)=>{const S=T.uri;return(v[S]||(v[S]=[])).push(E),v},{})[o.uri];c.length>1&&(r=Math.max.apply(Math,c));const d=o.videoRange,h=o.frameRate,g=o.codecSet.substring(0,4),p=th(e,r,v=>{if(v.videoRange!==d||v.frameRate!==h||v.codecSet.substring(0,4)!==g)return!1;const T=v.audioGroups,E=t.filter(S=>!T||T.indexOf(S.groupId)!==-1);return Zt(l,E,s)>-1});return p>-1?p:th(e,r,v=>{const T=v.audioGroups,E=t.filter(S=>!T||T.indexOf(S.groupId)!==-1);return Zt(l,E,s)>-1})}function th(l,e,t){for(let r=e;r>-1;r--)if(t(l[r]))return r;for(let r=e+1;r<l.length;r++)if(t(l[r]))return r;return-1}class Ly{constructor(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=()=>{const{fragCurrent:t,partCurrent:r,hls:s}=this,{autoLevelEnabled:o,media:a}=s;if(!t||!a)return;const c=performance.now(),d=r?r.stats:t.stats,h=r?r.duration:t.duration,g=c-d.loading.start,p=s.minAutoLevel;if(d.aborted||d.loaded&&d.loaded===d.total||t.level<=p){this.clearTimer(),this._nextAutoLevel=-1;return}if(!o||a.paused||!a.playbackRate||!a.readyState)return;const v=s.mainForwardBufferInfo;if(v===null)return;const T=this.bwEstimator.getEstimateTTFB(),E=Math.abs(a.playbackRate);if(g<=Math.max(T,1e3*(h/(E*2))))return;const S=v.len/E,A=d.loading.first?d.loading.first-d.loading.start:-1,R=d.loaded&&A>-1,k=this.getBwEstimate(),D=s.levels,N=D[t.level],P=d.total||Math.max(d.loaded,Math.round(h*N.averageBitrate/8));let V=R?g-A:g;V<1&&R&&(V=Math.min(g,d.loaded*8/k));const U=R?d.loaded*1e3/V:0,j=U?(P-d.loaded)/U:P*8/k+T/1e3;if(j<=S)return;const ee=U?U*8:k;let H=Number.POSITIVE_INFINITY,Q;for(Q=t.level-1;Q>p;Q--){const te=D[Q].maxBitrate;if(H=this.getTimeToLoadFrag(T/1e3,ee,h*te,!D[Q].details),H<S)break}if(H>=j||H>h*10)return;s.nextLoadLevel=s.nextAutoLevel=Q,R?this.bwEstimator.sample(g-Math.min(T,A),d.loaded):this.bwEstimator.sampleTTFB(g);const ge=D[Q].maxBitrate;this.getBwEstimate()*this.hls.config.abrBandWidthUpFactor>ge&&this.resetEstimator(ge),this.clearTimer(),F.warn(`[abr] Fragment ${t.sn}${r?" part "+r.index:""} of level ${t.level} is loading too slowly;
      Time to underbuffer: ${S.toFixed(3)} s
      Estimated load time for current fragment: ${j.toFixed(3)} s
      Estimated load time for down switch fragment: ${H.toFixed(3)} s
      TTFB estimate: ${A|0} ms
      Current BW estimate: ${se(k)?k|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${Q} @ ${ge|0} bps`),s.trigger(x.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:r,stats:d})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(F.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new fy(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.FRAG_LOADING,this.onFragLoading,this),e.on(x.FRAG_LOADED,this.onFragLoaded,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this),e.on(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(x.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.FRAG_LOADING,this.onFragLoading,this),e.off(x.FRAG_LOADED,this.onFragLoaded,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this),e.off(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(x.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(x.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const r=t.frag;if(!this.ignoreFragment(r)){if(!r.bitrateTest){var s;this.fragCurrent=r,this.partCurrent=(s=t.part)!=null?s:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case G.BUFFER_ADD_CODEC_ERROR:case G.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case G.FRAG_LOAD_TIMEOUT:{const r=t.frag,{fragCurrent:s,partCurrent:o}=this;if(r&&s&&r.sn===s.sn&&r.level===s.level){const a=performance.now(),c=o?o.stats:r.stats,d=a-c.loading.start,h=c.loading.first?c.loading.first-c.loading.start:-1;if(c.loaded&&h>-1){const p=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(d-Math.min(p,h),c.loaded)}else this.bwEstimator.sampleTTFB(d)}break}}}getTimeToLoadFrag(e,t,r,s){const o=e+r/t,a=s?this.lastLevelLoadSec:0;return o+a}onLevelLoaded(e,t){const r=this.hls.config,{loading:s}=t.stats,o=s.end-s.start;se(o)&&(this.lastLevelLoadSec=o/1e3),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)}onFragLoaded(e,{frag:t,part:r}){const s=r?r.stats:t.stats;if(t.type===ve.MAIN&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const o=r?r.duration:t.duration,a=this.hls.levels[t.level],c=(a.loaded?a.loaded.bytes:0)+s.loaded,d=(a.loaded?a.loaded.duration:0)+o;a.loaded={bytes:c,duration:d},a.realBitrate=Math.round(8*c/d)}if(t.bitrateTest){const o={stats:s,frag:t,part:r,id:t.type};this.onFragBuffered(x.FRAG_BUFFERED,o),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:r,part:s}=t,o=s!=null&&s.stats.loaded?s.stats:r.stats;if(o.aborted||this.ignoreFragment(r))return;const a=o.parsing.end-o.loading.start-Math.min(o.loading.first-o.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,o.loaded),o.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==ve.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,r=this.getBwEstimate(),s=this.hls.config.maxStarvationDelay,o=this.findBestLevel(r,t,e,0,s,1,1);if(o>-1)return o;const a=this.hls.firstLevel,c=Math.min(Math.max(a,t),e);return F.warn(`[abr] Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${c}`),c}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,r=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(e!==-1&&(!r||!s||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const o=r&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,o)&&a[e].loadError<=a[o].loadError)return e}return this._nextAutoLevel=o,this.nextAutoLevelKey=this.getAutoLevelKey(),o}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:r}=this,{maxAutoLevel:s,config:o,minAutoLevel:a}=r,c=t?t.duration:e?e.duration:0,d=this.getBwEstimate(),h=this.getStarvationDelay();let g=o.abrBandWidthFactor,p=o.abrBandWidthUpFactor;if(h){const A=this.findBestLevel(d,a,s,h,0,g,p);if(A>=0)return A}let v=c?Math.min(c,o.maxStarvationDelay):o.maxStarvationDelay;if(!h){const A=this.bitrateTestDelay;A&&(v=(c?Math.min(c,o.maxLoadingDelay):o.maxLoadingDelay)-A,F.info(`[abr] bitrate test took ${Math.round(1e3*A)}ms, set first fragment max fetchDuration to ${Math.round(1e3*v)} ms`),g=p=1)}const T=this.findBestLevel(d,a,s,h,v,g,p);if(F.info(`[abr] ${h?"rebuffering expected":"buffer is empty"}, optimal quality level ${T}`),T>-1)return T;const E=r.levels[a],S=r.levels[r.loadLevel];return(E==null?void 0:E.bitrate)<(S==null?void 0:S.bitrate)?a:r.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const r=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,s=e.mainForwardBufferInfo;return(s?s.len:0)/r}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,r,s,o,a,c){var d;const h=s+o,g=this.lastLoadedFragLevel,p=g===-1?this.hls.firstLevel:g,{fragCurrent:v,partCurrent:T}=this,{levels:E,allAudioTracks:S,loadLevel:A,config:R}=this.hls;if(E.length===1)return 0;const k=E[p],D=!!(k!=null&&(d=k.details)!=null&&d.live),N=A===-1||g===-1;let P,V="SDR",U=(k==null?void 0:k.frameRate)||0;const{audioPreference:j,videoPreference:ee}=R,H=this.audioTracksByGroup||(this.audioTracksByGroup=Ey(S));if(N){if(this.firstSelection!==-1)return this.firstSelection;const fe=this.codecTiers||(this.codecTiers=Ty(E,H,t,r)),oe=vy(fe,V,e,j,ee),{codecSet:he,videoRanges:q,minFramerate:z,minBitrate:K,preferHDR:w}=oe;P=he,V=w?q[q.length-1]:q[0],U=z,e=Math.max(e,K),F.log(`[abr] picked start tier ${JSON.stringify(oe)}`)}else P=k==null?void 0:k.codecSet,V=k==null?void 0:k.videoRange;const Q=T?T.duration:v?v.duration:0,ge=this.bwEstimator.getEstimateTTFB()/1e3,te=[];for(let fe=r;fe>=t;fe--){var de;const oe=E[fe],he=fe>p;if(!oe)continue;if(R.useMediaCapabilities&&!oe.supportedResult&&!oe.supportedPromise){const ce=navigator.mediaCapabilities;typeof(ce==null?void 0:ce.decodingInfo)=="function"&&hy(oe,H,V,U,e,j)?(oe.supportedPromise=gy(oe,H,ce),oe.supportedPromise.then(Ee=>{if(!this.hls)return;oe.supportedResult=Ee;const Te=this.hls.levels,Ae=Te.indexOf(oe);Ee.error?F.warn(`[abr] MediaCapabilities decodingInfo error: "${Ee.error}" for level ${Ae} ${JSON.stringify(Ee)}`):Ee.supported||(F.warn(`[abr] Unsupported MediaCapabilities decodingInfo result for level ${Ae} ${JSON.stringify(Ee)}`),Ae>-1&&Te.length>1&&(F.log(`[abr] Removing unsupported level ${Ae}`),this.hls.removeLevel(Ae)))})):oe.supportedResult=Zh}if(P&&oe.codecSet!==P||V&&oe.videoRange!==V||he&&U>oe.frameRate||!he&&U>0&&U<oe.frameRate||oe.supportedResult&&!((de=oe.supportedResult.decodingInfoResults)!=null&&de[0].smooth)){te.push(fe);continue}const q=oe.details,z=(T?q==null?void 0:q.partTarget:q==null?void 0:q.averagetargetduration)||Q;let K;he?K=c*e:K=a*e;const w=Q&&s>=Q*2&&o===0?E[fe].averageBitrate:E[fe].maxBitrate,$=this.getTimeToLoadFrag(ge,K,w*z,q===void 0);if(K>=w&&(fe===g||oe.loadError===0&&oe.fragmentError===0)&&($<=ge||!se($)||D&&!this.bitrateTestDelay||$<h)){const ce=this.forcedAutoLevel;return fe!==A&&(ce===-1||ce!==A)&&(te.length&&F.trace(`[abr] Skipped level(s) ${te.join(",")} of ${r} max with CODECS and VIDEO-RANGE:"${E[te[0]].codecs}" ${E[te[0]].videoRange}; not compatible with "${k.codecs}" ${V}`),F.info(`[abr] switch candidate:${p}->${fe} adjustedbw(${Math.round(K)})-bitrate=${Math.round(K-w)} ttfb:${ge.toFixed(1)} avgDuration:${z.toFixed(1)} maxFetchDuration:${h.toFixed(1)} fetchDuration:${$.toFixed(1)} firstSelection:${N} codecSet:${P} videoRange:${V} hls.loadLevel:${A}`)),N&&(this.firstSelection=fe),fe}}return-1}set nextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:r}=this.hls,s=Math.min(Math.max(e,r),t);this._nextAutoLevel!==s&&(this.nextAutoLevelKey="",this._nextAutoLevel=s)}}class Ay{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}var et={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class Ry{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(x.BUFFER_APPENDED,this.onBufferAppended,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this),e.on(x.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(x.BUFFER_APPENDED,this.onBufferAppended,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this),e.off(x.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const r=this.activePartLists[t];if(r)for(let s=r.length;s--;){const o=r[s];if(!o)break;const a=o.end;if(o.start<=e&&a!==null&&e<=a)return o}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){const{fragments:r}=this,s=Object.keys(r);for(let o=s.length;o--;){const a=r[s[o]];if((a==null?void 0:a.body.type)===t&&a.buffered){const c=a.body;if(c.start<=e&&e<=c.end)return c}}return null}detectEvictedFragments(e,t,r,s){this.timeRanges&&(this.timeRanges[e]=t);const o=(s==null?void 0:s.fragment.sn)||-1;Object.keys(this.fragments).forEach(a=>{const c=this.fragments[a];if(!c||o>=c.body.sn)return;if(!c.buffered&&!c.loaded){c.body.type===r&&this.removeFragment(c.body);return}const d=c.range[e];d&&d.time.some(h=>{const g=!this.isTimeBuffered(h.startPTS,h.endPTS,t);return g&&this.removeFragment(c.body),g})})}detectPartialFragments(e){const t=this.timeRanges,{frag:r,part:s}=e;if(!t||r.sn==="initSegment")return;const o=kr(r),a=this.fragments[o];if(!a||a.buffered&&r.gap)return;const c=!r.relurl;Object.keys(t).forEach(d=>{const h=r.elementaryStreams[d];if(!h)return;const g=t[d],p=c||h.partial===!0;a.range[d]=this.getBufferedTimes(r,s,p,g)}),a.loaded=null,Object.keys(a.range).length?(a.buffered=!0,(a.body.endList=r.endList||a.body.endList)&&(this.endListFragments[a.body.type]=a),Ws(a)||this.removeParts(r.sn-1,r.type)):this.removeFragment(a.body)}removeParts(e,t){const r=this.activePartLists[t];r&&(this.activePartLists[t]=r.filter(s=>s.fragment.sn>=e))}fragBuffered(e,t){const r=kr(e);let s=this.fragments[r];!s&&t&&(s=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,s.buffered=!0)}getBufferedTimes(e,t,r,s){const o={time:[],partial:r},a=e.start,c=e.end,d=e.minEndPTS||c,h=e.maxStartPTS||a;for(let g=0;g<s.length;g++){const p=s.start(g)-this.bufferPadding,v=s.end(g)+this.bufferPadding;if(h>=p&&d<=v){o.time.push({startPTS:Math.max(a,s.start(g)),endPTS:Math.min(c,s.end(g))});break}else if(a<v&&c>p){const T=Math.max(a,s.start(g)),E=Math.min(c,s.end(g));E>T&&(o.partial=!0,o.time.push({startPTS:T,endPTS:E}))}else if(c<=p)break}return o}getPartialFragment(e){let t=null,r,s,o,a=0;const{bufferPadding:c,fragments:d}=this;return Object.keys(d).forEach(h=>{const g=d[h];g&&Ws(g)&&(s=g.body.start-c,o=g.body.end+c,e>=s&&e<=o&&(r=Math.min(e-s,o-e),a<=r&&(t=g.body,a=r)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Ws(t))}getState(e){const t=kr(e),r=this.fragments[t];return r?r.buffered?Ws(r)?et.PARTIAL:et.OK:et.APPENDING:et.NOT_LOADED}isTimeBuffered(e,t,r){let s,o;for(let a=0;a<r.length;a++){if(s=r.start(a)-this.bufferPadding,o=r.end(a)+this.bufferPadding,e>=s&&t<=o)return!0;if(t<=s)return!1}return!1}onFragLoaded(e,t){const{frag:r,part:s}=t;if(r.sn==="initSegment"||r.bitrateTest)return;const o=s?null:t,a=kr(r);this.fragments[a]={body:r,appendedPTS:null,loaded:o,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:r,part:s,timeRanges:o}=t;if(r.sn==="initSegment")return;const a=r.type;if(s){let c=this.activePartLists[a];c||(this.activePartLists[a]=c=[]),c.push(s)}this.timeRanges=o,Object.keys(o).forEach(c=>{const d=o[c];this.detectEvictedFragments(c,d,a,s)})}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=kr(e);return!!this.fragments[t]}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,r,s,o){s&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const c=this.fragments[a];if(!c)return;const d=c.body;d.type!==r||s&&!d.gap||d.start<t&&d.end>e&&(c.buffered||o)&&this.removeFragment(d)})}removeFragment(e){const t=kr(e);e.stats.loaded=0,e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const s=e.sn;this.activePartLists[e.type]=r.filter(o=>o.fragment.sn!==s)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function Ws(l){var e,t,r;return l.buffered&&(l.body.gap||((e=l.range.video)==null?void 0:e.partial)||((t=l.range.audio)==null?void 0:t.partial)||((r=l.range.audiovideo)==null?void 0:r.partial))}function kr(l){return`${l.type}_${l.level}_${l.sn}`}const Iy={length:0,start:()=>0,end:()=>0};class Oe{static isBuffered(e,t){try{if(e){const r=Oe.getBuffered(e);for(let s=0;s<r.length;s++)if(t>=r.start(s)&&t<=r.end(s))return!0}}catch{}return!1}static bufferInfo(e,t,r){try{if(e){const s=Oe.getBuffered(e),o=[];let a;for(a=0;a<s.length;a++)o.push({start:s.start(a),end:s.end(a)});return this.bufferedInfo(o,t,r)}}catch{}return{len:0,start:t,end:t,nextStart:void 0}}static bufferedInfo(e,t,r){t=Math.max(0,t),e.sort(function(h,g){const p=h.start-g.start;return p||g.end-h.end});let s=[];if(r)for(let h=0;h<e.length;h++){const g=s.length;if(g){const p=s[g-1].end;e[h].start-p<r?e[h].end>p&&(s[g-1].end=e[h].end):s.push(e[h])}else s.push(e[h])}else s=e;let o=0,a,c=t,d=t;for(let h=0;h<s.length;h++){const g=s[h].start,p=s[h].end;if(t+r>=g&&t<p)c=g,d=p,o=d-t;else if(t+r<g){a=g;break}}return{len:o,start:c||0,end:d||0,nextStart:a}}static getBuffered(e){try{return e.buffered}catch(t){return F.log("failed to get media.buffered",t),Iy}}}class cu{constructor(e,t,r,s=0,o=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=js(),this.buffering={audio:js(),video:js(),audiovideo:js()},this.level=e,this.sn=t,this.id=r,this.size=s,this.part=o,this.partial=a}}function js(){return{start:0,executeStart:0,executeEnd:0,end:0}}function no(l,e){for(let r=0,s=l.length;r<s;r++){var t;if(((t=l[r])==null?void 0:t.cc)===e)return l[r]}return null}function Cy(l,e,t){return!!(e&&(t.endCC>t.startCC||l&&l.cc<t.startCC))}function wy(l,e){const t=l.fragments,r=e.fragments;if(!r.length||!t.length){F.log("No fragments to align");return}const s=no(t,r[0].cc);if(!s||s&&!s.startPTS){F.log("No frag in previous level to align on");return}return s}function nh(l,e){if(l){const t=l.start+e;l.start=l.startPTS=t,l.endPTS=t+l.duration}}function e0(l,e){const t=e.fragments;for(let r=0,s=t.length;r<s;r++)nh(t[r],l);e.fragmentHint&&nh(e.fragmentHint,l),e.alignedSliding=!0}function Dy(l,e,t){e&&(ky(l,t,e),!t.alignedSliding&&e&&vo(t,e),!t.alignedSliding&&e&&!t.skippedSegments&&qh(e,t))}function ky(l,e,t){if(Cy(l,t,e)){const r=wy(t,e);r&&se(r.start)&&(F.log(`Adjusting PTS using last level due to CC increase within current level ${e.url}`),e0(r.start,e))}}function vo(l,e){if(!l.hasProgramDateTime||!e.hasProgramDateTime)return;const t=l.fragments,r=e.fragments;if(!t.length||!r.length)return;let s,o;const a=Math.min(e.endCC,l.endCC);e.startCC<a&&l.startCC<a&&(s=no(r,a),o=no(t,a)),(!s||!o)&&(s=r[Math.floor(r.length/2)],o=no(t,s.cc)||t[Math.floor(t.length/2)]);const c=s.programDateTime,d=o.programDateTime;if(!c||!d)return;const h=(d-c)/1e3-(o.start-s.start);e0(h,l)}const rh=Math.pow(2,17);class _y{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const r=e.url;if(!r)return Promise.reject(new hn({type:Se.NETWORK_ERROR,details:G.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${r?"part list":"url"}`),networkDetails:null}));this.abort();const s=this.config,o=s.fLoader,a=s.loader;return new Promise((c,d)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(T=>T[0]==="GAP")){d(sh(e));return}else e.gap=!1;const h=this.loader=e.loader=o?new o(s):new a(s),g=ih(e),p=Zf(s.fragLoadPolicy.default),v={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:rh};e.stats=h.stats,h.load(g,v,{onSuccess:(T,E,S,A)=>{this.resetLoader(e,h);let R=T.data;S.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(R.slice(0,16)),R=R.slice(16)),c({frag:e,part:null,payload:R,networkDetails:A})},onError:(T,E,S,A)=>{this.resetLoader(e,h),d(new hn({type:Se.NETWORK_ERROR,details:G.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:tt({url:r,data:void 0},T),error:new Error(`HTTP Error ${T.code} ${T.text}`),networkDetails:S,stats:A}))},onAbort:(T,E,S)=>{this.resetLoader(e,h),d(new hn({type:Se.NETWORK_ERROR,details:G.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:S,stats:T}))},onTimeout:(T,E,S)=>{this.resetLoader(e,h),d(new hn({type:Se.NETWORK_ERROR,details:G.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${v.timeout}ms`),networkDetails:S,stats:T}))},onProgress:(T,E,S,A)=>{t&&t({frag:e,part:null,payload:S,networkDetails:A})}})})}loadPart(e,t,r){this.abort();const s=this.config,o=s.fLoader,a=s.loader;return new Promise((c,d)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){d(sh(e,t));return}const h=this.loader=e.loader=o?new o(s):new a(s),g=ih(e,t),p=Zf(s.fragLoadPolicy.default),v={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:rh};t.stats=h.stats,h.load(g,v,{onSuccess:(T,E,S,A)=>{this.resetLoader(e,h),this.updateStatsFromPart(e,t);const R={frag:e,part:t,payload:T.data,networkDetails:A};r(R),c(R)},onError:(T,E,S,A)=>{this.resetLoader(e,h),d(new hn({type:Se.NETWORK_ERROR,details:G.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:tt({url:g.url,data:void 0},T),error:new Error(`HTTP Error ${T.code} ${T.text}`),networkDetails:S,stats:A}))},onAbort:(T,E,S)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,h),d(new hn({type:Se.NETWORK_ERROR,details:G.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:S,stats:T}))},onTimeout:(T,E,S)=>{this.resetLoader(e,h),d(new hn({type:Se.NETWORK_ERROR,details:G.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${v.timeout}ms`),networkDetails:S,stats:T}))}})})}updateStatsFromPart(e,t){const r=e.stats,s=t.stats,o=s.total;if(r.loaded+=s.loaded,o){const d=Math.round(e.duration/t.duration),h=Math.min(Math.round(r.loaded/o),d),p=(d-h)*Math.round(r.loaded/h);r.total=r.loaded+p}else r.total=Math.max(r.loaded,r.total);const a=r.loading,c=s.loading;a.start?a.first+=c.first-c.start:(a.start=c.start,a.first=c.first),a.end=c.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function ih(l,e=null){const t=e||l,r={frag:l,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},s=t.byteRangeStartOffset,o=t.byteRangeEndOffset;if(se(s)&&se(o)){var a;let c=s,d=o;if(l.sn==="initSegment"&&((a=l.decryptdata)==null?void 0:a.method)==="AES-128"){const h=o-s;h%16&&(d=o+(16-h%16)),s!==0&&(r.resetIV=!0,c=s-16)}r.rangeStart=c,r.rangeEnd=d}return r}function sh(l,e){const t=new Error(`GAP ${l.gap?"tag":"attribute"} found`),r={type:Se.MEDIA_ERROR,details:G.FRAG_GAP,fatal:!1,frag:l,error:t,networkDetails:null};return e&&(r.part=e),(e||l).stats.aborted=!0,new hn(r)}class hn extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Py{constructor(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}decrypt(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}class Fy{constructor(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}function Oy(l){const e=l.byteLength,t=e&&new DataView(l.buffer).getUint8(e-1);return t?tr(l,0,e-t):l}class by{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),r=new Uint32Array(4);for(let s=0;s<4;s++)r[s]=t.getUint32(s*4);return r}initTable(){const e=this.sBox,t=this.invSBox,r=this.subMix,s=r[0],o=r[1],a=r[2],c=r[3],d=this.invSubMix,h=d[0],g=d[1],p=d[2],v=d[3],T=new Uint32Array(256);let E=0,S=0,A=0;for(A=0;A<256;A++)A<128?T[A]=A<<1:T[A]=A<<1^283;for(A=0;A<256;A++){let R=S^S<<1^S<<2^S<<3^S<<4;R=R>>>8^R&255^99,e[E]=R,t[R]=E;const k=T[E],D=T[k],N=T[D];let P=T[R]*257^R*16843008;s[E]=P<<24|P>>>8,o[E]=P<<16|P>>>16,a[E]=P<<8|P>>>24,c[E]=P,P=N*16843009^D*65537^k*257^E*16843008,h[R]=P<<24|P>>>8,g[R]=P<<16|P>>>16,p[R]=P<<8|P>>>24,v[R]=P,E?(E=k^T[T[T[N^k]]],S^=T[T[S]]):E=S=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let r=!0,s=0;for(;s<t.length&&r;)r=t[s]===this.key[s],s++;if(r)return;this.key=t;const o=this.keySize=t.length;if(o!==4&&o!==6&&o!==8)throw new Error("Invalid aes key size="+o);const a=this.ksRows=(o+6+1)*4;let c,d;const h=this.keySchedule=new Uint32Array(a),g=this.invKeySchedule=new Uint32Array(a),p=this.sBox,v=this.rcon,T=this.invSubMix,E=T[0],S=T[1],A=T[2],R=T[3];let k,D;for(c=0;c<a;c++){if(c<o){k=h[c]=t[c];continue}D=k,c%o===0?(D=D<<8|D>>>24,D=p[D>>>24]<<24|p[D>>>16&255]<<16|p[D>>>8&255]<<8|p[D&255],D^=v[c/o|0]<<24):o>6&&c%o===4&&(D=p[D>>>24]<<24|p[D>>>16&255]<<16|p[D>>>8&255]<<8|p[D&255]),h[c]=k=(h[c-o]^D)>>>0}for(d=0;d<a;d++)c=a-d,d&3?D=h[c]:D=h[c-4],d<4||c<=4?g[d]=D:g[d]=E[p[D>>>24]]^S[p[D>>>16&255]]^A[p[D>>>8&255]]^R[p[D&255]],g[d]=g[d]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,r){const s=this.keySize+6,o=this.invKeySchedule,a=this.invSBox,c=this.invSubMix,d=c[0],h=c[1],g=c[2],p=c[3],v=this.uint8ArrayToUint32Array_(r);let T=v[0],E=v[1],S=v[2],A=v[3];const R=new Int32Array(e),k=new Int32Array(R.length);let D,N,P,V,U,j,ee,H,Q,ge,te,de,fe,oe;const he=this.networkToHostOrderSwap;for(;t<R.length;){for(Q=he(R[t]),ge=he(R[t+1]),te=he(R[t+2]),de=he(R[t+3]),U=Q^o[0],j=de^o[1],ee=te^o[2],H=ge^o[3],fe=4,oe=1;oe<s;oe++)D=d[U>>>24]^h[j>>16&255]^g[ee>>8&255]^p[H&255]^o[fe],N=d[j>>>24]^h[ee>>16&255]^g[H>>8&255]^p[U&255]^o[fe+1],P=d[ee>>>24]^h[H>>16&255]^g[U>>8&255]^p[j&255]^o[fe+2],V=d[H>>>24]^h[U>>16&255]^g[j>>8&255]^p[ee&255]^o[fe+3],U=D,j=N,ee=P,H=V,fe=fe+4;D=a[U>>>24]<<24^a[j>>16&255]<<16^a[ee>>8&255]<<8^a[H&255]^o[fe],N=a[j>>>24]<<24^a[ee>>16&255]<<16^a[H>>8&255]<<8^a[U&255]^o[fe+1],P=a[ee>>>24]<<24^a[H>>16&255]<<16^a[U>>8&255]<<8^a[j&255]^o[fe+2],V=a[H>>>24]<<24^a[U>>16&255]<<16^a[j>>8&255]<<8^a[ee&255]^o[fe+3],k[t]=he(D^T),k[t+1]=he(V^E),k[t+2]=he(P^S),k[t+3]=he(N^A),T=Q,E=ge,S=te,A=de,t=t+4}return k.buffer}}const My=16;class du{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?Oy(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r){return this.useSoftware?new Promise((s,o)=>{this.softwareDecrypt(new Uint8Array(e),t,r);const a=this.flush();a?s(a.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r)}softwareDecrypt(e,t,r){const{currentIV:s,currentResult:o,remainderData:a}=this;this.logOnce("JS AES decrypt"),a&&(e=Ft(a,e),this.remainderData=null);const c=this.getValidChunk(e);if(!c.length)return null;s&&(r=s);let d=this.softwareDecrypter;d||(d=this.softwareDecrypter=new by),d.expandKey(t);const h=o;return this.currentResult=d.decrypt(c.buffer,0,r),this.currentIV=tr(c,-16).buffer,h||null}webCryptoDecrypt(e,t,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,r));this.key=t,this.fastAesKey=new Fy(this.subtle,t)}return this.fastAesKey.expandKey().then(s=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new Py(this.subtle,new Uint8Array(r)).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(F.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,t,r)))}onWebCryptoError(e,t,r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r);const s=this.flush();if(s)return s.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(e){let t=e;const r=e.length-e.length%My;return r!==e.length&&(t=tr(e,0,r),this.remainderData=tr(e,r)),t}logOnce(e){this.logEnabled&&(F.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Ny={toString:function(l){let e="";const t=l.length;for(let r=0;r<t;r++)e+=`[${l.start(r).toFixed(3)}-${l.end(r).toFixed(3)}]`;return e}},W={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class fu extends Ay{constructor(e,t,r,s,o){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=W.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=o,this.logPrefix=s,this.log=F.log.bind(F,`${s}:`),this.warn=F.warn.bind(F,`${s}:`),this.hls=e,this.fragmentLoader=new _y(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new du(e.config),e.on(x.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=W.STOPPED}_streamEnded(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;const r=t.partList;if(r!=null&&r.length){const o=r[r.length-1];return Oe.isBuffered(this.media,o.start+o.duration/2)}const s=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(s)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levelLastLoaded)==null?void 0:e.details}}onMediaAttached(e,t){const r=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),r.addEventListener("seeking",this.onvseeking),r.addEventListener("ended",this.onvended);const s=this.config;this.levels&&s.autoStartLoad&&this.state===W.STOPPED&&this.startLoad(s.startPosition)}onMediaDetaching(){const e=this.media;e!=null&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:e,fragCurrent:t,media:r,mediaBuffer:s,state:o}=this,a=r?r.currentTime:0,c=Oe.bufferInfo(s||r,a,e.maxBufferHole);if(this.log(`media seeking to ${se(a)?a.toFixed(3):a}, state: ${o}`),this.state===W.ENDED)this.resetLoadingState();else if(t){const d=e.maxFragLookUpTolerance,h=t.start-d,g=t.start+t.duration+d;if(!c.len||g<c.start||h>c.end){const p=a>g;(a<h||p)&&(p&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}r&&(this.fragmentTracker.removeFragmentsInRange(a,1/0,this.playlistType,!0),this.lastCurrentTime=a),!this.loadedmetadata&&!c.len&&(this.nextLoadPosition=this.startPosition=a),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.hls.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),super.onHandlerDestroying(),this.hls=null}onHandlerDestroyed(){this.state=W.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){const s=o=>{if(this.fragContextChanged(e)){this.warn(`Fragment ${e.sn}${o.part?" p: "+o.part.index:""} of level ${e.level} was dropped during download.`),this.fragmentTracker.removeFragment(e);return}e.stats.chunkCount++,this._handleFragmentLoadProgress(o)};this._doFragLoad(e,t,r,s).then(o=>{if(!o)return;const a=this.state;if(this.fragContextChanged(e)){(a===W.FRAG_LOADING||!this.fragCurrent&&a===W.PARSING)&&(this.fragmentTracker.removeFragment(e),this.state=W.IDLE);return}"payload"in o&&(this.log(`Loaded fragment ${e.sn} of level ${e.level}`),this.hls.trigger(x.FRAG_LOADED,o)),this._handleFragmentLoadComplete(o)}).catch(o=>{this.state===W.STOPPED||this.state===W.ERROR||(this.warn(`Frag error: ${(o==null?void 0:o.message)||o}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:r}=this;if(r.getState(e)===et.APPENDING){const o=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,o),c=Math.max(e.duration,a?a.len:this.config.maxBufferLength),d=this.backtrackFragment;((d?e.sn-d.sn:0)===1||this.reduceMaxBufferLength(c,e.duration))&&r.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===et.PARTIAL&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}flushMainBuffer(e,t,r=null){if(!(e-t))return;const s={startOffset:e,endOffset:t,type:r};this.hls.trigger(x.BUFFER_FLUSHING,s)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(r=>{if(!r||this.fragContextChanged(e)||!this.levels)throw new Error("init load aborted");return r}).then(r=>{const{hls:s}=this,{payload:o}=r,a=e.decryptdata;if(o&&o.byteLength>0&&a!=null&&a.key&&a.iv&&a.method==="AES-128"){const c=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),a.key.buffer,a.iv.buffer).catch(d=>{throw s.trigger(x.ERROR,{type:Se.MEDIA_ERROR,details:G.FRAG_DECRYPT_ERROR,fatal:!1,error:d,reason:d.message,frag:e}),d}).then(d=>{const h=self.performance.now();return s.trigger(x.FRAG_DECRYPTED,{frag:e,payload:d,stats:{tstart:c,tdecrypt:h}}),r.payload=d,this.completeInitSegmentLoad(r)})}return this.completeInitSegmentLoad(r)}).catch(r=>{this.state===W.STOPPED||this.state===W.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const r=e.frag.stats;this.state=W.IDLE,e.frag.data=new Uint8Array(e.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){var r,s,o,a;const c=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.playlistType===ve.MAIN?"level":"track"} ${e.level} (frag:[${((r=e.startPTS)!=null?r:NaN).toFixed(3)}-${((s=e.endPTS)!=null?s:NaN).toFixed(3)}] > buffer:${c?Ny.toString(Oe.getBuffered(c)):"(detached)"})`),e.sn!=="initSegment"){var d;if(e.type!==ve.SUBTITLE){const g=e.elementaryStreams;if(!Object.keys(g).some(p=>!!g[p])){this.state=W.IDLE;return}}const h=(d=this.levels)==null?void 0:d[e.level];h!=null&&h.fragmentError&&(this.log(`Resetting level fragment error count of ${h.fragmentError} on frag buffered`),h.fragmentError=0)}this.state=W.IDLE,c&&(!this.loadedmetadata&&e.type==ve.MAIN&&c.buffered.length&&((o=this.fragCurrent)==null?void 0:o.sn)===((a=this.fragPrevious)==null?void 0:a.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:r,part:s,partsLoaded:o}=e,a=!o||o.length===0||o.some(d=>!d),c=new cu(r.level,r.sn,r.stats.chunkCount+1,0,s?s.index:-1,!a);t.flush(c)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,s){var o;const a=t==null?void 0:t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let c=null;if(e.encrypted&&!((o=e.decryptdata)!=null&&o.key)?(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.logPrefix==="[stream-controller]"?"level":"track"} ${e.level}`),this.state=W.KEY_LOADING,this.fragCurrent=e,c=this.keyLoader.load(e).then(g=>{if(!this.fragContextChanged(g.frag))return this.hls.trigger(x.KEY_LOADED,g),this.state===W.KEY_LOADING&&(this.state=W.IDLE),g}),this.hls.trigger(x.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(c=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!e.encrypted&&a.encryptedFragments.length&&this.keyLoader.loadClear(e,a.encryptedFragments),r=Math.max(e.start,r||0),this.config.lowLatencyMode&&e.sn!=="initSegment"){const g=a.partList;if(g&&s){r>e.end&&a.fragmentHint&&(e=a.fragmentHint);const p=this.getNextPart(g,e,r);if(p>-1){const v=g[p];this.log(`Loading part sn: ${e.sn} p: ${v.index} cc: ${e.cc} of playlist [${a.startSN}-${a.endSN}] parts [0-${p}-${g.length-1}] ${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=v.start+v.duration,this.state=W.FRAG_LOADING;let T;return c?T=c.then(E=>!E||this.fragContextChanged(E.frag)?null:this.doFragPartsLoad(e,v,t,s)).catch(E=>this.handleFragLoadError(E)):T=this.doFragPartsLoad(e,v,t,s).catch(E=>this.handleFragLoadError(E)),this.hls.trigger(x.FRAG_LOADING,{frag:e,part:v,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):T}else if(!e.url||this.loadedEndOfParts(g,r))return Promise.resolve(null)}}this.log(`Loading fragment ${e.sn} cc: ${e.cc} ${a?"of ["+a.startSN+"-"+a.endSN+"] ":""}${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(r.toFixed(3))}`),se(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=W.FRAG_LOADING;const d=this.config.progressive;let h;return d&&c?h=c.then(g=>!g||this.fragContextChanged(g==null?void 0:g.frag)?null:this.fragmentLoader.load(e,s)).catch(g=>this.handleFragLoadError(g)):h=Promise.all([this.fragmentLoader.load(e,d?s:void 0),c]).then(([g])=>(!d&&g&&s&&s(g),g)).catch(g=>this.handleFragLoadError(g)),this.hls.trigger(x.FRAG_LOADING,{frag:e,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):h}doFragPartsLoad(e,t,r,s){return new Promise((o,a)=>{var c;const d=[],h=(c=r.details)==null?void 0:c.partList,g=p=>{this.fragmentLoader.loadPart(e,p,s).then(v=>{d[p.index]=v;const T=v.part;this.hls.trigger(x.FRAG_LOADED,v);const E=Qf(r,e.sn,p.index+1)||Xh(h,e.sn,p.index+1);if(E)g(E);else return o({frag:e,part:T,partsLoaded:d})}).catch(a)};g(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===G.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(x.ERROR,t)}else this.hls.trigger(x.ERROR,{type:Se.OTHER_ERROR,details:G.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==W.PARSING){!this.fragCurrent&&this.state!==W.STOPPED&&this.state!==W.ERROR&&(this.state=W.IDLE);return}const{frag:r,part:s,level:o}=t,a=self.performance.now();r.stats.parsing.end=a,s&&(s.stats.parsing.end=a),this.updateLevelTiming(r,s,o,e.partial)}getCurrentContext(e){const{levels:t,fragCurrent:r}=this,{level:s,sn:o,part:a}=e;if(!(t!=null&&t[s]))return this.warn(`Levels object was unset while buffering fragment ${o} of level ${s}. The current chunk will not be buffered.`),null;const c=t[s],d=a>-1?Qf(c,o,a):null,h=d?d.fragment:sy(c,o,r);return h?(r&&r!==h&&(h.stats=r.stats),{frag:h,part:d,level:c}):null}bufferFragmentData(e,t,r,s,o){var a;if(!e||this.state!==W.PARSING)return;const{data1:c,data2:d}=e;let h=c;if(c&&d&&(h=Ft(c,d)),!((a=h)!=null&&a.length))return;const g={type:e.type,frag:t,part:r,chunkMeta:s,parent:t.type,data:h};if(this.hls.trigger(x.BUFFER_APPENDING,g),e.dropped&&e.independent&&!r){if(o)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Oe.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const r=t.currentTime,s=Oe.bufferInfo(t,r,0),o=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,o*.25),c=Math.max(Math.min(e.start-a,s.end-a),r+a);e.start-c>a&&this.flushMainBuffer(c,e.start)}getFwdBufferInfo(e,t){const r=this.getLoadPosition();return se(r)?this.getFwdBufferInfoAtPos(e,r,t):null}getFwdBufferInfoAtPos(e,t,r){const{config:{maxBufferHole:s}}=this,o=Oe.bufferInfo(e,t,s);if(o.len===0&&o.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(t,r);if(a&&o.nextStart<a.end)return Oe.bufferInfo(e,t,Math.max(o.nextStart,s))}return o}getMaxBufferLength(e){const{config:t}=this;let r;return e?r=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):r=t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const r=this.config,s=Math.max(Math.min(e-t,r.maxBufferLength),t),o=Math.max(e-t*3,r.maxMaxBufferLength/2,s);return o>=s?(r.maxMaxBufferLength=o,this.warn(`Reduce max buffer length to ${o}s`),!0):!1}getAppendedFrag(e,t=ve.MAIN){const r=this.fragmentTracker.getAppendedFrag(e,ve.MAIN);return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const r=t.fragments,s=r.length;if(!s)return null;const{config:o}=this,a=r[0].start;let c;if(t.live){const d=o.initialLiveManifestSize;if(s<d)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${d})`),null;(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a)&&(c=this.getInitialLiveFragment(t,r),this.startPosition=this.nextLoadPosition=c?this.hls.liveSyncPosition||c.start:e)}else e<=a&&(c=r[0]);if(!c){const d=o.lowLatencyMode?t.partEnd:t.fragmentEnd;c=this.getFragmentAtPosition(e,d,t)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(e,t){const r=this.fragmentTracker.getState(e);return(r===et.OK||r===et.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,s,o){const a=e.gap,c=this.getNextFragment(this.nextLoadPosition,t);if(c===null)return c;if(e=c,a&&e&&!e.gap&&r.nextStart){const d=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,s);if(d!==null&&r.len+d.len>=o)return this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${e.sn}`),null}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,r){let s=-1,o=!1,a=!0;for(let c=0,d=e.length;c<d;c++){const h=e[c];if(a=a&&!h.independent,s>-1&&r<h.start)break;const g=h.loaded;g?s=-1:(o||h.independent||a)&&h.fragment===t&&(s=c),o=g}return s}loadedEndOfParts(e,t){const r=e[e.length-1];return r&&t>r.start&&r.loaded}getInitialLiveFragment(e,t){const r=this.fragPrevious;let s=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),s=ay(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const o=r.sn+1;if(o>=e.startSN&&o<=e.endSN){const a=t[o-e.startSN];r.cc===a.cc&&(s=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=cy(t,r.cc),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const o=this.hls.liveSyncPosition;o!==null&&(s=this.getFragmentAtPosition(o,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s}getFragmentAtPosition(e,t,r){const{config:s}=this;let{fragPrevious:o}=this,{fragments:a,endSN:c}=r;const{fragmentHint:d}=r,{maxFragLookUpTolerance:h}=s,g=r.partList,p=!!(s.lowLatencyMode&&g!=null&&g.length&&d);p&&d&&!this.bitrateTest&&(a=a.concat(d),c=d.sn);let v;if(e<t){const T=e>t-h?0:h;v=yo(o,a,e,T)}else v=a[a.length-1];if(v){const T=v.sn-r.startSN,E=this.fragmentTracker.getState(v);if((E===et.OK||E===et.PARTIAL&&v.gap)&&(o=v),o&&v.sn===o.sn&&(!p||g[0].fragment.sn>v.sn)&&o&&v.level===o.level){const A=a[T+1];v.sn<c&&this.fragmentTracker.getState(A)!==et.OK?v=A:v=null}}return v}synchronizeToLiveEdge(e){const{config:t,media:r}=this;if(!r)return;const s=this.hls.liveSyncPosition,o=r.currentTime,a=e.fragments[0].start,c=e.edge,d=o>=a-t.maxFragLookUpTolerance&&o<=c;if(s!==null&&r.duration>s&&(o<s||!d)){const h=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!d&&r.readyState<4||o<c-h)&&(this.loadedmetadata||(this.nextLoadPosition=s),r.readyState&&(this.warn(`Playback: ${o.toFixed(3)} is located too far from the end of live sliding playlist: ${c}, reset currentTime to : ${s.toFixed(3)}`),r.currentTime=s))}}alignPlaylists(e,t,r){const s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;const o=e.fragments[0].start,a=!t,c=e.alignedSliding&&se(o);if(a||!c&&!o){const{fragPrevious:d}=this;Dy(d,r,e);const h=e.fragments[0].start;return this.log(`Live playlist sliding: ${h.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} prev-sn: ${d?d.sn:"na"} fragments: ${s}`),h}return o}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let r=this.startPosition;if(r<t&&(r=-1),r===-1||this.lastCurrentTime===-1){const s=this.startTimeOffset!==null,o=s?this.startTimeOffset:e.startTimeOffset;o!==null&&se(o)?(r=t+o,o<0&&(r+=e.totalduration),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Start time offset ${o} found in ${s?"multivariant":"media"} playlist, adjust startPosition to ${r}`),this.startPosition=r):e.live?r=this.hls.liveSyncPosition||t:this.startPosition=r=0,this.lastCurrentTime=r}this.nextLoadPosition=r}getLoadPosition(){const{media:e}=this;let t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}handleFragLoadAborted(e,t){this.transmuxer&&e.sn!=="initSegment"&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==W.FRAG_LOADING_WAITING_RETRY)&&(this.state=W.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const g=this.getCurrentContext(t.chunkMeta);g&&(t.frag=g.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;if(this.fragContextChanged(r)){var s;this.warn(`Frag load error must match current frag to retry ${r.url} > ${(s=this.fragCurrent)==null?void 0:s.url}`);return}const o=t.details===G.FRAG_GAP;o&&this.fragmentTracker.fragBuffered(r,!0);const a=t.errorAction,{action:c,retryCount:d=0,retryConfig:h}=a||{};if(a&&c===it.RetryRequest&&h){this.resetStartWhenNotLoaded(this.levelLastLoaded);const g=lu(h,d);this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${d+1}/${h.maxNumRetry} in ${g}ms`),a.resolved=!0,this.retryDate=self.performance.now()+g,this.state=W.FRAG_LOADING_WAITING_RETRY}else if(h&&a)if(this.resetFragmentErrors(e),d<h.maxNumRetry)!o&&c!==it.RemoveAlternatePermanently&&(a.resolved=!0);else{F.warn(`${t.details} reached or exceeded max retry (${d})`);return}else(a==null?void 0:a.action)===it.SendAlternateToPenaltyBox?this.state=W.WAITING_LEVEL:this.state=W.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===W.PARSING||this.state===W.PARSED){const t=e.frag,r=e.parent,s=this.getFwdBufferInfo(this.mediaBuffer,r),o=s&&s.len>.5;o&&this.reduceMaxBufferLength(s.len,(t==null?void 0:t.duration)||10);const a=!o;return a&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${r} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===ve.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==W.STOPPED&&(this.state=W.IDLE)}afterBufferFlushed(e,t,r){if(!e)return;const s=Oe.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,s,r),this.state===W.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=W.IDLE}resetStartWhenNotLoaded(e){if(!this.loadedmetadata){this.startFragRequested=!1;const t=e?e.details:null;t!=null&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,s){var o;const a=r.details;if(!a){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((d,h)=>{const g=e.elementaryStreams[h];if(g){const p=g.endPTS-g.startPTS;if(p<=0)return this.warn(`Could not parse fragment ${e.sn} ${h} duration reliably (${p})`),d||!1;const v=s?0:Yh(a,e,g.startPTS,g.endPTS,g.startDTS,g.endDTS);return this.hls.trigger(x.LEVEL_PTS_UPDATED,{details:a,level:r,drift:v,type:h,frag:e,start:g.startPTS,end:g.endPTS}),!0}return d},!1)&&((o=this.transmuxer)==null?void 0:o.error)===null){const d=new Error(`Found no media in fragment ${e.sn} of level ${e.level} resetting transmuxer to fallback to playlist timing`);if(r.fragmentError===0&&(r.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(d.message),this.hls.trigger(x.ERROR,{type:Se.MEDIA_ERROR,details:G.FRAG_PARSING_ERROR,fatal:!1,error:d,frag:e,reason:`Found no media in msn ${e.sn} of level "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=W.PARSED,this.hls.trigger(x.FRAG_PARSED,{frag:e,part:t})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}class t0{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let r;if(e.length)e.length===1?r=e[0]:r=Uy(e,t);else return new Uint8Array(0);return this.reset(),r}reset(){this.chunks.length=0,this.dataLength=0}}function Uy(l,e){const t=new Uint8Array(e);let r=0;for(let s=0;s<l.length;s++){const o=l[s];t.set(o,r),r+=o.length}return t}function By(){return typeof __HLS_WORKER_BUNDLE__=="function"}function $y(){const l=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),e=self.URL.createObjectURL(l);return{worker:new self.Worker(e),objectURL:e}}function Gy(l){const e=new self.URL(l,self.location.href).href;return{worker:new self.Worker(e),scriptURL:e}}function Qt(l="",e=9e4){return{type:l,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class hu{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=Ft(this.cachedData,e),this.cachedData=null);let r=Di(e,0),s=r?r.length:0,o;const a=this._audioTrack,c=this._id3Track,d=r?au(r):void 0,h=e.length;for((this.basePTS===null||this.frameIndex===0&&se(d))&&(this.basePTS=Ky(d,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),r&&r.length>0&&c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Vt.audioId3,duration:Number.POSITIVE_INFINITY});s<h;){if(this.canParse(e,s)){const g=this.appendFrame(a,e,s);g?(this.frameIndex++,this.lastPTS=g.sample.pts,s+=g.length,o=s):s=h}else up(e,s)?(r=Di(e,s),c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Vt.audioId3,duration:Number.POSITIVE_INFINITY}),s+=r.length,o=s):s++;if(s===h&&o!==h){const g=tr(e,o);this.cachedData?this.cachedData=Ft(this.cachedData,g):this.cachedData=g}}return{audioTrack:a,videoTrack:Qt(),id3Track:c,textTrack:Qt()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Qt(),id3Track:this._id3Track,textTrack:Qt()}}destroy(){}}const Ky=(l,e,t)=>{if(se(l))return l*90;const r=t?t.baseTime*9e4/t.timescale:0;return e*9e4+r};function Vy(l,e,t,r){let s,o,a,c;const d=navigator.userAgent.toLowerCase(),h=r,g=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];s=((e[t+2]&192)>>>6)+1;const p=(e[t+2]&60)>>>2;if(p>g.length-1){const v=new Error(`invalid ADTS sampling index:${p}`);l.emit(x.ERROR,x.ERROR,{type:Se.MEDIA_ERROR,details:G.FRAG_PARSING_ERROR,fatal:!0,error:v,reason:v.message});return}return a=(e[t+2]&1)<<2,a|=(e[t+3]&192)>>>6,F.log(`manifest codec:${r}, ADTS type:${s}, samplingIndex:${p}`),/firefox/i.test(d)?p>=6?(s=5,c=new Array(4),o=p-3):(s=2,c=new Array(2),o=p):d.indexOf("android")!==-1?(s=2,c=new Array(2),o=p):(s=5,c=new Array(4),r&&(r.indexOf("mp4a.40.29")!==-1||r.indexOf("mp4a.40.5")!==-1)||!r&&p>=6?o=p-3:((r&&r.indexOf("mp4a.40.2")!==-1&&(p>=6&&a===1||/vivaldi/i.test(d))||!r&&a===1)&&(s=2,c=new Array(2)),o=p)),c[0]=s<<3,c[0]|=(p&14)>>1,c[1]|=(p&1)<<7,c[1]|=a<<3,s===5&&(c[1]|=(o&14)>>1,c[2]=(o&1)<<7,c[2]|=8,c[3]=0),{config:c,samplerate:g[p],channelCount:a,codec:"mp4a.40."+s,manifestCodec:h}}function n0(l,e){return l[e]===255&&(l[e+1]&246)===240}function r0(l,e){return l[e+1]&1?7:9}function gu(l,e){return(l[e+3]&3)<<11|l[e+4]<<3|(l[e+5]&224)>>>5}function Hy(l,e){return e+5<l.length}function Eo(l,e){return e+1<l.length&&n0(l,e)}function zy(l,e){return Hy(l,e)&&n0(l,e)&&gu(l,e)<=l.length-e}function Wy(l,e){if(Eo(l,e)){const t=r0(l,e);if(e+t>=l.length)return!1;const r=gu(l,e);if(r<=t)return!1;const s=e+r;return s===l.length||Eo(l,s)}return!1}function i0(l,e,t,r,s){if(!l.samplerate){const o=Vy(e,t,r,s);if(!o)return;l.config=o.config,l.samplerate=o.samplerate,l.channelCount=o.channelCount,l.codec=o.codec,l.manifestCodec=o.manifestCodec,F.log(`parsed codec:${l.codec}, rate:${o.samplerate}, channels:${o.channelCount}`)}}function s0(l){return 1024*9e4/l}function jy(l,e){const t=r0(l,e);if(e+t<=l.length){const r=gu(l,e)-t;if(r>0)return{headerLength:t,frameLength:r}}}function o0(l,e,t,r,s){const o=s0(l.samplerate),a=r+s*o,c=jy(e,t);let d;if(c){const{frameLength:p,headerLength:v}=c,T=v+p,E=Math.max(0,t+T-e.length);E?(d=new Uint8Array(T-v),d.set(e.subarray(t+v,e.length),0)):d=e.subarray(t+v,t+T);const S={unit:d,pts:a};return E||l.samples.push(S),{sample:S,length:T,missing:E}}const h=e.length-t;return d=new Uint8Array(h),d.set(e.subarray(t,e.length),0),{sample:{unit:d,pts:a},length:h,missing:-1}}let Ys=null;const Yy=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],qy=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Xy=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Qy=[0,1,1,4];function a0(l,e,t,r,s){if(t+24>e.length)return;const o=l0(e,t);if(o&&t+o.frameLength<=e.length){const a=o.samplesPerFrame*9e4/o.sampleRate,c=r+s*a,d={unit:e.subarray(t,t+o.frameLength),pts:c,dts:c};return l.config=[],l.channelCount=o.channelCount,l.samplerate=o.sampleRate,l.samples.push(d),{sample:d,length:o.frameLength,missing:0}}}function l0(l,e){const t=l[e+1]>>3&3,r=l[e+1]>>1&3,s=l[e+2]>>4&15,o=l[e+2]>>2&3;if(t!==1&&s!==0&&s!==15&&o!==3){const a=l[e+2]>>1&1,c=l[e+3]>>6,d=t===3?3-r:r===3?3:4,h=Yy[d*14+s-1]*1e3,p=qy[(t===3?0:t===2?1:2)*3+o],v=c===3?1:2,T=Xy[t][r],E=Qy[r],S=T*8*E,A=Math.floor(T*h/p+a)*E;if(Ys===null){const D=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Ys=D?parseInt(D[1]):0}return!!Ys&&Ys<=87&&r===2&&h>=224e3&&c===0&&(l[e+3]=l[e+3]|128),{sampleRate:p,channelCount:v,frameLength:A,samplesPerFrame:S}}}function mu(l,e){return l[e]===255&&(l[e+1]&224)===224&&(l[e+1]&6)!==0}function u0(l,e){return e+1<l.length&&mu(l,e)}function Jy(l,e){return mu(l,e)&&4<=l.length-e}function c0(l,e){if(e+1<l.length&&mu(l,e)){const r=l0(l,e);let s=4;r!=null&&r.frameLength&&(s=r.frameLength);const o=e+s;return o===l.length||u0(l,o)}return!1}class Zy extends hu{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Di(e,0);let r=(t==null?void 0:t.length)||0;if(c0(e,r))return!1;for(let s=e.length;r<s;r++)if(Wy(e,r))return F.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return zy(e,t)}appendFrame(e,t,r){i0(e,this.observer,t,r,e.manifestCodec);const s=o0(e,t,r,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s}}const ev=/\/emsg[-/]ID3/i;class tv{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,s){const o=this.videoTrack=Qt("video",1),a=this.audioTrack=Qt("audio",1),c=this.txtTrack=Qt("text",1);if(this.id3Track=Qt("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const d=$h(e);if(d.video){const{id:h,timescale:g,codec:p}=d.video;o.id=h,o.timescale=c.timescale=g,o.codec=p}if(d.audio){const{id:h,timescale:g,codec:p}=d.audio;a.id=h,a.timescale=g,a.codec=p}c.id=Nh.text,o.sampleDuration=0,o.duration=a.duration=s}resetContiguity(){this.remainderData=null}static probe(e){return vp(e)}demux(e,t){this.timeOffset=t;let r=e;const s=this.videoTrack,o=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=Ft(this.remainderData,e));const c=Ip(r);this.remainderData=c.remainder,s.samples=c.valid||new Uint8Array}else s.samples=r;const a=this.extractID3Track(s,t);return o.samples=Pf(t,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(t,this.timeOffset);return r.samples=Pf(e,t),{videoTrack:t,audioTrack:Qt(),id3Track:s,textTrack:Qt()}}extractID3Track(e,t){const r=this.id3Track;if(e.samples.length){const s=Le(e.samples,["emsg"]);s&&s.forEach(o=>{const a=Dp(o);if(ev.test(a.schemeIdUri)){const c=se(a.presentationTime)?a.presentationTime/a.timeScale:t+a.presentationTimeDelta/a.timeScale;let d=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;d<=.001&&(d=Number.POSITIVE_INFINITY);const h=a.payload;r.samples.push({data:h,len:h.byteLength,dts:c,pts:c,type:Vt.emsg,duration:d})}})}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}}const d0=(l,e)=>{let t=0,r=5;e+=r;const s=new Uint32Array(1),o=new Uint32Array(1),a=new Uint8Array(1);for(;r>0;){a[0]=l[e];const c=Math.min(r,8),d=8-c;o[0]=4278190080>>>24+d<<d,s[0]=(a[0]&o[0])>>d,t=t?t<<c|s[0]:s[0],e+=1,r-=c}return t};class nv extends hu{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,r){const s=f0(e,t,r,this.basePTS,this.frameIndex);if(s!==-1)return{sample:e.samples[e.samples.length-1],length:s,missing:0}}static probe(e){if(!e)return!1;const t=Di(e,0);if(!t)return!1;const r=t.length;return e[r]===11&&e[r+1]===119&&au(t)!==void 0&&d0(e,r)<16}}function f0(l,e,t,r,s){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const o=e[t+4]>>6;if(o>=3)return-1;const c=[48e3,44100,32e3][o],d=e[t+4]&63,g=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][d*3+o]*2;if(t+g>e.length)return-1;const p=e[t+6]>>5;let v=0;p===2?v+=2:(p&1&&p!==1&&(v+=2),p&4&&(v+=2));const T=(e[t+6]<<8|e[t+7])>>12-v&1,S=[2,1,2,3,3,4,4,5][p]+T,A=e[t+5]>>3,R=e[t+5]&7,k=new Uint8Array([o<<6|A<<1|R>>2,(R&3)<<6|p<<3|T<<2|d>>4,d<<4&224]),D=1536/c*9e4,N=r+s*D,P=e.subarray(t,t+g);return l.config=k,l.channelCount=S,l.samplerate=c,l.samples.push({unit:P,pts:N}),g}class rv{constructor(){this.VideoSample=null}createVideoSample(e,t,r,s){return{key:e,frame:!1,pts:t,dts:r,units:[],debug:s,length:0}}getLastNalUnit(e){var t;let r=this.VideoSample,s;if((!r||r.units.length===0)&&(r=e[e.length-1]),(t=r)!=null&&t.units){const o=r.units;s=o[o.length-1]}return s}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const r=t.samples,s=r.length;if(s){const o=r[s-1];e.pts=o.pts,e.dts=o.dts}else{t.dropped++;return}}t.samples.push(e)}e.debug.length&&F.log(e.pts+"/"+e.dts+":"+e.debug)}}class oh{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,r=e.byteLength-t,s=new Uint8Array(4),o=Math.min(4,t);if(o===0)throw new Error("no bytes available");s.set(e.subarray(r,r+o)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=o*8,this.bytesAvailable-=o}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const r=this.word>>>32-t;if(e>32&&F.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let t=8,r=8,s;for(let o=0;o<e;o++)r!==0&&(s=this.readEG(),r=(t+s+256)%256),t=r===0?t:r}readSPS(){let e=0,t=0,r=0,s=0,o,a,c;const d=this.readUByte.bind(this),h=this.readBits.bind(this),g=this.readUEG.bind(this),p=this.readBoolean.bind(this),v=this.skipBits.bind(this),T=this.skipEG.bind(this),E=this.skipUEG.bind(this),S=this.skipScalingList.bind(this);d();const A=d();if(h(5),v(3),d(),E(),A===100||A===110||A===122||A===244||A===44||A===83||A===86||A===118||A===128){const V=g();if(V===3&&v(1),E(),E(),v(1),p())for(a=V!==3?8:12,c=0;c<a;c++)p()&&(c<6?S(16):S(64))}E();const R=g();if(R===0)g();else if(R===1)for(v(1),T(),T(),o=g(),c=0;c<o;c++)T();E(),v(1);const k=g(),D=g(),N=h(1);N===0&&v(1),v(1),p()&&(e=g(),t=g(),r=g(),s=g());let P=[1,1];if(p()&&p())switch(d()){case 1:P=[1,1];break;case 2:P=[12,11];break;case 3:P=[10,11];break;case 4:P=[16,11];break;case 5:P=[40,33];break;case 6:P=[24,11];break;case 7:P=[20,11];break;case 8:P=[32,11];break;case 9:P=[80,33];break;case 10:P=[18,11];break;case 11:P=[15,11];break;case 12:P=[64,33];break;case 13:P=[160,99];break;case 14:P=[4,3];break;case 15:P=[3,2];break;case 16:P=[2,1];break;case 255:{P=[d()<<8|d(),d()<<8|d()];break}}return{width:Math.ceil((k+1)*16-e*2-t*2),height:(2-N)*(D+1)*16-(N?2:4)*(r+s),pixelRatio:P}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class iv extends rv{parseAVCPES(e,t,r,s,o){const a=this.parseAVCNALu(e,r.data);let c=this.VideoSample,d,h=!1;r.data=null,c&&a.length&&!e.audFound&&(this.pushAccessUnit(c,e),c=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts,"")),a.forEach(g=>{var p;switch(g.type){case 1:{let S=!1;d=!0;const A=g.data;if(h&&A.length>4){const R=new oh(A).readSliceType();(R===2||R===4||R===7||R===9)&&(S=!0)}if(S){var v;(v=c)!=null&&v.frame&&!c.key&&(this.pushAccessUnit(c,e),c=this.VideoSample=null)}c||(c=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts,"")),c.frame=!0,c.key=S;break}case 5:d=!0,(p=c)!=null&&p.frame&&!c.key&&(this.pushAccessUnit(c,e),c=this.VideoSample=null),c||(c=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts,"")),c.key=!0,c.frame=!0;break;case 6:{d=!0,Kh(g.data,1,r.pts,t.samples);break}case 7:{var T,E;d=!0,h=!0;const S=g.data,R=new oh(S).readSPS();if(!e.sps||e.width!==R.width||e.height!==R.height||((T=e.pixelRatio)==null?void 0:T[0])!==R.pixelRatio[0]||((E=e.pixelRatio)==null?void 0:E[1])!==R.pixelRatio[1]){e.width=R.width,e.height=R.height,e.pixelRatio=R.pixelRatio,e.sps=[S],e.duration=o;const k=S.subarray(1,4);let D="avc1.";for(let N=0;N<3;N++){let P=k[N].toString(16);P.length<2&&(P="0"+P),D+=P}e.codec=D}break}case 8:d=!0,e.pps=[g.data];break;case 9:d=!0,e.audFound=!0,c&&this.pushAccessUnit(c,e),c=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts,"");break;case 12:d=!0;break;default:d=!1,c&&(c.debug+="unknown NAL "+g.type+" ");break}c&&d&&c.units.push(g)}),s&&c&&(this.pushAccessUnit(c,e),this.VideoSample=null)}parseAVCNALu(e,t){const r=t.byteLength;let s=e.naluState||0;const o=s,a=[];let c=0,d,h,g,p=-1,v=0;for(s===-1&&(p=0,v=t[0]&31,s=0,c=1);c<r;){if(d=t[c++],!s){s=d?0:1;continue}if(s===1){s=d?0:2;continue}if(!d)s=3;else if(d===1){if(h=c-s-1,p>=0){const T={data:t.subarray(p,h),type:v};a.push(T)}else{const T=this.getLastNalUnit(e.samples);T&&(o&&c<=4-o&&T.state&&(T.data=T.data.subarray(0,T.data.byteLength-o)),h>0&&(T.data=Ft(T.data,t.subarray(0,h)),T.state=0))}c<r?(g=t[c]&31,p=c,v=g,s=0):s=-1}else s=0}if(p>=0&&s>=0){const T={data:t.subarray(p,r),type:v,state:s};a.push(T)}if(a.length===0){const T=this.getLastNalUnit(e.samples);T&&(T.data=Ft(T.data,t))}return e.naluState=s,a}}class sv{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new du(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(e,t,r){const s=e[t].unit;if(s.length<=16)return;const o=s.subarray(16,s.length-s.length%16),a=o.buffer.slice(o.byteOffset,o.byteOffset+o.length);this.decryptBuffer(a).then(c=>{const d=new Uint8Array(c);s.set(d,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)})}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length){r();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,r=new Int8Array(t);let s=0;for(let o=32;o<e.length-16;o+=160,s+=16)r.set(e.subarray(o,o+16),s);return r}getAvcDecryptedUnit(e,t){const r=new Uint8Array(t);let s=0;for(let o=32;o<e.length-16;o+=160,s+=16)e.set(r.subarray(s,s+16),o);return e}decryptAvcSample(e,t,r,s,o){const a=Vh(o.data),c=this.getAvcEncryptedData(a);this.decryptBuffer(c.buffer).then(d=>{o.data=this.getAvcDecryptedUnit(a,d),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,s)})}decryptAvcSamples(e,t,r,s){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length){s();return}const o=e[t].units;for(;!(r>=o.length);r++){const a=o[r];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,r,s,a),!this.decrypter.isSync()))return}}}}const Ze=188;class Mn{constructor(e,t,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.videoParser=new iv}static probe(e){const t=Mn.syncOffset(e);return t>0&&F.warn(`MPEG2-TS detected but first sync word found @ offset ${t}`),t!==-1}static syncOffset(e){const t=e.length;let r=Math.min(Ze*5,t-Ze)+1,s=0;for(;s<r;){let o=!1,a=-1,c=0;for(let d=s;d<t;d+=Ze)if(e[d]===71&&(t-d===Ze||e[d+Ze]===71)){if(c++,a===-1&&(a=d,a!==0&&(r=Math.min(a+Ze*99,e.length-Ze)+1)),o||(o=Xl(e,d)===0),o&&c>1&&(a===0&&c>2||d+Ze>r))return a}else{if(c)return-1;break}s++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:Nh[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,r,s){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Mn.createTrack("video"),this._audioTrack=Mn.createTrack("audio",s),this._id3Track=Mn.createTrack("id3"),this._txtTrack=Mn.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r,this._duration=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,r=!1,s=!1){r||(this.sampleAes=null);let o;const a=this._videoTrack,c=this._audioTrack,d=this._id3Track,h=this._txtTrack;let g=a.pid,p=a.pesData,v=c.pid,T=d.pid,E=c.pesData,S=d.pesData,A=null,R=this.pmtParsed,k=this._pmtId,D=e.length;if(this.remainderData&&(e=Ft(this.remainderData,e),D=e.length,this.remainderData=null),D<Ze&&!s)return this.remainderData=e,{audioTrack:c,videoTrack:a,id3Track:d,textTrack:h};const N=Math.max(0,Mn.syncOffset(e));D-=(D-N)%Ze,D<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,D,e.buffer.byteLength-D));let P=0;for(let U=N;U<D;U+=Ze)if(e[U]===71){const j=!!(e[U+1]&64),ee=Xl(e,U),H=(e[U+3]&48)>>4;let Q;if(H>1){if(Q=U+5+e[U+4],Q===U+Ze)continue}else Q=U+4;switch(ee){case g:j&&(p&&(o=_r(p))&&this.videoParser.parseAVCPES(a,h,o,!1,this._duration),p={data:[],size:0}),p&&(p.data.push(e.subarray(Q,U+Ze)),p.size+=U+Ze-Q);break;case v:if(j){if(E&&(o=_r(E)))switch(c.segmentCodec){case"aac":this.parseAACPES(c,o);break;case"mp3":this.parseMPEGPES(c,o);break;case"ac3":this.parseAC3PES(c,o);break}E={data:[],size:0}}E&&(E.data.push(e.subarray(Q,U+Ze)),E.size+=U+Ze-Q);break;case T:j&&(S&&(o=_r(S))&&this.parseID3PES(d,o),S={data:[],size:0}),S&&(S.data.push(e.subarray(Q,U+Ze)),S.size+=U+Ze-Q);break;case 0:j&&(Q+=e[Q]+1),k=this._pmtId=ov(e,Q);break;case k:{j&&(Q+=e[Q]+1);const ge=av(e,Q,this.typeSupported,r,this.observer);g=ge.videoPid,g>0&&(a.pid=g,a.segmentCodec=ge.segmentVideoCodec),v=ge.audioPid,v>0&&(c.pid=v,c.segmentCodec=ge.segmentAudioCodec),T=ge.id3Pid,T>0&&(d.pid=T),A!==null&&!R&&(F.warn(`MPEG-TS PMT found at ${U} after unknown PID '${A}'. Backtracking to sync byte @${N} to parse all TS packets.`),A=null,U=N-188),R=this.pmtParsed=!0;break}case 17:case 8191:break;default:A=ee;break}}else P++;P>0&&To(this.observer,new Error(`Found ${P} TS packet/s that do not start with 0x47`)),a.pesData=p,c.pesData=E,d.pesData=S;const V={audioTrack:c,videoTrack:a,id3Track:d,textTrack:h};return s&&this.extractRemainingSamples(V),V}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:r,id3Track:s,textTrack:o}=e,a=r.pesData,c=t.pesData,d=s.pesData;let h;if(a&&(h=_r(a))?(this.videoParser.parseAVCPES(r,o,h,!0,this._duration),r.pesData=null):r.pesData=a,c&&(h=_r(c))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,h);break;case"mp3":this.parseMPEGPES(t,h);break;case"ac3":this.parseAC3PES(t,h);break}t.pesData=null}else c!=null&&c.size&&F.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=c;d&&(h=_r(d))?(this.parseID3PES(s,h),s.pesData=null):s.pesData=d}demuxSampleAes(e,t,r){const s=this.demux(e,r,!0,!this.config.progressive),o=this.sampleAes=new sv(this.observer,this.config,t);return this.decrypt(s,o)}decrypt(e,t){return new Promise(r=>{const{audioTrack:s,videoTrack:o}=e;s.samples&&s.segmentCodec==="aac"?t.decryptAacSamples(s.samples,0,()=>{o.samples?t.decryptAvcSamples(o.samples,0,0,()=>{r(e)}):r(e)}):o.samples&&t.decryptAvcSamples(o.samples,0,0,()=>{r(e)})})}destroy(){this._duration=0}parseAACPES(e,t){let r=0;const s=this.aacOverFlow;let o=t.data;if(s){this.aacOverFlow=null;const p=s.missing,v=s.sample.unit.byteLength;if(p===-1)o=Ft(s.sample.unit,o);else{const T=v-p;s.sample.unit.set(o.subarray(0,p),T),e.samples.push(s.sample),r=s.missing}}let a,c;for(a=r,c=o.length;a<c-1&&!Eo(o,a);a++);if(a!==r){let p;const v=a<c-1;if(v?p=`AAC PES did not start with ADTS header,offset:${a}`:p="No ADTS header found in AAC PES",To(this.observer,new Error(p),v),!v)return}i0(e,this.observer,o,a,this.audioCodec);let d;if(t.pts!==void 0)d=t.pts;else if(s){const p=s0(e.samplerate);d=s.sample.pts+p}else{F.warn("[tsdemuxer]: AAC PES unknown PTS");return}let h=0,g;for(;a<c;)if(g=o0(e,o,a,d,h),a+=g.length,g.missing){this.aacOverFlow=g;break}else for(h++;a<c-1&&!Eo(o,a);a++);}parseMPEGPES(e,t){const r=t.data,s=r.length;let o=0,a=0;const c=t.pts;if(c===void 0){F.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<s;)if(u0(r,a)){const d=a0(e,r,a,c,o);if(d)a+=d.length,o++;else break}else a++}parseAC3PES(e,t){{const r=t.data,s=t.pts;if(s===void 0){F.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const o=r.length;let a=0,c=0,d;for(;c<o&&(d=f0(e,r,c,s,a++))>0;)c+=d}}parseID3PES(e,t){if(t.pts===void 0){F.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const r=We({},t,{type:this._videoTrack?Vt.emsg:Vt.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function Xl(l,e){return((l[e+1]&31)<<8)+l[e+2]}function ov(l,e){return(l[e+10]&31)<<8|l[e+11]}function av(l,e,t,r,s){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},a=(l[e+1]&15)<<8|l[e+2],c=e+3+a-4,d=(l[e+10]&15)<<8|l[e+11];for(e+=12+d;e<c;){const h=Xl(l,e),g=(l[e+3]&15)<<8|l[e+4];switch(l[e]){case 207:if(!r){_l("ADTS AAC");break}case 15:o.audioPid===-1&&(o.audioPid=h);break;case 21:o.id3Pid===-1&&(o.id3Pid=h);break;case 219:if(!r){_l("H.264");break}case 27:o.videoPid===-1&&(o.videoPid=h,o.segmentVideoCodec="avc");break;case 3:case 4:!t.mpeg&&!t.mp3?F.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=h,o.segmentAudioCodec="mp3");break;case 193:if(!r){_l("AC-3");break}case 129:t.ac3?o.audioPid===-1&&(o.audioPid=h,o.segmentAudioCodec="ac3"):F.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&g>0){let p=e+5,v=g;for(;v>2;){switch(l[p]){case 106:t.ac3!==!0?F.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=h,o.segmentAudioCodec="ac3");break}const E=l[p+1]+2;p+=E,v-=E}}break;case 194:case 135:return To(s,new Error("Unsupported EC-3 in M2TS found")),o;case 36:return To(s,new Error("Unsupported HEVC in M2TS found")),o}e+=g+5}return o}function To(l,e,t){F.warn(`parsing error: ${e.message}`),l.emit(x.ERROR,x.ERROR,{type:Se.MEDIA_ERROR,details:G.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function _l(l){F.log(`${l} with AES-128-CBC encryption found in unencrypted stream`)}function _r(l){let e=0,t,r,s,o,a;const c=l.data;if(!l||l.size===0)return null;for(;c[0].length<19&&c.length>1;)c[0]=Ft(c[0],c[1]),c.splice(1,1);if(t=c[0],(t[0]<<16)+(t[1]<<8)+t[2]===1){if(r=(t[4]<<8)+t[5],r&&r>l.size-6)return null;const h=t[7];h&192&&(o=(t[9]&14)*536870912+(t[10]&255)*4194304+(t[11]&254)*16384+(t[12]&255)*128+(t[13]&254)/2,h&64?(a=(t[14]&14)*536870912+(t[15]&255)*4194304+(t[16]&254)*16384+(t[17]&255)*128+(t[18]&254)/2,o-a>60*9e4&&(F.warn(`${Math.round((o-a)/9e4)}s delta between PTS and DTS, align them`),o=a)):a=o),s=t[8];let g=s+9;if(l.size<=g)return null;l.size-=g;const p=new Uint8Array(l.size);for(let v=0,T=c.length;v<T;v++){t=c[v];let E=t.byteLength;if(g)if(g>E){g-=E;continue}else t=t.subarray(g),E-=g,g=0;p.set(t,e),e+=E}return r&&(r-=s+3),{data:p,pts:o,dts:a,len:r}}return null}class lv extends hu{resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Di(e,0);let r=(t==null?void 0:t.length)||0;if(t&&e[r]===11&&e[r+1]===119&&au(t)!==void 0&&d0(e,r)<=16)return!1;for(let s=e.length;r<s;r++)if(c0(e,r))return F.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return Jy(e,t)}appendFrame(e,t,r){if(this.basePTS!==null)return a0(e,t,r,this.basePTS,this.frameIndex)}}class ah{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const bn=Math.pow(2,32)-1;class b{static init(){b.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in b.types)b.types.hasOwnProperty(e)&&(b.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);b.HDLR_TYPES={video:t,audio:r};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o=new Uint8Array([0,0,0,0,0,0,0,0]);b.STTS=b.STSC=b.STCO=o,b.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),b.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),b.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),b.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),c=new Uint8Array([97,118,99,49]),d=new Uint8Array([0,0,0,1]);b.FTYP=b.box(b.types.ftyp,a,d,a,c),b.DINF=b.box(b.types.dinf,b.box(b.types.dref,s))}static box(e,...t){let r=8,s=t.length;const o=s;for(;s--;)r+=t[s].byteLength;const a=new Uint8Array(r);for(a[0]=r>>24&255,a[1]=r>>16&255,a[2]=r>>8&255,a[3]=r&255,a.set(e,4),s=0,r=8;s<o;s++)a.set(t[s],r),r+=t[s].byteLength;return a}static hdlr(e){return b.box(b.types.hdlr,b.HDLR_TYPES[e])}static mdat(e){return b.box(b.types.mdat,e)}static mdhd(e,t){t*=e;const r=Math.floor(t/(bn+1)),s=Math.floor(t%(bn+1));return b.box(b.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(e){return b.box(b.types.mdia,b.mdhd(e.timescale,e.duration),b.hdlr(e.type),b.minf(e))}static mfhd(e){return b.box(b.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?b.box(b.types.minf,b.box(b.types.smhd,b.SMHD),b.DINF,b.stbl(e)):b.box(b.types.minf,b.box(b.types.vmhd,b.VMHD),b.DINF,b.stbl(e))}static moof(e,t,r){return b.box(b.types.moof,b.mfhd(e),b.traf(r,t))}static moov(e){let t=e.length;const r=[];for(;t--;)r[t]=b.trak(e[t]);return b.box.apply(null,[b.types.moov,b.mvhd(e[0].timescale,e[0].duration)].concat(r).concat(b.mvex(e)))}static mvex(e){let t=e.length;const r=[];for(;t--;)r[t]=b.trex(e[t]);return b.box.apply(null,[b.types.mvex,...r])}static mvhd(e,t){t*=e;const r=Math.floor(t/(bn+1)),s=Math.floor(t%(bn+1)),o=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return b.box(b.types.mvhd,o)}static sdtp(e){const t=e.samples||[],r=new Uint8Array(4+t.length);let s,o;for(s=0;s<t.length;s++)o=t[s].flags,r[s+4]=o.dependsOn<<4|o.isDependedOn<<2|o.hasRedundancy;return b.box(b.types.sdtp,r)}static stbl(e){return b.box(b.types.stbl,b.stsd(e),b.box(b.types.stts,b.STTS),b.box(b.types.stsc,b.STSC),b.box(b.types.stsz,b.STSZ),b.box(b.types.stco,b.STCO))}static avc1(e){let t=[],r=[],s,o,a;for(s=0;s<e.sps.length;s++)o=e.sps[s],a=o.byteLength,t.push(a>>>8&255),t.push(a&255),t=t.concat(Array.prototype.slice.call(o));for(s=0;s<e.pps.length;s++)o=e.pps[s],a=o.byteLength,r.push(a>>>8&255),r.push(a&255),r=r.concat(Array.prototype.slice.call(o));const c=b.box(b.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(r))),d=e.width,h=e.height,g=e.pixelRatio[0],p=e.pixelRatio[1];return b.box(b.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d>>8&255,d&255,h>>8&255,h&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,b.box(b.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),b.box(b.types.pasp,new Uint8Array([g>>24,g>>16&255,g>>8&255,g&255,p>>24,p>>16&255,p>>8&255,p&255])))}static esds(e){const t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}static audioStsd(e){const t=e.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return b.box(b.types.mp4a,b.audioStsd(e),b.box(b.types.esds,b.esds(e)))}static mp3(e){return b.box(b.types[".mp3"],b.audioStsd(e))}static ac3(e){return b.box(b.types["ac-3"],b.audioStsd(e),b.box(b.types.dac3,e.config))}static stsd(e){return e.type==="audio"?e.segmentCodec==="mp3"&&e.codec==="mp3"?b.box(b.types.stsd,b.STSD,b.mp3(e)):e.segmentCodec==="ac3"?b.box(b.types.stsd,b.STSD,b.ac3(e)):b.box(b.types.stsd,b.STSD,b.mp4a(e)):b.box(b.types.stsd,b.STSD,b.avc1(e))}static tkhd(e){const t=e.id,r=e.duration*e.timescale,s=e.width,o=e.height,a=Math.floor(r/(bn+1)),c=Math.floor(r%(bn+1));return b.box(b.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,c>>24,c>>16&255,c>>8&255,c&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,o>>8&255,o&255,0,0]))}static traf(e,t){const r=b.sdtp(e),s=e.id,o=Math.floor(t/(bn+1)),a=Math.floor(t%(bn+1));return b.box(b.types.traf,b.box(b.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),b.box(b.types.tfdt,new Uint8Array([1,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,a>>24,a>>16&255,a>>8&255,a&255])),b.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,b.box(b.types.trak,b.tkhd(e),b.mdia(e))}static trex(e){const t=e.id;return b.box(b.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const r=e.samples||[],s=r.length,o=12+16*s,a=new Uint8Array(o);let c,d,h,g,p,v;for(t+=8+o,a.set([e.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),c=0;c<s;c++)d=r[c],h=d.duration,g=d.size,p=d.flags,v=d.cts,a.set([h>>>24&255,h>>>16&255,h>>>8&255,h&255,g>>>24&255,g>>>16&255,g>>>8&255,g&255,p.isLeading<<2|p.dependsOn,p.isDependedOn<<6|p.hasRedundancy<<4|p.paddingValue<<1|p.isNonSync,p.degradPrio&61440,p.degradPrio&15,v>>>24&255,v>>>16&255,v>>>8&255,v&255],12+16*c);return b.box(b.types.trun,a)}static initSegment(e){b.types||b.init();const t=b.moov(e);return Ft(b.FTYP,t)}}b.types=void 0;b.HDLR_TYPES=void 0;b.STTS=void 0;b.STSC=void 0;b.STCO=void 0;b.STSZ=void 0;b.VMHD=void 0;b.SMHD=void 0;b.STSD=void 0;b.FTYP=void 0;b.DINF=void 0;const h0=9e4;function pu(l,e,t=1,r=!1){const s=l*e*t;return r?Math.round(s):s}function uv(l,e,t=1,r=!1){return pu(l,e,1/t,r)}function Ii(l,e=!1){return pu(l,1e3,1/h0,e)}function cv(l,e=1){return pu(l,h0,1/e)}const dv=10*1e3,lh=1024,fv=1152,hv=1536;let Pr=null,Pl=null;class ro{constructor(e,t,r,s=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,Pr===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Pr=a?parseInt(a[1]):0}if(Pl===null){const o=navigator.userAgent.match(/Safari\/(\d+)/i);Pl=o?parseInt(o[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){F.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){F.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){F.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const r=e.reduce((s,o)=>{const a=o.pts-s;return a<-4294967296?(t=!0,Pt(s,o.pts)):a>0?s:o.pts},e[0].pts);return t&&F.debug("PTS rollover detected"),r}remux(e,t,r,s,o,a,c,d){let h,g,p,v,T,E,S=o,A=o;const R=e.pid>-1,k=t.pid>-1,D=t.samples.length,N=e.samples.length>0,P=c&&D>0||D>1;if((!R||N)&&(!k||P)||this.ISGenerated||c){if(this.ISGenerated){var U,j,ee,H;const de=this.videoTrackConfig;de&&(t.width!==de.width||t.height!==de.height||((U=t.pixelRatio)==null?void 0:U[0])!==((j=de.pixelRatio)==null?void 0:j[0])||((ee=t.pixelRatio)==null?void 0:ee[1])!==((H=de.pixelRatio)==null?void 0:H[1]))&&this.resetInitSegment()}else p=this.generateIS(e,t,o,a);const Q=this.isVideoContiguous;let ge=-1,te;if(P&&(ge=gv(t.samples),!Q&&this.config.forceKeyFrameOnDiscontinuity))if(E=!0,ge>0){F.warn(`[mp4-remuxer]: Dropped ${ge} out of ${D} video samples due to a missing keyframe`);const de=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(ge),t.dropped+=ge,A+=(t.samples[0].pts-de)/t.inputTimeScale,te=A}else ge===-1&&(F.warn(`[mp4-remuxer]: No keyframe found out of ${D} video samples`),E=!1);if(this.ISGenerated){if(N&&P){const de=this.getVideoStartPts(t.samples),oe=(Pt(e.samples[0].pts,de)-de)/t.inputTimeScale;S+=Math.max(0,oe),A+=Math.max(0,-oe)}if(N){if(e.samplerate||(F.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),p=this.generateIS(e,t,o,a)),g=this.remuxAudio(e,S,this.isAudioContiguous,a,k||P||d===ve.AUDIO?A:void 0),P){const de=g?g.endPTS-g.startPTS:0;t.inputTimeScale||(F.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),p=this.generateIS(e,t,o,a)),h=this.remuxVideo(t,A,Q,de)}}else P&&(h=this.remuxVideo(t,A,Q,0));h&&(h.firstKeyFrame=ge,h.independent=ge!==-1,h.firstKeyFramePTS=te)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(T=g0(r,o,this._initPTS,this._initDTS)),s.samples.length&&(v=m0(s,o,this._initPTS))),{audio:g,video:h,initSegment:p,independent:E,text:v,id3:T}}generateIS(e,t,r,s){const o=e.samples,a=t.samples,c=this.typeSupported,d={},h=this._initPTS;let g=!h||s,p="audio/mp4",v,T,E;if(g&&(v=T=1/0),e.config&&o.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":c.mpeg?(p="audio/mpeg",e.codec=""):c.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}d.audio={id:"audio",container:p,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&c.mpeg?new Uint8Array(0):b.initSegment([e]),metadata:{channelCount:e.channelCount}},g&&(E=e.inputTimeScale,!h||E!==h.timescale?v=T=o[0].pts-Math.round(E*r):g=!1)}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,d.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:b.initSegment([t]),metadata:{width:t.width,height:t.height}},g)if(E=t.inputTimeScale,!h||E!==h.timescale){const S=this.getVideoStartPts(a),A=Math.round(E*r);T=Math.min(T,Pt(a[0].dts,S)-A),v=Math.min(v,S-A)}else g=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(d).length)return this.ISGenerated=!0,g?(this._initPTS={baseTime:v,timescale:E},this._initDTS={baseTime:T,timescale:E}):v=E=void 0,{tracks:d,initPTS:v,timescale:E}}remuxVideo(e,t,r,s){const o=e.inputTimeScale,a=e.samples,c=[],d=a.length,h=this._initPTS;let g=this.nextAvcDts,p=8,v=this.videoSampleDuration,T,E,S=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY,R=!1;if(!r||g===null){const z=t*o,K=a[0].pts-Pt(a[0].dts,a[0].pts);Pr&&g!==null&&Math.abs(z-K-g)<15e3?r=!0:g=z-K}const k=h.baseTime*o/h.timescale;for(let z=0;z<d;z++){const K=a[z];K.pts=Pt(K.pts-k,g),K.dts=Pt(K.dts-k,g),K.dts<a[z>0?z-1:z].dts&&(R=!0)}R&&a.sort(function(z,K){const w=z.dts-K.dts,$=z.pts-K.pts;return w||$}),T=a[0].dts,E=a[a.length-1].dts;const D=E-T,N=D?Math.round(D/(d-1)):v||e.inputTimeScale/30;if(r){const z=T-g,K=z>N,w=z<-1;if((K||w)&&(K?F.warn(`AVC: ${Ii(z,!0)} ms (${z}dts) hole between fragments detected at ${t.toFixed(3)}`):F.warn(`AVC: ${Ii(-z,!0)} ms (${z}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!w||g>=a[0].pts||Pr)){T=g;const $=a[0].pts-z;if(K)a[0].dts=T,a[0].pts=$;else for(let re=0;re<a.length&&!(a[re].dts>$);re++)a[re].dts-=z,a[re].pts-=z;F.log(`Video: Initial PTS/DTS adjusted: ${Ii($,!0)}/${Ii(T,!0)}, delta: ${Ii(z,!0)} ms`)}}T=Math.max(0,T);let P=0,V=0,U=T;for(let z=0;z<d;z++){const K=a[z],w=K.units,$=w.length;let re=0;for(let ce=0;ce<$;ce++)re+=w[ce].data.length;V+=re,P+=$,K.length=re,K.dts<U?(K.dts=U,U+=N/4|0||1):U=K.dts,S=Math.min(K.pts,S),A=Math.max(K.pts,A)}E=a[d-1].dts;const j=V+4*P+8;let ee;try{ee=new Uint8Array(j)}catch(z){this.observer.emit(x.ERROR,x.ERROR,{type:Se.MUX_ERROR,details:G.REMUX_ALLOC_ERROR,fatal:!1,error:z,bytes:j,reason:`fail allocating video mdat ${j}`});return}const H=new DataView(ee.buffer);H.setUint32(0,j),ee.set(b.types.mdat,4);let Q=!1,ge=Number.POSITIVE_INFINITY,te=Number.POSITIVE_INFINITY,de=Number.NEGATIVE_INFINITY,fe=Number.NEGATIVE_INFINITY;for(let z=0;z<d;z++){const K=a[z],w=K.units;let $=0;for(let Ee=0,Te=w.length;Ee<Te;Ee++){const Ae=w[Ee],Ie=Ae.data,Pe=Ae.data.byteLength;H.setUint32(p,Pe),p+=4,ee.set(Ie,p),p+=Pe,$+=4+Pe}let re;if(z<d-1)v=a[z+1].dts-K.dts,re=a[z+1].pts-K.pts;else{const Ee=this.config,Te=z>0?K.dts-a[z-1].dts:N;if(re=z>0?K.pts-a[z-1].pts:N,Ee.stretchShortVideoTrack&&this.nextAudioPts!==null){const Ae=Math.floor(Ee.maxBufferHole*o),Ie=(s?S+s*o:this.nextAudioPts)-K.pts;Ie>Ae?(v=Ie-Te,v<0?v=Te:Q=!0,F.log(`[mp4-remuxer]: It is approximately ${Ie/90} ms to the next segment; using duration ${v/90} ms for the last video frame.`)):v=Te}else v=Te}const ce=Math.round(K.pts-K.dts);ge=Math.min(ge,v),de=Math.max(de,v),te=Math.min(te,re),fe=Math.max(fe,re),c.push(new uh(K.key,v,$,ce))}if(c.length){if(Pr){if(Pr<70){const z=c[0].flags;z.dependsOn=2,z.isNonSync=0}}else if(Pl&&fe-te<de-ge&&N/de<.025&&c[0].cts===0){F.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let z=T;for(let K=0,w=c.length;K<w;K++){const $=z+c[K].duration,re=z+c[K].cts;if(K<w-1){const ce=$+c[K+1].cts;c[K].duration=ce-re}else c[K].duration=K?c[K-1].duration:N;c[K].cts=0,z=$}}}v=Q||!v?N:v,this.nextAvcDts=g=E+v,this.videoSampleDuration=v,this.isVideoContiguous=!0;const q={data1:b.moof(e.sequenceNumber++,T,We({},e,{samples:c})),data2:ee,startPTS:S/o,endPTS:(A+v)/o,startDTS:T/o,endDTS:g/o,type:"video",hasAudio:!1,hasVideo:!0,nb:c.length,dropped:e.dropped};return e.samples=[],e.dropped=0,q}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return fv;case"ac3":return hv;default:return lh}}remuxAudio(e,t,r,s,o){const a=e.inputTimeScale,c=e.samplerate?e.samplerate:a,d=a/c,h=this.getSamplesPerFrame(e),g=h*d,p=this._initPTS,v=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,T=[],E=o!==void 0;let S=e.samples,A=v?0:8,R=this.nextAudioPts||-1;const k=t*a,D=p.baseTime*a/p.timescale;if(this.isAudioContiguous=r=r||S.length&&R>0&&(s&&Math.abs(k-R)<9e3||Math.abs(Pt(S[0].pts-D,k)-R)<20*g),S.forEach(function(oe){oe.pts=Pt(oe.pts-D,k)}),!r||R<0){if(S=S.filter(oe=>oe.pts>=0),!S.length)return;o===0?R=0:s&&!E?R=Math.max(0,k):R=S[0].pts}if(e.segmentCodec==="aac"){const oe=this.config.maxAudioFramesDrift;for(let he=0,q=R;he<S.length;he++){const z=S[he],K=z.pts,w=K-q,$=Math.abs(1e3*w/a);if(w<=-oe*g&&E)he===0&&(F.warn(`Audio frame @ ${(K/a).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*w/a)} ms.`),this.nextAudioPts=R=q=K);else if(w>=oe*g&&$<dv&&E){let re=Math.round(w/g);q=K-re*g,q<0&&(re--,q+=g),he===0&&(this.nextAudioPts=R=q),F.warn(`[mp4-remuxer]: Injecting ${re} audio frame @ ${(q/a).toFixed(3)}s due to ${Math.round(1e3*w/a)} ms gap.`);for(let ce=0;ce<re;ce++){const Ee=Math.max(q,0);let Te=ah.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);Te||(F.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),Te=z.unit.subarray()),S.splice(he,0,{unit:Te,pts:Ee}),q+=g,he++}}z.pts=q,q+=g}}let N=null,P=null,V,U=0,j=S.length;for(;j--;)U+=S[j].unit.byteLength;for(let oe=0,he=S.length;oe<he;oe++){const q=S[oe],z=q.unit;let K=q.pts;if(P!==null){const $=T[oe-1];$.duration=Math.round((K-P)/d)}else if(r&&e.segmentCodec==="aac"&&(K=R),N=K,U>0){U+=A;try{V=new Uint8Array(U)}catch($){this.observer.emit(x.ERROR,x.ERROR,{type:Se.MUX_ERROR,details:G.REMUX_ALLOC_ERROR,fatal:!1,error:$,bytes:U,reason:`fail allocating audio mdat ${U}`});return}v||(new DataView(V.buffer).setUint32(0,U),V.set(b.types.mdat,4))}else return;V.set(z,A);const w=z.byteLength;A+=w,T.push(new uh(!0,h,w,0)),P=K}const ee=T.length;if(!ee)return;const H=T[T.length-1];this.nextAudioPts=R=P+d*H.duration;const Q=v?new Uint8Array(0):b.moof(e.sequenceNumber++,N/d,We({},e,{samples:T}));e.samples=[];const ge=N/a,te=R/a,fe={data1:Q,data2:V,startPTS:ge,endPTS:te,startDTS:ge,endDTS:te,type:"audio",hasAudio:!0,hasVideo:!1,nb:ee};return this.isAudioContiguous=!0,fe}remuxEmptyAudio(e,t,r,s){const o=e.inputTimeScale,a=e.samplerate?e.samplerate:o,c=o/a,d=this.nextAudioPts,h=this._initDTS,g=h.baseTime*9e4/h.timescale,p=(d!==null?d:s.startDTS*o)+g,v=s.endDTS*o+g,T=c*lh,E=Math.ceil((v-p)/T),S=ah.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(F.warn("[mp4-remuxer]: remux empty Audio"),!S){F.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}const A=[];for(let R=0;R<E;R++){const k=p+R*T;A.push({unit:S,pts:k,dts:k})}return e.samples=A,this.remuxAudio(e,t,r,!1)}}function Pt(l,e){let t;if(e===null)return l;for(e<l?t=-8589934592:t=8589934592;Math.abs(l-e)>4294967296;)l+=t;return l}function gv(l){for(let e=0;e<l.length;e++)if(l[e].key)return e;return-1}function g0(l,e,t,r){const s=l.samples.length;if(!s)return;const o=l.inputTimeScale;for(let c=0;c<s;c++){const d=l.samples[c];d.pts=Pt(d.pts-t.baseTime*o/t.timescale,e*o)/o,d.dts=Pt(d.dts-r.baseTime*o/r.timescale,e*o)/o}const a=l.samples;return l.samples=[],{samples:a}}function m0(l,e,t){const r=l.samples.length;if(!r)return;const s=l.inputTimeScale;for(let a=0;a<r;a++){const c=l.samples[a];c.pts=Pt(c.pts-t.baseTime*s/t.timescale,e*s)/s}l.samples.sort((a,c)=>a.pts-c.pts);const o=l.samples;return l.samples=[],{samples:o}}class uh{constructor(e,t,r,s){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=r,this.cts=s,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}}}class mv{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,r,s){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(Sp(e,s)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:r}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const s=this.initData=$h(e);s.audio&&(t=ch(s.audio,_e.AUDIO)),s.video&&(r=ch(s.video,_e.VIDEO));const o={};s.audio&&s.video?o.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:e,id:"main"}:s.audio?o.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:s.video?o.video={container:"video/mp4",codec:r,initSegment:e,id:"main"}:F.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=o}remux(e,t,r,s,o,a){var c,d;let{initPTS:h,lastEndTime:g}=this;const p={audio:void 0,video:void 0,text:s,id3:r,initSegment:void 0};se(g)||(g=this.lastEndTime=o||0);const v=t.samples;if(!(v!=null&&v.length))return p;const T={initPTS:void 0,timescale:1};let E=this.initData;if((c=E)!=null&&c.length||(this.generateInitSegment(v),E=this.initData),!((d=E)!=null&&d.length))return F.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),p;this.emitInitSegment&&(T.tracks=this.initTracks,this.emitInitSegment=!1);const S=Lp(v,E),A=xp(E,v),R=A===null?o:A;(pv(h,R,o,S)||T.timescale!==h.timescale&&a)&&(T.initPTS=R-o,h&&h.timescale===1&&F.warn(`Adjusting initPTS by ${T.initPTS-h.baseTime}`),this.initPTS=h={baseTime:T.initPTS,timescale:1});const k=e?R-h.baseTime/h.timescale:g,D=k+S;Rp(E,v,h.baseTime/h.timescale),S>0?this.lastEndTime=D:(F.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const N=!!E.audio,P=!!E.video;let V="";N&&(V+="audio"),P&&(V+="video");const U={data1:v,startPTS:k,startDTS:k,endPTS:D,endDTS:D,type:V,hasAudio:N,hasVideo:P,nb:1,dropped:0};return p.audio=U.type==="audio"?U:void 0,p.video=U.type!=="audio"?U:void 0,p.initSegment=T,p.id3=g0(r,o,h,h),s.samples.length&&(p.text=m0(s,o,h)),p}}function pv(l,e,t,r){if(l===null)return!0;const s=Math.max(r,1),o=e-l.baseTime/l.timescale;return Math.abs(o-t)>s}function ch(l,e){const t=l==null?void 0:l.codec;if(t&&t.length>4)return t;if(e===_e.AUDIO){if(t==="ec-3"||t==="ac-3"||t==="alac")return t;if(t==="fLaC"||t==="Opus")return ho(t,!1);const r="mp4a.40.5";return F.info(`Parsed audio codec "${t}" or audio object type not handled. Using "${r}"`),r}return F.warn(`Unhandled video codec "${t}"`),t==="hvc1"||t==="hev1"?"hvc1.1.6.L120.90":t==="av01"?"av01.0.04M.08":"avc1.42e01e"}let gn;try{gn=self.performance.now.bind(self.performance)}catch{F.debug("Unable to use Performance API on this environment"),gn=Mr==null?void 0:Mr.Date.now}const io=[{demux:tv,remux:mv},{demux:Mn,remux:ro},{demux:Zy,remux:ro},{demux:lv,remux:ro}];io.splice(2,0,{demux:nv,remux:ro});class dh{constructor(e,t,r,s,o){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.vendor=s,this.id=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,s){const o=r.transmuxing;o.executeStart=gn();let a=new Uint8Array(e);const{currentTransmuxState:c,transmuxConfig:d}=this;s&&(this.currentTransmuxState=s);const{contiguous:h,discontinuity:g,trackSwitch:p,accurateTimeOffset:v,timeOffset:T,initSegmentChange:E}=s||c,{audioCodec:S,videoCodec:A,defaultInitPts:R,duration:k,initSegmentData:D}=d,N=yv(a,t);if(N&&N.method==="AES-128"){const j=this.getDecrypter();if(j.isSync()){let ee=j.softwareDecrypt(a,N.key.buffer,N.iv.buffer);if(r.part>-1&&(ee=j.flush()),!ee)return o.executeEnd=gn(),Fl(r);a=new Uint8Array(ee)}else return this.decryptionPromise=j.webCryptoDecrypt(a,N.key.buffer,N.iv.buffer).then(ee=>{const H=this.push(ee,null,r);return this.decryptionPromise=null,H}),this.decryptionPromise}const P=this.needsProbing(g,p);if(P){const j=this.configureTransmuxer(a);if(j)return F.warn(`[transmuxer] ${j.message}`),this.observer.emit(x.ERROR,x.ERROR,{type:Se.MEDIA_ERROR,details:G.FRAG_PARSING_ERROR,fatal:!1,error:j,reason:j.message}),o.executeEnd=gn(),Fl(r)}(g||p||E||P)&&this.resetInitSegment(D,S,A,k,t),(g||E||P)&&this.resetInitialTimestamp(R),h||this.resetContiguity();const V=this.transmux(a,N,T,v,r),U=this.currentTransmuxState;return U.contiguous=!0,U.discontinuity=!1,U.trackSwitch=!1,o.executeEnd=gn(),V}flush(e){const t=e.transmuxing;t.executeStart=gn();const{decrypter:r,currentTransmuxState:s,decryptionPromise:o}=this;if(o)return o.then(()=>this.flush(e));const a=[],{timeOffset:c}=s;if(r){const p=r.flush();p&&a.push(this.push(p,null,e))}const{demuxer:d,remuxer:h}=this;if(!d||!h)return t.executeEnd=gn(),[Fl(e)];const g=d.flush(c);return so(g)?g.then(p=>(this.flushRemux(a,p,e),a)):(this.flushRemux(a,g,e),a)}flushRemux(e,t,r){const{audioTrack:s,videoTrack:o,id3Track:a,textTrack:c}=t,{accurateTimeOffset:d,timeOffset:h}=this.currentTransmuxState;F.log(`[transmuxer.ts]: Flushed fragment ${r.sn}${r.part>-1?" p: "+r.part:""} of level ${r.level}`);const g=this.remuxer.remux(s,o,a,c,h,d,!0,this.id);e.push({remuxResult:g,chunkMeta:r}),r.transmuxing.executeEnd=gn()}resetInitialTimestamp(e){const{demuxer:t,remuxer:r}=this;!t||!r||(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,s,o){const{demuxer:a,remuxer:c}=this;!a||!c||(a.resetInitSegment(e,t,r,s),c.resetInitSegment(e,t,r,o))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,s,o){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,r,s,o):a=this.transmuxUnencrypted(e,r,s,o),a}transmuxUnencrypted(e,t,r,s){const{audioTrack:o,videoTrack:a,id3Track:c,textTrack:d}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(o,a,c,d,t,r,!1,this.id),chunkMeta:s}}transmuxSampleAes(e,t,r,s,o){return this.demuxer.demuxSampleAes(e,t,r).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,r,s,!1,this.id),chunkMeta:o}))}configureTransmuxer(e){const{config:t,observer:r,typeSupported:s,vendor:o}=this;let a;for(let v=0,T=io.length;v<T;v++){var c;if((c=io[v].demux)!=null&&c.probe(e)){a=io[v];break}}if(!a)return new Error("Failed to find demuxer by probing fragment data");const d=this.demuxer,h=this.remuxer,g=a.remux,p=a.demux;(!h||!(h instanceof g))&&(this.remuxer=new g(r,t,s,o)),(!d||!(d instanceof p))&&(this.demuxer=new p(r,t,s),this.probe=p.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new du(this.config)),e}}function yv(l,e){let t=null;return l.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Fl=l=>({remuxResult:{},chunkMeta:l});function so(l){return"then"in l&&l.then instanceof Function}class vv{constructor(e,t,r,s,o){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=s,this.defaultInitPts=o||null}}class Ev{constructor(e,t,r,s,o,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=s,this.timeOffset=o,this.initSegmentChange=a}}var p0={exports:{}};(function(l){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function s(d,h,g){this.fn=d,this.context=h,this.once=g||!1}function o(d,h,g,p,v){if(typeof g!="function")throw new TypeError("The listener must be a function");var T=new s(g,p||d,v),E=t?t+h:h;return d._events[E]?d._events[E].fn?d._events[E]=[d._events[E],T]:d._events[E].push(T):(d._events[E]=T,d._eventsCount++),d}function a(d,h){--d._eventsCount===0?d._events=new r:delete d._events[h]}function c(){this._events=new r,this._eventsCount=0}c.prototype.eventNames=function(){var h=[],g,p;if(this._eventsCount===0)return h;for(p in g=this._events)e.call(g,p)&&h.push(t?p.slice(1):p);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(g)):h},c.prototype.listeners=function(h){var g=t?t+h:h,p=this._events[g];if(!p)return[];if(p.fn)return[p.fn];for(var v=0,T=p.length,E=new Array(T);v<T;v++)E[v]=p[v].fn;return E},c.prototype.listenerCount=function(h){var g=t?t+h:h,p=this._events[g];return p?p.fn?1:p.length:0},c.prototype.emit=function(h,g,p,v,T,E){var S=t?t+h:h;if(!this._events[S])return!1;var A=this._events[S],R=arguments.length,k,D;if(A.fn){switch(A.once&&this.removeListener(h,A.fn,void 0,!0),R){case 1:return A.fn.call(A.context),!0;case 2:return A.fn.call(A.context,g),!0;case 3:return A.fn.call(A.context,g,p),!0;case 4:return A.fn.call(A.context,g,p,v),!0;case 5:return A.fn.call(A.context,g,p,v,T),!0;case 6:return A.fn.call(A.context,g,p,v,T,E),!0}for(D=1,k=new Array(R-1);D<R;D++)k[D-1]=arguments[D];A.fn.apply(A.context,k)}else{var N=A.length,P;for(D=0;D<N;D++)switch(A[D].once&&this.removeListener(h,A[D].fn,void 0,!0),R){case 1:A[D].fn.call(A[D].context);break;case 2:A[D].fn.call(A[D].context,g);break;case 3:A[D].fn.call(A[D].context,g,p);break;case 4:A[D].fn.call(A[D].context,g,p,v);break;default:if(!k)for(P=1,k=new Array(R-1);P<R;P++)k[P-1]=arguments[P];A[D].fn.apply(A[D].context,k)}}return!0},c.prototype.on=function(h,g,p){return o(this,h,g,p,!1)},c.prototype.once=function(h,g,p){return o(this,h,g,p,!0)},c.prototype.removeListener=function(h,g,p,v){var T=t?t+h:h;if(!this._events[T])return this;if(!g)return a(this,T),this;var E=this._events[T];if(E.fn)E.fn===g&&(!v||E.once)&&(!p||E.context===p)&&a(this,T);else{for(var S=0,A=[],R=E.length;S<R;S++)(E[S].fn!==g||v&&!E[S].once||p&&E[S].context!==p)&&A.push(E[S]);A.length?this._events[T]=A.length===1?A[0]:A:a(this,T)}return this},c.prototype.removeAllListeners=function(h){var g;return h?(g=t?t+h:h,this._events[g]&&a(this,g)):(this._events=new r,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=t,c.EventEmitter=c,l.exports=c})(p0);var Tv=p0.exports,yu=Vm(Tv);class y0{constructor(e,t,r,s){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const o=e.config;this.hls=e,this.id=t,this.useWorker=!!o.enableWorker,this.onTransmuxComplete=r,this.onFlush=s;const a=(h,g)=>{g=g||{},g.frag=this.frag,g.id=this.id,h===x.ERROR&&(this.error=g.error),this.hls.trigger(h,g)};this.observer=new yu,this.observer.on(x.FRAG_DECRYPTED,a),this.observer.on(x.ERROR,a);const c=nr(o.preferManagedMediaSource)||{isTypeSupported:()=>!1},d={mpeg:c.isTypeSupported("audio/mpeg"),mp3:c.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:c.isTypeSupported('audio/mp4; codecs="ac-3"')};if(this.useWorker&&typeof Worker<"u"&&(o.workerPath||By())){try{o.workerPath?(F.log(`loading Web Worker ${o.workerPath} for "${t}"`),this.workerContext=Gy(o.workerPath)):(F.log(`injecting Web Worker for "${t}"`),this.workerContext=$y()),this.onwmsg=p=>this.onWorkerMessage(p);const{worker:g}=this.workerContext;g.addEventListener("message",this.onwmsg),g.onerror=p=>{const v=new Error(`${p.message}  (${p.filename}:${p.lineno})`);o.enableWorker=!1,F.warn(`Error in "${t}" Web Worker, fallback to inline`),this.hls.trigger(x.ERROR,{type:Se.OTHER_ERROR,details:G.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:v})},g.postMessage({cmd:"init",typeSupported:d,vendor:"",id:t,config:JSON.stringify(o)})}catch(g){F.warn(`Error setting up "${t}" Web Worker, fallback to inline`,g),this.resetWorker(),this.error=null,this.transmuxer=new dh(this.observer,d,o,"",t)}return}this.transmuxer=new dh(this.observer,d,o,"",t)}resetWorker(){if(this.workerContext){const{worker:e,objectURL:t}=this.workerContext;t&&self.URL.revokeObjectURL(t),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(e,t,r,s,o,a,c,d,h,g){var p,v;h.transmuxing.start=self.performance.now();const{transmuxer:T}=this,E=a?a.start:o.start,S=o.decryptdata,A=this.frag,R=!(A&&o.cc===A.cc),k=!(A&&h.level===A.level),D=A?h.sn-A.sn:-1,N=this.part?h.part-this.part.index:-1,P=D===0&&h.id>1&&h.id===(A==null?void 0:A.stats.chunkCount),V=!k&&(D===1||D===0&&(N===1||P&&N<=0)),U=self.performance.now();(k||D||o.stats.parsing.start===0)&&(o.stats.parsing.start=U),a&&(N||!V)&&(a.stats.parsing.start=U);const j=!(A&&((p=o.initSegment)==null?void 0:p.url)===((v=A.initSegment)==null?void 0:v.url)),ee=new Ev(R,V,d,k,E,j);if(!V||R||j){F.log(`[transmuxer-interface, ${o.type}]: Starting new transmux session for sn: ${h.sn} p: ${h.part} level: ${h.level} id: ${h.id}
        discontinuity: ${R}
        trackSwitch: ${k}
        contiguous: ${V}
        accurateTimeOffset: ${d}
        timeOffset: ${E}
        initSegmentChange: ${j}`);const H=new vv(r,s,t,c,g);this.configureTransmuxer(H)}if(this.frag=o,this.part=a,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:S,chunkMeta:h,state:ee},e instanceof ArrayBuffer?[e]:[]);else if(T){const H=T.push(e,S,h,ee);so(H)?(T.async=!0,H.then(Q=>{this.handleTransmuxComplete(Q)}).catch(Q=>{this.transmuxerError(Q,h,"transmuxer-interface push error")})):(T.async=!1,this.handleTransmuxComplete(H))}}flush(e){e.transmuxing.start=self.performance.now();const{transmuxer:t}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(t){let r=t.flush(e);so(r)||t.async?(so(r)||(r=Promise.resolve(r)),r.then(o=>{this.handleFlushResult(o,e)}).catch(o=>{this.transmuxerError(o,e,"transmuxer-interface flush error")})):this.handleFlushResult(r,e)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(x.ERROR,{type:Se.MEDIA_ERROR,details:G.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach(r=>{this.handleTransmuxComplete(r)}),this.onFlush(t)}onWorkerMessage(e){const t=e.data;if(!(t!=null&&t.event)){F.warn(`worker message received with no ${t?"event name":"data"}`);return}const r=this.hls;if(this.hls)switch(t.event){case"init":{var s;const o=(s=this.workerContext)==null?void 0:s.objectURL;o&&self.URL.revokeObjectURL(o);break}case"transmuxComplete":{this.handleTransmuxComplete(t.data);break}case"flush":{this.onFlush(t.data);break}case"workerLog":F[t.data.logType]&&F[t.data.logType](t.data.message);break;default:{t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data);break}}}configureTransmuxer(e){const{transmuxer:t}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}function v0(l,e){if(l.length!==e.length)return!1;for(let t=0;t<l.length;t++)if(!Ur(l[t].attrs,e[t].attrs))return!1;return!0}function Ur(l,e,t){const r=l["STABLE-RENDITION-ID"];return r&&!t?r===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(s=>l[s]!==e[s])}function Ql(l,e){return e.label.toLowerCase()===l.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(l.lang||"").toLowerCase())}const fh=100;class Sv extends fu{constructor(e,t,r){super(e,t,r,"[audio-stream-controller]",ve.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:e}=this;e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(x.ERROR,this.onError,this),e.on(x.BUFFER_RESET,this.onBufferReset,this),e.on(x.BUFFER_CREATED,this.onBufferCreated,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(x.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(x.ERROR,this.onError,this),e.off(x.BUFFER_RESET,this.onBufferReset,this),e.off(x.BUFFER_CREATED,this.onBufferCreated,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(x.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(e,{frag:t,id:r,initPTS:s,timescale:o}){if(r==="main"){const a=t.cc;this.initPTS[t.cc]={baseTime:s,timescale:o},this.log(`InitPTS for cc: ${a} found from main: ${s}`),this.videoTrackCC=a,this.state===W.WAITING_INIT_PTS&&this.tick()}}startLoad(e){if(!this.levels){this.startPosition=e,this.state=W.STOPPED;return}const t=this.lastCurrentTime;this.stopLoad(),this.setInterval(fh),t>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t,this.state=W.IDLE):(this.loadedmetadata=!1,this.state=W.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}doTick(){switch(this.state){case W.IDLE:this.doTickIdle();break;case W.WAITING_TRACK:{var e;const{levels:r,trackId:s}=this,o=r==null||(e=r[s])==null?void 0:e.details;if(o){if(this.waitForCdnTuneIn(o))break;this.state=W.WAITING_INIT_PTS}break}case W.FRAG_LOADING_WAITING_RETRY:{var t;const r=performance.now(),s=this.retryDate;if(!s||r>=s||(t=this.media)!=null&&t.seeking){const{levels:o,trackId:a}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((o==null?void 0:o[a])||null),this.state=W.IDLE}break}case W.WAITING_INIT_PTS:{const r=this.waitingData;if(r){const{frag:s,part:o,cache:a,complete:c}=r;if(this.initPTS[s.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=W.FRAG_LOADING;const d=a.flush(),h={frag:s,part:o,payload:d,networkDetails:null};this._handleFragmentLoadProgress(h),c&&super._handleFragmentLoadComplete(h)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${s.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const d=this.getLoadPosition(),h=Oe.bufferInfo(this.mediaBuffer,d,this.config.maxBufferHole);ql(h.end,this.config.maxFragLookUpTolerance,s)<0&&(this.log(`Waiting fragment cc (${s.cc}) @ ${s.start} cancelled because another fragment at ${h.end} is needed`),this.clearWaitingFragment())}}else this.state=W.IDLE}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=W.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){const{hls:e,levels:t,media:r,trackId:s}=this,o=e.config;if(!r&&(this.startFragRequested||!o.startFragPrefetch)||!(t!=null&&t[s]))return;const a=t[s],c=a.details;if(!c||c.live&&this.levelLastLoaded!==a||this.waitForCdnTuneIn(c)){this.state=W.WAITING_TRACK;return}const d=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&d&&(this.bufferFlushed=!1,this.afterBufferFlushed(d,_e.AUDIO,ve.AUDIO));const h=this.getFwdBufferInfo(d,ve.AUDIO);if(h===null)return;const{bufferedTrack:g,switchingTrack:p}=this;if(!p&&this._streamEnded(h,c)){e.trigger(x.BUFFER_EOS,{type:"audio"}),this.state=W.ENDED;return}const v=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,ve.MAIN),T=h.len,E=this.getMaxBufferLength(v==null?void 0:v.len),S=c.fragments,A=S[0].start;let R=this.flushing?this.getLoadPosition():h.end;if(p&&r){const P=this.getLoadPosition();g&&!Ur(p.attrs,g.attrs)&&(R=P),c.PTSKnown&&P<A&&(h.end>A||h.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=A+.05)}if(T>=E&&!p&&R<S[S.length-1].start)return;let k=this.getNextFragment(R,c),D=!1;if(k&&this.isLoopLoading(k,R)&&(D=!!k.gap,k=this.getNextFragmentLoopLoading(k,c,h,ve.MAIN,E)),!k){this.bufferFlushed=!0;return}const N=v&&k.start>v.end+c.targetduration;if(N||!(v!=null&&v.len)&&h.len){const P=this.getAppendedFrag(k.start,ve.MAIN);if(P===null||(D||(D=!!P.gap||!!N&&v.len===0),N&&!D||D&&h.nextStart&&h.nextStart<P.end))return}this.loadFragment(k,a,R)}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}onMediaDetaching(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,super.onMediaDetaching()}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(r=>new Nr(r))}onAudioTrackSwitching(e,t){const r=!!t.url;this.trackId=t.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),r?this.setInterval(fh):this.resetTransmuxer(),r?(this.switchingTrack=t,this.state=W.IDLE,this.flushAudioIfNeeded(t)):(this.switchingTrack=null,this.bufferedTrack=t,this.state=W.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(e,t){this.mainDetails=t.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(x.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(e,t){var r;if(this.mainDetails==null){this.cachedTrackLoadedData=t;return}const{levels:s}=this,{details:o,id:a}=t;if(!s){this.warn(`Audio tracks were reset while loading level ${a}`);return}this.log(`Audio track ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`);const c=s[a];let d=0;if(o.live||(r=c.details)!=null&&r.live){this.checkLiveUpdate(o);const g=this.mainDetails;if(o.deltaUpdateFailed||!g)return;if(!c.details&&o.hasProgramDateTime&&g.hasProgramDateTime)vo(o,g),d=o.fragments[0].start;else{var h;d=this.alignPlaylists(o,c.details,(h=this.levelLastLoaded)==null?void 0:h.details)}}c.details=o,this.levelLastLoaded=c,!this.startFragRequested&&(this.mainDetails||!o.live)&&this.setStartPosition(this.mainDetails||o,d),this.state===W.WAITING_TRACK&&!this.waitForCdnTuneIn(o)&&(this.state=W.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:r,part:s,payload:o}=e,{config:a,trackId:c,levels:d}=this;if(!d){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const h=d[c];if(!h){this.warn("Audio track is undefined on fragment load progress");return}const g=h.details;if(!g){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(r.start);return}const p=a.defaultAudioCodec||h.audioCodec||"mp4a.40.2";let v=this.transmuxer;v||(v=this.transmuxer=new y0(this.hls,ve.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const T=this.initPTS[r.cc],E=(t=r.initSegment)==null?void 0:t.data;if(T!==void 0){const A=s?s.index:-1,R=A!==-1,k=new cu(r.level,r.sn,r.stats.chunkCount,o.byteLength,A,R);v.push(o,E,p,"",r,s,g.totalduration,!1,k,T)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${g.startSN} ,${g.endSN}],track ${c}`);const{cache:S}=this.waitingData=this.waitingData||{frag:r,part:s,cache:new t0,complete:!1};S.push(new Uint8Array(o)),this.waitingVideoCC=this.videoTrackCC,this.state=W.WAITING_INIT_PTS}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(e,t){const r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}onFragBuffered(e,t){const{frag:r,part:s}=t;if(r.type!==ve.AUDIO){if(!this.loadedmetadata&&r.type===ve.MAIN){const o=this.videoBuffer||this.media;o&&Oe.getBuffered(o).length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${s?" p: "+s.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(r.sn!=="initSegment"){this.fragPrevious=r;const o=this.switchingTrack;o&&(this.bufferedTrack=o,this.switchingTrack=null,this.hls.trigger(x.AUDIO_TRACK_SWITCHED,tt({},o)))}this.fragBufferedComplete(r,s)}onError(e,t){var r;if(t.fatal){this.state=W.ERROR;return}switch(t.details){case G.FRAG_GAP:case G.FRAG_PARSING_ERROR:case G.FRAG_DECRYPT_ERROR:case G.FRAG_LOAD_ERROR:case G.FRAG_LOAD_TIMEOUT:case G.KEY_LOAD_ERROR:case G.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ve.AUDIO,t);break;case G.AUDIO_TRACK_LOAD_ERROR:case G.AUDIO_TRACK_LOAD_TIMEOUT:case G.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===W.WAITING_TRACK&&((r=t.context)==null?void 0:r.type)===Ce.AUDIO_TRACK&&(this.state=W.IDLE);break;case G.BUFFER_APPEND_ERROR:case G.BUFFER_FULL_ERROR:if(!t.parent||t.parent!=="audio")return;if(t.details===G.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case G.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==_e.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==_e.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===W.ENDED&&(this.state=W.IDLE);const r=this.mediaBuffer||this.media;r&&(this.afterBufferFlushed(r,t,ve.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const r="audio",{hls:s}=this,{remuxResult:o,chunkMeta:a}=e,c=this.getCurrentContext(a);if(!c){this.resetWhenMissingContext(a);return}const{frag:d,part:h,level:g}=c,{details:p}=g,{audio:v,text:T,id3:E,initSegment:S}=o;if(this.fragContextChanged(d)||!p){this.fragmentTracker.removeFragment(d);return}if(this.state=W.PARSING,this.switchingTrack&&v&&this.completeAudioSwitch(this.switchingTrack),S!=null&&S.tracks){const A=d.initSegment||d;this._bufferInitSegment(g,S.tracks,A,a),s.trigger(x.FRAG_PARSING_INIT_SEGMENT,{frag:A,id:r,tracks:S.tracks})}if(v){const{startPTS:A,endPTS:R,startDTS:k,endDTS:D}=v;h&&(h.elementaryStreams[_e.AUDIO]={startPTS:A,endPTS:R,startDTS:k,endDTS:D}),d.setElementaryStreamInfo(_e.AUDIO,A,R,k,D),this.bufferFragmentData(v,d,h,a)}if(E!=null&&(t=E.samples)!=null&&t.length){const A=We({id:r,frag:d,details:p},E);s.trigger(x.FRAG_PARSING_METADATA,A)}if(T){const A=We({id:r,frag:d,details:p},T);s.trigger(x.FRAG_PARSING_USERDATA,A)}}_bufferInitSegment(e,t,r,s){if(this.state!==W.PARSING)return;t.video&&delete t.video;const o=t.audio;if(!o)return;o.id="audio";const a=e.audioCodec;this.log(`Init audio buffer, container:${o.container}, codecs[level/parsed]=[${a}/${o.codec}]`),a&&a.split(",").length===1&&(o.levelCodec=a),this.hls.trigger(x.BUFFER_CODECS,t);const c=o.initSegment;if(c!=null&&c.byteLength){const d={type:"audio",frag:r,part:null,chunkMeta:s,parent:r.type,data:c};this.hls.trigger(x.BUFFER_APPENDING,d)}this.tickImmediate()}loadFragment(e,t,r){const s=this.fragmentTracker.getState(e);if(this.fragCurrent=e,this.switchingTrack||s===et.NOT_LOADED||s===et.PARTIAL){var o;if(e.sn==="initSegment")this._loadInitSegment(e,t);else if((o=t.details)!=null&&o.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=W.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragments[0].start!==t.details.fragments[0].start&&vo(t.details,a)}else this.startFragRequested=!0,super.loadFragment(e,t,r)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){const{media:t,bufferedTrack:r}=this,s=r==null?void 0:r.attrs,o=e.attrs;t&&s&&(s.CHANNELS!==o.CHANNELS||r.name!==e.name||r.lang!==e.lang)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(x.AUDIO_TRACK_SWITCHED,tt({},e))}}class xv extends uu{constructor(e){super(e,"[audio-track-controller]"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.LEVEL_LOADING,this.onLevelLoading,this),e.on(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.LEVEL_LOADING,this.onLevelLoading,this),e.off(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(x.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:r,groupId:s,details:o}=t,a=this.tracksInGroup[r];if(!a||a.groupId!==s){this.warn(`Audio track with id:${r} and group:${s} not found in active group ${a==null?void 0:a.groupId}`);return}const c=a.details;a.details=t.details,this.log(`Audio track ${r} "${a.name}" lang:${a.lang} group:${s} loaded [${o.startSN}-${o.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.audioGroups||null,s=this.groupIds;let o=this.currentTrack;if(!r||(s==null?void 0:s.length)!==(r==null?void 0:r.length)||r!=null&&r.some(c=>(s==null?void 0:s.indexOf(c))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const c=this.tracks.filter(v=>!r||r.indexOf(v.groupId)!==-1);if(c.length)this.selectDefaultTrack&&!c.some(v=>v.default)&&(this.selectDefaultTrack=!1),c.forEach((v,T)=>{v.id=T});else if(!o&&!this.tracksInGroup.length)return;this.tracksInGroup=c;const d=this.hls.config.audioPreference;if(!o&&d){const v=Zt(d,c,Dr);if(v>-1)o=c[v];else{const T=Zt(d,this.tracks);o=this.tracks[T]}}let h=this.findTrackId(o);h===-1&&o&&(h=this.findTrackId(null));const g={audioTracks:c};this.log(`Updating audio tracks, ${c.length} track(s) found in group(s): ${r==null?void 0:r.join(",")}`),this.hls.trigger(x.AUDIO_TRACKS_UPDATED,g);const p=this.trackId;if(h!==-1&&p===-1)this.setAudioTrack(h);else if(c.length&&p===-1){var a;const v=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${c.length}`);this.warn(v.message),this.hls.trigger(x.ERROR,{type:Se.MEDIA_ERROR,details:G.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:v})}}else this.shouldReloadPlaylist(o)&&this.setAudioTrack(this.trackId)}onError(e,t){t.fatal||!t.context||t.context.type===Ce.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&(this.requestScheduled=-1,this.checkRetry(t))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){const s=this.currentTrack;if(s&&Or(e,s,Dr))return s;const o=Zt(e,this.tracksInGroup,Dr);if(o>-1){const a=this.tracksInGroup[o];return this.setAudioTrack(o),a}else if(s){let a=t.loadLevel;a===-1&&(a=t.firstAutoLevel);const c=xy(e,t.levels,r,a,Dr);if(c===-1)return null;t.nextLoadLevel=c}if(e.channels||e.audioCodec){const a=Zt(e,r);if(a>-1)return r[a]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const r=this.currentTrack,s=t[e],o=s.details&&!s.details.live;if(e===this.trackId&&s===r&&o||(this.log(`Switching to audio-track ${e} "${s.name}" lang:${s.lang} group:${s.groupId} channels:${s.channels}`),this.trackId=e,this.currentTrack=s,this.hls.trigger(x.AUDIO_TRACK_SWITCHING,tt({},s)),o))return;const a=this.switchParams(s.url,r==null?void 0:r.details,s.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const s=t[r];if(!(this.selectDefaultTrack&&!s.default)&&(!e||Or(e,s,Dr)))return r}if(e){const{name:r,lang:s,assocLang:o,characteristics:a,audioCodec:c,channels:d}=e;for(let h=0;h<t.length;h++){const g=t[h];if(Or({name:r,lang:s,assocLang:o,characteristics:a,audioCodec:c,channels:d},g,Dr))return h}for(let h=0;h<t.length;h++){const g=t[h];if(Ur(e.attrs,g.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return h}for(let h=0;h<t.length;h++){const g=t[h];if(Ur(e.attrs,g.attrs,["LANGUAGE"]))return h}}return-1}loadPlaylist(e){const t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){super.loadPlaylist();const r=t.id,s=t.groupId;let o=t.url;if(e)try{o=e.addDirectives(o)}catch(a){this.warn(`Could not construct new URL with HLS Delivery Directives: ${a}`)}this.log(`loading audio-track playlist ${r} "${t.name}" lang:${t.lang} group:${s}`),this.clearTimer(),this.hls.trigger(x.AUDIO_TRACK_LOADING,{url:o,id:r,groupId:s,deliveryDirectives:e||null})}}}const hh=500;class Lv extends fu{constructor(e,t,r){super(e,t,r,"[subtitle-stream-controller]",ve.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}_registerListeners(){const{hls:e}=this;e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.ERROR,this.onError,this),e.on(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(x.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.ERROR,this.onError,this),e.off(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(x.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(e){this.stopLoad(),this.state=W.IDLE,this.setInterval(hh),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:r,success:s}=t;if(this.fragPrevious=r,this.state=W.IDLE,!s)return;const o=this.tracksBuffered[this.currentTrackId];if(!o)return;let a;const c=r.start;for(let h=0;h<o.length;h++)if(c>=o[h].start&&c<=o[h].end){a=o[h];break}const d=r.start+r.duration;a?a.end=d:(a={start:c,end:d},o.push(a)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null)}onBufferFlushing(e,t){const{startOffset:r,endOffset:s}=t;if(r===0&&s!==Number.POSITIVE_INFINITY){const o=s-1;if(o<=0)return;t.endOffsetSubtitles=Math.max(0,o),this.tracksBuffered.forEach(a=>{for(let c=0;c<a.length;){if(a[c].end<=o){a.shift();continue}else if(a[c].start<o)a[c].start=o;else break;c++}}),this.fragmentTracker.removeFragmentsInRange(r,o,ve.SUBTITLE)}}onFragBuffered(e,t){if(!this.loadedmetadata&&t.frag.type===ve.MAIN){var r;(r=this.media)!=null&&r.buffered.length&&(this.loadedmetadata=!0)}}onError(e,t){const r=t.frag;(r==null?void 0:r.type)===ve.SUBTITLE&&(t.details===G.FRAG_GAP&&this.fragmentTracker.fragBuffered(r,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==W.STOPPED&&(this.state=W.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&v0(this.levels,t)){this.levels=t.map(r=>new Nr(r));return}this.tracksBuffered=[],this.levels=t.map(r=>{const s=new Nr(r);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,ve.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var r;if(this.currentTrackId=t.id,!((r=this.levels)!=null&&r.length)||this.currentTrackId===-1){this.clearInterval();return}const s=this.levels[this.currentTrackId];s!=null&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.setInterval(hh)}onSubtitleTrackLoaded(e,t){var r;const{currentTrackId:s,levels:o}=this,{details:a,id:c}=t;if(!o){this.warn(`Subtitle tracks were reset while loading level ${c}`);return}const d=o[c];if(c>=o.length||!d)return;this.log(`Subtitle track ${c} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let h=0;if(a.live||(r=d.details)!=null&&r.live){const p=this.mainDetails;if(a.deltaUpdateFailed||!p)return;const v=p.fragments[0];if(!d.details)a.hasProgramDateTime&&p.hasProgramDateTime?(vo(a,p),h=a.fragments[0].start):v&&(h=v.start,Yl(a,h));else{var g;h=this.alignPlaylists(a,d.details,(g=this.levelLastLoaded)==null?void 0:g.details),h===0&&v&&(h=v.start,Yl(a,h))}}d.details=a,this.levelLastLoaded=d,c===s&&(!this.startFragRequested&&(this.mainDetails||!a.live)&&this.setStartPosition(this.mainDetails||a,h),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===W.IDLE&&(yo(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),d.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:r}=e,s=t.decryptdata,o=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&s!=null&&s.key&&s.iv&&s.method==="AES-128"){const a=performance.now();this.decrypter.decrypt(new Uint8Array(r),s.key.buffer,s.iv.buffer).catch(c=>{throw o.trigger(x.ERROR,{type:Se.MEDIA_ERROR,details:G.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:t}),c}).then(c=>{const d=performance.now();o.trigger(x.FRAG_DECRYPTED,{frag:t,payload:c,stats:{tstart:a,tdecrypt:d}})}).catch(c=>{this.warn(`${c.name}: ${c.message}`),this.state=W.IDLE})}}doTick(){if(!this.media){this.state=W.IDLE;return}if(this.state===W.IDLE){const{currentTrackId:e,levels:t}=this,r=t==null?void 0:t[e];if(!r||!t.length||!r.details)return;const{config:s}=this,o=this.getLoadPosition(),a=Oe.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],o,s.maxBufferHole),{end:c,len:d}=a,h=this.getFwdBufferInfo(this.media,ve.MAIN),g=r.details,p=this.getMaxBufferLength(h==null?void 0:h.len)+g.levelTargetDuration;if(d>p)return;const v=g.fragments,T=v.length,E=g.edge;let S=null;const A=this.fragPrevious;if(c<E){const R=s.maxFragLookUpTolerance,k=c>E-R?0:R;S=yo(A,v,Math.max(v[0].start,c),k),!S&&A&&A.start<v[0].start&&(S=v[0])}else S=v[T-1];if(!S)return;if(S=this.mapToInitFragWhenRequired(S),S.sn!=="initSegment"){const R=S.sn-g.startSN,k=v[R-1];k&&k.cc===S.cc&&this.fragmentTracker.getState(k)===et.NOT_LOADED&&(S=k)}this.fragmentTracker.getState(S)===et.NOT_LOADED&&this.loadFragment(S,r,c)}}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.max(t,e):t}loadFragment(e,t,r){this.fragCurrent=e,e.sn==="initSegment"?this._loadInitSegment(e,t):(this.startFragRequested=!0,super.loadFragment(e,t,r))}get mediaBufferTimeRanges(){return new Av(this.tracksBuffered[this.currentTrackId]||[])}}class Av{constructor(e){this.buffered=void 0;const t=(r,s,o)=>{if(s=s>>>0,s>o-1)throw new DOMException(`Failed to execute '${r}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${o})`);return e[s][r]};this.buffered={get length(){return e.length},end(r){return t("end",r,e.length)},start(r){return t("start",r,e.length)}}}}class Rv extends uu{constructor(e){super(e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const r=eo(this.media.textTracks);for(let o=0;o<r.length;o++)if(r[o].mode==="hidden")t=r[o];else if(r[o].mode==="showing"){t=r[o];break}const s=this.findTrackForTextTrack(t);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.LEVEL_LOADING,this.onLevelLoading,this),e.on(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.LEVEL_LOADING,this.onLevelLoading,this),e.off(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(x.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),eo(this.media.textTracks).forEach(t=>{Fr(t)}),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:r,groupId:s,details:o}=t,a=this.tracksInGroup[r];if(!a||a.groupId!==s){this.warn(`Subtitle track with id:${r} and group:${s} not found in active group ${a==null?void 0:a.groupId}`);return}const c=a.details;a.details=t.details,this.log(`Subtitle track ${r} "${a.name}" lang:${a.lang} group:${s} loaded [${o.startSN}-${o.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.subtitleGroups||null,s=this.groupIds;let o=this.currentTrack;if(!r||(s==null?void 0:s.length)!==(r==null?void 0:r.length)||r!=null&&r.some(a=>(s==null?void 0:s.indexOf(a))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(g=>!r||r.indexOf(g.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(g=>g.default)&&(this.selectDefaultTrack=!1),a.forEach((g,p)=>{g.id=p});else if(!o&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const c=this.hls.config.subtitlePreference;if(!o&&c){this.selectDefaultTrack=!1;const g=Zt(c,a);if(g>-1)o=a[g];else{const p=Zt(c,this.tracks);o=this.tracks[p]}}let d=this.findTrackId(o);d===-1&&o&&(d=this.findTrackId(null));const h={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${r==null?void 0:r.join(",")}" group-id`),this.hls.trigger(x.SUBTITLE_TRACKS_UPDATED,h),d!==-1&&this.trackId===-1&&this.setSubtitleTrack(d)}else this.shouldReloadPlaylist(o)&&this.setSubtitleTrack(this.trackId)}findTrackId(e){const t=this.tracksInGroup,r=this.selectDefaultTrack;for(let s=0;s<t.length;s++){const o=t[s];if(!(r&&!o.default||!r&&!e)&&(!e||Or(o,e)))return s}if(e){for(let s=0;s<t.length;s++){const o=t[s];if(Ur(e.attrs,o.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const o=t[s];if(Ur(e.attrs,o.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const s=t[r];if(Ql(s,e))return r}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Ce.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const r=this.currentTrack;if(r&&Or(e,r))return r;const s=Zt(e,this.tracksInGroup);if(s>-1){const o=this.tracksInGroup[s];return this.setSubtitleTrack(s),o}else{if(r)return null;{const o=Zt(e,t);if(o>-1)return t[o]}}}}return null}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){const r=t.id,s=t.groupId;let o=t.url;if(e)try{o=e.addDirectives(o)}catch(a){this.warn(`Could not construct new URL with HLS Delivery Directives: ${a}`)}this.log(`Loading subtitle playlist for id ${r}`),this.hls.trigger(x.SUBTITLE_TRACK_LOADING,{url:o,id:r,groupId:s,deliveryDirectives:e||null})}}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=eo(e.textTracks),r=this.currentTrack;let s;if(r&&(s=t.filter(o=>Ql(r,o))[0],s||this.warn(`Unable to find subtitle TextTrack with name "${r.name}" and language "${r.lang}"`)),[].slice.call(t).forEach(o=>{o.mode!=="disabled"&&o!==s&&(o.mode="disabled")}),s){const o=this.subtitleDisplay?"showing":"hidden";s.mode!==o&&(s.mode=o)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!se(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const r=this.currentTrack,s=t[e]||null;if(this.trackId=e,this.currentTrack=s,this.toggleTrackModes(),!s){this.hls.trigger(x.SUBTITLE_TRACK_SWITCH,{id:e});return}const o=!!s.details&&!s.details.live;if(e===this.trackId&&s===r&&o)return;this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:""));const{id:a,groupId:c="",name:d,type:h,url:g}=s;this.hls.trigger(x.SUBTITLE_TRACK_SWITCH,{id:a,groupId:c,name:d,type:h,url:g});const p=this.switchParams(s.url,r==null?void 0:r.details,s.details);this.loadPlaylist(p)}}class Iv{constructor(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}append(e,t,r){const s=this.queues[t];s.push(e),s.length===1&&!r&&this.executeNext(t)}insertAbort(e,t){this.queues[t].unshift(e),this.executeNext(t)}appendBlocker(e){let t;const r=new Promise(o=>{t=o}),s={execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(s,e),r}executeNext(e){const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(s){F.warn(`[buffer-operation-queue]: Exception executing "${e}" SourceBuffer operation: ${s}`),r.onError(s);const o=this.buffers[e];o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues[e].shift(),this.executeNext(e)}current(e){return this.queues[e][0]}}const gh=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/;class Cv{constructor(e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=r=>{this.hls&&this.hls.pauseBuffering()},this._onStartStreaming=r=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=()=>{const{media:r,mediaSource:s}=this;this.log("Media source opened"),r&&(r.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(x.MEDIA_ATTACHED,{media:r,mediaSource:s})),s&&s.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:r,_objectUrl:s}=this;r!==s&&F.error(`Media element src was set while attaching MediaSource (${s} > ${r})`)},this.hls=e;const t="[buffer-controller]";this.appendSource=Mp(nr(e.config.preferManagedMediaSource)),this.log=F.log.bind(F,t),this.warn=F.warn.bind(F,t),this.error=F.error.bind(F,t),this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null}registerListeners(){const{hls:e}=this;e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.BUFFER_RESET,this.onBufferReset,this),e.on(x.BUFFER_APPENDING,this.onBufferAppending,this),e.on(x.BUFFER_CODECS,this.onBufferCodecs,this),e.on(x.BUFFER_EOS,this.onBufferEos,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(x.FRAG_PARSED,this.onFragParsed,this),e.on(x.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:e}=this;e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.BUFFER_RESET,this.onBufferReset,this),e.off(x.BUFFER_APPENDING,this.onBufferAppending,this),e.off(x.BUFFER_CODECS,this.onBufferCodecs,this),e.off(x.BUFFER_EOS,this.onBufferEos,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(x.FRAG_PARSED,this.onFragParsed,this),e.off(x.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new Iv(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,this.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(e,t){const r=this.media=t.media,s=nr(this.appendSource);if(r&&s){var o;const a=this.mediaSource=new s;this.log(`created media source: ${(o=a.constructor)==null?void 0:o.name}`),a.addEventListener("sourceopen",this._onMediaSourceOpen),a.addEventListener("sourceended",this._onMediaSourceEnded),a.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(a.addEventListener("startstreaming",this._onStartStreaming),a.addEventListener("endstreaming",this._onEndStreaming));const c=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{r.removeAttribute("src");const d=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||d&&a instanceof d,mh(r),wv(r,c),r.load()}catch{r.src=c}else r.src=c;r.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:e,mediaSource:t,_objectUrl:r}=this;if(t){if(this.log("media source detaching"),t.readyState==="open")try{t.endOfStream()}catch(s){this.warn(`onMediaDetaching: ${s.message} while calling endOfStream`)}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(t.removeEventListener("startstreaming",this._onStartStreaming),t.removeEventListener("endstreaming",this._onEndStreaming)),e&&(e.removeEventListener("emptied",this._onMediaEmptied),r&&self.URL.revokeObjectURL(r),this.mediaSrc===r?(e.removeAttribute("src"),this.appendSource&&mh(e),e.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(x.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(e=>{this.resetBuffer(e)}),this._initSourceBuffer()}resetBuffer(e){const t=this.sourceBuffer[e];try{if(t){var r;this.removeBufferListeners(e),this.sourceBuffer[e]=void 0,(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(t)}}catch(s){this.warn(`onBufferReset ${e}`,s)}}onBufferCodecs(e,t){const r=this.getSourceBufferTypes().length,s=Object.keys(t);if(s.forEach(a=>{if(r){const d=this.tracks[a];if(d&&typeof d.buffer.changeType=="function"){var c;const{id:h,codec:g,levelCodec:p,container:v,metadata:T}=t[a],E=Mf(d.codec,d.levelCodec),S=E==null?void 0:E.replace(gh,"$1");let A=Mf(g,p);const R=(c=A)==null?void 0:c.replace(gh,"$1");if(A&&S!==R){a.slice(0,5)==="audio"&&(A=ho(A,this.appendSource));const k=`${v};codecs=${A}`;this.appendChangeType(a,k),this.log(`switching codec ${E} to ${A}`),this.tracks[a]={buffer:d.buffer,codec:g,container:v,levelCodec:p,metadata:T,id:h}}}}else this.pendingTracks[a]=t[a]}),r)return;const o=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==o&&(this.log(`${o} bufferCodec event(s) expected ${s.join(",")}`),this.bufferCodecEventsExpected=o),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks()}appendChangeType(e,t){const{operationQueue:r}=this,s={execute:()=>{const o=this.sourceBuffer[e];o&&(this.log(`changing ${e} sourceBuffer type to ${t}`),o.changeType(t)),r.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};r.append(s,e,!!this.pendingTracks[e])}onBufferAppending(e,t){const{hls:r,operationQueue:s,tracks:o}=this,{data:a,type:c,frag:d,part:h,chunkMeta:g}=t,p=g.buffering[c],v=self.performance.now();p.start=v;const T=d.stats.buffering,E=h?h.stats.buffering:null;T.start===0&&(T.start=v),E&&E.start===0&&(E.start=v);const S=o.audio;let A=!1;c==="audio"&&(S==null?void 0:S.container)==="audio/mpeg"&&(A=!this.lastMpegAudioChunk||g.id===1||this.lastMpegAudioChunk.sn!==g.sn,this.lastMpegAudioChunk=g);const R=d.start,k={execute:()=>{if(p.executeStart=self.performance.now(),A){const D=this.sourceBuffer[c];if(D){const N=R-D.timestampOffset;Math.abs(N)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${R} (delta: ${N}) sn: ${d.sn})`),D.timestampOffset=R)}}this.appendExecutor(a,c)},onStart:()=>{},onComplete:()=>{const D=self.performance.now();p.executeEnd=p.end=D,T.first===0&&(T.first=D),E&&E.first===0&&(E.first=D);const{sourceBuffer:N}=this,P={};for(const V in N)P[V]=Oe.getBuffered(N[V]);this.appendErrors[c]=0,c==="audio"||c==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(x.BUFFER_APPENDED,{type:c,frag:d,part:h,chunkMeta:g,parent:d.type,timeRanges:P})},onError:D=>{const N={type:Se.MEDIA_ERROR,parent:d.type,details:G.BUFFER_APPEND_ERROR,sourceBufferName:c,frag:d,part:h,chunkMeta:g,error:D,err:D,fatal:!1};if(D.code===DOMException.QUOTA_EXCEEDED_ERR)N.details=G.BUFFER_FULL_ERROR;else{const P=++this.appendErrors[c];N.details=G.BUFFER_APPEND_ERROR,this.warn(`Failed ${P}/${r.config.appendErrorMaxRetry} times to append segment in "${c}" sourceBuffer`),P>=r.config.appendErrorMaxRetry&&(N.fatal=!0)}r.trigger(x.ERROR,N)}};s.append(k,c,!!this.pendingTracks[c])}onBufferFlushing(e,t){const{operationQueue:r}=this,s=o=>({execute:this.removeExecutor.bind(this,o,t.startOffset,t.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(x.BUFFER_FLUSHED,{type:o})},onError:a=>{this.warn(`Failed to remove from ${o} SourceBuffer`,a)}});t.type?r.append(s(t.type),t.type):this.getSourceBufferTypes().forEach(o=>{r.append(s(o),o)})}onFragParsed(e,t){const{frag:r,part:s}=t,o=[],a=s?s.elementaryStreams:r.elementaryStreams;a[_e.AUDIOVIDEO]?o.push("audiovideo"):(a[_e.AUDIO]&&o.push("audio"),a[_e.VIDEO]&&o.push("video"));const c=()=>{const d=self.performance.now();r.stats.buffering.end=d,s&&(s.stats.buffering.end=d);const h=s?s.stats:r.stats;this.hls.trigger(x.FRAG_BUFFERED,{frag:r,part:s,stats:h,id:r.type})};o.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers(c,o)}onFragChanged(e,t){this.trimBuffers()}onBufferEos(e,t){this.getSourceBufferTypes().reduce((s,o)=>{const a=this.sourceBuffer[o];return a&&(!t.type||t.type===o)&&(a.ending=!0,a.ended||(a.ended=!0,this.log(`${o} sourceBuffer now EOS`))),s&&!!(!a||a.ended)},!0)&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(o=>{const a=this.sourceBuffer[o];a&&(a.ending=!1)});const{mediaSource:s}=this;if(!s||s.readyState!=="open"){s&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${s.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),s.endOfStream()}))}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}trimBuffers(){const{hls:e,details:t,media:r}=this;if(!r||t===null||!this.getSourceBufferTypes().length)return;const o=e.config,a=r.currentTime,c=t.levelTargetDuration,d=t.live&&o.liveBackBufferLength!==null?o.liveBackBufferLength:o.backBufferLength;if(se(d)&&d>0){const h=Math.max(d,c),g=Math.floor(a/c)*c-h;this.flushBackBuffer(a,c,g)}if(se(o.frontBufferFlushThreshold)&&o.frontBufferFlushThreshold>0){const h=Math.max(o.maxBufferLength,o.frontBufferFlushThreshold),g=Math.max(h,c),p=Math.floor(a/c)*c+g;this.flushFrontBuffer(a,c,p)}}flushBackBuffer(e,t,r){const{details:s,sourceBuffer:o}=this;this.getSourceBufferTypes().forEach(c=>{const d=o[c];if(d){const h=Oe.getBuffered(d);if(h.length>0&&r>h.start(0)){if(this.hls.trigger(x.BACK_BUFFER_REACHED,{bufferEnd:r}),s!=null&&s.live)this.hls.trigger(x.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(d.ended&&h.end(h.length-1)-e<t*2){this.log(`Cannot flush ${c} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(x.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:c})}}})}flushFrontBuffer(e,t,r){const{sourceBuffer:s}=this;this.getSourceBufferTypes().forEach(a=>{const c=s[a];if(c){const d=Oe.getBuffered(c),h=d.length;if(h<2)return;const g=d.start(h-1),p=d.end(h-1);if(r>g||e>=g&&e<=p)return;if(c.ended&&e-p<2*t){this.log(`Cannot flush ${a} front buffer while SourceBuffer is in ended state`);return}this.hls.trigger(x.BUFFER_FLUSHING,{startOffset:g,endOffset:1/0,type:a})}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")return;const{details:e,hls:t,media:r,mediaSource:s}=this,o=e.fragments[0].start+e.totalduration,a=r.duration,c=se(s.duration)?s.duration:0;e.live&&t.config.liveDurationInfinity?(s.duration=1/0,this.updateSeekableRange(e)):(o>c&&o>a||!se(a))&&(this.log(`Updating Media Source duration to ${o.toFixed(3)}`),s.duration=o)}updateSeekableRange(e){const t=this.mediaSource,r=e.fragments;if(r.length&&e.live&&t!=null&&t.setLiveSeekableRange){const o=Math.max(0,r[0].start),a=Math.max(o,o+e.totalduration);this.log(`Media Source duration is set to ${t.duration}. Setting seekable range to ${o}-${a}.`),t.setLiveSeekableRange(o,a)}}checkPendingTracks(){const{bufferCodecEventsExpected:e,operationQueue:t,pendingTracks:r}=this,s=Object.keys(r).length;if(s&&(!e||s===2||"audiovideo"in r)){this.createSourceBuffers(r),this.pendingTracks={};const o=this.getSourceBufferTypes();if(o.length)this.hls.trigger(x.BUFFER_CREATED,{tracks:this.tracks}),o.forEach(a=>{t.executeNext(a)});else{const a=new Error("could not create source buffer for media codec(s)");this.hls.trigger(x.ERROR,{type:Se.MEDIA_ERROR,details:G.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:a,reason:a.message})}}}createSourceBuffers(e){const{sourceBuffer:t,mediaSource:r}=this;if(!r)throw Error("createSourceBuffers called when mediaSource was null");for(const o in e)if(!t[o]){var s;const a=e[o];if(!a)throw Error(`source buffer exists for track ${o}, however track does not`);let c=((s=a.levelCodec)==null?void 0:s.indexOf(","))===-1?a.levelCodec:a.codec;c&&o.slice(0,5)==="audio"&&(c=ho(c,this.appendSource));const d=`${a.container};codecs=${c}`;this.log(`creating sourceBuffer(${d})`);try{const h=t[o]=r.addSourceBuffer(d),g=o;this.addBufferListener(g,"updatestart",this._onSBUpdateStart),this.addBufferListener(g,"updateend",this._onSBUpdateEnd),this.addBufferListener(g,"error",this._onSBUpdateError),this.appendSource&&this.addBufferListener(g,"bufferedchange",(p,v)=>{const T=v.removedRanges;T!=null&&T.length&&this.hls.trigger(x.BUFFER_FLUSHED,{type:o})}),this.tracks[o]={buffer:h,codec:c,container:a.container,levelCodec:a.levelCodec,metadata:a.metadata,id:a.id}}catch(h){this.error(`error while trying to add sourceBuffer: ${h.message}`),this.hls.trigger(x.ERROR,{type:Se.MEDIA_ERROR,details:G.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:h,sourceBufferName:o,mimeType:d})}}}get mediaSrc(){var e,t;const r=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return r==null?void 0:r.src}_onSBUpdateStart(e){const{operationQueue:t}=this;t.current(e).onStart()}_onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const{operationQueue:r}=this;r.current(e).onComplete(),r.shiftAndExecuteNext(e)}_onSBUpdateError(e,t){var r;const s=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(r=this.mediaSource)==null?void 0:r.readyState}`);this.error(`${s}`,t),this.hls.trigger(x.ERROR,{type:Se.MEDIA_ERROR,details:G.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:s,fatal:!1});const o=this.operationQueue.current(e);o&&o.onError(s)}removeExecutor(e,t,r){const{media:s,mediaSource:o,operationQueue:a,sourceBuffer:c}=this,d=c[e];if(!s||!o||!d){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),a.shiftAndExecuteNext(e);return}const h=se(s.duration)?s.duration:1/0,g=se(o.duration)?o.duration:1/0,p=Math.max(0,t),v=Math.min(r,h,g);v>p&&(!d.ending||d.ended)?(d.ended=!1,this.log(`Removing [${p},${v}] from the ${e} SourceBuffer`),d.remove(p,v)):a.shiftAndExecuteNext(e)}appendExecutor(e,t){const r=this.sourceBuffer[t];if(!r){if(!this.pendingTracks[t])throw new Error(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);return}r.ended=!1,r.appendBuffer(e)}blockBuffers(e,t=this.getSourceBufferTypes()){if(!t.length){this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);return}const{operationQueue:r}=this,s=t.map(o=>r.appendBlocker(o));Promise.all(s).then(()=>{e(),t.forEach(o=>{const a=this.sourceBuffer[o];a!=null&&a.updating||r.shiftAndExecuteNext(o)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(e,t,r){const s=this.sourceBuffer[e];if(!s)return;const o=r.bind(this,e);this.listeners[e].push({event:t,listener:o}),s.addEventListener(t,o)}removeBufferListeners(e){const t=this.sourceBuffer[e];t&&this.listeners[e].forEach(r=>{t.removeEventListener(r.event,r.listener)})}}function mh(l){const e=l.querySelectorAll("source");[].slice.call(e).forEach(t=>{l.removeChild(t)})}function wv(l,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,l.appendChild(t)}const Dv={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},E0=l=>String.fromCharCode(Dv[l]||l),Kt=15,fn=100,kv={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},_v={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Pv={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Fv={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Ov=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class bv{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const r=typeof t=="function"?t():t;F.log(`${this.time} [${e}] ${r}`)}}}const Qn=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class T0{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){const s=t[r];e.hasOwnProperty(s)&&(this[s]=e[s])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class Mv{constructor(){this.uchar=" ",this.penState=new T0}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class Nv{constructor(e){this.chars=[],this.pos=0,this.currPenState=new T0,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<fn;t++)this.chars.push(new Mv);this.logger=e}equals(e){for(let t=0;t<fn;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<fn;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<fn;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>fn&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=fn)}moveCursor(e){const t=this.pos+e;if(e>1)for(let r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=E0(e);if(this.pos>=fn){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<fn;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let r=0;r<fn;r++){const s=this.chars[r].uchar;s!==" "&&(t=!1),e.push(s)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Ol{constructor(e){this.rows=[],this.currRow=Kt-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Kt;t++)this.rows.push(new Nv(e));this.logger=e}reset(){for(let e=0;e<Kt;e++)this.rows[e].clear();this.currRow=Kt-1}equals(e){let t=!0;for(let r=0;r<Kt;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<Kt;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Kt;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+JSON.stringify(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let c=0;c<Kt;c++)this.rows[c].clear();const o=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const c=a.rows[o].cueStartTime,d=this.logger.time;if(c!==null&&d!==null&&c<d)for(let h=0;h<this.nrRollUpRows;h++)this.rows[t-this.nrRollUpRows+h+1].copy(a.rows[o+h])}}this.currRow=t;const r=this.rows[this.currRow];if(e.indent!==null){const o=e.indent,a=Math.max(o-1,0);r.setCursor(e.indent),e.color=r.chars[a].penState.foreground}const s={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let r="",s=-1;for(let o=0;o<Kt;o++){const a=this.rows[o].getTextString();a&&(s=o+1,e?t.push("Row "+s+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?r="["+t.join(" | ")+"]":r=t.join(`
`)),r}getTextAndFormat(){return this.rows}}class ph{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Ol(r),this.nonDisplayedMemory=new Ol(r),this.lastOutputScreen=new Ol(r),this.currRollUpRow=this.displayedMemory.rows[Kt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Kt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const r=Math.floor(e/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=s[r]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class yh{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=Bv(),this.logger=void 0;const s=this.logger=new bv;this.channels=[null,new ph(e,t,s),new ph(e+1,r,s)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let r=0;r<t.length;r+=2){const s=t[r]&127,o=t[r+1]&127;let a=!1,c=null;if(s===0&&o===0)continue;this.logger.log(3,()=>"["+Qn([t[r],t[r+1]])+"] -> ("+Qn([s,o])+")");const d=this.cmdHistory;if(s>=16&&s<=31){if(Uv(s,o,d)){qs(null,null,d),this.logger.log(3,()=>"Repeated command ("+Qn([s,o])+") is dropped");continue}qs(s,o,this.cmdHistory),a=this.parseCmd(s,o),a||(a=this.parseMidrow(s,o)),a||(a=this.parsePAC(s,o)),a||(a=this.parseBackgroundAttributes(s,o))}else qs(null,null,d);if(!a&&(c=this.parseChars(s,o),c)){const g=this.currentChannel;g&&g>0?this.channels[g].insertChars(c):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!a&&!c&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Qn([s,o])+" orig: "+Qn([t[r],t[r+1]]))}}parseCmd(e,t){const r=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=33&&t<=35;if(!(r||s))return!1;const o=e===20||e===21||e===23?1:2,a=this.channels[o];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),this.currentChannel=o,!0}parseMidrow(e,t){let r=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?r=1:r=2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[r];return s?(s.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Qn([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let r;const s=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,o=(e===16||e===24)&&t>=64&&t<=95;if(!(s||o))return!1;const a=e<=23?1:2;t>=64&&t<=95?r=a===1?kv[e]:Pv[e]:r=a===1?_v[e]:Fv[e];const c=this.channels[a];return c?(c.setPAC(this.interpretPAC(r,t)),this.currentChannel=a,!0):!1}interpretPAC(e,t){let r;const s={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?r=t-96:r=t-64,s.underline=(r&1)===1,r<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((r-16)/2)*4,s}parseChars(e,t){let r,s=null,o=null;if(e>=25?(r=2,o=e-8):(r=1,o=e),o>=17&&o<=19){let a;o===17?a=t+80:o===18?a=t+112:a=t+144,this.logger.log(2,()=>"Special char '"+E0(a)+"' in channel "+r),s=[a]}else e>=32&&e<=127&&(s=t===0?[e]:[e,t]);return s&&this.logger.log(3,()=>"Char codes =  "+Qn(s).join(",")),s}parseBackgroundAttributes(e,t){const r=(e===16||e===24)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=45&&t<=47;if(!(r||s))return!1;let o;const a={};e===16||e===24?(o=Math.floor((t-32)/2),a.background=Ov[o],t%2===1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));const c=e<=23?1:2;return this.channels[c].setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}qs(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r&&r.cueSplitAtTime(e)}}}function qs(l,e,t){t.a=l,t.b=e}function Uv(l,e,t){return t.a===l&&t.b===e}function Bv(){return{a:null,b:null}}class Xs{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var vu=function(){if(Mr!=null&&Mr.VTTCue)return self.VTTCue;const l=["","lr","rl"],e=["start","middle","end","left","right"];function t(c,d){if(typeof d!="string"||!Array.isArray(c))return!1;const h=d.toLowerCase();return~c.indexOf(h)?h:!1}function r(c){return t(l,c)}function s(c){return t(e,c)}function o(c,...d){let h=1;for(;h<arguments.length;h++){const g=arguments[h];for(const p in g)c[p]=g[p]}return c}function a(c,d,h){const g=this,p={enumerable:!0};g.hasBeenReset=!1;let v="",T=!1,E=c,S=d,A=h,R=null,k="",D=!0,N="auto",P="start",V=50,U="middle",j=50,ee="middle";Object.defineProperty(g,"id",o({},p,{get:function(){return v},set:function(H){v=""+H}})),Object.defineProperty(g,"pauseOnExit",o({},p,{get:function(){return T},set:function(H){T=!!H}})),Object.defineProperty(g,"startTime",o({},p,{get:function(){return E},set:function(H){if(typeof H!="number")throw new TypeError("Start time must be set to a number.");E=H,this.hasBeenReset=!0}})),Object.defineProperty(g,"endTime",o({},p,{get:function(){return S},set:function(H){if(typeof H!="number")throw new TypeError("End time must be set to a number.");S=H,this.hasBeenReset=!0}})),Object.defineProperty(g,"text",o({},p,{get:function(){return A},set:function(H){A=""+H,this.hasBeenReset=!0}})),Object.defineProperty(g,"region",o({},p,{get:function(){return R},set:function(H){R=H,this.hasBeenReset=!0}})),Object.defineProperty(g,"vertical",o({},p,{get:function(){return k},set:function(H){const Q=r(H);if(Q===!1)throw new SyntaxError("An invalid or illegal string was specified.");k=Q,this.hasBeenReset=!0}})),Object.defineProperty(g,"snapToLines",o({},p,{get:function(){return D},set:function(H){D=!!H,this.hasBeenReset=!0}})),Object.defineProperty(g,"line",o({},p,{get:function(){return N},set:function(H){if(typeof H!="number"&&H!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");N=H,this.hasBeenReset=!0}})),Object.defineProperty(g,"lineAlign",o({},p,{get:function(){return P},set:function(H){const Q=s(H);if(!Q)throw new SyntaxError("An invalid or illegal string was specified.");P=Q,this.hasBeenReset=!0}})),Object.defineProperty(g,"position",o({},p,{get:function(){return V},set:function(H){if(H<0||H>100)throw new Error("Position must be between 0 and 100.");V=H,this.hasBeenReset=!0}})),Object.defineProperty(g,"positionAlign",o({},p,{get:function(){return U},set:function(H){const Q=s(H);if(!Q)throw new SyntaxError("An invalid or illegal string was specified.");U=Q,this.hasBeenReset=!0}})),Object.defineProperty(g,"size",o({},p,{get:function(){return j},set:function(H){if(H<0||H>100)throw new Error("Size must be between 0 and 100.");j=H,this.hasBeenReset=!0}})),Object.defineProperty(g,"align",o({},p,{get:function(){return ee},set:function(H){const Q=s(H);if(!Q)throw new SyntaxError("An invalid or illegal string was specified.");ee=Q,this.hasBeenReset=!0}})),g.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}();class $v{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function S0(l){function e(r,s,o,a){return(r|0)*3600+(s|0)*60+(o|0)+parseFloat(a||0)}const t=l.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class Gv{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let s=0;s<r.length;++s)if(t===r[s]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function x0(l,e,t,r){const s=r?l.split(r):[l];for(const o in s){if(typeof s[o]!="string")continue;const a=s[o].split(t);if(a.length!==2)continue;const c=a[0],d=a[1];e(c,d)}}const Jl=new vu(0,0,""),Qs=Jl.align==="middle"?"middle":"center";function Kv(l,e,t){const r=l;function s(){const c=S0(l);if(c===null)throw new Error("Malformed timestamp: "+r);return l=l.replace(/^[^\sa-zA-Z-]+/,""),c}function o(c,d){const h=new Gv;x0(c,function(v,T){let E;switch(v){case"region":for(let S=t.length-1;S>=0;S--)if(t[S].id===T){h.set(v,t[S].region);break}break;case"vertical":h.alt(v,T,["rl","lr"]);break;case"line":E=T.split(","),h.integer(v,E[0]),h.percent(v,E[0])&&h.set("snapToLines",!1),h.alt(v,E[0],["auto"]),E.length===2&&h.alt("lineAlign",E[1],["start",Qs,"end"]);break;case"position":E=T.split(","),h.percent(v,E[0]),E.length===2&&h.alt("positionAlign",E[1],["start",Qs,"end","line-left","line-right","auto"]);break;case"size":h.percent(v,T);break;case"align":h.alt(v,T,["start",Qs,"end","left","right"]);break}},/:/,/\s/),d.region=h.get("region",null),d.vertical=h.get("vertical","");let g=h.get("line","auto");g==="auto"&&Jl.line===-1&&(g=-1),d.line=g,d.lineAlign=h.get("lineAlign","start"),d.snapToLines=h.get("snapToLines",!0),d.size=h.get("size",100),d.align=h.get("align",Qs);let p=h.get("position","auto");p==="auto"&&Jl.position===50&&(p=d.align==="start"||d.align==="left"?0:d.align==="end"||d.align==="right"?100:50),d.position=p}function a(){l=l.replace(/^\s+/,"")}if(a(),e.startTime=s(),a(),l.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);l=l.slice(3),a(),e.endTime=s(),a(),o(l,e)}function L0(l){return l.replace(/<br(?: \/)?>/gi,`
`)}class Vv{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new $v,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function r(){let o=t.buffer,a=0;for(o=L0(o);a<o.length&&o[a]!=="\r"&&o[a]!==`
`;)++a;const c=o.slice(0,a);return o[a]==="\r"&&++a,o[a]===`
`&&++a,t.buffer=o.slice(a),c}function s(o){x0(o,function(a,c){},/:/)}try{let o="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;o=r();const c=o.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(c!=null&&c[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:o=r(),t.state){case"HEADER":/:/.test(o)?s(o):o||(t.state="ID");continue;case"NOTE":o||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(o)){t.state="NOTE";break}if(!o)continue;if(t.cue=new vu(0,0,""),t.state="CUE",o.indexOf("-->")===-1){t.cue.id=o;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{Kv(o,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const c=o.indexOf("-->")!==-1;if(!o||c&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=o}continue;case"BADCUE":o||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const Hv=/\r\n|\n\r|\n|\r/g,bl=function(e,t,r=0){return e.slice(r,r+t.length)===t},zv=function(e){let t=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),s=parseInt(e.slice(-9,-7)),o=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!se(t)||!se(r)||!se(s)||!se(o))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=60*1e3*s,t+=60*60*1e3*o,t},Ml=function(e){let t=5381,r=e.length;for(;r;)t=t*33^e.charCodeAt(--r);return(t>>>0).toString()};function Eu(l,e,t){return Ml(l.toString())+Ml(e.toString())+Ml(t)}const Wv=function(e,t,r){let s=e[t],o=e[s.prevCC];if(!o||!o.new&&s.new){e.ccOffset=e.presentationOffset=s.start,s.new=!1;return}for(;(a=o)!=null&&a.new;){var a;e.ccOffset+=s.start-o.start,s.new=!1,s=o,o=e[s.prevCC]}e.presentationOffset=r};function jv(l,e,t,r,s,o,a){const c=new Vv,d=en(new Uint8Array(l)).trim().replace(Hv,`
`).split(`
`),h=[],g=e?cv(e.baseTime,e.timescale):0;let p="00:00.000",v=0,T=0,E,S=!0;c.oncue=function(A){const R=t[r];let k=t.ccOffset;const D=(v-g)/9e4;if(R!=null&&R.new&&(T!==void 0?k=t.ccOffset=R.start:Wv(t,r,D)),D){if(!e){E=new Error("Missing initPTS for VTT MPEGTS");return}k=D-t.presentationOffset}const N=A.endTime-A.startTime,P=Pt((A.startTime+k-T)*9e4,s*9e4)/9e4;A.startTime=Math.max(P,0),A.endTime=Math.max(P+N,0);const V=A.text.trim();A.text=decodeURIComponent(encodeURIComponent(V)),A.id||(A.id=Eu(A.startTime,A.endTime,V)),A.endTime>0&&h.push(A)},c.onparsingerror=function(A){E=A},c.onflush=function(){if(E){a(E);return}o(h)},d.forEach(A=>{if(S)if(bl(A,"X-TIMESTAMP-MAP=")){S=!1,A.slice(16).split(",").forEach(R=>{bl(R,"LOCAL:")?p=R.slice(6):bl(R,"MPEGTS:")&&(v=parseInt(R.slice(7)))});try{T=zv(p)/1e3}catch(R){E=R}return}else A===""&&(S=!1);c.parse(A+`
`)}),c.flush()}const Nl="stpp.ttml.im1t",A0=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,R0=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Yv={left:"start",center:"center",right:"end",start:"start",end:"end"};function vh(l,e,t,r){const s=Le(new Uint8Array(l),["mdat"]);if(s.length===0){r(new Error("Could not parse IMSC1 mdat"));return}const o=s.map(c=>en(c)),a=uv(e.baseTime,1,e.timescale);try{o.forEach(c=>t(qv(c,a)))}catch(c){r(c)}}function qv(l,e){const s=new DOMParser().parseFromString(l,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const o={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(o).reduce((p,v)=>(p[v]=s.getAttribute(`ttp:${v}`)||o[v],p),{}),c=s.getAttribute("xml:space")!=="preserve",d=Eh(Ul(s,"styling","style")),h=Eh(Ul(s,"layout","region")),g=Ul(s,"body","[begin]");return[].map.call(g,p=>{const v=I0(p,c);if(!v||!p.hasAttribute("begin"))return null;const T=$l(p.getAttribute("begin"),a),E=$l(p.getAttribute("dur"),a);let S=$l(p.getAttribute("end"),a);if(T===null)throw Th(p);if(S===null){if(E===null)throw Th(p);S=T+E}const A=new vu(T-e,S-e,v);A.id=Eu(A.startTime,A.endTime,A.text);const R=h[p.getAttribute("region")],k=d[p.getAttribute("style")],D=Xv(R,k,d),{textAlign:N}=D;if(N){const P=Yv[N];P&&(A.lineAlign=P),A.align=N}return We(A,D),A}).filter(p=>p!==null)}function Ul(l,e,t){const r=l.getElementsByTagName(e)[0];return r?[].slice.call(r.querySelectorAll(t)):[]}function Eh(l){return l.reduce((e,t)=>{const r=t.getAttribute("xml:id");return r&&(e[r]=t),e},{})}function I0(l,e){return[].slice.call(l.childNodes).reduce((t,r,s)=>{var o;return r.nodeName==="br"&&s?t+`
`:(o=r.childNodes)!=null&&o.length?I0(r,e):e?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}function Xv(l,e,t){const r="http://www.w3.org/ns/ttml#styling";let s=null;const o=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=l!=null&&l.hasAttribute("style")?l.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(s=t[a]),o.reduce((c,d)=>{const h=Bl(e,r,d)||Bl(l,r,d)||Bl(s,r,d);return h&&(c[d]=h),c},{})}function Bl(l,e,t){return l&&l.hasAttributeNS(e,t)?l.getAttributeNS(e,t):null}function Th(l){return new Error(`Could not parse ttml timestamp ${l}`)}function $l(l,e){if(!l)return null;let t=S0(l);return t===null&&(A0.test(l)?t=Qv(l,e):R0.test(l)&&(t=Jv(l,e))),t}function Qv(l,e){const t=A0.exec(l),r=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+r/e.frameRate}function Jv(l,e){const t=R0.exec(l),r=Number(t[1]);switch(t[2]){case"h":return r*3600;case"m":return r*60;case"ms":return r*1e3;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}class Zv{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=xh(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(x.FRAG_LOADING,this.onFragLoading,this),e.on(x.FRAG_LOADED,this.onFragLoaded,this),e.on(x.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(x.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(x.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(x.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(x.FRAG_LOADING,this.onFragLoading,this),e.off(x.FRAG_LOADED,this.onFragLoaded,this),e.off(x.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(x.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(x.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(x.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){const e=new Xs(this,"textTrack1"),t=new Xs(this,"textTrack2"),r=new Xs(this,"textTrack3"),s=new Xs(this,"textTrack4");this.cea608Parser1=new yh(1,e,t),this.cea608Parser2=new yh(3,r,s)}}addCues(e,t,r,s,o){let a=!1;for(let c=o.length;c--;){const d=o[c],h=eE(d[0],d[1],t,r);if(h>=0&&(d[0]=Math.min(d[0],t),d[1]=Math.max(d[1],r),a=!0,h/(r-t)>.5))return}if(a||o.push([t,r]),this.config.renderTextTracksNatively){const c=this.captionsTracks[e];this.Cues.newCue(c,t,r,s)}else{const c=this.Cues.newCue(null,t,r,s);this.hls.trigger(x.CUES_PARSED,{type:"captions",cues:c,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:s,timescale:o}){const{unparsedVttFrags:a}=this;r==="main"&&(this.initPTS[t.cc]={baseTime:s,timescale:o}),a.length&&(this.unparsedVttFrags=[],a.forEach(c=>{this.onFragLoaded(x.FRAG_LOADED,c)}))}getExistingTrack(e,t){const{media:r}=this;if(r)for(let s=0;s<r.textTracks.length;s++){const o=r.textTracks[s];if(Sh(o,{name:e,lang:t,attrs:{}}))return o}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:r,media:s}=this,{label:o,languageCode:a}=t[e],c=this.getExistingTrack(o,a);if(c)r[e]=c,Fr(r[e]),Wh(r[e],s);else{const d=this.createTextTrack("captions",o,a);d&&(d[e]=!0,r[e]=d)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const r=t.label,s={_id:e,label:r,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(x.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,r){const s=this.media;if(s)return s.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:e}=this;Object.keys(e).forEach(t=>{Fr(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=xh(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let r=0;r<t.length;r++)Fr(t[r])}onSubtitleTracksUpdated(e,t){const r=t.subtitleTracks||[],s=r.some(o=>o.textCodec===Nl);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(v0(this.tracks,r)){this.tracks=r;return}if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const a=this.media,c=a?eo(a.textTracks):null;if(this.tracks.forEach((d,h)=>{let g;if(c){let p=null;for(let v=0;v<c.length;v++)if(c[v]&&Sh(c[v],d)){p=c[v],c[v]=null;break}p&&(g=p)}if(g)Fr(g);else{const p=C0(d);g=this.createTextTrack(p,d.name,d.lang),g&&(g.mode="disabled")}g&&this.textTracks.push(g)}),c!=null&&c.length){const d=c.filter(h=>h!==null).map(h=>h.label);d.length&&F.warn(`Media element contains unused subtitle tracks: ${d.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(c=>({label:c.name,kind:c.type.toLowerCase(),default:c.default,subtitleTrack:c}));this.hls.trigger(x.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(r=>{const s=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(!s)return;const o=`textTrack${s[1]}`,a=this.captionsProperties[o];a&&(a.label=r.name,r.lang&&(a.languageCode=r.lang),a.media=r)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===ve.MAIN){var r,s;const{cea608Parser1:o,cea608Parser2:a,lastSn:c}=this,{cc:d,sn:h}=t.frag,g=(r=(s=t.part)==null?void 0:s.index)!=null?r:-1;o&&a&&(h!==c+1||h===c&&g!==this.lastPartIndex+1||d!==this.lastCc)&&(o.reset(),a.reset()),this.lastCc=d,this.lastSn=h,this.lastPartIndex=g}}onFragLoaded(e,t){const{frag:r,payload:s}=t;if(r.type===ve.SUBTITLE)if(s.byteLength){const o=r.decryptdata,a="stats"in t;if(o==null||!o.encrypted||a){const c=this.tracks[r.level],d=this.vttCCs;d[r.cc]||(d[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),c&&c.textCodec===Nl?this._parseIMSC1(r,s):this._parseVTTs(t)}}else this.hls.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const r=this.hls;vh(t,this.initPTS[e.cc],s=>{this._appendCues(s,e.level),r.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},s=>{F.log(`Failed to parse IMSC1: ${s}`),r.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})}_parseVTTs(e){var t;const{frag:r,payload:s}=e,{initPTS:o,unparsedVttFrags:a}=this,c=o.length-1;if(!o[r.cc]&&c===-1){a.push(e);return}const d=this.hls,h=(t=r.initSegment)!=null&&t.data?Ft(r.initSegment.data,new Uint8Array(s)):s;jv(h,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,g=>{this._appendCues(g,r.level),d.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},g=>{const p=g.message==="Missing initPTS for VTT MPEGTS";p?a.push(e):this._fallbackToIMSC1(r,s),F.log(`Failed to parse VTT cue: ${g}`),!(p&&c>r.cc)&&d.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:g})})}_fallbackToIMSC1(e,t){const r=this.tracks[e.level];r.textCodec||vh(t,this.initPTS[e.cc],()=>{r.textCodec=Nl,this._parseIMSC1(e,t)},()=>{r.textCodec="wvtt"})}_appendCues(e,t){const r=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||s.mode==="disabled")return;e.forEach(o=>jh(s,o))}else{const s=this.tracks[t];if(!s)return;const o=s.default?"default":"subtitles"+t;r.trigger(x.CUES_PARSED,{type:"subtitles",cues:e,track:o})}}onFragDecrypted(e,t){const{frag:r}=t;r.type===ve.SUBTITLE&&this.onFragLoaded(x.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){this.initCea608Parsers();const{cea608Parser1:r,cea608Parser2:s}=this;if(!this.enabled||!r||!s)return;const{frag:o,samples:a}=t;if(!(o.type===ve.MAIN&&this.closedCaptionsForLevel(o)==="NONE"))for(let c=0;c<a.length;c++){const d=a[c].bytes;if(d){const h=this.extractCea608Data(d);r.addData(a[c].pts,h[0]),s.addData(a[c].pts,h[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:s,type:o}){const{media:a}=this;if(!(!a||a.currentTime<r)){if(!o||o==="video"){const{captionsTracks:c}=this;Object.keys(c).forEach(d=>zl(c[d],t,r))}if(this.config.renderTextTracksNatively&&t===0&&s!==void 0){const{textTracks:c}=this;Object.keys(c).forEach(d=>zl(c[d],t,s))}}}extractCea608Data(e){const t=[[],[]],r=e[0]&31;let s=2;for(let o=0;o<r;o++){const a=e[s++],c=127&e[s++],d=127&e[s++];if(c===0&&d===0)continue;if((4&a)!==0){const g=3&a;(g===0||g===1)&&(t[g].push(c),t[g].push(d))}}return t}}function C0(l){return l.characteristics&&/transcribes-spoken-dialog/gi.test(l.characteristics)&&/describes-music-and-sound/gi.test(l.characteristics)?"captions":"subtitles"}function Sh(l,e){return!!l&&l.kind===C0(e)&&Ql(e,l)}function eE(l,e,t,r){return Math.min(e,r)-Math.max(l,t)}function xh(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class Tu{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(x.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(x.BUFFER_CODECS,this.onBufferCodecs,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(x.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(x.BUFFER_CODECS,this.onBufferCodecs,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&se(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,r=this.getMaxLevel(e.length-1);r!==this.autoLevelCapping&&F.log(`Setting autoLevelCapping to ${r}: ${e[r].height}p@${e[r].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=r,t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const r=t.filter((s,o)=>this.isLevelAllowed(s)&&o<=e);return this.clientRect=null,Tu.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,!t.width&&!t.height&&(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return e}isLevelAllowed(e){return!this.restrictedLevels.some(r=>e.bitrate===r.bitrate&&e.width===r.width&&e.height===r.height)}static getMaxLevelByMediaSize(e,t,r){if(!(e!=null&&e.length))return-1;const s=(c,d)=>d?c.width!==d.width||c.height!==d.height:!0;let o=e.length-1;const a=Math.max(t,r);for(let c=0;c<e.length;c+=1){const d=e[c];if((d.width>=a||d.height>=a)&&s(d,e[c+1])){o=c;break}}return o}}class tE{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const r=this.hls.config;if(r.capLevelOnFPSDrop){const s=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}checkFPS(e,t,r){const s=performance.now();if(t){if(this.lastTime){const o=s-this.lastTime,a=r-this.lastDroppedFrames,c=t-this.lastDecodedFrames,d=1e3*a/o,h=this.hls;if(h.trigger(x.FPS_DROP,{currentDropped:a,currentDecoded:c,totalDroppedFrames:r}),d>0&&a>h.config.fpsDroppedMonitoringThreshold*c){let g=h.currentLevel;F.warn("drop FPS ratio greater than max allowed value for currentLevel: "+g),g>0&&(h.autoLevelCapping===-1||h.autoLevelCapping>=g)&&(g=g-1,h.trigger(x.FPS_DROP_LEVEL_CAPPING,{level:g,droppedLevel:h.currentLevel}),h.autoLevelCapping=g,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}const Js="[eme]";class br{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=br.CDMCleanupPromise?[br.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=F.debug.bind(F,Js),this.log=F.log.bind(F,Js),this.warn=F.warn.bind(F,Js),this.error=F.error.bind(F,Js),this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(x.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(x.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(x.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(x.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(x.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(x.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:r}=this.config,s=t[e];if(s)return s.licenseUrl;if(e===be.WIDEVINE&&r)return r;throw new Error(`no license server URL configured for key-system "${e}"`)}getServerCertificateUrl(e){const{drmSystems:t}=this.config,r=t[e];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,r=(a,c,d)=>!!a&&d.indexOf(a)===c,s=t.map(a=>a.audioCodec).filter(r),o=t.map(a=>a.videoCodec).filter(r);return s.length+o.length===0&&o.push("avc1.42e01e"),new Promise((a,c)=>{const d=h=>{const g=h.shift();this.getMediaKeysPromise(g,s,o).then(p=>a({keySystem:g,mediaKeys:p})).catch(p=>{h.length?d(h):p instanceof _t?c(p):c(new _t({type:Se.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_NO_ACCESS,error:p,fatal:!0},p.message))})};d(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:r}=this.config;if(typeof r!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${r}`;return Fh===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return r(e,t)}getMediaKeysPromise(e,t,r){const s=ap(e,t,r,this.config.drmSystemOptions),o=this.keySystemAccessPromises[e];let a=o==null?void 0:o.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${e}" key-system access with config: ${JSON.stringify(s)}`),a=this.requestMediaKeySystemAccess(e,s);const c=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(d=>{this.log(`Failed to obtain access to key-system "${e}": ${d}`)}),a.then(d=>{this.log(`Access for key-system "${d.keySystem}" obtained`);const h=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),c.mediaKeys=d.createMediaKeys().then(g=>(this.log(`Media-keys created for "${e}"`),h.then(p=>p?this.setMediaKeysServerCertificate(g,e,p):g))),c.mediaKeys.catch(g=>{this.error(`Failed to create media-keys for "${e}"}: ${g}`)}),c.mediaKeys})}return a.then(()=>o.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:r}){this.log(`Creating key-system session "${t}" keyId: ${Xt.hexDump(e.keyId||[])}`);const s=r.createSession(),o={decryptdata:e,keySystem:t,mediaKeys:r,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(o),o}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const r=this.createMediaKeySessionContext(e),s=this.getKeyIdString(t),o="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(r,o,t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return Xt.hexDump(e.keyId)}updateKeySession(e,t){var r;const s=e.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyID ${Xt.hexDump(((r=e.decryptdata)==null?void 0:r.keyId)||[])}
      } (data length: ${t&&t.byteLength})`),s.update(t)}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise((t,r)=>{const s=xl(this.config),o=e.map(wf).filter(a=>!!a&&s.indexOf(a)!==-1);return this.getKeySystemSelectionPromise(o).then(({keySystem:a})=>{const c=kf(a);c?t(c):r(new Error(`Unable to find format for key-system "${a}"`))}).catch(r)})}loadKey(e){const t=e.keyInfo.decryptdata,r=this.getKeyIdString(t),s=`(keyId: ${r} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${s}`);let o=this.keyIdToKeySessionPromise[r];return o||(o=this.keyIdToKeySessionPromise[r]=this.getKeySystemForKeyPromise(t).then(({keySystem:a,mediaKeys:c})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${s}`),this.attemptSetMediaKeys(a,c).then(()=>{this.throwIfDestroyed();const d=this.createMediaKeySessionContext({keySystem:a,mediaKeys:c,decryptdata:t});return this.generateRequestWithPreferredKeySession(d,"cenc",t.pssh,"playlist-key")}))),o.catch(a=>this.handleError(a))),o}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof _t?this.hls.trigger(x.ERROR,e.data):this.hls.trigger(x.ERROR,{type:Se.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),r=this.keyIdToKeySessionPromise[t];if(!r){const s=wf(e.keyFormat),o=s?[s]:xl(this.config);return this.attemptKeySystemAccess(o)}return r}getKeySystemSelectionPromise(e){if(e.length||(e=xl(this.config)),e.length===0)throw new _t({type:Se.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}_onMediaEncrypted(e){const{initDataType:t,initData:r}=e,s=`"${e.type}" event: init data type: "${t}"`;if(this.debug(s),r===null)return;let o,a;if(t==="sinf"&&this.config.drmSystems[be.FAIRPLAY]){const p=qe(new Uint8Array(r));try{const v=su(JSON.parse(p).sinf),T=Gh(new Uint8Array(v));if(!T)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");o=T.subarray(8,24),a=be.FAIRPLAY}catch(v){this.warn(`${s} Failed to parse sinf: ${v}`);return}}else{const p=Pp(r),v=p.filter(T=>T.systemId===Ci.WIDEVINE)[0];if(!v){p.length===0||p.some(T=>!T.systemId)?this.warn(`${s} contains incomplete or invalid pssh data`):this.log(`ignoring ${s} for ${p.map(T=>Df(T.systemId)).join(",")} pssh data in favor of playlist keys`);return}if(a=Df(v.systemId),v.version===0&&v.data){const T=v.data.length-22;o=v.data.subarray(T,T+16)}}if(!a||!o)return;const c=Xt.hexDump(o),{keyIdToKeySessionPromise:d,mediaKeySessions:h}=this;let g=d[c];for(let p=0;p<h.length;p++){const v=h[p],T=v.decryptdata;if(!T.keyId)continue;const E=Xt.hexDump(T.keyId);if(c===E||T.uri.replace(/-/g,"").indexOf(c)!==-1){if(g=d[E],T.pssh)break;delete d[E],T.pssh=new Uint8Array(r),T.keyId=o,g=d[c]=g.then(()=>this.generateRequestWithPreferredKeySession(v,t,r,"encrypted-event-key-match"));break}}g||(g=d[c]=this.getKeySystemSelectionPromise([a]).then(({keySystem:p,mediaKeys:v})=>{var T;this.throwIfDestroyed();const E=new ki("ISO-23001-7",c,(T=kf(p))!=null?T:"");return E.pssh=new Uint8Array(r),E.keyId=o,this.attemptSetMediaKeys(p,v).then(()=>{this.throwIfDestroyed();const S=this.createMediaKeySessionContext({decryptdata:E,keySystem:p,mediaKeys:v});return this.generateRequestWithPreferredKeySession(S,t,r,"encrypted-event-no-match")})})),g.catch(p=>this.handleError(p))}_onWaitingForKey(e){this.log(`"${e.type}" event`)}attemptSetMediaKeys(e,t){const r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const s=Promise.all(r).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${e}"`),r.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(o=>r.indexOf(o)===-1)})}generateRequestWithPreferredKeySession(e,t,r,s){var o,a;const c=(o=this.config.drmSystems)==null||(a=o[e.keySystem])==null?void 0:a.generateRequest;if(c)try{const E=c.call(this.hls,t,r,e);if(!E)throw new Error("Invalid response from configured generateRequest filter");t=E.initDataType,r=e.decryptdata.pssh=E.initData?new Uint8Array(E.initData):null}catch(E){var d;if(this.warn(E.message),(d=this.hls)!=null&&d.config.debug)throw E}if(r===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(e);const h=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${s}": ${h} (init data type: ${t} length: ${r?r.byteLength:null})`);const g=new yu,p=e._onmessage=E=>{const S=e.mediaKeysSession;if(!S){g.emit("error",new Error("invalid state"));return}const{messageType:A,message:R}=E;this.log(`"${A}" message event for session "${S.sessionId}" message size: ${R.byteLength}`),A==="license-request"||A==="license-renewal"?this.renewLicense(e,R).catch(k=>{this.handleError(k),g.emit("error",k)}):A==="license-release"?e.keySystem===be.FAIRPLAY&&(this.updateKeySession(e,Vl("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${A}"`)},v=e._onkeystatuseschange=E=>{if(!e.mediaKeysSession){g.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);const A=e.keyStatus;g.emit("keyStatus",A),A==="expired"&&(this.warn(`${e.keySystem} expired for key ${h}`),this.renewKeySession(e))};e.mediaKeysSession.addEventListener("message",p),e.mediaKeysSession.addEventListener("keystatuseschange",v);const T=new Promise((E,S)=>{g.on("error",S),g.on("keyStatus",A=>{A.startsWith("usable")?E():A==="output-restricted"?S(new _t({type:Se.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):A==="internal-error"?S(new _t({type:Se.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${A}"`)):A==="expired"?S(new Error("key expired while generating request")):this.warn(`unhandled key status change "${A}"`)})});return e.mediaKeysSession.generateRequest(t,r).then(()=>{var E;this.log(`Request generated for key-session "${(E=e.mediaKeysSession)==null?void 0:E.sessionId}" keyId: ${h}`)}).catch(E=>{throw new _t({type:Se.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_NO_SESSION,error:E,fatal:!1},`Error generating key-session request: ${E}`)}).then(()=>T).catch(E=>{throw g.removeAllListeners(),this.removeSession(e),E}).then(()=>(g.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,r)=>{this.log(`key status change "${t}" for keyStatuses keyId: ${Xt.hexDump("buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r))} session keyId: ${Xt.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){const t=this.config,r=t.loader,s=new r(t),o=this.getServerCertificateUrl(e);return o?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,c)=>{const d={responseType:"arraybuffer",url:o},h=t.certLoadPolicy.default,g={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(v,T,E,S)=>{a(v.data)},onError:(v,T,E,S)=>{c(new _t({type:Se.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:E,response:tt({url:d.url,data:void 0},v)},`"${e}" certificate request failed (${o}). Status: ${v.code} (${v.text})`))},onTimeout:(v,T,E)=>{c(new _t({type:Se.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:E,response:{url:d.url,data:void 0}},`"${e}" certificate request timed out (${o})`))},onAbort:(v,T,E)=>{c(new Error("aborted"))}};s.load(d,g,p)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,r){return new Promise((s,o)=>{e.setServerCertificate(r).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${r==null?void 0:r.byteLength}) on "${t}"`),s(e)}).catch(a=>{o(new _t({type:Se.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(r=>this.updateKeySession(e,new Uint8Array(r)).catch(s=>{throw new _t({type:Se.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:s,fatal:!0},s.message)}))}unpackPlayReadyKeyMessage(e,t){const r=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!r.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const s=new DOMParser().parseFromString(r,"application/xml"),o=s.querySelectorAll("HttpHeader");if(o.length>0){let g;for(let p=0,v=o.length;p<v;p++){var a,c;g=o[p];const T=(a=g.querySelector("name"))==null?void 0:a.textContent,E=(c=g.querySelector("value"))==null?void 0:c.textContent;T&&E&&e.setRequestHeader(T,E)}}const d=s.querySelector("Challenge"),h=d==null?void 0:d.textContent;if(!h)throw new Error("Cannot find <Challenge> in key message");return Vl(atob(h))}setupLicenseXHR(e,t,r,s){const o=this.config.licenseXhrSetup;return o?Promise.resolve().then(()=>{if(!r.decryptdata)throw new Error("Key removed");return o.call(this.hls,e,t,r,s)}).catch(a=>{if(!r.decryptdata)throw a;return e.open("POST",t,!0),o.call(this.hls,e,t,r,s)}).then(a=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||s})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:s}))}requestLicense(e,t){const r=this.config.keyLoadPolicy.default;return new Promise((s,o)=>{const a=this.getLicenseServerUrl(e.keySystem);this.log(`Sending license request to URL: ${a}`);const c=new XMLHttpRequest;c.responseType="arraybuffer",c.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return o(new Error("invalid state"));if(c.readyState===4)if(c.status===200){this._requestLicenseFailureCount=0;let d=c.response;this.log(`License received ${d instanceof ArrayBuffer?d.byteLength:d}`);const h=this.config.licenseResponseCallback;if(h)try{d=h.call(this.hls,c,a,e)}catch(g){this.error(g)}s(d)}else{const d=r.errorRetry,h=d?d.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>h||c.status>=400&&c.status<500)o(new _t({type:Se.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:c,response:{url:a,data:void 0,code:c.status,text:c.statusText}},`License Request XHR failed (${a}). Status: ${c.status} (${c.statusText})`));else{const g=h-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${g} attempts left`),this.requestLicense(e,t).then(s,o)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=c,this.setupLicenseXHR(c,a,e,t).then(({xhr:d,licenseChallenge:h})=>{e.keySystem==be.PLAYREADY&&(h=this.unpackPlayReadyKeyMessage(d,h)),d.send(h)})})}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const r=t.media;this.media=r,r.addEventListener("encrypted",this.onMediaEncrypted),r.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media,t=this.mediaKeySessions;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},ki.clearKeyUriToKeyIdMap();const r=t.length;br.CDMCleanupPromise=Promise.all(t.map(s=>this.removeSession(s)).concat(e==null?void 0:e.setMediaKeys(null).catch(s=>{this.log(`Could not clear media keys: ${s}`)}))).then(()=>{r&&(this.log("finished closing key sessions and clearing media keys"),t.length=0)}).catch(s=>{this.log(`Could not close sessions and clear media keys: ${s}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const r=t.reduce((s,o)=>(s.indexOf(o.keyFormat)===-1&&s.push(o.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:r}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const s=this.mediaKeySessions.indexOf(e);return s>-1&&this.mediaKeySessions.splice(s,1),t.remove().catch(o=>{this.log(`Could not remove session: ${o}`)}).then(()=>t.close()).catch(o=>{this.log(`Could not close session: ${o}`)})}}}br.CDMCleanupPromise=void 0;class _t extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}var ut;(function(l){l.MANIFEST="m",l.AUDIO="a",l.VIDEO="v",l.MUXED="av",l.INIT="i",l.CAPTION="c",l.TIMED_TEXT="tt",l.KEY="k",l.OTHER="o"})(ut||(ut={}));var Zl;(function(l){l.DASH="d",l.HLS="h",l.SMOOTH="s",l.OTHER="o"})(Zl||(Zl={}));var er;(function(l){l.OBJECT="CMCD-Object",l.REQUEST="CMCD-Request",l.SESSION="CMCD-Session",l.STATUS="CMCD-Status"})(er||(er={}));const nE={[er.OBJECT]:["br","d","ot","tb"],[er.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[er.SESSION]:["cid","pr","sf","sid","st","v"],[er.STATUS]:["bs","rtp"]};class Br{constructor(e,t){this.value=void 0,this.params=void 0,Array.isArray(e)&&(e=e.map(r=>r instanceof Br?r:new Br(r))),this.value=e,this.params=t}}class w0{constructor(e){this.description=void 0,this.description=e}}const rE="Dict";function iE(l){return Array.isArray(l)?JSON.stringify(l):l instanceof Map?"Map{}":l instanceof Set?"Set{}":typeof l=="object"?JSON.stringify(l):String(l)}function sE(l,e,t,r){return new Error(`failed to ${l} "${iE(e)}" as ${t}`,{cause:r})}const Lh="Bare Item",oE="Boolean",aE="Byte Sequence",lE="Decimal",uE="Integer";function cE(l){return l<-999999999999999||999999999999999<l}const dE=/[\x00-\x1f\x7f]+/,fE="Token",hE="Key";function tn(l,e,t){return sE("serialize",l,e,t)}function gE(l){if(typeof l!="boolean")throw tn(l,oE);return l?"?1":"?0"}function mE(l){return btoa(String.fromCharCode(...l))}function pE(l){if(ArrayBuffer.isView(l)===!1)throw tn(l,aE);return`:${mE(l)}:`}function D0(l){if(cE(l))throw tn(l,uE);return l.toString()}function yE(l){return`@${D0(l.getTime()/1e3)}`}function k0(l,e){if(l<0)return-k0(-l,e);const t=Math.pow(10,e);if(Math.abs(l*t%1-.5)<Number.EPSILON){const s=Math.floor(l*t);return(s%2===0?s:s+1)/t}else return Math.round(l*t)/t}function vE(l){const e=k0(l,3);if(Math.floor(Math.abs(e)).toString().length>12)throw tn(l,lE);const t=e.toString();return t.includes(".")?t:`${t}.0`}const EE="String";function TE(l){if(dE.test(l))throw tn(l,EE);return`"${l.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function SE(l){return l.description||l.toString().slice(7,-1)}function Ah(l){const e=SE(l);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw tn(e,fE);return e}function eu(l){switch(typeof l){case"number":if(!se(l))throw tn(l,Lh);return Number.isInteger(l)?D0(l):vE(l);case"string":return TE(l);case"symbol":return Ah(l);case"boolean":return gE(l);case"object":if(l instanceof Date)return yE(l);if(l instanceof Uint8Array)return pE(l);if(l instanceof w0)return Ah(l);default:throw tn(l,Lh)}}function tu(l){if(/^[a-z*][a-z0-9\-_.*]*$/.test(l)===!1)throw tn(l,hE);return l}function Su(l){return l==null?"":Object.entries(l).map(([e,t])=>t===!0?`;${tu(e)}`:`;${tu(e)}=${eu(t)}`).join("")}function _0(l){return l instanceof Br?`${eu(l.value)}${Su(l.params)}`:eu(l)}function xE(l){return`(${l.value.map(_0).join(" ")})${Su(l.params)}`}function LE(l,e={whitespace:!0}){if(typeof l!="object")throw tn(l,rE);const t=l instanceof Map?l.entries():Object.entries(l),r=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([s,o])=>{o instanceof Br||(o=new Br(o));let a=tu(s);return o.value===!0?a+=Su(o.params):(a+="=",Array.isArray(o.value)?a+=xE(o):a+=_0(o)),a}).join(`,${r}`)}function AE(l,e){return LE(l,e)}const RE=l=>l==="ot"||l==="sf"||l==="st",IE=l=>typeof l=="number"?se(l):l!=null&&l!==""&&l!==!1;function CE(l,e){const t=new URL(l),r=new URL(e);if(t.origin!==r.origin)return l;const s=t.pathname.split("/").slice(1),o=r.pathname.split("/").slice(1,-1);for(;s[0]===o[0];)s.shift(),o.shift();for(;o.length;)o.shift(),s.unshift("..");return s.join("/")}function wE(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const o=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(s=="x"?o:o&3|8).toString(16)})}}}const oo=l=>Math.round(l),DE=(l,e)=>(e!=null&&e.baseUrl&&(l=CE(l,e.baseUrl)),encodeURIComponent(l)),Zs=l=>oo(l/100)*100,kE={br:oo,d:oo,bl:Zs,dl:Zs,mtp:Zs,nor:DE,rtp:Zs,tb:oo};function _E(l,e){const t={};if(l==null||typeof l!="object")return t;const r=Object.keys(l).sort(),s=We({},kE,e==null?void 0:e.formatters),o=e==null?void 0:e.filter;return r.forEach(a=>{if(o!=null&&o(a))return;let c=l[a];const d=s[a];d&&(c=d(c,e)),!(a==="v"&&c===1)&&(a=="pr"&&c===1||IE(c)&&(RE(a)&&typeof c=="string"&&(c=new w0(c)),t[a]=c))}),t}function P0(l,e={}){return l?AE(_E(l,e),We({whitespace:!1},e)):""}function PE(l,e={}){if(!l)return{};const t=Object.entries(l),r=Object.entries(nE).concat(Object.entries((e==null?void 0:e.customHeaderMap)||{})),s=t.reduce((o,a)=>{var c,d;const[h,g]=a,p=((c=r.find(v=>v[1].includes(h)))==null?void 0:c[0])||er.REQUEST;return(d=o[p])!=null||(o[p]={}),o[p][h]=g,o},{});return Object.entries(s).reduce((o,[a,c])=>(o[a]=P0(c,e),o),{})}function FE(l,e,t){return We(l,PE(e,t))}const OE="CMCD";function bE(l,e={}){if(!l)return"";const t=P0(l,e);return`${OE}=${encodeURIComponent(t)}`}const Rh=/CMCD=[^&#]+/;function ME(l,e,t){const r=bE(e,t);if(!r)return l;if(Rh.test(l))return l.replace(Rh,r);const s=l.includes("?")?"&":"?";return`${l}${s}${r}`}class NE{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:ut.MANIFEST,su:!this.initialized})}catch(o){F.warn("Could not generate manifest CMCD data.",o)}},this.applyFragmentData=s=>{try{const o=s.frag,a=this.hls.levels[o.level],c=this.getObjectType(o),d={d:o.duration*1e3,ot:c};(c===ut.VIDEO||c===ut.AUDIO||c==ut.MUXED)&&(d.br=a.bitrate/1e3,d.tb=this.getTopBandwidth(c)/1e3,d.bl=this.getBufferLength(c)),this.apply(s,d)}catch(o){F.warn("Could not generate segment CMCD data.",o)}},this.hls=e;const t=this.config=e.config,{cmcd:r}=t;r!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||wE(),this.cid=r.contentId,this.useHeaders=r.useHeaders===!0,this.includeKeys=r.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHED,this.onMediaDetached,this),e.on(x.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHED,this.onMediaDetached,this),e.off(x.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,s;this.audioBuffer=(r=t.tracks.audio)==null?void 0:r.buffer,this.videoBuffer=(s=t.tracks.video)==null?void 0:s.buffer}createData(){var e;return{v:1,sf:Zl.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){We(t,this.createData());const r=t.ot===ut.INIT||t.ot===ut.VIDEO||t.ot===ut.MUXED;this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:s}=this;s&&(t=Object.keys(t).reduce((o,a)=>(s.includes(a)&&(o[a]=t[a]),o),{})),this.useHeaders?(e.headers||(e.headers={}),FE(e.headers,t)):e.url=ME(e.url,t)}getObjectType(e){const{type:t}=e;if(t==="subtitle")return ut.TIMED_TEXT;if(e.sn==="initSegment")return ut.INIT;if(t==="audio")return ut.AUDIO;if(t==="main")return this.hls.audioTracks.length?ut.VIDEO:ut.MUXED}getTopBandwidth(e){let t=0,r;const s=this.hls;if(e===ut.AUDIO)r=s.audioTracks;else{const o=s.maxAutoLevel,a=o>-1?o+1:s.levels.length;r=s.levels.slice(0,a)}for(const o of r)o.bitrate>t&&(t=o.bitrate);return t>0?t:NaN}getBufferLength(e){const t=this.hls.media,r=e===ut.AUDIO?this.audioBuffer:this.videoBuffer;return!r||!t?NaN:Oe.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(o){this.loader=void 0,this.loader=new r(o)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(o,a,c){t(o),this.loader.load(o,a,c)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(o){this.loader=void 0,this.loader=new r(o)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(o,a,c){t(o),this.loader.load(o,a,c)}}}}const UE=3e5;class BE{constructor(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=F.log.bind(F,"[content-steering]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.ERROR,this.onError,this))}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(r=>r!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:r}=t;r!==null&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:r}=t;if((r==null?void 0:r.action)===it.SendAlternateToPenaltyBox&&r.flags===Gt.MoveAllAlternatesMatchingHost){const s=this.levels;let o=this.pathwayPriority,a=this.pathwayId;if(t.context){const{groupId:c,pathwayId:d,type:h}=t.context;c&&s?a=this.getPathwayForGroupId(c,h,a):d&&(a=d)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!o&&s&&(o=s.reduce((c,d)=>(c.indexOf(d.pathwayId)===-1&&c.push(d.pathwayId),c),[])),o&&o.length>1&&(this.updatePathwayPriority(o),r.resolved=this.pathwayId!==a),r.resolved||F.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${s&&s.length} priorities: ${JSON.stringify(o)} penalized: ${JSON.stringify(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this.pathwayPriority=e;let t;const r=this.penalizedPathways,s=performance.now();Object.keys(r).forEach(o=>{s-r[o]>UE&&delete r[o]});for(let o=0;o<e.length;o++){const a=e[o];if(a in r)continue;if(a===this.pathwayId)return;const c=this.hls.nextLoadLevel,d=this.hls.levels[c];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,Qh(t),this.hls.trigger(x.LEVELS_UPDATED,{levels:t});const h=this.hls.levels[c];d&&h&&this.levels&&(h.attrs["STABLE-VARIANT-ID"]!==d.attrs["STABLE-VARIANT-ID"]&&h.bitrate!==d.bitrate&&this.log(`Unstable Pathways change from bitrate ${d.bitrate} to ${h.bitrate}`),this.hls.nextLoadLevel=c);break}}}getPathwayForGroupId(e,t,r){const s=this.getLevelsForPathway(r).concat(this.levels||[]);for(let o=0;o<s.length;o++)if(t===Ce.AUDIO_TRACK&&s[o].hasAudioGroup(e)||t===Ce.SUBTITLE_TRACK&&s[o].hasSubtitleGroup(e))return s[o].pathwayId;return r}clonePathways(e){const t=this.levels;if(!t)return;const r={},s={};e.forEach(o=>{const{ID:a,"BASE-ID":c,"URI-REPLACEMENT":d}=o;if(t.some(g=>g.pathwayId===a))return;const h=this.getLevelsForPathway(c).map(g=>{const p=new Ge(g.attrs);p["PATHWAY-ID"]=a;const v=p.AUDIO&&`${p.AUDIO}_clone_${a}`,T=p.SUBTITLES&&`${p.SUBTITLES}_clone_${a}`;v&&(r[p.AUDIO]=v,p.AUDIO=v),T&&(s[p.SUBTITLES]=T,p.SUBTITLES=T);const E=F0(g.uri,p["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",d),S=new Nr({attrs:p,audioCodec:g.audioCodec,bitrate:g.bitrate,height:g.height,name:g.name,url:E,videoCodec:g.videoCodec,width:g.width});if(g.audioGroups)for(let A=1;A<g.audioGroups.length;A++)S.addGroupId("audio",`${g.audioGroups[A]}_clone_${a}`);if(g.subtitleGroups)for(let A=1;A<g.subtitleGroups.length;A++)S.addGroupId("text",`${g.subtitleGroups[A]}_clone_${a}`);return S});t.push(...h),Ih(this.audioTracks,r,d,a),Ih(this.subtitleTracks,s,d,a)})}loadSteeringManifest(e){const t=this.hls.config,r=t.loader;this.loader&&this.loader.destroy(),this.loader=new r(t);let s;try{s=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(s.protocol!=="data:"){const g=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+g)}const o={responseType:"json",url:s.href},a=t.steeringManifestLoadPolicy.default,c=a.errorRetry||a.timeoutRetry||{},d={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:c.maxNumRetry||0,retryDelay:c.retryDelayMs||0,maxRetryDelay:c.maxRetryDelayMs||0},h={onSuccess:(g,p,v,T)=>{this.log(`Loaded steering manifest: "${s}"`);const E=g.data;if(E.VERSION!==1){this.log(`Steering VERSION ${E.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=E.TTL;const{"RELOAD-URI":S,"PATHWAY-CLONES":A,"PATHWAY-PRIORITY":R}=E;if(S)try{this.uri=new self.URL(S,s).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${S}`);return}this.scheduleRefresh(this.uri||v.url),A&&this.clonePathways(A);const k={steeringManifest:E,url:s.toString()};this.hls.trigger(x.STEERING_MANIFEST_LOADED,k),R&&this.updatePathwayPriority(R)},onError:(g,p,v,T)=>{if(this.log(`Error loading steering manifest: ${g.code} ${g.text} (${p.url})`),this.stopLoad(),g.code===410){this.enabled=!1,this.log(`Steering manifest ${p.url} no longer available`);return}let E=this.timeToLoad*1e3;if(g.code===429){const S=this.loader;if(typeof(S==null?void 0:S.getResponseHeader)=="function"){const A=S.getResponseHeader("Retry-After");A&&(E=parseFloat(A)*1e3)}this.log(`Steering manifest ${p.url} rate limited`);return}this.scheduleRefresh(this.uri||p.url,E)},onTimeout:(g,p,v)=>{this.log(`Timeout loading steering manifest (${p.url})`),this.scheduleRefresh(this.uri||p.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(o,d,h)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var r;const s=(r=this.hls)==null?void 0:r.media;if(s&&!s.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function Ih(l,e,t,r){l&&Object.keys(e).forEach(s=>{const o=l.filter(a=>a.groupId===s).map(a=>{const c=We({},a);return c.details=void 0,c.attrs=new Ge(c.attrs),c.url=c.attrs.URI=F0(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),c.groupId=c.attrs["GROUP-ID"]=e[s],c.attrs["PATHWAY-ID"]=r,c});l.push(...o)})}function F0(l,e,t,r){const{HOST:s,PARAMS:o,[t]:a}=r;let c;e&&(c=a==null?void 0:a[e],c&&(l=c));const d=new self.URL(l);return s&&!c&&(d.host=s),o&&Object.keys(o).sort().forEach(h=>{h&&d.searchParams.set(h,o[h])}),d.href}const $E=/^age:\s*[\d.]+\s*$/im;class O0{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new So,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const r=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;const o=this.xhrSetup;o?Promise.resolve().then(()=>{if(!(this.loader!==r||this.stats.aborted))return o(r,t.url)}).catch(a=>{if(!(this.loader!==r||this.stats.aborted))return r.open("GET",t.url,!0),o(r,t.url)}).then(()=>{this.loader!==r||this.stats.aborted||this.openAndSendXhr(r,t,e)}).catch(a=>{this.callbacks.onError({code:r.status,text:a.message},t,r,s)}):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);const s=t.headers,{maxTimeToFirstByteMs:o,maxLoadTimeMs:a}=r.loadPolicy;if(s)for(const c in s)e.setRequestHeader(c,s[c]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=o&&se(o)?o:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:r}=this;if(!e||!t)return;const s=t.readyState,o=this.config;if(!r.aborted&&s>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),o.timeout!==o.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),o.timeout=o.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),o.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const a=t.status,c=t.responseType!=="text";if(a>=200&&a<300&&(c&&t.response||t.responseText!==null)){r.loading.end=Math.max(self.performance.now(),r.loading.first);const d=c?t.response:t.responseText,h=t.responseType==="arraybuffer"?d.byteLength:d.length;if(r.loaded=r.total=h,r.bwEstimate=r.total*8e3/(r.loading.end-r.loading.first),!this.callbacks)return;const g=this.callbacks.onProgress;if(g&&g(r,e,d,t),!this.callbacks)return;const p={url:t.responseURL,data:d,code:a};this.callbacks.onSuccess(p,r,e,t)}else{const d=o.loadPolicy.errorRetry,h=r.retry,g={url:e.url,data:void 0,code:a};po(d,h,!1,g)?this.retry(d):(F.error(`${a} while loading ${e.url}`),this.callbacks.onError({code:a,text:t.statusText},e,t,r))}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(po(e,t,!0))this.retry(e);else{var r;F.warn(`timeout while loading ${(r=this.context)==null?void 0:r.url}`);const s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:r}=this;this.retryDelay=lu(e,r.retry),r.retry++,F.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&$E.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}function GE(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const KE=/(\d+)-(\d+)\/(\d+)/;class Ch{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||WE,this.controller=new self.AbortController,this.stats=new So}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const o=VE(e,this.controller.signal),a=r.onProgress,c=e.responseType==="arraybuffer",d=c?"byteLength":"length",{maxTimeToFirstByteMs:h,maxLoadTimeMs:g}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,o),self.clearTimeout(this.requestTimeout),t.timeout=h&&se(h)?h:g,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),r.onTimeout(s,e,this.response)},t.timeout),self.fetch(this.request).then(p=>{this.response=this.loader=p;const v=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=g,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),r.onTimeout(s,e,this.response)},g-(v-s.loading.start)),!p.ok){const{status:T,statusText:E}=p;throw new jE(E||"fetch, bad network response",T,p)}return s.loading.first=v,s.total=zE(p.headers)||s.total,a&&se(t.highWaterMark)?this.loadProgressively(p,s,e,t.highWaterMark,a):c?p.arrayBuffer():e.responseType==="json"?p.json():p.text()}).then(p=>{const v=this.response;if(!v)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const T=p[d];T&&(s.loaded=s.total=T);const E={url:v.url,data:p,code:v.status};a&&!se(t.highWaterMark)&&a(s,e,p,v),r.onSuccess(E,s,e,v)}).catch(p=>{if(self.clearTimeout(this.requestTimeout),s.aborted)return;const v=p&&p.code||0,T=p?p.message:null;r.onError({code:v,text:T},e,p?p.details:null,s)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,s=0,o){const a=new t0,c=e.body.getReader(),d=()=>c.read().then(h=>{if(h.done)return a.dataLength&&o(t,r,a.flush(),e),Promise.resolve(new ArrayBuffer(0));const g=h.value,p=g.length;return t.loaded+=p,p<s||a.dataLength?(a.push(g),a.dataLength>=s&&o(t,r,a.flush(),e)):o(t,r,g,e),d()}).catch(()=>Promise.reject());return d()}}function VE(l,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(We({},l.headers))};return l.rangeEnd&&t.headers.set("Range","bytes="+l.rangeStart+"-"+String(l.rangeEnd-1)),t}function HE(l){const e=KE.exec(l);if(e)return parseInt(e[2])-parseInt(e[1])+1}function zE(l){const e=l.get("Content-Range");if(e){const r=HE(e);if(se(r))return r}const t=l.get("Content-Length");if(t)return parseInt(t)}function WE(l,e){return new self.Request(l.url,e)}class jE extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}const YE=/\s/,qE={newCue(l,e,t,r){const s=[];let o,a,c,d,h;const g=self.VTTCue||self.TextTrackCue;for(let v=0;v<r.rows.length;v++)if(o=r.rows[v],c=!0,d=0,h="",!o.isEmpty()){var p;for(let S=0;S<o.chars.length;S++)YE.test(o.chars[S].uchar)&&c?d++:(h+=o.chars[S].uchar,c=!1);o.cueStartTime=e,e===t&&(t+=1e-4),d>=16?d--:d++;const T=L0(h.trim()),E=Eu(e,t,T);l!=null&&(p=l.cues)!=null&&p.getCueById(E)||(a=new g(e,t,T),a.id=E,a.line=v+1,a.align="left",a.position=10+Math.min(80,Math.floor(d*8/32)*10),s.push(a))}return l&&s.length&&(s.sort((v,T)=>v.line==="auto"||T.line==="auto"?0:v.line>8&&T.line>8?T.line-v.line:v.line-T.line),s.forEach(v=>jh(l,v))),s}},XE={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},b0=tt(tt({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:O0,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Ly,bufferController:Cv,capLevelController:Tu,errorController:dy,fpsController:tE,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Fh,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!0,certLoadPolicy:{default:XE},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},QE()),{},{subtitleStreamController:Lv,subtitleTrackController:Rv,timelineController:Zv,audioStreamController:Sv,audioTrackController:xv,emeController:br,cmcdController:NE,contentSteeringController:BE});function QE(){return{cueHandler:qE,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function JE(l,e){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const t=nu(l),r=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(o=>{const a=`${o==="level"?"playlist":o}LoadPolicy`,c=e[a]===void 0,d=[];s.forEach(h=>{const g=`${o}Loading${h}`,p=e[g];if(p!==void 0&&c){d.push(g);const v=t[a].default;switch(e[a]={default:v},h){case"TimeOut":v.maxLoadTimeMs=p,v.maxTimeToFirstByteMs=p;break;case"MaxRetry":v.errorRetry.maxNumRetry=p,v.timeoutRetry.maxNumRetry=p;break;case"RetryDelay":v.errorRetry.retryDelayMs=p,v.timeoutRetry.retryDelayMs=p;break;case"MaxRetryTimeout":v.errorRetry.maxRetryDelayMs=p,v.timeoutRetry.maxRetryDelayMs=p;break}}}),d.length&&F.warn(`hls.js config: "${d.join('", "')}" setting(s) are deprecated, use "${a}": ${JSON.stringify(e[a])}`)}),tt(tt({},t),e)}function nu(l){return l&&typeof l=="object"?Array.isArray(l)?l.map(nu):Object.keys(l).reduce((e,t)=>(e[t]=nu(l[t]),e),{}):l}function ZE(l){const e=l.loader;e!==Ch&&e!==O0?(F.log("[config]: Custom loader detected, cannot enable progressive streaming"),l.progressive=!1):GE()&&(l.loader=Ch,l.progressive=!0,l.enableSoftwareAES=!0,F.log("[config]: Progressive streaming enabled, using FetchLoader"))}let Gl;class eT extends uu{constructor(e,t){super(e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this),e.on(x.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this),e.off(x.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const r=this.hls.config.preferManagedMediaSource,s=[],o={},a={};let c=!1,d=!1,h=!1;t.levels.forEach(g=>{var p,v;const T=g.attrs;let{audioCodec:E,videoCodec:S}=g;((p=E)==null?void 0:p.indexOf("mp4a.40.34"))!==-1&&(Gl||(Gl=/chrome|firefox/i.test(navigator.userAgent)),Gl&&(g.audioCodec=E=void 0)),E&&(g.audioCodec=E=ho(E,r)),((v=S)==null?void 0:v.indexOf("avc1"))===0&&(S=g.videoCodec=$p(S));const{width:A,height:R,unknownCodecs:k}=g;if(c||(c=!!(A&&R)),d||(d=!!S),h||(h=!!E),k!=null&&k.length||E&&!Il(E,"audio",r)||S&&!Il(S,"video",r))return;const{CODECS:D,"FRAME-RATE":N,"HDCP-LEVEL":P,"PATHWAY-ID":V,RESOLUTION:U,"VIDEO-RANGE":j}=T,H=`${`${V||"."}-`}${g.bitrate}-${U}-${N}-${D}-${j}-${P}`;if(o[H])if(o[H].uri!==g.url&&!g.attrs["PATHWAY-ID"]){const Q=a[H]+=1;g.attrs["PATHWAY-ID"]=new Array(Q+1).join(".");const ge=new Nr(g);o[H]=ge,s.push(ge)}else o[H].addGroupId("audio",T.AUDIO),o[H].addGroupId("text",T.SUBTITLES);else{const Q=new Nr(g);o[H]=Q,a[H]=1,s.push(Q)}}),this.filterAndSortMediaOptions(s,t,c,d,h)}filterAndSortMediaOptions(e,t,r,s,o){let a=[],c=[],d=e;if((r||s)&&o&&(d=d.filter(({videoCodec:E,videoRange:S,width:A,height:R})=>(!!E||!!(A&&R))&&Zp(S))),d.length===0){Promise.resolve().then(()=>{if(this.hls){t.levels.length&&this.warn(`One or more CODECS in variant not supported: ${JSON.stringify(t.levels[0].attrs)}`);const E=new Error("no level with compatible codecs found in manifest");this.hls.trigger(x.ERROR,{type:Se.MEDIA_ERROR,details:G.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:E,reason:E.message})}});return}if(t.audioTracks){const{preferManagedMediaSource:E}=this.hls.config;a=t.audioTracks.filter(S=>!S.audioCodec||Il(S.audioCodec,"audio",E)),wh(a)}t.subtitles&&(c=t.subtitles,wh(c));const h=d.slice(0);d.sort((E,S)=>{if(E.attrs["HDCP-LEVEL"]!==S.attrs["HDCP-LEVEL"])return(E.attrs["HDCP-LEVEL"]||"")>(S.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&E.height!==S.height)return E.height-S.height;if(E.frameRate!==S.frameRate)return E.frameRate-S.frameRate;if(E.videoRange!==S.videoRange)return go.indexOf(E.videoRange)-go.indexOf(S.videoRange);if(E.videoCodec!==S.videoCodec){const A=bf(E.videoCodec),R=bf(S.videoCodec);if(A!==R)return R-A}if(E.uri===S.uri&&E.codecSet!==S.codecSet){const A=fo(E.codecSet),R=fo(S.codecSet);if(A!==R)return R-A}return E.averageBitrate!==S.averageBitrate?E.averageBitrate-S.averageBitrate:0});let g=h[0];if(this.steering&&(d=this.steering.filterParsedLevels(d),d.length!==h.length)){for(let E=0;E<h.length;E++)if(h[E].pathwayId===d[0].pathwayId){g=h[E];break}}this._levels=d;for(let E=0;E<d.length;E++)if(d[E]===g){var p;this._firstLevel=E;const S=g.bitrate,A=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${d.length} level(s) found, first bitrate: ${S}`),((p=this.hls.userConfig)==null?void 0:p.abrEwmaDefaultEstimate)===void 0){const R=Math.min(S,this.hls.config.abrEwmaDefaultEstimateMax);R>A&&A===b0.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=R)}break}const v=o&&!s,T={levels:d,audioTracks:a,subtitleTracks:c,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:o,video:s,altAudio:!v&&a.some(E=>!!E.url)};this.hls.trigger(x.MANIFEST_PARSED,T),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return this._levels.length===0?null:this._levels}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const g=new Error("invalid level idx"),p=e<0;if(this.hls.trigger(x.ERROR,{type:Se.OTHER_ERROR,details:G.LEVEL_SWITCH_ERROR,level:e,fatal:p,error:g,reason:g.message}),p)return;e=Math.min(e,t.length-1)}const r=this.currentLevelIndex,s=this.currentLevel,o=s?s.attrs["PATHWAY-ID"]:void 0,a=t[e],c=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,r===e&&a.details&&s&&o===c)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${c?" with Pathway "+c:""} from level ${r}${o?" with Pathway "+o:""}`);const d={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(x.LEVEL_SWITCHING,d);const h=a.details;if(!h||h.live){const g=this.switchParams(a.uri,s==null?void 0:s.details,h);this.loadPlaylist(g)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}onError(e,t){t.fatal||!t.context||t.context.type===Ce.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===ve.MAIN){const r=t.elementaryStreams;if(!Object.keys(r).some(o=>!!r[o]))return;const s=this._levels[t.level];s!=null&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}onLevelLoaded(e,t){var r;const{level:s,details:o}=t,a=this._levels[s];if(!a){var c;this.warn(`Invalid level index ${s}`),(c=t.deliveryDirectives)!=null&&c.skip&&(o.deltaUpdateFailed=!0);return}s===this.currentLevelIndex?(a.fragmentError===0&&(a.loadError=0),this.playlistLoaded(s,t,a.details)):(r=t.deliveryDirectives)!=null&&r.skip&&(o.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist();const t=this.currentLevelIndex,r=this.currentLevel;if(r&&this.shouldLoadPlaylist(r)){let s=r.uri;if(e)try{s=e.addDirectives(s)}catch(a){this.warn(`Could not construct new URL with HLS Delivery Directives: ${a}`)}const o=r.attrs["PATHWAY-ID"];this.log(`Loading level index ${t}${(e==null?void 0:e.msn)!==void 0?" at sn "+e.msn+" part "+e.part:""} with${o?" Pathway "+o:""} ${s}`),this.clearTimer(),this.hls.trigger(x.LEVEL_LOADING,{url:s,level:t,pathwayId:r.attrs["PATHWAY-ID"],id:0,deliveryDirectives:e||null})}}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;const r=this._levels.filter((s,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(s),s===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,s.details&&s.details.fragments.forEach(a=>a.level=-1)),!1));Qh(r),this._levels=r,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(x.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:r}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(x.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:r}))}}function wh(l){const e={};l.forEach(t=>{const r=t.groupId||"";t.id=e[r]=e[r]||0,e[r]++})}class tT{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const r in this.keyUriToKeyInfo){const s=this.keyUriToKeyInfo[r].loader;if(s){var t;if(e&&e!==((t=s.context)==null?void 0:t.frag.type))return;s.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=G.KEY_LOAD_ERROR,r,s,o){return new hn({type:Se.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:o,error:r,networkDetails:s})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:r,cc:s}=e;for(let o=0;o<t.length;o++){const a=t[o];if(s<=a.cc&&(r==="initSegment"||a.sn==="initSegment"||r<a.sn)){this.emeController.selectKeySystemFormat(a).then(c=>{a.setKeyFormat(c)});break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var r,s;t&&e.setKeyFormat(t);const o=e.decryptdata;if(!o){const h=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,G.KEY_LOAD_ERROR,h))}const a=o.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,G.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));let c=this.keyUriToKeyInfo[a];if((r=c)!=null&&r.decryptdata.key)return o.key=c.decryptdata.key,Promise.resolve({frag:e,keyInfo:c});if((s=c)!=null&&s.keyLoadPromise){var d;switch((d=c.mediaKeySessionContext)==null?void 0:d.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return c.keyLoadPromise.then(h=>(o.key=h.keyInfo.decryptdata.key,{frag:e,keyInfo:c}))}}switch(c=this.keyUriToKeyInfo[a]={decryptdata:o,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},o.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return o.keyFormat==="identity"?this.loadKeyHTTP(c,e):this.loadKeyEME(c,e);case"AES-128":return this.loadKeyHTTP(c,e);default:return Promise.reject(this.createKeyLoadError(e,G.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${o.method}"`)))}}loadKeyEME(e,t){const r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const s=this.emeController.loadKey(r);if(s)return(e.keyLoadPromise=s.then(o=>(e.mediaKeySessionContext=o,r))).catch(o=>{throw e.keyLoadPromise=null,o})}return Promise.resolve(r)}loadKeyHTTP(e,t){const r=this.config,s=r.loader,o=new s(r);return t.keyLoader=e.loader=o,e.keyLoadPromise=new Promise((a,c)=>{const d={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},h=r.keyLoadPolicy.default,g={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(v,T,E,S)=>{const{frag:A,keyInfo:R,url:k}=E;if(!A.decryptdata||R!==this.keyUriToKeyInfo[k])return c(this.createKeyLoadError(A,G.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),S));R.decryptdata.key=A.decryptdata.key=new Uint8Array(v.data),A.keyLoader=null,R.loader=null,a({frag:A,keyInfo:R})},onError:(v,T,E,S)=>{this.resetLoader(T),c(this.createKeyLoadError(t,G.KEY_LOAD_ERROR,new Error(`HTTP Error ${v.code} loading key ${v.text}`),E,tt({url:d.url,data:void 0},v)))},onTimeout:(v,T,E)=>{this.resetLoader(T),c(this.createKeyLoadError(t,G.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),E))},onAbort:(v,T,E)=>{this.resetLoader(T),c(this.createKeyLoadError(t,G.INTERNAL_ABORTED,new Error("key loading aborted"),E))}};o.load(d,g,p)})}resetLoader(e){const{frag:t,keyInfo:r,url:s}=e,o=r.loader;t.keyLoader===o&&(t.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[s],o&&o.destroy()}}function M0(){return self.SourceBuffer||self.WebKitSourceBuffer}function N0(){if(!nr())return!1;const e=M0();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function nT(){if(!N0())return!1;const l=nr();return typeof(l==null?void 0:l.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>l.isTypeSupported(_i(e,"video")))||["mp4a.40.2","fLaC"].some(e=>l.isTypeSupported(_i(e,"audio"))))}function rT(){var l;const e=M0();return typeof(e==null||(l=e.prototype)==null?void 0:l.changeType)=="function"}const iT=250,ao=2,sT=.1,oT=.05;class aT{constructor(e,t,r,s){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=r,this.hls=s}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(e,t){const{config:r,media:s,stalled:o}=this;if(s===null)return;const{currentTime:a,seeking:c}=s,d=this.seeking&&!c,h=!this.seeking&&c;if(this.seeking=c,a!==e){if(this.moved=!0,c||(this.nudgeRetry=0),o!==null){if(this.stallReported){const A=self.performance.now()-o;F.warn(`playback not stuck anymore @${a}, after ${Math.round(A)}ms`),this.stallReported=!1}this.stalled=null}return}if(h||d){this.stalled=null;return}if(s.paused&&!c||s.ended||s.playbackRate===0||!Oe.getBuffered(s).length){this.nudgeRetry=0;return}const g=Oe.bufferInfo(s,a,0),p=g.nextStart||0;if(c){const A=g.len>ao,R=!p||t&&t.start<=a||p-a>ao&&!this.fragmentTracker.getPartialFragment(a);if(A||R)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var v;if(!(g.len>0)&&!p)return;const R=Math.max(p,g.start||0)-a,k=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,N=(k==null||(v=k.details)==null?void 0:v.live)?k.details.targetduration*2:ao,P=this.fragmentTracker.getPartialFragment(a);if(R>0&&(R<=N||P)){s.paused||this._trySkipBufferHole(P);return}}const T=self.performance.now();if(o===null){this.stalled=T;return}const E=T-o;if(!c&&E>=iT&&(this._reportStall(g),!this.media))return;const S=Oe.bufferInfo(s,a,r.maxBufferHole);this._tryFixBufferStall(S,E)}_tryFixBufferStall(e,t){const{config:r,fragmentTracker:s,media:o}=this;if(o===null)return;const a=o.currentTime,c=s.getPartialFragment(a);c&&(this._trySkipBufferHole(c)||!this.media)||(e.len>r.maxBufferHole||e.nextStart&&e.nextStart-a<r.maxBufferHole)&&t>r.highBufferWatchdogPeriod*1e3&&(F.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(e){const{hls:t,media:r,stallReported:s}=this;if(!s&&r){this.stallReported=!0;const o=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${JSON.stringify(e)})`);F.warn(o.message),t.trigger(x.ERROR,{type:Se.MEDIA_ERROR,details:G.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len})}}_trySkipBufferHole(e){const{config:t,hls:r,media:s}=this;if(s===null)return 0;const o=s.currentTime,a=Oe.bufferInfo(s,o,0),c=o<a.start?a.start:a.nextStart;if(c){const d=a.len<=t.maxBufferHole,h=a.len>0&&a.len<1&&s.readyState<3,g=c-o;if(g>0&&(d||h)){if(g>t.maxBufferHole){const{fragmentTracker:v}=this;let T=!1;if(o===0){const E=v.getAppendedFrag(0,ve.MAIN);E&&c<E.end&&(T=!0)}if(!T){const E=e||v.getAppendedFrag(o,ve.MAIN);if(E){let S=!1,A=E.end;for(;A<c;){const R=v.getPartialFragment(A);if(R)A+=R.duration;else{S=!0;break}}if(S)return 0}}}const p=Math.max(c+oT,o+sT);if(F.warn(`skipping hole, adjusting currentTime from ${o} to ${p}`),this.moved=!0,this.stalled=null,s.currentTime=p,e&&!e.gap){const v=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${p}`);r.trigger(x.ERROR,{type:Se.MEDIA_ERROR,details:G.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:v,reason:v.message,frag:e})}return p}}return 0}_tryNudgeBuffer(){const{config:e,hls:t,media:r,nudgeRetry:s}=this;if(r===null)return;const o=r.currentTime;if(this.nudgeRetry++,s<e.nudgeMaxRetry){const a=o+(s+1)*e.nudgeOffset,c=new Error(`Nudging 'currentTime' from ${o} to ${a}`);F.warn(c.message),r.currentTime=a,t.trigger(x.ERROR,{type:Se.MEDIA_ERROR,details:G.BUFFER_NUDGE_ON_STALL,error:c,fatal:!1})}else{const a=new Error(`Playhead still not moving while enough data buffered @${o} after ${e.nudgeMaxRetry} nudges`);F.error(a.message),t.trigger(x.ERROR,{type:Se.MEDIA_ERROR,details:G.BUFFER_STALLED_ERROR,error:a,fatal:!0})}}}const lT=100;class uT extends fu{constructor(e,t,r){super(e,t,r,"[stream-controller]",ve.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.LEVEL_LOADING,this.onLevelLoading,this),e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(x.ERROR,this.onError,this),e.on(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(x.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(x.BUFFER_CREATED,this.onBufferCreated,this),e.on(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(x.ERROR,this.onError,this),e.off(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(x.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(x.BUFFER_CREATED,this.onBufferCreated,this),e.off(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying()}startLoad(e){if(this.levels){const{lastCurrentTime:t,hls:r}=this;if(this.stopLoad(),this.setInterval(lT),this.level=-1,!this.startFragRequested){let s=r.startLevel;s===-1&&(r.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=r.firstAutoLevel),r.nextLoadLevel=s,this.level=r.loadLevel,this.loadedmetadata=!1}t>0&&e===-1&&(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t),this.state=W.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=W.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case W.WAITING_LEVEL:{const{levels:t,level:r}=this,s=t==null?void 0:t[r],o=s==null?void 0:s.details;if(o&&(!o.live||this.levelLastLoaded===s)){if(this.waitForCdnTuneIn(o))break;this.state=W.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=W.IDLE;break}break}case W.FRAG_LOADING_WAITING_RETRY:{var e;const t=self.performance.now(),r=this.retryDate;if(!r||t>=r||(e=this.media)!=null&&e.seeking){const{levels:s,level:o}=this,a=s==null?void 0:s[o];this.resetStartWhenNotLoaded(a||null),this.state=W.IDLE}}break}this.state===W.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:r,media:s}=this;if(t===null||!s&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const o=e.nextLoadLevel;if(!(r!=null&&r[o]))return;const a=r[o],c=this.getMainFwdBufferInfo();if(c===null)return;const d=this.getLevelDetails();if(d&&this._streamEnded(c,d)){const S={};this.altAudio&&(S.type="video"),this.hls.trigger(x.BUFFER_EOS,S),this.state=W.ENDED;return}e.loadLevel!==o&&e.manualLevel===-1&&this.log(`Adapting to level ${o} from level ${this.level}`),this.level=e.nextLoadLevel=o;const h=a.details;if(!h||this.state===W.WAITING_LEVEL||h.live&&this.levelLastLoaded!==a){this.level=o,this.state=W.WAITING_LEVEL;return}const g=c.len,p=this.getMaxBufferLength(a.maxBitrate);if(g>=p)return;this.backtrackFragment&&this.backtrackFragment.start>c.end&&(this.backtrackFragment=null);const v=this.backtrackFragment?this.backtrackFragment.start:c.end;let T=this.getNextFragment(v,h);if(this.couldBacktrack&&!this.fragPrevious&&T&&T.sn!=="initSegment"&&this.fragmentTracker.getState(T)!==et.OK){var E;const A=((E=this.backtrackFragment)!=null?E:T).sn-h.startSN,R=h.fragments[A-1];R&&T.cc===R.cc&&(T=R,this.fragmentTracker.removeFragment(R))}else this.backtrackFragment&&c.len&&(this.backtrackFragment=null);if(T&&this.isLoopLoading(T,v)){if(!T.gap){const A=this.audioOnly&&!this.altAudio?_e.AUDIO:_e.VIDEO,R=(A===_e.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;R&&this.afterBufferFlushed(R,A,ve.MAIN)}T=this.getNextFragmentLoopLoading(T,h,c,ve.MAIN,p)}T&&(T.initSegment&&!T.initSegment.data&&!this.bitrateTest&&(T=T.initSegment),this.loadFragment(T,a,v))}loadFragment(e,t,r){const s=this.fragmentTracker.getState(e);this.fragCurrent=e,s===et.NOT_LOADED||s===et.PARTIAL?e.sn==="initSegment"?this._loadInitSegment(e,t):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,super.loadFragment(e,t,r)):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,ve.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let r;const s=this.getAppendedFrag(t.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const o=this.getLevelDetails();if(o!=null&&o.live){const c=this.getMainFwdBufferInfo();if(!c||c.len<o.targetduration*2)return}if(!t.paused&&e){const c=this.hls.nextLoadLevel,d=e[c],h=this.fragLastKbps;h&&this.fragCurrent?r=this.fragCurrent.duration*d.maxBitrate/(1e3*h)+1:r=0}else r=0;const a=this.getBufferedFrag(t.currentTime+r);if(a){const c=this.followingBufferedFrag(a);if(c){this.abortCurrentFrag();const d=c.maxStartPTS?c.maxStartPTS:c.start,h=c.duration,g=Math.max(a.end,d+Math.min(Math.max(h-this.config.maxFragLookUpTolerance,h*(this.couldBacktrack?.5:.125)),h*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(g,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case W.KEY_LOADING:case W.FRAG_LOADING:case W.FRAG_LOADING_WAITING_RETRY:case W.PARSING:case W.PARSED:this.state=W.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const r=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),r.addEventListener("playing",this.onvplaying),r.addEventListener("seeked",this.onvseeked),this.gapController=new aT(this.config,r,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:e}=this;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const e=this.media,t=e?e.currentTime:null;se(t)&&this.log(`Media seeked to ${t.toFixed(3)}`);const r=this.getMainFwdBufferInfo();if(r===null||r.len===0){this.warn(`Main forward buffer length on "seeked" event ${r?r.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(x.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1}onManifestParsed(e,t){let r=!1,s=!1;t.levels.forEach(o=>{const a=o.audioCodec;a&&(r=r||a.indexOf("mp4a.40.2")!==-1,s=s||a.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=r&&s&&!rT(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:r}=this;if(!r||this.state!==W.IDLE)return;const s=r[t.level];(!s.details||s.details.live&&this.levelLastLoaded!==s||this.waitForCdnTuneIn(s.details))&&(this.state=W.WAITING_LEVEL)}onLevelLoaded(e,t){var r;const{levels:s}=this,o=t.level,a=t.details,c=a.totalduration;if(!s){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${c}`);const d=s[o],h=this.fragCurrent;h&&(this.state===W.FRAG_LOADING||this.state===W.FRAG_LOADING_WAITING_RETRY)&&h.level!==t.level&&h.loader&&this.abortCurrentFrag();let g=0;if(a.live||(r=d.details)!=null&&r.live){var p;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;g=this.alignPlaylists(a,d.details,(p=this.levelLastLoaded)==null?void 0:p.details)}if(d.details=a,this.levelLastLoaded=d,this.hls.trigger(x.LEVEL_UPDATED,{details:a,level:o}),this.state===W.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=W.IDLE}this.startFragRequested?a.live&&this.synchronizeToLiveEdge(a):this.setStartPosition(a,g),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:r,part:s,payload:o}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const c=a[r.level],d=c.details;if(!d){this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),this.fragmentTracker.removeFragment(r);return}const h=c.videoCodec,g=d.PTSKnown||!d.live,p=(t=r.initSegment)==null?void 0:t.data,v=this._getAudioCodec(c),T=this.transmuxer=this.transmuxer||new y0(this.hls,ve.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),E=s?s.index:-1,S=E!==-1,A=new cu(r.level,r.sn,r.stats.chunkCount,o.byteLength,E,S),R=this.initPTS[r.cc];T.push(o,p,v,h,r,s,d.totalduration,g,A,R)}onAudioTrackSwitching(e,t){const r=this.altAudio;if(!!!t.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const o=this.hls;r&&(o.trigger(x.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),o.trigger(x.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const r=t.id,s=!!this.hls.audioTracks[r].url;if(s){const o=this.videoBuffer;o&&this.mediaBuffer!==o&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=o)}this.altAudio=s,this.tick()}onBufferCreated(e,t){const r=t.tracks;let s,o,a=!1;for(const c in r){const d=r[c];if(d.id==="main"){if(o=c,s=d,c==="video"){const h=r[c];h&&(this.videoBuffer=h.buffer)}}else a=!0}a&&s?(this.log(`Alternate track found, use ${o}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:r,part:s}=t;if(r&&r.type!==ve.MAIN)return;if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${s?" p: "+s.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),this.state===W.PARSED&&(this.state=W.IDLE);return}const o=s?s.stats:r.stats;this.fragLastKbps=Math.round(8*o.total/(o.buffering.end-o.loading.first)),r.sn!=="initSegment"&&(this.fragPrevious=r),this.fragBufferedComplete(r,s)}onError(e,t){var r;if(t.fatal){this.state=W.ERROR;return}switch(t.details){case G.FRAG_GAP:case G.FRAG_PARSING_ERROR:case G.FRAG_DECRYPT_ERROR:case G.FRAG_LOAD_ERROR:case G.FRAG_LOAD_TIMEOUT:case G.KEY_LOAD_ERROR:case G.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ve.MAIN,t);break;case G.LEVEL_LOAD_ERROR:case G.LEVEL_LOAD_TIMEOUT:case G.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===W.WAITING_LEVEL&&((r=t.context)==null?void 0:r.type)===Ce.LEVEL&&(this.state=W.IDLE);break;case G.BUFFER_APPEND_ERROR:case G.BUFFER_FULL_ERROR:if(!t.parent||t.parent!=="main")return;if(t.details===G.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case G.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}checkBuffer(){const{media:e,gapController:t}=this;if(!(!e||!t||!e.readyState)){if(this.loadedmetadata||!Oe.getBuffered(e).length){const r=this.state!==W.IDLE?this.fragCurrent:null;t.poll(this.lastCurrentTime,r)}this.lastCurrentTime=e.currentTime}}onFragLoadEmergencyAborted(){this.state=W.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==_e.AUDIO||this.audioOnly&&!this.altAudio){const r=(t===_e.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(r,t,ve.MAIN),this.tick()}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let r=this.startPosition;if(r>=0&&t<r){if(e.seeking){this.log(`could not seek to ${r}, already seeking at ${t}`);return}const s=Oe.getBuffered(e),a=(s.length?s.start(0):0)-r;a>0&&(a<this.config.maxBufferHole||a<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${a} to match buffer start`),r+=a,this.startPosition=r),this.log(`seek to target start position ${r} from current time ${t}`),e.currentTime=r}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(r=>{const{hls:s}=this;if(!r||this.fragContextChanged(e))return;t.fragmentError=0,this.state=W.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=e.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),s.trigger(x.FRAG_LOADED,r),e.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const r="main",{hls:s}=this,{remuxResult:o,chunkMeta:a}=e,c=this.getCurrentContext(a);if(!c){this.resetWhenMissingContext(a);return}const{frag:d,part:h,level:g}=c,{video:p,text:v,id3:T,initSegment:E}=o,{details:S}=g,A=this.altAudio?void 0:o.audio;if(this.fragContextChanged(d)){this.fragmentTracker.removeFragment(d);return}if(this.state=W.PARSING,E){if(E!=null&&E.tracks){const D=d.initSegment||d;this._bufferInitSegment(g,E.tracks,D,a),s.trigger(x.FRAG_PARSING_INIT_SEGMENT,{frag:D,id:r,tracks:E.tracks})}const R=E.initPTS,k=E.timescale;se(R)&&(this.initPTS[d.cc]={baseTime:R,timescale:k},s.trigger(x.INIT_PTS_FOUND,{frag:d,id:r,initPTS:R,timescale:k}))}if(p&&S&&d.sn!=="initSegment"){const R=S.fragments[d.sn-1-S.startSN],k=d.sn===S.startSN,D=!R||d.cc>R.cc;if(o.independent!==!1){const{startPTS:N,endPTS:P,startDTS:V,endDTS:U}=p;if(h)h.elementaryStreams[p.type]={startPTS:N,endPTS:P,startDTS:V,endDTS:U};else if(p.firstKeyFrame&&p.independent&&a.id===1&&!D&&(this.couldBacktrack=!0),p.dropped&&p.independent){const j=this.getMainFwdBufferInfo(),ee=(j?j.end:this.getLoadPosition())+this.config.maxBufferHole,H=p.firstKeyFramePTS?p.firstKeyFramePTS:N;if(!k&&ee<H-this.config.maxBufferHole&&!D){this.backtrack(d);return}else D&&(d.gap=!0);d.setElementaryStreamInfo(p.type,d.start,P,d.start,U,!0)}else k&&N>ao&&(d.gap=!0);d.setElementaryStreamInfo(p.type,N,P,V,U),this.backtrackFragment&&(this.backtrackFragment=d),this.bufferFragmentData(p,d,h,a,k||D)}else if(k||D)d.gap=!0;else{this.backtrack(d);return}}if(A){const{startPTS:R,endPTS:k,startDTS:D,endDTS:N}=A;h&&(h.elementaryStreams[_e.AUDIO]={startPTS:R,endPTS:k,startDTS:D,endDTS:N}),d.setElementaryStreamInfo(_e.AUDIO,R,k,D,N),this.bufferFragmentData(A,d,h,a)}if(S&&T!=null&&(t=T.samples)!=null&&t.length){const R={id:r,frag:d,details:S,samples:T.samples};s.trigger(x.FRAG_PARSING_METADATA,R)}if(S&&v){const R={id:r,frag:d,details:S,samples:v.samples};s.trigger(x.FRAG_PARSING_USERDATA,R)}}_bufferInitSegment(e,t,r,s){if(this.state!==W.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;const{audio:o,video:a,audiovideo:c}=t;if(o){let d=e.audioCodec;const h=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){d&&(d.indexOf("mp4a.40.5")!==-1?d="mp4a.40.2":d="mp4a.40.5");const g=o.metadata;g&&"channelCount"in g&&(g.channelCount||1)!==1&&h.indexOf("firefox")===-1&&(d="mp4a.40.5")}d&&d.indexOf("mp4a.40.5")!==-1&&h.indexOf("android")!==-1&&o.container!=="audio/mpeg"&&(d="mp4a.40.2",this.log(`Android: force audio codec to ${d}`)),e.audioCodec&&e.audioCodec!==d&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${d}"`),o.levelCodec=d,o.id="main",this.log(`Init audio buffer, container:${o.container}, codecs[selected/level/parsed]=[${d||""}/${e.audioCodec||""}/${o.codec}]`)}a&&(a.levelCodec=e.videoCodec,a.id="main",this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${a.codec}]`)),c&&this.log(`Init audiovideo buffer, container:${c.container}, codecs[level/parsed]=[${e.codecs}/${c.codec}]`),this.hls.trigger(x.BUFFER_CODECS,t),Object.keys(t).forEach(d=>{const g=t[d].initSegment;g!=null&&g.byteLength&&this.hls.trigger(x.BUFFER_APPENDING,{type:d,data:g,frag:r,part:null,chunkMeta:s,parent:r.type})}),this.tickImmediate()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,ve.MAIN)}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=W.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const r=e.currentTime;if(Oe.isBuffered(e,r)?t=this.getAppendedFrag(r):Oe.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;const s=this.fragPlaying,o=t.level;(!s||t.sn!==s.sn||s.level!==o)&&(this.fragPlaying=t,this.hls.trigger(x.FRAG_CHANGED,{frag:t}),(!s||s.level!==o)&&this.hls.trigger(x.LEVEL_SWITCHED,{level:o}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){const e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get currentProgramDateTime(){const e=this.media;if(e){const t=e.currentTime,r=this.currentFrag;if(r&&se(t)&&se(r.programDateTime)){const s=r.programDateTime+(t-r.start)*1e3;return new Date(s)}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class mn{static get version(){return"1.5.17"}static isMSESupported(){return N0()}static isSupported(){return nT()}static getMediaSource(){return nr()}static get Events(){return x}static get ErrorTypes(){return Se}static get ErrorDetails(){return G}static get DefaultConfig(){return mn.defaultConfig?mn.defaultConfig:b0}static set DefaultConfig(e){mn.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new yu,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,Qm(e.debug||!1,"Hls instance");const t=this.config=JE(mn.DefaultConfig,e);this.userConfig=e,t.progressive&&ZE(t);const{abrController:r,bufferController:s,capLevelController:o,errorController:a,fpsController:c}=t,d=new a(this),h=this.abrController=new r(this),g=this.bufferController=new s(this),p=this.capLevelController=new o(this),v=new c(this),T=new zp(this),E=new Xp(this),S=t.contentSteeringController,A=S?new S(this):null,R=this.levelController=new eT(this,A),k=new Ry(this),D=new tT(this.config),N=this.streamController=new uT(this,k,D);p.setStreamController(N),v.setStreamController(N);const P=[T,R,N];A&&P.splice(1,0,A),this.networkControllers=P;const V=[h,g,p,v,E,k];this.audioTrackController=this.createController(t.audioTrackController,P);const U=t.audioStreamController;U&&P.push(new U(this,k,D)),this.subtitleTrackController=this.createController(t.subtitleTrackController,P);const j=t.subtitleStreamController;j&&P.push(new j(this,k,D)),this.createController(t.timelineController,V),D.emeController=this.emeController=this.createController(t.emeController,V),this.cmcdController=this.createController(t.cmcdController,V),this.latencyController=this.createController(Qp,V),this.coreComponents=V,P.push(d);const ee=d.onErrorOut;typeof ee=="function"&&this.on(x.ERROR,ee,d)}createController(e,t){if(e){const r=new e(this);return t&&t.push(r),r}return null}on(e,t,r=this){this._emitter.on(e,t,r)}once(e,t,r=this){this._emitter.once(e,t,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,r=this,s){this._emitter.off(e,t,r,s)}listeners(e){return this._emitter.listeners(e)}emit(e,t,r){return this._emitter.emit(e,t,r)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(r){if(F.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),!this.triggeringException){this.triggeringException=!0;const s=e===x.ERROR;this.trigger(x.ERROR,{type:Se.OTHER_ERROR,details:G.INTERNAL_EXCEPTION,fatal:s,event:e,error:r}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){F.log("destroy"),this.trigger(x.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){F.log("attachMedia"),this._media=e,this.trigger(x.MEDIA_ATTACHING,{media:e})}detachMedia(){F.log("detachMedia"),this.trigger(x.MEDIA_DETACHING,void 0),this._media=null}loadSource(e){this.stopLoad();const t=this.media,r=this.url,s=this.url=iu.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,F.log(`loadSource:${s}`),t&&r&&(r!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(x.MANIFEST_LOADING,{url:e})}startLoad(e=-1){F.log(`startLoad(${e})`),this.started=!0,this.networkControllers.forEach(t=>{t.startLoad(e)})}stopLoad(){F.log("stopLoad"),this.started=!1,this.networkControllers.forEach(e=>{e.stopLoad()})}resumeBuffering(){this.started&&this.networkControllers.forEach(e=>{"fragmentLoader"in e&&e.startLoad(-1)})}pauseBuffering(){this.networkControllers.forEach(e=>{"fragmentLoader"in e&&e.stopLoad()})}swapAudioCodec(){F.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){F.log("recoverMediaError");const e=this._media;this.detachMedia(),e&&this.attachMedia(e)}removeLevel(e){this.levelController.removeLevel(e)}get levels(){const e=this.levelController.levels;return e||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){F.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){F.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){F.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){F.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){F.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(F.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){Jp(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const r=e.length;for(let s=0;s<r;s++)if(e[s].maxBitrate>=t)return s;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:r}=this;let s;if(t===-1&&e!=null&&e.length?s=e.length-1:s=t,r)for(let o=s;o--;){const a=e[o].attrs["HDCP-LEVEL"];if(a&&a<=r)return o}return s}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}setAudioOption(e){var t;return(t=this.audioTrackController)==null?void 0:t.setAudioOption(e)}setSubtitleOption(e){var t;return(t=this.subtitleTrackController)==null||t.setSubtitleOption(e),null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}mn.defaultConfig=void 0;const lo={1:{name:"안전모 미착용",color:"#0ca678"},2:{name:"안전 조끼 미착용",color:"#f76707"},5:{name:"중장비",color:"#d6336c"},6:{name:"자동차",color:"#ae3ec9"},7:{name:"낙상",color:"#f59f00"},8:{name:"보행 중 휴대폰 사용",color:"#495057"},9:{name:"구조 요청",color:"#f03e3e"}},Dh=640;function cT(){var v,T;const l=Jn.useRef(null),[e,t]=Jn.useState(null),[r,s]=Jn.useState([]),[o,a]=Jn.useState(null),c=(((v=l.current)==null?void 0:v.clientHeight)??0)/Dh,d=(((T=l.current)==null?void 0:T.clientWidth)??0)/Dh,h=()=>{l.current&&(l.current.currentTime=l.current.duration-2)},g=({details:{fragments:E}})=>{var k;const S=E[E.length-1];if(!S)return;const A=S.start,R=JSON.parse(((k=S.tagList.find(D=>D[0]==="BOUNDING-BOX"))==null?void 0:k[1])??"[]");R.length!==0&&s(D=>[...D,{id:R[0].image_id,start:A,end:A+S.duration,items:R.filter(({category_id:N})=>N in lo).map(({bbox:N,category_id:P})=>({x:N[0]-N[2]/2,y:N[1]-N[3]/2,width:N[2],height:N[3],categoryId:P}))}])},p=({currentTarget:{currentTime:E}})=>{r.length>0&&r[0].start<=E?(a(r[0]),s(S=>S.slice(1))):o&&o.end<=E&&a(null)};return Jn.useEffect(()=>{if(mn.isSupported()&&e){const E=new mn;E.loadSource(e),E.on(mn.Events.LEVEL_PTS_UPDATED,(S,A)=>g(A)),l.current&&E.attachMedia(l.current)}},[e]),Jn.useEffect(()=>{const E=S=>t(S.data);return window.addEventListener("message",E),document.addEventListener("message",E),()=>{window.removeEventListener("message",E),document.removeEventListener("message",E)}},[]),e?Nn.jsxs("div",{style:{position:"relative",width:"100vw",height:"100vh",background:"rgba(0, 0, 0, 0.5)"},children:[Nn.jsx("video",{ref:l,src:e,autoPlay:!0,muted:!0,controls:!0,style:{width:"100%",height:"100%",objectFit:"contain"},onLoadedMetadata:h,onTimeUpdate:p}),o==null?void 0:o.items.map(({x:E,y:S,width:A,height:R,categoryId:k},D)=>Nn.jsx(dT,{top:c*S,left:d*E,width:d*A,height:c*R,categoryId:k},D))]}):null}function dT({top:l,left:e,width:t,height:r,categoryId:s}){return Nn.jsx("div",{style:{overflow:"visible",display:"flex",alignItems:"flex-start",position:"absolute",top:l,left:e,width:t,height:r,border:`0.3vw solid ${lo[s].color}`},children:Nn.jsx("div",{style:{margin:"-0.3vw 0 0 -0.3vw",padding:"0.2vw 0.4vw",background:lo[s].color,fontSize:"0.7vw",fontWeight:"bold",color:"#ffffff",wordBreak:"keep-all"},children:lo[s].name})})}Km.createRoot(document.getElementById("root")).render(Nn.jsxs(Jn.StrictMode,{children:[Nn.jsx("style",{children:`
        @import url("https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard-dynamic-subset.min.css");
      
        * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
          font-family: "Pretendard", sans-serif;
          }`}),Nn.jsx(cT,{})]}));</script>
  </head>
  <body>
    <div id="root"></div>
  </body>
</html>
